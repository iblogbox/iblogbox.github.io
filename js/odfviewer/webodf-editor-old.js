var giseditor=!0,gdocumentType,clicktimer,gstyleParseUtils,godfcontainer,historylist=[],newaddlist=[];window.addEventListener&&window.addEventListener("hashchange",function(){var m=window.location.hash;if(m)for(var e=0;e<=historylist.length-1;e++)if(historylist[e].url==m){clearTimeout(clicktimer);clicktimer=setTimeout(function(){try{historylist[e].node.scrollIntoView(!0)}catch(h){}},100);break}});var g_errmsg=function(m){proc_g_errmsg&&proc_g_errmsg(m)},webodf_version="0.5.9";
function Runtime(){}Runtime.prototype.getVariable=function(m){};Runtime.prototype.toJson=function(m){};Runtime.prototype.fromJson=function(m){};Runtime.prototype.byteArrayFromString=function(m,e){};Runtime.prototype.byteArrayToString=function(m,e){};Runtime.prototype.read=function(m,e,h,b){};Runtime.prototype.readFile=function(m,e,h){};Runtime.prototype.readFileSync=function(m,e){};Runtime.prototype.loadXML=function(m,e){};Runtime.prototype.writeFile=function(m,e,h){};
Runtime.prototype.deleteFile=function(m,e){};Runtime.prototype.log=function(m,e){};Runtime.prototype.setTimeout=function(m,e){};Runtime.prototype.clearTimeout=function(m){};Runtime.prototype.libraryPaths=function(){};Runtime.prototype.currentDirectory=function(){};Runtime.prototype.setCurrentDirectory=function(m){};Runtime.prototype.type=function(){};Runtime.prototype.getDOMImplementation=function(){};Runtime.prototype.parseXML=function(m){};Runtime.prototype.exit=function(m){};
Runtime.prototype.getWindow=function(){};Runtime.prototype.requestAnimationFrame=function(m){};Runtime.prototype.cancelAnimationFrame=function(m){};Runtime.prototype.assert=function(m,e){};var IS_COMPILED_CODE=!0;
Runtime.byteArrayToString=function(m,e){function h(b){var l="",f,p=b.length;for(f=0;f<p;f+=1)l+=String.fromCharCode(b[f]&255);return l}function b(b){var l="",f,p=b.length,d=[],n,a,c,k;for(f=3<=p&&239===b[0]&&187===b[1]&&191===b[2]?3:0;f<p;f+=1)n=b[f],128>n?d.push(n):(f+=1,a=b[f],194<=n&&224>n?d.push((n&31)<<6|a&63):(f+=1,c=b[f],224<=n&&240>n?d.push((n&15)<<12|(a&63)<<6|c&63):(f+=1,k=b[f],240<=n&&245>n&&(n=(n&7)<<18|(a&63)<<12|(c&63)<<6|k&63,n-=65536,d.push((n>>10)+55296,(n&1023)+56320))))),1E3<=d.length&&
(l+=String.fromCharCode.apply(null,d),d.length=0);return l+String.fromCharCode.apply(null,d)}var f;"utf8"===e?f=b(m):("binary"!==e&&this.log("Unsupported encoding: "+e),f=h(m));return f};Runtime.getVariable=function(m){try{return eval(m)}catch(e){}};Runtime.toJson=function(m){return JSON.stringify(m)};Runtime.fromJson=function(m){return JSON.parse(m)};Runtime.getFunctionName=function(m){return void 0===m.name?(m=/function\s+(\w+)/.exec(m))&&m[1]:m.name};
Runtime.assert=function(m,e){if(!m)throw this.log("alert","ASSERTION FAILED:\n"+e),Error(e);};
function BrowserRuntime(){function m(b){var d=b.length,n,a,c=0;for(n=0;n<d;n+=1)a=b.charCodeAt(n),c+=1+(128<a)+(2048<a),55040<a&&57344>a&&(c+=1,n+=1);return c}function e(b,d,n){var a=b.length,c,k;d=new Uint8Array(new ArrayBuffer(d));n?(d[0]=239,d[1]=187,d[2]=191,k=3):k=0;for(n=0;n<a;n+=1)c=b.charCodeAt(n),128>c?(d[k]=c,k+=1):2048>c?(d[k]=192|c>>>6,d[k+1]=128|c&63,k+=2):55040>=c||57344<=c?(d[k]=224|c>>>12&15,d[k+1]=128|c>>>6&63,d[k+2]=128|c&63,k+=3):(n+=1,c=(c-55296<<10|b.charCodeAt(n)-56320)+65536,
d[k]=240|c>>>18&7,d[k+1]=128|c>>>12&63,d[k+2]=128|c>>>6&63,d[k+3]=128|c&63,k+=4);return d}function h(b){var d=b.length,n=new Uint8Array(new ArrayBuffer(d)),a;for(a=0;a<d;a+=1)n[a]=b.charCodeAt(a)&255;return n}function b(b,d){var n;void 0!==d?n=b:d=b;console.log(d);q.enableAlerts&&"alert"===n&&alert(d)}function f(b,d,n){if(0!==n.status||n.responseText)if(200===n.status||0===n.status){if(n.response&&"string"!==typeof n.response)"binary"===d?(n=n.response,n=new Uint8Array(n)):n=String(n.response);else if("binary"===
d)if(null!==n.responseBody&&"undefined"!==String(typeof VBArray)){n=(new VBArray(n.responseBody)).toArray();var a=n.length;d=new Uint8Array(new ArrayBuffer(a));for(b=0;b<a;b+=1)d[b]=n[b];n=d}else{(b=n.getResponseHeader("Content-Length"))&&(b=parseInt(b,10));if(b&&b!==n.responseText.length)a:{a=n.responseText;d=!1;var c=m(a);if("number"===typeof b){if(b!==c&&b!==c+3){a=void 0;break a}d=c+3===b;c=b}a=e(a,c,d)}void 0===a&&(a=h(n.responseText));n=a}else n=n.responseText;n={err:null,data:n}}else n={err:n.responseText||
n.statusText,data:null};else n={err:"File "+b+" is empty.",data:null};return n}function g(b,d,n){var a=new XMLHttpRequest;a.open("GET",b,n);a.overrideMimeType&&("binary"!==d?a.overrideMimeType("text/plain; charset="+d):a.overrideMimeType("text/plain; charset=x-user-defined"));return a}function l(b,d,n){function a(a){var c=document.getElementById("canvas");if(c)c.innerHTML='<div style="font-size:14px;padding:5px">'+a+'<span id="inner_progress"></span></div>';else if(c=document.getElementById("webodfeditor-canvas1"))if(c.innerHTML=
'<div style="font-size:14px;padding:10px">'+a+'<span id="inner_progress"></span></div>',c=document.getElementById("webodfeditor-canvascontainer1"))c.scrollTop=0}
	b=b || '';
	var accessToken=b.split("&access_token=")[1];
	var match=b.match(/\/files\/(.*?)\?alt=media/i);
	if(match && match[1]) b='https://www.googleapis.com/drive/v2/files/'+match[1]+'?alt=media';
	var c=g(b,d,!0);
	if(accessToken) c.setRequestHeader('Authorization', 'Bearer ' + accessToken);
c.onreadystatechange=function(){var k;4===c.readyState&&(a("Loading the file... Please wait..."),setTimeout(function(){k=f(b,d,c);n(k.err,k.data)},10))};if(b)if(0==b.toLowerCase().indexOf("blob"))a("Loading the file... Please wait...");else{a("Downloading the file... Please wait...");var k=(new Date).getTime();c.onprogress=
function(a){if(k){var c=new Date;if(300>c.getTime()-k)return;k=c.getTime()}c=a.totalSize||a.total||0;0==c&&"undefined"!==typeof g_docsize&&(c=g_docsize||0);1.8446744073709552E19<=c&&(c=0);a=a.position||a.loaded||0;var r=document.getElementById("inner_progress");r&&(r.innerHTML=" ("+number_format(a)+"/"+number_format(c)+")")}}try{c.send(null)}catch(r){a("Loading..."),n(r.message,null)}}var q=this;this.byteArrayFromString=function(b,d){var n;"utf8"===d?n=e(b,m(b),!1):("binary"!==d&&q.log("unknown encoding: "+
d),n=h(b));return n};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.readFile=l;this.read=function(b,d,n,a){l(b,"binary",function(c,k){var r=null;if(k){if("string"===typeof k)throw"This should not happen.";r=k.subarray(d,d+n)}a(c,r)})};this.readFileSync=function(b,d){var n=g(b,d,!1),a;try{n.send(null);a=f(b,d,n);if(a.err)throw a.err;if(null===a.data)throw"No data read from "+b+".";}catch(c){throw c;
}return a.data};this.writeFile=function(b,d,n){var a=new XMLHttpRequest,c;a.open("PUT",b,!0);a.onreadystatechange=function(){4===a.readyState&&(0!==a.status||a.responseText?200<=a.status&&300>a.status||0===a.status?n(null):n("Status "+String(a.status)+": "+a.responseText||a.statusText):n("File "+b+" is empty."))};c=d.buffer&&!a.sendAsBinary?d.buffer:q.byteArrayToString(d,"binary");try{a.sendAsBinary?a.sendAsBinary(c):a.send(c)}catch(k){q.log("HUH? "+k+" "+d),n(k.message)}};this.deleteFile=function(b,
d){var n=new XMLHttpRequest;n.open("DELETE",b,!0);n.onreadystatechange=function(){4===n.readyState&&(200>n.status&&300<=n.status?d(n.responseText):d(null))};n.send(null)};this.loadXML=function(b,d){var n=new XMLHttpRequest;n.open("GET",b,!0);n.overrideMimeType&&n.overrideMimeType("text/xml");n.onreadystatechange=function(){4===n.readyState&&(0!==n.status||n.responseText?200===n.status||0===n.status?d(null,n.responseXML):d(n.responseText,null):d("File "+b+" is empty.",null))};try{n.send(null)}catch(a){d(a.message,
null)}};this.log=b;this.enableAlerts=!0;this.assert=Runtime.assert;this.setTimeout=function(b,d){return setTimeout(function(){b()},d)};this.clearTimeout=function(b){clearTimeout(b)};this.libraryPaths=function(){return["lib"]};this.setCurrentDirectory=function(){};this.currentDirectory=function(){return""};this.type=function(){return"BrowserRuntime"};this.getDOMImplementation=function(){return window.document.implementation};this.parseXML=function(b){var d=new DOMParser;b&&(b=b.trim());return d.parseFromString(b,
"text/xml")};this.exit=function(l){b("Calling exit with code "+String(l)+", but exit() is not implemented.")};this.getWindow=function(){return window};this.requestAnimationFrame=function(b){var d=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,n=0;if(d)d.bind(window),n=d(b);else return setTimeout(b,15);return n};this.cancelAnimationFrame=function(b){var d=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||
window.mozCancelAnimationFrame||window.msCancelAnimationFrame;d?(d.bind(window),d(b)):clearTimeout(b)}}
function NodeJSRuntime(){function m(b){var d=b.length,n,a=new Uint8Array(new ArrayBuffer(d));for(n=0;n<d;n+=1)a[n]=b[n];return a}function e(l,d,n){function a(a,k){if(a)return n(a,null);if(!k)return n("No data for "+l+".",null);if("string"===typeof k)return n(a,k);n(a,m(k))}l=f.resolve(g,l);"binary"!==d?b.readFile(l,d,a):b.readFile(l,null,a)}var h=this,b=require("fs"),f=require("path"),g="",l,q;this.byteArrayFromString=function(b,d){var n=new Buffer(b,d),a,c=n.length,k=new Uint8Array(new ArrayBuffer(c));
for(a=0;a<c;a+=1)k[a]=n[a];return k};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.readFile=e;this.loadXML=function(b,d){alert("2"+b);e(b,"utf-8",function(n,a){if(n)return d(n,null);if(!a)return d("No data for "+b+".",null);d(null,h.parseXML(a))})};this.writeFile=function(l,d,n){d=new Buffer(d);l=f.resolve(g,l);b.writeFile(l,d,"binary",function(a){n(a||null)})};this.deleteFile=function(l,d){l=f.resolve(g,
l);b.unlink(l,d)};this.read=function(l,d,n,a){l=f.resolve(g,l);b.open(l,"r+",666,function(c,k){if(c)a(c,null);else{var r=new Buffer(n);b.read(k,r,0,n,d,function(c){b.close(k);a(c,m(r))})}})};this.readFileSync=function(l,d){var n;n=b.readFileSync(l,"binary"===d?null:d);if(null===n)throw"File "+l+" could not be read.";"binary"===d&&(n=m(n));return n};this.log=function(b,d){var l;void 0!==d?l=b:d=b;"alert"===l&&process.stderr.write("\n!!!!! ALERT !!!!!\n");process.stderr.write(d+"\n");"alert"===l&&process.stderr.write("!!!!! ALERT !!!!!\n")};
this.assert=Runtime.assert;this.setTimeout=function(b,d){return setTimeout(function(){b()},d)};this.clearTimeout=function(b){clearTimeout(b)};this.libraryPaths=function(){return[__dirname]};this.setCurrentDirectory=function(b){g=b};this.currentDirectory=function(){return g};this.type=function(){return"NodeJSRuntime"};this.getDOMImplementation=function(){return q};this.parseXML=function(b){b&&(b=b.trim());return l.parseFromString(b,"text/xml")};this.exit=process.exit;this.getWindow=function(){return null};
this.requestAnimationFrame=function(b){return setTimeout(b,15)};this.cancelAnimationFrame=function(b){clearTimeout(b)};l=new (require("xmldom").DOMParser);q=h.parseXML("<a/>").implementation}
function RhinoRuntime(){var m=this,e={},h=e.javax.xml.parsers.DocumentBuilderFactory.newInstance(),b,f,g="";h.setValidating(!1);h.setNamespaceAware(!0);h.setExpandEntityReferences(!1);h.setSchema(null);f=e.org.xml.sax.EntityResolver({resolveEntity:function(b,f){var g=new e.java.io.FileReader(f);return new e.org.xml.sax.InputSource(g)}});b=h.newDocumentBuilder();b.setEntityResolver(f);this.byteArrayFromString=function(b,f){var g,d=b.length,n=new Uint8Array(new ArrayBuffer(d));for(g=0;g<d;g+=1)n[g]=
b.charCodeAt(g)&255;return n};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.loadXML=function(l,f){var g=new e.java.io.File(l),d=null;try{d=b.parse(g)}catch(n){return print(n),f(n,null)}f(null,d)};this.readFile=function(b,f,h){g&&(b=g+"/"+b);var d=new e.java.io.File(b),n="binary"===f?"latin1":f;d.isFile()?((b=readFile(b,n))&&"binary"===f&&(b=m.byteArrayFromString(b,"binary")),h(null,b)):h(b+" is not a file.",
null)};this.writeFile=function(b,f,h){g&&(b=g+"/"+b);b=new e.java.io.FileOutputStream(b);var d,n=f.length;for(d=0;d<n;d+=1)b.write(f[d]);b.close();h(null)};this.deleteFile=function(b,f){g&&(b=g+"/"+b);var h=new e.java.io.File(b),d=b+Math.random(),d=new e.java.io.File(d);h.rename(d)?(d.deleteOnExit(),f(null)):f("Could not delete "+b)};this.read=function(b,f,h,d){g&&(b=g+"/"+b);var n;n=b;var a="binary";(new e.java.io.File(n)).isFile()?("binary"===a&&(a="latin1"),n=readFile(n,a)):n=null;n?d(null,this.byteArrayFromString(n.substring(f,
f+h),"binary")):d("Cannot read "+b,null)};this.readFileSync=function(b,f){if(!f)return"";var g=readFile(b,f);if(null===g)throw"File could not be read.";return g};this.log=function(b,f){var g;void 0!==f?g=b:f=b;"alert"===g&&print("\n!!!!! ALERT !!!!!");print(f);"alert"===g&&print("!!!!! ALERT !!!!!")};this.assert=Runtime.assert;this.setTimeout=function(b){b();return 0};this.clearTimeout=function(){};this.libraryPaths=function(){return["lib"]};this.setCurrentDirectory=function(b){g=b};this.currentDirectory=
function(){return g};this.type=function(){return"RhinoRuntime"};this.getDOMImplementation=function(){return b.getDOMImplementation()};this.parseXML=function(f){f=new e.java.io.StringReader(f);f=new e.org.xml.sax.InputSource(f);return b.parse(f)};this.exit=quit;this.getWindow=function(){return null};this.requestAnimationFrame=function(b){b();return 0};this.cancelAnimationFrame=function(){}}
Runtime.create=function(){return"undefined"!==String(typeof window)?new BrowserRuntime:"undefined"!==String(typeof require)?new NodeJSRuntime:new RhinoRuntime};var runtime=Runtime.create(),core={},gui={},xmldom={},odf={},ops={},webodf={};(function(){webodf.Version="undefined"!==String(typeof webodf_version)?webodf_version:"From Source"})();
(function(){function m(b,f,d){var n=b+"/manifest.json",a,c;runtime.log("Loading manifest: "+n);try{a=runtime.readFileSync(n,"utf-8")}catch(k){if(d)runtime.log("No loadable manifest found.");else throw console.log(String(k)),k;return}d=JSON.parse(a);for(c in d)d.hasOwnProperty(c)&&(f[c]={dir:b,deps:d[c]})}function e(b,f,d){function n(r){if(!k[r]&&!d(r)){if(c[r])throw"Circular dependency detected for "+r+".";c[r]=!0;if(!f[r])throw"Missing dependency information for class "+r+".";var b=f[r],g=b.deps,
l,e=g.length;for(l=0;l<e;l+=1)n(g[l]);c[r]=!1;k[r]=!0;a.push(b.dir+"/"+r.replace(".","/")+".js")}}var a=[],c={},k={};b.forEach(n);return a}function h(b,f){return f+("\n//# sourceURL="+b)}function b(b){var f,d;for(f=0;f<b.length;f+=1)d=runtime.readFileSync(b[f],"utf-8"),d=h(b[f],d),eval(d)}function f(b){b=b.split(".");var f,d=l,n=b.length;for(f=0;f<n;f+=1){if(!d.hasOwnProperty(b[f]))return!1;d=d[b[f]]}return!0}var g,l={core:core,gui:gui,xmldom:xmldom,odf:odf,ops:ops};runtime.loadClasses=function(l,
h){if(IS_COMPILED_CODE||0===l.length)return h&&h();var d;if(!(d=g)){d=[];var n=runtime.libraryPaths(),a;runtime.currentDirectory()&&-1===n.indexOf(runtime.currentDirectory())&&m(runtime.currentDirectory(),d,!0);for(a=0;a<n.length;a+=1)m(n[a],d)}g=d;l=e(l,g,f);if(0===l.length)return h&&h();if("BrowserRuntime"===runtime.type()&&h){d=l;n=document.currentScript||document.documentElement.lastChild;a=document.createDocumentFragment();var c,k;for(k=0;k<d.length;k+=1)c=document.createElement("script"),c.type=
"text/javascript",c.charset="utf-8",c.async=!1,c.setAttribute("src",d[k]),a.appendChild(c);h&&(c.onload=h);n.parentNode.insertBefore(a,n)}else b(l),h&&h()};runtime.loadClass=function(b,f){runtime.loadClasses([b],f)}})();(function(){var m=function(e){return e};runtime.getTranslator=function(){return m};runtime.setTranslator=function(e){m=e};runtime.tr=function(e){var h=m(e);return h&&"string"===String(typeof h)?h:e}})();
(function(m){function e(e){if(e.length){var b=e[0];runtime.readFile(b,"utf8",function(f,g){function l(){var b;(b=eval(p))&&runtime.exit(b)}var q="",q=b.lastIndexOf("/"),p=g,q=-1!==q?b.substring(0,q):".";runtime.setCurrentDirectory(q);f?(runtime.log(f),runtime.exit(1)):null===p?(runtime.log("No code found for "+b),runtime.exit(1)):l.apply(null,e)})}}m=m?Array.prototype.slice.call(m):[];"NodeJSRuntime"===runtime.type()?e(process.argv.slice(2)):"RhinoRuntime"===runtime.type()?e(m):e(m.slice(1))})("undefined"!==
String(typeof arguments)&&arguments);(function(){core.Async=function(){return{forEach:function(m,e,h){function b(b){l!==g&&(b?(l=g,h(b)):(l+=1,l===g&&h(null)))}var f,g=m.length,l=0;for(f=0;f<g;f+=1)e(m[f],b)},destroyAll:function(m,e){function h(b,f){if(f)e(f);else if(b<m.length)m[b](function(f){h(b+1,f)});else e()}h(0,void 0)}}}()})();
function makeBase64(){function m(a){var c,k=a.length,r=new Uint8Array(new ArrayBuffer(k));for(c=0;c<k;c+=1)r[c]=a.charCodeAt(c)&255;return r}function e(a){var c,k="",r,b=a.length-2;for(r=0;r<b;r+=3)c=a[r]<<16|a[r+1]<<8|a[r+2],k+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c>>>18],k+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c>>>12&63],k+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c>>>6&63],k+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c&
63];r===b+1?(c=a[r]<<4,k+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c>>>6],k+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c&63],k+="=="):r===b&&(c=a[r]<<10|a[r+1]<<2,k+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c>>>12],k+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c>>>6&63],k+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c&63],k+="=");return k}function h(a){a=a.replace(/[^A-Za-z0-9+\/]+/g,
"");var c=a.length,k=new Uint8Array(new ArrayBuffer(3*c)),b=a.length%4,d=0,f,s;for(f=0;f<c;f+=4)s=(r[a.charAt(f)]||0)<<18|(r[a.charAt(f+1)]||0)<<12|(r[a.charAt(f+2)]||0)<<6|(r[a.charAt(f+3)]||0),k[d]=s>>16,k[d+1]=s>>8&255,k[d+2]=s&255,d+=3;c=3*c-[0,0,2,1][b];return k.subarray(0,c)}function b(a){var c,k,r=a.length,b=0,d=new Uint8Array(new ArrayBuffer(3*r));for(c=0;c<r;c+=1)k=a[c],128>k?d[b++]=k:(2048>k?d[b++]=192|k>>>6:(d[b++]=224|k>>>12&15,d[b++]=128|k>>>6&63),d[b++]=128|k&63);return d.subarray(0,
b)}function f(a){var c,k,r,b,d=a.length,s=new Uint8Array(new ArrayBuffer(d)),f=0;for(c=0;c<d;c+=1)k=a[c],128>k?s[f++]=k:(c+=1,r=a[c],224>k?s[f++]=(k&31)<<6|r&63:(c+=1,b=a[c],s[f++]=(k&15)<<12|(r&63)<<6|b&63));return s.subarray(0,f)}function g(a){return e(m(a))}function l(a){return String.fromCharCode.apply(String,h(a))}function q(a){return f(m(a))}function p(a){a=f(a);for(var c="",k=0;k<a.length;)c+=String.fromCharCode.apply(String,a.subarray(k,k+45E3)),k+=45E3;return c}function d(a,c,k){var r,b,
d,s="";for(d=c;d<k;d+=1)c=a.charCodeAt(d)&255,128>c?s+=String.fromCharCode(c):(d+=1,r=a.charCodeAt(d)&255,224>c?s+=String.fromCharCode((c&31)<<6|r&63):(d+=1,b=a.charCodeAt(d)&255,s+=String.fromCharCode((c&15)<<12|(r&63)<<6|b&63)));return s}function n(a,c){function k(){var f=b+1E5;f>a.length&&(f=a.length);r+=d(a,b,f);b=f;f=b===a.length;c(r,f)&&!f&&runtime.setTimeout(k,0)}var r="",b=0;1E5>a.length?c(d(a,0,a.length),!0):("string"!==typeof a&&(a=a.slice()),k())}function a(a){return b(m(a))}function c(a){return String.fromCharCode.apply(String,
b(a))}function k(a){return String.fromCharCode.apply(String,b(m(a)))}var r=function(a){var c={},k,r;k=0;for(r=a.length;k<r;k+=1)c[a.charAt(k)]=k;return c}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),B,y,z=runtime.getWindow(),v,A;z&&z.btoa?(v=z.btoa,B=function(a){return v(k(a))}):(v=g,B=function(c){return e(a(c))});z&&z.atob?(A=z.atob,y=function(a){a=A(a);return d(a,0,a.length)}):(A=l,y=function(a){return p(h(a))});core.Base64=function(){this.convertByteArrayToBase64=this.convertUTF8ArrayToBase64=
e;this.convertBase64ToByteArray=this.convertBase64ToUTF8Array=h;this.convertUTF16ArrayToByteArray=this.convertUTF16ArrayToUTF8Array=b;this.convertByteArrayToUTF16Array=this.convertUTF8ArrayToUTF16Array=f;this.convertUTF8StringToBase64=g;this.convertBase64ToUTF8String=l;this.convertUTF8StringToUTF16Array=q;this.convertByteArrayToUTF16String=this.convertUTF8ArrayToUTF16String=p;this.convertUTF8StringToUTF16String=n;this.convertUTF16StringToByteArray=this.convertUTF16StringToUTF8Array=a;this.convertUTF16ArrayToUTF8String=
c;this.convertUTF16StringToUTF8String=k;this.convertUTF16StringToBase64=B;this.convertBase64ToUTF16String=y;this.fromBase64=l;this.toBase64=g;this.atob=A;this.btoa=v;this.utob=k;this.btou=n;this.encode=B;this.encodeURI=function(a){return B(a).replace(/[+\/]/g,function(a){return"+"===a?"-":"_"}).replace(/\\=+$/,"")};this.decode=function(a){return y(a.replace(/[\-_]/g,function(a){return"-"===a?"+":"/"}))};return this};return core.Base64}core.Base64=makeBase64();
core.CSSUnits=function(){var m=this,e={"in":1,cm:2.54,mm:25.4,pt:72,pc:12,px:96};this.convert=function(h,b,f){return h*e[f]/e[b]};this.convertMeasure=function(e,b){var f,g;e&&b&&(f=parseFloat(e),g=e.replace(f.toString(),""),f=m.convert(f,g,b));return f};this.getUnits=function(e){return e.substr(e.length-2,e.length)}};
(function(){function m(){var b,f,g,l,e,p,d,n,a;void 0===h&&(f=(b=runtime.getWindow())&&b.document,p=f.documentElement,d=f.body,h={rangeBCRIgnoresElementBCR:!1,unscaledRangeClientRects:!1,elementBCRIgnoresBodyScroll:!1},f&&(l=f.createElement("div"),l.style.position="absolute",l.style.left="-99999px",l.style.transform="scale(2)",l.style["-webkit-transform"]="scale(2)",e=f.createElement("div"),l.appendChild(e),d.appendChild(l),b=f.createRange(),b.selectNode(e),h.rangeBCRIgnoresElementBCR=0===b.getClientRects().length,
e.appendChild(f.createTextNode("Rect transform test")),f=e.getBoundingClientRect(),g=b.getBoundingClientRect(),h.unscaledRangeClientRects=2<Math.abs(f.height-g.height),l.style.transform="",l.style["-webkit-transform"]="",f=p.style.overflow,g=d.style.overflow,n=d.style.height,a=d.scrollTop,p.style.overflow="visible",d.style.overflow="visible",d.style.height="200%",d.scrollTop=d.scrollHeight,h.elementBCRIgnoresBodyScroll=b.getBoundingClientRect().top!==e.getBoundingClientRect().top,d.scrollTop=a,d.style.height=
n,d.style.overflow=g,p.style.overflow=f,b.detach(),d.removeChild(l),b=Object.keys(h).map(function(a){return a+":"+String(h[a])}).join(", "),runtime.log("Detected browser quirks - "+b)));return h}function e(b,f,g){for(b=b?b.firstElementChild:null;b;){if(b.localName===g&&b.namespaceURI===f)return b;b=b.nextElementSibling}return null}var h;core.DomUtilsImpl=function(){function b(a,c){for(var b=0,d;a.parentNode!==c;)runtime.assert(null!==a.parentNode,"parent is null"),a=a.parentNode;for(d=c.firstChild;d!==
a;)b+=1,d=d.nextSibling;return b}function f(a,c){return 0>=a.compareBoundaryPoints(Range.START_TO_START,c)&&0<=a.compareBoundaryPoints(Range.END_TO_END,c)}function g(a,c){return 0>=a.compareBoundaryPoints(Range.END_TO_START,c)&&0<=a.compareBoundaryPoints(Range.START_TO_END,c)}function l(a,c){var b=null;a.nodeType===Node.TEXT_NODE&&(0===a.length?(a.parentNode.removeChild(a),c.nodeType===Node.TEXT_NODE&&(b=c)):(c.nodeType===Node.TEXT_NODE&&(a.appendData(c.data),c.parentNode.removeChild(c)),b=a));return b}
function h(a){for(var c=a.parentNode;a.firstChild;)c.insertBefore(a.firstChild,a);c.removeChild(a);return c}function p(a,c){var b=a.parentNode,d=a.firstChild,f=c(a),n;if(f===NodeFilter.FILTER_SKIP)return b;for(;d;)n=d.nextSibling,p(d,c),d=n;b&&f===NodeFilter.FILTER_REJECT&&h(a);return b}function d(a,c){return a===c||Boolean(a.compareDocumentPosition(c)&Node.DOCUMENT_POSITION_CONTAINED_BY)}function n(a,c){return m().unscaledRangeClientRects?a:a/c}function a(c,b,d){Object.keys(b).forEach(function(f){var n=
f.split(":"),g=n[1],l=d(n[0]),n=b[f],e=typeof n;"object"===e?Object.keys(n).length&&(f=l?c.getElementsByTagNameNS(l,g)[0]||c.ownerDocument.createElementNS(l,f):c.getElementsByTagName(g)[0]||c.ownerDocument.createElement(f),c.appendChild(f),a(f,n,d)):l&&(runtime.assert("number"===e||"string"===e,"attempting to map unsupported type '"+e+"' (key: "+f+")"),c.setAttributeNS(l,f,String(n)))})}var c=null;this.splitBoundaries=function(a){var c,d=[],f,n,g;if(a.startContainer.nodeType===Node.TEXT_NODE||a.endContainer.nodeType===
Node.TEXT_NODE){f=a.endContainer;n=a.endContainer.nodeType!==Node.TEXT_NODE?a.endOffset===a.endContainer.childNodes.length:!1;g=a.endOffset;c=a.endContainer;if(g<c.childNodes.length)for(c=c.childNodes.item(g),g=0;c.firstChild;)c=c.firstChild;else for(;c.lastChild;)c=c.lastChild,g=c.nodeType===Node.TEXT_NODE?c.textContent.length:c.childNodes.length;c===f&&(f=null);a.setEnd(c,g);g=a.endContainer;0!==a.endOffset&&g.nodeType===Node.TEXT_NODE&&(c=g,a.endOffset!==c.length&&(d.push(c.splitText(a.endOffset)),
d.push(c)));g=a.startContainer;0!==a.startOffset&&g.nodeType===Node.TEXT_NODE&&(c=g,a.startOffset!==c.length&&(g=c.splitText(a.startOffset),d.push(c),d.push(g),a.setStart(g,0)));if(null!==f){for(g=a.endContainer;g.parentNode&&g.parentNode!==f;)g=g.parentNode;n=n?f.childNodes.length:b(g,f);a.setEnd(f,n)}}return d};this.containsRange=f;this.rangesIntersect=g;this.rangeIntersection=function(a,c){var b;g(a,c)&&(b=a.cloneRange(),-1===a.compareBoundaryPoints(Range.START_TO_START,c)&&b.setStart(c.startContainer,
c.startOffset),1===a.compareBoundaryPoints(Range.END_TO_END,c)&&b.setEnd(c.endContainer,c.endOffset));return b};this.getNodesInRange=function(a,c,b){var d=[],f=a.commonAncestorContainer,f=f.nodeType===Node.TEXT_NODE?f.parentNode:f;b=a.startContainer.ownerDocument.createTreeWalker(f,b,c,!1);var n,g;a.endContainer.childNodes[a.endOffset-1]?(n=a.endContainer.childNodes[a.endOffset-1],g=Node.DOCUMENT_POSITION_PRECEDING|Node.DOCUMENT_POSITION_CONTAINED_BY):(n=a.endContainer,g=Node.DOCUMENT_POSITION_PRECEDING);
if(a.startContainer.childNodes[a.startOffset])a=a.startContainer.childNodes[a.startOffset],b.currentNode=a;else{var l=a.startContainer;a.startOffset===(l.nodeType===Node.TEXT_NODE?l.length:l.childNodes.length)?(a=a.startContainer,b.currentNode=a,b.lastChild(),a=b.nextNode()):(a=a.startContainer,b.currentNode=a)}if(a){a=b.currentNode;if(a!==f)for(a=a.parentNode;a&&a!==f;)c(a)===NodeFilter.FILTER_REJECT&&(b.currentNode=a),a=a.parentNode;a=b.currentNode;switch(c(a)){case NodeFilter.FILTER_REJECT:for(a=
b.nextSibling();!a&&b.parentNode();)a=b.nextSibling();break;case NodeFilter.FILTER_SKIP:a=b.nextNode()}for(;a;){c=n.compareDocumentPosition(a);if(0!==c&&0===(c&g))break;d.push(a);a=b.nextNode()}}return d};this.normalizeTextNodes=function(a){a&&a.nextSibling&&(a=l(a,a.nextSibling));a&&a.previousSibling&&l(a.previousSibling,a)};this.rangeContainsNode=function(a,c){var b=c.ownerDocument.createRange(),d=c.ownerDocument.createRange(),n;b.setStart(a.startContainer,a.startOffset);b.setEnd(a.endContainer,
a.endOffset);d.selectNodeContents(c);n=f(b,d);b.detach();d.detach();return n};this.mergeIntoParent=h;this.removeUnwantedNodes=p;this.removeAllChildNodes=function(a){for(;a.firstChild;)a.removeChild(a.firstChild)};this.getElementsByTagNameNS=function(a,c,b){var d=[];a=a.getElementsByTagNameNS(c,b);d.length=b=a.length;for(c=0;c<b;c+=1)d[c]=a.item(c);return d};this.getElementsByTagName=function(a,c){var b=[],d,f,n;d=a.getElementsByTagName(c);b.length=n=d.length;for(f=0;f<n;f+=1)b[f]=d.item(f);return b};
this.containsNode=function(a,c){return a===c||a.contains(c)};this.comparePoints=function(a,c,d,f){if(a===d)return f-c;var n=a.compareDocumentPosition(d);2===n?n=-1:4===n?n=1:10===n?(c=b(a,d),n=c<f?1:-1):(f=b(d,a),n=f<c?-1:1);return n};this.adaptRangeDifferenceToZoomLevel=n;this.translateRect=function(a,c,b){return{top:n(a.top-c.top,b),left:n(a.left-c.left,b),bottom:n(a.bottom-c.top,b),right:n(a.right-c.left,b),width:n(a.width,b),height:n(a.height,b)}};this.getBoundingClientRect=function(a){var b=
a.ownerDocument,d=m(),f=b.body;if((!1===d.unscaledRangeClientRects||d.rangeBCRIgnoresElementBCR)&&a.nodeType===Node.ELEMENT_NODE)return a=a.getBoundingClientRect(),d.elementBCRIgnoresBodyScroll?{left:a.left+f.scrollLeft,right:a.right+f.scrollLeft,top:a.top+f.scrollTop,bottom:a.bottom+f.scrollTop,width:a.width,height:a.height}:a;var n;c?n=c:c=n=b.createRange();d=n;d.selectNode(a);return d.getBoundingClientRect()};this.mapKeyValObjOntoNode=function(a,c,b){Object.keys(c).forEach(function(d){var f=d.split(":"),
n=f[1],f=b(f[0]),g=c[d];f?(n=a.getElementsByTagNameNS(f,n)[0],n||(n=a.ownerDocument.createElementNS(f,d),a.appendChild(n)),n.textContent=g):runtime.log("Key ignored: "+d)})};this.removeKeyElementsFromNode=function(a,c,b){c.forEach(function(c){var d=c.split(":"),r=d[1];(d=b(d[0]))?(r=a.getElementsByTagNameNS(d,r)[0])?r.parentNode.removeChild(r):runtime.log("Element for "+c+" not found."):runtime.log("Property Name ignored: "+c)})};this.getKeyValRepresentationOfNode=function(a,c){for(var b={},d=a.firstElementChild,
f;d;){if(f=c(d.namespaceURI))b[f+":"+d.localName]=d.textContent;d=d.nextElementSibling}return b};this.mapObjOntoNode=a;this.cloneEvent=function(a){var c=Object.create(null);Object.keys(a.constructor.prototype).forEach(function(b){c[b]=a[b]});null==c.clientX&&(c=Object.create(null),Object.keys(a).forEach(function(b){c[b]=a[b]}));c.prototype=a.constructor.prototype;return c};this.getDirectChild=e;(function(a){var c,b;b=runtime.getWindow();null!==b&&(c=b.navigator.appVersion.toLowerCase(),b=-1===c.indexOf("chrome")&&
(-1!==c.indexOf("applewebkit")||-1!==c.indexOf("safari")),c=-1!==c.indexOf("msie")||-1!==c.indexOf("trident"),b||c)&&(a.containsNode=d)})(this)};core.DomUtils=new core.DomUtilsImpl})();
core.Cursor=function(m,e){function h(a){a.parentNode&&(q.push(a.previousSibling),q.push(a.nextSibling),a.parentNode.removeChild(a))}function b(a,c,b){if(c.nodeType===Node.TEXT_NODE){runtime.assert(Boolean(c),"putCursorIntoTextNode: invalid container");var d=c.parentNode;runtime.assert(Boolean(d),"putCursorIntoTextNode: container without parent");runtime.assert(0<=b&&b<=c.length,"putCursorIntoTextNode: offset is out of bounds");0===b?d.insertBefore(a,c):(b!==c.length&&c.splitText(b),d.insertBefore(a,
c.nextSibling))}else c.nodeType===Node.ELEMENT_NODE&&c.insertBefore(a,c.childNodes.item(b));q.push(a.previousSibling);q.push(a.nextSibling)}var f=m.createElementNS("urn:webodf:names:cursor","cursor"),g=m.createElementNS("urn:webodf:names:cursor","anchor"),l,q=[],p=m.createRange(),d,n=core.DomUtils;this.getNode=function(){return f};this.getAnchorNode=function(){return g.parentNode?g:f};this.getSelectedRange=function(){d?(p.setStartBefore(f),p.collapse(!0)):(p.setStartAfter(l?g:f),p.setEndBefore(l?
f:g));return p};this.setSelectedRange=function(a,c){p&&p!==a&&p.detach();p=a;l=!1!==c;(d=a.collapsed)?(h(g),h(f),b(f,a.startContainer,a.startOffset)):(h(g),h(f),b(l?f:g,a.endContainer,a.endOffset),b(l?g:f,a.startContainer,a.startOffset));q.forEach(n.normalizeTextNodes);q.length=0};this.hasForwardSelection=function(){return l};this.remove=function(){h(f);q.forEach(n.normalizeTextNodes);q.length=0};f.setAttributeNS("urn:webodf:names:cursor","memberId",e);g.setAttributeNS("urn:webodf:names:cursor","memberId",
e)};core.Destroyable=function(){};core.Destroyable.prototype.destroy=function(m){};core.EventSource=function(){};core.EventSource.prototype.subscribe=function(m,e){};core.EventSource.prototype.unsubscribe=function(m,e){};
core.EventNotifier=function(m){function e(b){runtime.assert(!h.hasOwnProperty(b),'Duplicated event ids: "'+b+'" registered more than once.');h[b]=[]}var h={};this.emit=function(b,f){var g,l;runtime.assert(h.hasOwnProperty(b),'unknown event fired "'+b+'"');l=h[b];for(g=0;g<l.length;g+=1)l[g](f)};this.subscribe=function(b,f){runtime.assert(h.hasOwnProperty(b),'tried to subscribe to unknown event "'+b+'"');h[b].push(f)};this.unsubscribe=function(b,f){var g;runtime.assert(h.hasOwnProperty(b),'tried to unsubscribe from unknown event "'+
b+'"');g=h[b].indexOf(f);runtime.assert(-1!==g,'tried to unsubscribe unknown callback from event "'+b+'"');-1!==g&&h[b].splice(g,1)};this.register=e;m&&m.forEach(e)};
core.ScheduledTask=function(m,e,h){function b(){l&&(h(g),l=!1)}function f(){b();m.apply(void 0,q);q=null}var g,l=!1,q=[],p=!1;this.trigger=function(){runtime.assert(!1===p,"Can't trigger destroyed ScheduledTask instance");q=Array.prototype.slice.call(arguments);l||(l=!0,g=e(f))};this.triggerImmediate=function(){runtime.assert(!1===p,"Can't trigger destroyed ScheduledTask instance");q=Array.prototype.slice.call(arguments);f()};this.processRequests=function(){l&&f()};this.cancel=b;this.restart=function(){runtime.assert(!1===
p,"Can't trigger destroyed ScheduledTask instance");b();l=!0;g=e(f)};this.destroy=function(d){b();p=!0;d()}};
(function(){var m;core.Task={};core.Task.SUPPRESS_MANUAL_PROCESSING=!1;core.Task.processTasks=function(){core.Task.SUPPRESS_MANUAL_PROCESSING||m.performRedraw()};core.Task.createRedrawTask=function(e){return new core.ScheduledTask(e,m.requestRedrawTask,m.cancelRedrawTask)};core.Task.createTimeoutTask=function(e,h){return new core.ScheduledTask(e,function(b){return runtime.setTimeout(b,h)},runtime.clearTimeout)};m=new function(){var e={};this.requestRedrawTask=function(h){var b=runtime.requestAnimationFrame(function(){h();
delete e[b]});e[b]=h;return b};this.performRedraw=function(){Object.keys(e).forEach(function(h){e[h]();runtime.cancelAnimationFrame(parseInt(h,10))});e={}};this.cancelRedrawTask=function(h){runtime.cancelAnimationFrame(h);delete e[h]}}})();
core.EventSubscriptions=function(){function m(b,f,g){b.subscribe(f,g);h.push({eventSource:b,eventid:f,callback:g})}function e(){var g=[];h.forEach(function(b){b.eventSource.unsubscribe(b.eventid,b.callback)});h.length=0;Object.keys(f).forEach(function(b){f[b].forEach(function(b){g.push(b.task.destroy)});delete f[b]});core.Async.destroyAll(g,function(){});b=new core.EventNotifier}var h=[],b=new core.EventNotifier,f={},g=0;this.addSubscription=m;this.addFrameSubscription=function(l,e,h){var d,n,a,c;
f.hasOwnProperty(e)||(f[e]=[]);a=f[e];for(c=0;c<a.length;c+=1)if(a[c].eventSource===l){d=a[c];break}d||(n="s"+g,g+=1,b.register(n),d={frameEventId:n,eventSource:l,task:core.Task.createRedrawTask(function(){b.emit(n,void 0)})},a.push(d),m(l,e,d.task.trigger));b.subscribe(d.frameEventId,h)};this.unsubscribeAll=e;this.destroy=function(b){e();b()}};core.LazyProperty=function(m){var e,h=!1;this.value=function(){h||(e=m(),h=!0);return e};this.reset=function(){h=!1}};
core.LoopWatchDog=function(m,e){var h=Date.now(),b=0;this.check=function(){var f;if(m&&(f=Date.now(),f-h>m))throw runtime.log("alert","watchdog timeout"),"timeout!";if(0<e&&(b+=1,b>e))throw runtime.log("alert","watchdog loop overflow"),"loop overflow";}};core.NodeFilterChain=function(m){var e=NodeFilter.FILTER_REJECT,h=NodeFilter.FILTER_ACCEPT;this.acceptNode=function(b){var f;for(f=0;f<m.length;f+=1)if(m[f].acceptNode(b)===e)return e;return h}};
core.PositionIterator=function(m,e,h,b){function f(){this.acceptNode=function(a){return!a||a.nodeType===k&&0===a.length?y:B}}function g(a){this.acceptNode=function(c){return!c||c.nodeType===k&&0===c.length?y:a.acceptNode(c)}}function l(){var c=n.currentNode,b=c.nodeType;a=b===k?c.length-1:b===r?1:0}function q(){if(null===n.previousSibling()){if(!n.parentNode()||n.currentNode===m)return n.firstChild(),!1;a=0}else l();return!0}function p(){var b=n.currentNode,r;r=c(b);if(b!==m)for(b=b.parentNode;b&&
b!==m;)c(b)===y&&(n.currentNode=b,r=y),b=b.parentNode;r===y?(a=n.currentNode.nodeType===k?b.length:1,b=d.nextPosition()):b=r===B?!0:d.nextPosition();b&&runtime.assert(c(n.currentNode)===B,"moveToAcceptedNode did not result in walker being on an accepted node");return b}var d=this,n,a,c,k=Node.TEXT_NODE,r=Node.ELEMENT_NODE,B=NodeFilter.FILTER_ACCEPT,y=NodeFilter.FILTER_REJECT;this.nextPosition=function(){var c=n.currentNode,b=c.nodeType;if(c===m)return!1;if(0===a&&b===r)null===n.firstChild()&&(a=1);
else if(b===k&&a+1<c.length)a+=1;else if(null!==n.nextSibling())a=0;else if(n.parentNode())a=1;else return!1;return!0};this.previousPosition=function(){var c=!0,b=n.currentNode;0===a?c=q():b.nodeType===k?a-=1:null!==n.lastChild()?l():b===m?c=!1:a=0;return c};this.previousNode=q;this.container=function(){var c=n.currentNode,b=c.nodeType;0===a&&b!==k&&(c=c.parentNode);return c};this.rightNode=function(){var b=n.currentNode,d=b.nodeType;if(d===k&&a===b.length)for(b=b.nextSibling;b&&c(b)!==B;)b=b.nextSibling;
else d===r&&1===a&&(b=null);return b};this.leftNode=function(){var b=n.currentNode;if(0===a)for(b=b.previousSibling;b&&c(b)!==B;)b=b.previousSibling;else if(b.nodeType===r)for(b=b.lastChild;b&&c(b)!==B;)b=b.previousSibling;return b};this.getCurrentNode=function(){return n.currentNode};this.unfilteredDomOffset=function(){if(n.currentNode.nodeType===k)return a;for(var c=0,b=n.currentNode,b=1===a?b.lastChild:b.previousSibling;b;)c+=1,b=b.previousSibling;return c};this.getPreviousSibling=function(){var a=
n.currentNode,c=n.previousSibling();n.currentNode=a;return c};this.getNextSibling=function(){var a=n.currentNode,c=n.nextSibling();n.currentNode=a;return c};this.setPositionBeforeElement=function(c){runtime.assert(Boolean(c),"setPositionBeforeElement called without element");n.currentNode=c;a=0;return p()};this.setUnfilteredPosition=function(c,b){runtime.assert(Boolean(c),"PositionIterator.setUnfilteredPosition called without container");n.currentNode=c;c.nodeType===k?(a=b,runtime.assert(b<=c.length,
"Error in setPosition: "+b+" > "+c.length),runtime.assert(0<=b,"Error in setPosition: "+b+" < 0"),b===c.length&&(n.nextSibling()?a=0:n.parentNode()?a=1:runtime.assert(!1,"Error in setUnfilteredPosition: position not valid."))):b<c.childNodes.length?(n.currentNode=c.childNodes.item(b),a=0):a=1;return p()};this.moveToEnd=function(){n.currentNode=m;a=1};this.moveToEndOfNode=function(c){c.nodeType===k?d.setUnfilteredPosition(c,c.length):(n.currentNode=c,a=1)};this.isBeforeNode=function(){return 0===a};
this.getNodeFilter=function(){return c};c=(h?new g(h):new f).acceptNode;c.acceptNode=c;e=e||NodeFilter.SHOW_ALL;runtime.assert(m.nodeType!==Node.TEXT_NODE,"Internet Explorer doesn't allow tree walker roots to be text nodes");n=m.ownerDocument.createTreeWalker(m,e,c,b);a=0;null===n.firstChild()&&(a=1)};core.PositionFilter=function(){};core.PositionFilter.FilterResult={FILTER_ACCEPT:1,FILTER_REJECT:2,FILTER_SKIP:3};core.PositionFilter.prototype.acceptPosition=function(m){};
core.PositionFilterChain=function(){var m=[],e=core.PositionFilter.FilterResult.FILTER_ACCEPT,h=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(b){var f;for(f=0;f<m.length;f+=1)if(m[f].acceptPosition(b)===h)return h;return e};this.addFilter=function(b){m.push(b)}};core.StepDirection={PREVIOUS:1,NEXT:2};
core.StepIterator=function(m,e){function h(){a=null;k=c=void 0}function b(){void 0===k&&(k=m.acceptPosition(e)===d);return k}function f(a,c){h();return e.setUnfilteredPosition(a,c)}function g(){a||(a=e.container());return a}function l(){void 0===c&&(c=e.unfilteredDomOffset());return c}function q(){for(h();e.nextPosition();)if(h(),b())return!0;return!1}function p(){for(h();e.previousPosition();)if(h(),b())return!0;return!1}var d=core.PositionFilter.FilterResult.FILTER_ACCEPT,n=core.StepDirection.NEXT,
a,c,k;this.isStep=b;this.setPosition=f;this.container=g;this.offset=l;this.nextStep=q;this.previousStep=p;this.advanceStep=function(a){return a===n?q():p()};this.roundToClosestStep=function(){var a,c,k=b();k||(a=g(),c=l(),k=p(),k||(f(a,c),k=q()));return k};this.roundToPreviousStep=function(){var a=b();a||(a=p());return a};this.roundToNextStep=function(){var a=b();a||(a=q());return a};this.leftNode=function(){return e.leftNode()};this.snapshot=function(){return new core.StepIterator.StepSnapshot(g(),
l())};this.restore=function(a){f(a.container,a.offset)}};core.StepIterator.StepSnapshot=function(m,e){this.container=m;this.offset=e};
core.Utils=function(){function m(e,h){if(h&&Array.isArray(h)){e=e||[];if(!Array.isArray(e))throw"Destination is not an array.";e=e.concat(h.map(function(b){return m(null,b)}))}else if(h&&"object"===typeof h){e=e||{};if("object"!==typeof e)throw"Destination is not an object.";Object.keys(h).forEach(function(b){e[b]=m(e[b],h[b])})}else e=h;return e}this.hashString=function(e){var h=0,b,f;b=0;for(f=e.length;b<f;b+=1)h=(h<<5)-h+e.charCodeAt(b),h|=0;return h};this.mergeObjects=function(e,h){Object.keys(h).forEach(function(b){e[b]=
m(e[b],h[b])});return e}};
core.Zip=function(m,e){function h(b,f){b&&0==b.indexOf("./")&&(b=b.substring(2));var a=q.file(b);a?f(null,a.asUint8Array()):f(b+" not found.",null)}function b(b,f){h(b,function(a,c){if(a||null===c)return f(a,null);var b=runtime.byteArrayToString(c,"utf8");f(null,b)})}function f(b,f){if(godfcontainer&&0<newaddlist.length){var a,c,k,r=[];a=godfcontainer.rootElement.body.getElementsByTagNameNS("urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","image");for(k=0;k<a.length;k+=1)node=a.item(k),c=node.getAttributeNS("http://www.w3.org/1999/xlink",
"href"),r.push(c);for(filename in q.files)0==filename.indexOf("Pictures/")&&0>r.indexOf(filename)&&0<=newaddlist.indexOf(filename)&&(q.remove(filename),console.log("Removed: "+filename))}try{b(q.generate({type:"uint8array",compression:"DEFLATE"}))}catch(g){f(g.message)}}function g(b,n){f(function(a){runtime.writeFile(b,a,n)},n)}var l=this,q,p=new core.Base64;this.load=h;this.isexist=function(b){if(q.files[b])return!0};this.save=function(b,f,a,c,k){k||(k=!1);q.file(b,f,{date:c,base64:k,compression:a?
"DEFLATE":"STORE"})};this.remove=function(b){var f=null!==q.file(b);q.remove(b);return f};this.write=function(b){g(m,b)};this.writeAs=g;this.createByteArray=f;this.loadContentXmlAsFragments=function(d,f){b(d,function(a,c){if(a)return f.rootElementReady(a);f.rootElementReady(null,c,!0)})};this.loadAsString=b;this.loadAsDOM=function(d,f){b(d,function(a,c){if(a||null===c)f(a,null);else if(6291456<c.length)g_errmsg("Sorry, It takes too much time to run.");else{var b=(new DOMParser).parseFromString(c.trim(),
"text/xml");f(null,b)}})};this.loadAsDataURL=function(b,f,a){if(b&&1E3>b.length){var c=(b||"").toLowerCase().trim();if(0==c.indexOf("http://")||0==c.indexOf("https://")){a(null,b);return}}h(b,function(c,r){if(c||!r)return a(c,null);var g=0,l;f||(f=80===r[1]&&78===r[2]&&71===r[3]?"image/png":255===r[0]&&216===r[1]&&255===r[2]?"image/jpeg":71===r[0]&&73===r[1]&&70===r[2]?"image/gif":66===r[0]&&77===r[1]?"image/bmp":"");f||(f=getmimetype2(b)||"application/octet-stream");for(l="data:"+f+";base64,";g<
r.length;)l+=p.convertUTF8ArrayToBase64(r.subarray(g,Math.min(g+45E3,r.length))),g+=45E3;a(null,l)})};this.getEntries=function(){return Object.keys(q.files).map(function(b){return{filename:b,date:q.files[b].date}})};q=new externs.JSZip;null!==e&&runtime.readFile(m,"binary",function(b,f){"string"===typeof f&&(b="file was read as a string. Should be Uint8Array.");if(b||!f||0===f.length)e("File '"+m+"' cannot be read. Err: "+(b||"[none]"),l);else{try{q.load(f,{checkCRC32:!1})}catch(a){e(a.message,l);
return}e(null,l)}})};core.SimpleClientRect=null;gui.CommonConstraints={EDIT:{ANNOTATIONS:{ONLY_DELETE_OWN:"onlyDeleteOwn"},REVIEW_MODE:"reviewMode"}};
gui.SessionConstraints=function(){function m(b){e.hasOwnProperty(b)||(e[b]=!1,h.register(b))}var e={},h=new core.EventNotifier;this.registerConstraint=m;this.subscribe=function(b,f){m(b);h.subscribe(b,f)};this.unsubscribe=function(b,f){h.unsubscribe(b,f)};this.setState=function(b,f){runtime.assert(!0===e.hasOwnProperty(b),"No such constraint");e[b]!==f&&(e[b]=f,h.emit(b,f))};this.getState=function(b){runtime.assert(!0===e.hasOwnProperty(b),"No such constraint");return e[b]}};
gui.BlacklistNamespaceNodeFilter=function(m){var e={},h=NodeFilter.FILTER_REJECT,b=NodeFilter.FILTER_ACCEPT;this.acceptNode=function(f){return!f||e.hasOwnProperty(f.namespaceURI)?h:b};(function(){m.forEach(function(b){e[b]=!0})})()};
odf.Namespaces={namespaceMap:{config:"urn:oasis:names:tc:opendocument:xmlns:config:1.0",db:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dc:"http://purl.org/dc/elements/1.1/",dr3d:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",draw:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chart:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fo:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",form:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",math:"http://www.w3.org/1998/Math/MathML",
meta:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",number:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",office:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentation:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",style:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svg:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",table:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",text:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xforms:"http://www.w3.org/2002/xforms",
xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},prefixMap:{},configns:"urn:oasis:names:tc:opendocument:xmlns:config:1.0",dbns:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dcns:"http://purl.org/dc/elements/1.1/",dr3dns:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",drawns:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chartns:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fons:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",formns:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",
mathns:"http://www.w3.org/1998/Math/MathML",metans:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",numberns:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",officens:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentationns:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",stylens:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svgns:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",tablens:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",textns:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",
xformsns:"http://www.w3.org/2002/xforms",xlinkns:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/XML/1998/namespace"};(function(){var m=odf.Namespaces.namespaceMap,e=odf.Namespaces.prefixMap,h;for(h in m)m.hasOwnProperty(h)&&(e[m[h]]=h)})();odf.Namespaces.forEachPrefix=function(m){var e=odf.Namespaces.namespaceMap,h;for(h in e)e.hasOwnProperty(h)&&m(h,e[h])};
odf.Namespaces.lookupNamespaceURI=function(m){var e=null;odf.Namespaces.namespaceMap.hasOwnProperty(m)&&(e=odf.Namespaces.namespaceMap[m]);return e};odf.Namespaces.lookupPrefix=function(m){var e=odf.Namespaces.prefixMap;return e.hasOwnProperty(m)?e[m]:null};odf.Namespaces.lookupNamespaceURI.lookupNamespaceURI=odf.Namespaces.lookupNamespaceURI;
(function(){odf.OdfSchemaImpl=function(){var m=[["config:config-item","uncategorized"],["form:item","object"],["form:option","uncategorized"],["math:math","field"],["meta:user-defined","uncategorized"],["number:currency-symbol","uncategorized"],["number:embedded-text","uncategorized"],["number:text","uncategorized"],["presentation:date-time-decl","uncategorized"],["presentation:footer-decl","uncategorized"],["presentation:header-decl","uncategorized"],["svg:desc","text"],["svg:title","text"],["table:desc",
"uncategorized"],["table:title","uncategorized"],["text:a","text"],["text:author-initials","field"],["text:author-name","field"],["text:bibliography-mark","field"],["text:bookmark-ref","field"],["text:chapter","field"],["text:character-count","field"],["text:conditional-text","field"],["text:creation-date","field"],["text:creation-time","field"],["text:creator","field"],["text:database-display","field"],["text:database-name","field"],["text:database-row-number","field"],["text:date","field"],["text:dde-connection",
"field"],["text:description","field"],["text:editing-cycles","field"],["text:editing-duration","field"],["text:execute-macro","uncategorized"],["text:expression","uncategorized"],["text:file-name","field"],["text:h","text"],["text:hidden-paragraph","text"],["text:hidden-text","text"],["text:image-count","field"],["text:index-entry-span","uncategorized"],["text:index-title-template","uncategorized"],["text:initial-creator","field"],["text:keywords","field"],["text:linenumbering-separator","style"],
["text:measure","uncategorized"],["text:meta","uncategorized"],["text:meta-field","uncategorized"],["text:modification-date","field"],["text:modification-time","field"],["text:note-citation","field"],["text:note-continuation-notice-backward","style"],["text:note-continuation-notice-forward","style"],["text:note-ref","field"],["text:object-count","field"],["text:p","text"],["text:page-continuation","uncategorized"],["text:page-count","field"],["text:page-number","field"],["text:page-variable-get",
"field"],["text:page-variable-set","field"],["text:paragraph-count","field"],["text:placeholder","field"],["text:print-date","field"],["text:print-time","field"],["text:printed-by","field"],["text:reference-ref","field"],["text:ruby-base","text"],["text:ruby-text","text"],["text:script","text"],["text:sender-city","field"],["text:sender-company","field"],["text:sender-country","field"],["text:sender-email","field"],["text:sender-fax","field"],["text:sender-firstname","field"],["text:sender-initials",
"field"],["text:sender-lastname","field"],["text:sender-phone-private","field"],["text:sender-phone-work","field"],["text:sender-position","field"],["text:sender-postal-code","field"],["text:sender-state-or-province","field"],["text:sender-street","field"],["text:sender-title","field"],["text:sequence","uncategorized"],["text:sequence-ref","uncategorized"],["text:sheet-name","uncategorized"],["text:span","text"],["text:subject","field"],["text:table-count","field"],["text:table-formula","deprecated"],
["text:template-name","uncategorized"],["text:text-input","field"],["text:time","field"],["text:title","field"],["text:user-defined","field"],["text:user-field-get","field"],["text:user-field-input","field"],["text:variable-get","field"],["text:variable-input","field"],["text:variable-set","field"],["text:word-count","field"],["xforms:model","uncategorized"]],e={};this.isTextContainer=function(h,b){return"text"===e[h+":"+b]};this.isField=function(h,b){return"field"===e[h+":"+b]};this.getFields=function(){return m.filter(function(e){return"field"===
e[1]}).map(function(e){return e[0]})};(function(){m.forEach(function(h){var b=h[1],f=h[0].split(":");h=f[0];var f=f[1],g=odf.Namespaces.lookupNamespaceURI(h);g?e[g+":"+f]=b:runtime.log("DEBUG: OdfSchema - unknown prefix '"+h+"'")})})()};odf.OdfSchema=new odf.OdfSchemaImpl})();
odf.OdfUtilsImpl=function(){function m(a){return"image"===(a&&a.localName)&&a.namespaceURI===E}function e(a){if(null!==a&&a.nodeType===Node.ELEMENT_NODE&&"frame"===a.localName&&a.namespaceURI===E){var c=a.getAttributeNS(J,"anchor-type");if("as-char"===c||"char"===c||"paragraph"===c)return!0;c=a.getAttributeNS(P,"width");a=a.getAttributeNS(P,"height");if(c&&a)return!0}return!1}function h(a){var c;(c="annotation"===(a&&a.localName)&&a.namespaceURI===odf.Namespaces.officens)||(c="div"===(a&&a.localName)&&
"annotationWrapper"===a.className);return c}function b(a){return"a"===(a&&a.localName)&&a.namespaceURI===J}function f(a){var c=a&&a.localName;return("p"===c||"h"===c)&&a.namespaceURI===J}function g(a,c){for(a&&void 0!==c&&!f(a)&&a.childNodes.item(c)&&(a=a.childNodes.item(c));a&&!f(a);)a=a.parentNode;return a}function l(a,c){for(;a&&a!==c;){if(a.namespaceURI===odf.Namespaces.officens&&"annotation"===a.localName)return a;a=a.parentNode}return null}function q(a){return/^[ \t\r\n]+$/.test(a)}function p(a){if(null===
a||a.nodeType!==Node.ELEMENT_NODE)return!1;var c=a.localName;return W.isTextContainer(a.namespaceURI,c)||"span"===c&&"webodf-annotationHighlight"===a.className}function d(a){return null===a||a.nodeType!==Node.ELEMENT_NODE?!1:W.isField(a.namespaceURI,a.localName)}function n(a){var c=a&&a.localName,b=!1;c&&(a=a.namespaceURI,a===J&&(b="s"===c||"tab"===c||"line-break"===c));return b}function a(a){return n(a)||d(a)||e(a)||h(a)}function c(a){var c=a&&a.localName,b=!1;c&&(a=a.namespaceURI,a===J&&(b="s"===
c));return b}function k(a){return-1!==U.indexOf(a.namespaceURI)}function r(a){if(n(a)||d(a))return!1;if(p(a.parentNode)&&a.nodeType===Node.TEXT_NODE)return 0===a.textContent.length;for(a=a.firstChild;a;){if(k(a)||!r(a))return!1;a=a.nextSibling}return!0}function B(a){for(;null!==a.firstChild&&p(a);)a=a.firstChild;return a}function y(a){for(;null!==a.lastChild&&p(a);)a=a.lastChild;return a}function z(a){for(;!f(a)&&null===a.previousSibling;)a=a.parentNode;return f(a)?null:y(a.previousSibling)}function v(a){for(;!f(a)&&
null===a.nextSibling;)a=a.parentNode;return f(a)?null:B(a.nextSibling)}function A(b){for(var s=!1;b;)if(b.nodeType===Node.TEXT_NODE)if(0===b.length)b=z(b);else return!q(b.data.substr(b.length-1,1));else a(b)?(s=!1===c(b),b=null):b=z(b);return s}function t(c){var b=!1,s;for(c=c&&B(c);c;){s=c.nodeType===Node.TEXT_NODE?c.length:0;if(0<s&&!q(c.data)){b=!0;break}if(a(c)){b=!0;break}c=v(c)}return b}function w(a,c){return q(a.data.substr(c))?!t(v(a)):!1}function H(c,b){var s=c.data,k;if(!q(s[b])||a(c.parentNode))return!1;
0<b?q(s[b-1])||(k=!0):A(z(c))&&(k=!0);return!0===k?w(c,b)?!1:!0:!1}function I(a){return(a=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px)|(%))/.exec(a))?{value:parseFloat(a[1]),unit:a[3]}:null}function D(a){return(a=I(a))&&(0>a.value||"%"===a.unit)?null:a}function C(a){return(a=I(a))&&"%"!==a.unit?null:a}function s(a){switch(a.namespaceURI){case odf.Namespaces.drawns:case odf.Namespaces.svgns:case odf.Namespaces.dr3dns:return!1;case odf.Namespaces.textns:switch(a.localName){case "note-body":case "ruby-text":return!1}break;
case odf.Namespaces.officens:switch(a.localName){case "annotation":case "binary-data":case "event-listeners":return!1}break;default:switch(a.localName){case "cursor":case "editinfo":return!1}}return!0}function u(a){return Boolean(g(a)&&(!q(a.textContent)||H(a,0)))}function x(a,c){for(;0<c.length&&!Q.rangeContainsNode(a,c[0]);)c.shift();for(;0<c.length&&!Q.rangeContainsNode(a,c[c.length-1]);)c.pop()}function G(c,b,k){var f;f=Q.getNodesInRange(c,function(c){var b=NodeFilter.FILTER_REJECT;if(n(c.parentNode)||
d(c.parentNode)||h(c))b=NodeFilter.FILTER_REJECT;else if(c.nodeType===Node.TEXT_NODE){if(k||u(c))b=NodeFilter.FILTER_ACCEPT}else if(a(c))b=NodeFilter.FILTER_ACCEPT;else if(s(c)||p(c))b=NodeFilter.FILTER_SKIP;return b},NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);b||x(c,f);return f}function M(a,c,b){for(;a;){if(b(a)){c[0]!==a&&c.unshift(a);break}if(h(a))break;a=a.parentNode}}function F(a,c){var b=a;if(c<b.childNodes.length-1)b=b.childNodes[c+1];else{for(;!b.nextSibling;)b=b.parentNode;b=b.nextSibling}for(;b.firstChild;)b=
b.firstChild;return b}var J=odf.Namespaces.textns,P=odf.Namespaces.svgns,E=odf.Namespaces.drawns,aa=odf.Namespaces.xlinkns,Q=core.DomUtils,U=[odf.Namespaces.dbns,odf.Namespaces.dcns,odf.Namespaces.dr3dns,odf.Namespaces.drawns,odf.Namespaces.chartns,odf.Namespaces.formns,odf.Namespaces.numberns,odf.Namespaces.officens,odf.Namespaces.presentationns,odf.Namespaces.stylens,odf.Namespaces.svgns,odf.Namespaces.tablens,odf.Namespaces.textns],W=odf.OdfSchema;this.isImage=m;this.isCharacterFrame=e;this.isInlineRoot=
h;this.isTextSpan=function(a){return"span"===(a&&a.localName)&&a.namespaceURI===J};this.isHyperlink=b;this.getHyperlinkTarget=function(a){return a.getAttributeNS(aa,"href")||""};this.isParagraph=f;this.getParagraphElement=g;this.getParentAnnotation=l;this.isWithinAnnotation=function(a,c){return Boolean(l(a,c))};this.getAnnotationCreator=function(a){return(a=a.getElementsByTagNameNS(odf.Namespaces.dcns,"creator")[0])?a.textContent:""};this.isListItem=function(a){return"list-item"===(a&&a.localName)&&
a.namespaceURI===J};this.isLineBreak=function(a){return"line-break"===(a&&a.localName)&&a.namespaceURI===J};this.isODFWhitespace=q;this.isGroupingElement=p;this.isFieldElement=d;this.isCharacterElement=n;this.isAnchoredAsCharacterElement=a;this.isSpaceElement=c;this.isODFNode=k;this.hasNoODFContent=r;this.firstChild=B;this.lastChild=y;this.previousNode=z;this.nextNode=v;this.scanLeftForNonSpace=A;this.lookLeftForCharacter=function(c){var b,s=b=0;c.nodeType===Node.TEXT_NODE&&(s=c.length);0<s?(b=c.data,
b=q(b.substr(s-1,1))?1===s?A(z(c))?2:0:q(b.substr(s-2,1))?0:2:1):a(c)&&(b=1);return b};this.lookRightForCharacter=function(c){var b=!1,s=0;c&&c.nodeType===Node.TEXT_NODE&&(s=c.length);0<s?b=!q(c.data.substr(0,1)):a(c)&&(b=!0);return b};this.scanLeftForAnyCharacter=function(c){var b=!1,s;for(c=c&&y(c);c;){s=c.nodeType===Node.TEXT_NODE?c.length:0;if(0<s&&!q(c.data)){b=!0;break}if(a(c)){b=!0;break}c=z(c)}return b};this.scanRightForAnyCharacter=t;this.isTrailingWhitespace=w;this.isSignificantWhitespace=
H;this.isDowngradableSpaceElement=function(a){return c(a)?A(z(a))&&t(v(a)):!1};this.parseLength=I;this.parseNonNegativeLength=D;this.parseFoFontSize=function(a){var c;c=(c=I(a))&&(0>=c.value||"%"===c.unit)?null:c;return c||C(a)};this.parseFoLineHeight=function(a){return D(a)||C(a)};this.isTextContentContainingNode=s;this.getTextNodes=function(a,c){var b;b=Q.getNodesInRange(a,function(a){var c=NodeFilter.FILTER_REJECT;a.nodeType===Node.TEXT_NODE?u(a)&&(c=NodeFilter.FILTER_ACCEPT):s(a)&&(c=NodeFilter.FILTER_SKIP);
return c},NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);c||x(a,b);return b};this.getTextElements=G;this.getParagraphElements=function(a){var c;c=Q.getNodesInRange(a,function(a){var c=NodeFilter.FILTER_REJECT;if(f(a))c=NodeFilter.FILTER_ACCEPT;else if(s(a)||p(a))c=NodeFilter.FILTER_SKIP;return c},NodeFilter.SHOW_ELEMENT);M(a.startContainer,c,f);return c};this.getImageElements=function(a){var c;c=Q.getNodesInRange(a,function(a){var c=NodeFilter.FILTER_SKIP;m(a)&&(c=NodeFilter.FILTER_ACCEPT);return c},
NodeFilter.SHOW_ELEMENT);M(a.startContainer,c,m);return c};this.getHyperlinkElements=function(a){var c=[],s=a.cloneRange();a.collapsed&&a.endContainer.nodeType===Node.ELEMENT_NODE&&(a=F(a.endContainer,a.endOffset),a.nodeType===Node.TEXT_NODE&&s.setEnd(a,1));G(s,!0,!1).forEach(function(a){for(a=a.parentNode;!f(a);){if(b(a)&&-1===c.indexOf(a)){c.push(a);break}a=a.parentNode}});s.detach();return c};this.getNormalizedFontFamilyName=function(a){/^(["'])(?:.|[\n\r])*?\1$/.test(a)||(a=a.replace(/^[ \t\r\n\f]*((?:.|[\n\r])*?)[ \t\r\n\f]*$/,
"$1"),/[ \t\r\n\f]/.test(a)&&(a="'"+a.replace(/[ \t\r\n\f]+/g," ")+"'"));return a}};odf.OdfUtils=new odf.OdfUtilsImpl;gui.OdfTextBodyNodeFilter=function(){var m=odf.OdfUtils,e=Node.TEXT_NODE,h=NodeFilter.FILTER_REJECT,b=NodeFilter.FILTER_ACCEPT,f=odf.Namespaces.textns;this.acceptNode=function(g){if(g.nodeType===e){if(!m.isGroupingElement(g.parentNode))return h}else if(g.namespaceURI===f&&"tracked-changes"===g.localName)return h;return b}};xmldom.LSSerializerFilter=function(){};
xmldom.LSSerializerFilter.prototype.acceptNode=function(m){};odf.OdfNodeFilter=function(){this.acceptNode=function(m){return"http://www.w3.org/1999/xhtml"===m.namespaceURI?NodeFilter.FILTER_SKIP:m.namespaceURI&&m.namespaceURI.match(/^urn:webodf:/)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}};xmldom.XPathIterator=function(){};xmldom.XPathIterator.prototype.next=function(){};xmldom.XPathIterator.prototype.reset=function(){};xmldom.XPathAtom;
function createXPathSingleton(){function m(b,a,c){return-1!==b&&(b<a||-1===a)&&(b<c||-1===c)}function e(b){for(var a=[],c=0,k=b.length,f;c<k;){var g=b,l=k,e=a,h="",q=[],t=g.indexOf("[",c),p=g.indexOf("/",c),H=g.indexOf("=",c);m(p,t,H)?(h=g.substring(c,p),c=p+1):m(t,p,H)?(h=g.substring(c,t),c=d(g,t,q)):m(H,p,t)?(h=g.substring(c,H),c=H):(h=g.substring(c,l),c=l);e.push({location:h,predicates:q});if(c<k&&"="===b[c]){f=b.substring(c+1,k);if(2<f.length&&("'"===f[0]||'"'===f[0]))f=f.slice(1,f.length-1);
else try{f=parseInt(f,10)}catch(I){}c=k}}return{steps:a,value:f}}function h(){var b=null,a=!1;this.setNode=function(a){b=a};this.reset=function(){a=!1};this.next=function(){var c=a?null:b;a=!0;return c}}function b(b,a,c){this.reset=function(){b.reset()};this.next=function(){for(var k=b.next();k;){k.nodeType===Node.ELEMENT_NODE&&(k=k.getAttributeNodeNS(a,c));if(k)break;k=b.next()}return k}}function f(b,a){var c=b.next(),k=null;this.reset=function(){b.reset();c=b.next();k=null};this.next=function(){for(;c;){if(k)if(a&&
k.firstChild)k=k.firstChild;else{for(;!k.nextSibling&&k!==c;)k=k.parentNode;k===c?c=b.next():k=k.nextSibling}else{do(k=c.firstChild)||(c=b.next());while(c&&!k)}if(k&&k.nodeType===Node.ELEMENT_NODE)return k}return null}}function g(b,a){this.reset=function(){b.reset()};this.next=function(){for(var c=b.next();c&&!a(c);)c=b.next();return c}}function l(b,a,c){a=a.split(":",2);var k=c(a[0]),f=a[1];return new g(b,function(a){return a.localName===f&&a.namespaceURI===k})}function q(b,a,c){var k=new h,f=p(k,
a,c),d=a.value;return void 0===d?new g(b,function(a){k.setNode(a);f.reset();return null!==f.next()}):new g(b,function(a){k.setNode(a);f.reset();return(a=f.next())?a.nodeValue===d:!1})}var p,d;d=function(b,a,c){for(var k=a,f=b.length,d=0;k<f;)"]"===b[k]?(d-=1,0>=d&&c.push(e(b.substring(a,k)))):"["===b[k]&&(0>=d&&(a=k+1),d+=1),k+=1;return k};p=function(d,a,c){var k,r,g,e;for(k=0;k<a.steps.length;k+=1){g=a.steps[k];r=g.location;if(""===r)d=new f(d,!1);else if("@"===r[0]){r=r.substr(1).split(":",2);e=
c(r[0]);if(!e)throw"No namespace associated with the prefix "+r[0];d=new b(d,e,r[1])}else"."!==r&&(d=new f(d,!1),-1!==r.indexOf(":")&&(d=l(d,r,c)));for(r=0;r<g.predicates.length;r+=1)e=g.predicates[r],d=q(d,e,c)}return d};return{getODFElementsWithXPath:function(b,a,c){var k=b.ownerDocument,d=[],f=null;if(k&&"function"===typeof k.evaluate)for(c=k.evaluate(a,b,c,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null),f=c.iterateNext();null!==f;)f.nodeType===Node.ELEMENT_NODE&&d.push(f),f=c.iterateNext();else{d=
new h;d.setNode(b);b=e(a);d=p(d,b,c);b=[];for(c=d.next();c;)b.push(c),c=d.next();d=b}return d}}}xmldom.XPath=createXPathSingleton();
odf.StyleInfo=function(){function m(a,c){var b,k,d,f,r,g=0;if(b=D[a.localName])if(d=b[a.namespaceURI])g=d.length;for(b=0;b<g;b+=1)k=d[b],f=k.ns,r=k.localname,(k=a.getAttributeNS(f,r))&&a.setAttributeNS(f,H[f]+r,c+k);for(d=a.firstElementChild;d;)m(d,c),d=d.nextElementSibling}function e(a,c){var b,k,d,f,r,g=0;if(b=D[a.localName])if(d=b[a.namespaceURI])g=d.length;for(b=0;b<g;b+=1)if(k=d[b],f=k.ns,r=k.localname,k=a.getAttributeNS(f,r))k=k.replace(c,""),a.setAttributeNS(f,H[f]+r,k);for(d=a.firstElementChild;d;)e(d,
c),d=d.nextElementSibling}function h(a,c){var b,k,d,f,r,g=0;if(b=D[a.localName])if(d=b[a.namespaceURI])g=d.length;for(b=0;b<g;b+=1)if(f=d[b],k=f.ns,r=f.localname,k=a.getAttributeNS(k,r))c=c||{},f=f.keyname,c.hasOwnProperty(f)?c[f][k]=1:(r={},r[k]=1,c[f]=r);return c}function b(a,c){var k,d;h(a,c);for(k=a.firstChild;k;)k.nodeType===Node.ELEMENT_NODE&&(d=k,b(d,c)),k=k.nextSibling}function f(a,c,b){this.key=a;this.name=c;this.family=b;this.requires={}}function g(a,c,b){var k=a+'"'+c,d=b[k];d||(d=b[k]=
new f(k,a,c));return d}function l(a,c,b){var k,d,f,r,e,n=0;k=a.getAttributeNS(A,"name");r=a.getAttributeNS(A,"family");k&&r&&(c=g(k,r,b));if(c){if(k=D[a.localName])if(f=k[a.namespaceURI])n=f.length;for(k=0;k<n;k+=1)if(r=f[k],d=r.ns,e=r.localname,d=a.getAttributeNS(d,e))r=r.keyname,r=g(d,r,b),c.requires[r.key]=r}for(a=a.firstElementChild;a;)l(a,c,b),a=a.nextElementSibling;return b}function q(a,c){var b=c[a.family];b||(b=c[a.family]={});b[a.name]=1;Object.keys(a.requires).forEach(function(b){q(a.requires[b],
c)})}function p(a,c){var b=l(a,null,{});Object.keys(b).forEach(function(a){a=b[a];var s=c[a.family];s&&s.hasOwnProperty(a.name)&&q(a,c)})}function d(a,c){function b(c){(c=r.getAttributeNS(A,c))&&(a[c]=!0)}var k=["font-name","font-name-asian","font-name-complex"],f,r;for(f=c&&c.firstElementChild;f;)r=f,k.forEach(b),d(a,r),f=f.nextElementSibling}function n(a,c){function b(a){var k=f.getAttributeNS(A,a);k&&c.hasOwnProperty(k)&&f.setAttributeNS(A,"style:"+a,c[k])}var k=["font-name","font-name-asian",
"font-name-complex"],d,f;for(d=a&&a.firstElementChild;d;)f=d,k.forEach(b),n(f,c),d=d.nextElementSibling}var a=odf.Namespaces.chartns,c=odf.Namespaces.dbns,k=odf.Namespaces.dr3dns,r=odf.Namespaces.drawns,B=odf.Namespaces.formns,y=odf.Namespaces.numberns,z=odf.Namespaces.officens,v=odf.Namespaces.presentationns,A=odf.Namespaces.stylens,t=odf.Namespaces.tablens,w=odf.Namespaces.textns,H={"urn:oasis:names:tc:opendocument:xmlns:chart:1.0":"chart:","urn:oasis:names:tc:opendocument:xmlns:database:1.0":"db:",
"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0":"dr3d:","urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":"draw:","urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":"fo:","urn:oasis:names:tc:opendocument:xmlns:form:1.0":"form:","urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":"number:","urn:oasis:names:tc:opendocument:xmlns:office:1.0":"office:","urn:oasis:names:tc:opendocument:xmlns:presentation:1.0":"presentation:","urn:oasis:names:tc:opendocument:xmlns:style:1.0":"style:","urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0":"svg:",
"urn:oasis:names:tc:opendocument:xmlns:table:1.0":"table:","urn:oasis:names:tc:opendocument:xmlns:text:1.0":"chart:","http://www.w3.org/XML/1998/namespace":"xml:"},I={text:[{ens:A,en:"tab-stop",ans:A,a:"leader-text-style"},{ens:A,en:"drop-cap",ans:A,a:"style-name"},{ens:w,en:"notes-configuration",ans:w,a:"citation-body-style-name"},{ens:w,en:"notes-configuration",ans:w,a:"citation-style-name"},{ens:w,en:"a",ans:w,a:"style-name"},{ens:w,en:"alphabetical-index",ans:w,a:"style-name"},{ens:w,en:"linenumbering-configuration",
ans:w,a:"style-name"},{ens:w,en:"list-level-style-number",ans:w,a:"style-name"},{ens:w,en:"ruby-text",ans:w,a:"style-name"},{ens:w,en:"span",ans:w,a:"style-name"},{ens:w,en:"a",ans:w,a:"visited-style-name"},{ens:A,en:"text-properties",ans:A,a:"text-line-through-text-style"},{ens:w,en:"alphabetical-index-source",ans:w,a:"main-entry-style-name"},{ens:w,en:"index-entry-bibliography",ans:w,a:"style-name"},{ens:w,en:"index-entry-chapter",ans:w,a:"style-name"},{ens:w,en:"index-entry-link-end",ans:w,a:"style-name"},
{ens:w,en:"index-entry-link-start",ans:w,a:"style-name"},{ens:w,en:"index-entry-page-number",ans:w,a:"style-name"},{ens:w,en:"index-entry-span",ans:w,a:"style-name"},{ens:w,en:"index-entry-tab-stop",ans:w,a:"style-name"},{ens:w,en:"index-entry-text",ans:w,a:"style-name"},{ens:w,en:"index-title-template",ans:w,a:"style-name"},{ens:w,en:"list-level-style-bullet",ans:w,a:"style-name"},{ens:w,en:"outline-level-style",ans:w,a:"style-name"}],paragraph:[{ens:r,en:"caption",ans:r,a:"text-style-name"},{ens:r,
en:"circle",ans:r,a:"text-style-name"},{ens:r,en:"connector",ans:r,a:"text-style-name"},{ens:r,en:"control",ans:r,a:"text-style-name"},{ens:r,en:"custom-shape",ans:r,a:"text-style-name"},{ens:r,en:"ellipse",ans:r,a:"text-style-name"},{ens:r,en:"frame",ans:r,a:"text-style-name"},{ens:r,en:"line",ans:r,a:"text-style-name"},{ens:r,en:"measure",ans:r,a:"text-style-name"},{ens:r,en:"path",ans:r,a:"text-style-name"},{ens:r,en:"polygon",ans:r,a:"text-style-name"},{ens:r,en:"polyline",ans:r,a:"text-style-name"},
{ens:r,en:"rect",ans:r,a:"text-style-name"},{ens:r,en:"regular-polygon",ans:r,a:"text-style-name"},{ens:z,en:"annotation",ans:r,a:"text-style-name"},{ens:B,en:"column",ans:B,a:"text-style-name"},{ens:A,en:"style",ans:A,a:"next-style-name"},{ens:t,en:"body",ans:t,a:"paragraph-style-name"},{ens:t,en:"even-columns",ans:t,a:"paragraph-style-name"},{ens:t,en:"even-rows",ans:t,a:"paragraph-style-name"},{ens:t,en:"first-column",ans:t,a:"paragraph-style-name"},{ens:t,en:"first-row",ans:t,a:"paragraph-style-name"},
{ens:t,en:"last-column",ans:t,a:"paragraph-style-name"},{ens:t,en:"last-row",ans:t,a:"paragraph-style-name"},{ens:t,en:"odd-columns",ans:t,a:"paragraph-style-name"},{ens:t,en:"odd-rows",ans:t,a:"paragraph-style-name"},{ens:w,en:"notes-configuration",ans:w,a:"default-style-name"},{ens:w,en:"alphabetical-index-entry-template",ans:w,a:"style-name"},{ens:w,en:"bibliography-entry-template",ans:w,a:"style-name"},{ens:w,en:"h",ans:w,a:"style-name"},{ens:w,en:"illustration-index-entry-template",ans:w,a:"style-name"},
{ens:w,en:"index-source-style",ans:w,a:"style-name"},{ens:w,en:"object-index-entry-template",ans:w,a:"style-name"},{ens:w,en:"p",ans:w,a:"style-name"},{ens:w,en:"table-index-entry-template",ans:w,a:"style-name"},{ens:w,en:"table-of-content-entry-template",ans:w,a:"style-name"},{ens:w,en:"table-index-entry-template",ans:w,a:"style-name"},{ens:w,en:"user-index-entry-template",ans:w,a:"style-name"},{ens:A,en:"page-layout-properties",ans:A,a:"register-truth-ref-style-name"}],chart:[{ens:a,en:"axis",ans:a,
a:"style-name"},{ens:a,en:"chart",ans:a,a:"style-name"},{ens:a,en:"data-label",ans:a,a:"style-name"},{ens:a,en:"data-point",ans:a,a:"style-name"},{ens:a,en:"equation",ans:a,a:"style-name"},{ens:a,en:"error-indicator",ans:a,a:"style-name"},{ens:a,en:"floor",ans:a,a:"style-name"},{ens:a,en:"footer",ans:a,a:"style-name"},{ens:a,en:"grid",ans:a,a:"style-name"},{ens:a,en:"legend",ans:a,a:"style-name"},{ens:a,en:"mean-value",ans:a,a:"style-name"},{ens:a,en:"plot-area",ans:a,a:"style-name"},{ens:a,en:"regression-curve",
ans:a,a:"style-name"},{ens:a,en:"series",ans:a,a:"style-name"},{ens:a,en:"stock-gain-marker",ans:a,a:"style-name"},{ens:a,en:"stock-loss-marker",ans:a,a:"style-name"},{ens:a,en:"stock-range-line",ans:a,a:"style-name"},{ens:a,en:"subtitle",ans:a,a:"style-name"},{ens:a,en:"title",ans:a,a:"style-name"},{ens:a,en:"wall",ans:a,a:"style-name"}],section:[{ens:w,en:"alphabetical-index",ans:w,a:"style-name"},{ens:w,en:"bibliography",ans:w,a:"style-name"},{ens:w,en:"illustration-index",ans:w,a:"style-name"},
{ens:w,en:"index-title",ans:w,a:"style-name"},{ens:w,en:"object-index",ans:w,a:"style-name"},{ens:w,en:"section",ans:w,a:"style-name"},{ens:w,en:"table-of-content",ans:w,a:"style-name"},{ens:w,en:"table-index",ans:w,a:"style-name"},{ens:w,en:"user-index",ans:w,a:"style-name"}],ruby:[{ens:w,en:"ruby",ans:w,a:"style-name"}],table:[{ens:c,en:"query",ans:c,a:"style-name"},{ens:c,en:"table-representation",ans:c,a:"style-name"},{ens:t,en:"background",ans:t,a:"style-name"},{ens:t,en:"table",ans:t,a:"style-name"}],
"table-column":[{ens:c,en:"column",ans:c,a:"style-name"},{ens:t,en:"table-column",ans:t,a:"style-name"}],"table-row":[{ens:c,en:"query",ans:c,a:"default-row-style-name"},{ens:c,en:"table-representation",ans:c,a:"default-row-style-name"},{ens:t,en:"table-row",ans:t,a:"style-name"}],"table-cell":[{ens:c,en:"column",ans:c,a:"default-cell-style-name"},{ens:t,en:"table-column",ans:t,a:"default-cell-style-name"},{ens:t,en:"table-row",ans:t,a:"default-cell-style-name"},{ens:t,en:"body",ans:t,a:"style-name"},
{ens:t,en:"covered-table-cell",ans:t,a:"style-name"},{ens:t,en:"even-columns",ans:t,a:"style-name"},{ens:t,en:"covered-table-cell",ans:t,a:"style-name"},{ens:t,en:"even-columns",ans:t,a:"style-name"},{ens:t,en:"even-rows",ans:t,a:"style-name"},{ens:t,en:"first-column",ans:t,a:"style-name"},{ens:t,en:"first-row",ans:t,a:"style-name"},{ens:t,en:"last-column",ans:t,a:"style-name"},{ens:t,en:"last-row",ans:t,a:"style-name"},{ens:t,en:"odd-columns",ans:t,a:"style-name"},{ens:t,en:"odd-rows",ans:t,a:"style-name"},
{ens:t,en:"table-cell",ans:t,a:"style-name"}],graphic:[{ens:k,en:"cube",ans:r,a:"style-name"},{ens:k,en:"extrude",ans:r,a:"style-name"},{ens:k,en:"rotate",ans:r,a:"style-name"},{ens:k,en:"scene",ans:r,a:"style-name"},{ens:k,en:"sphere",ans:r,a:"style-name"},{ens:r,en:"caption",ans:r,a:"style-name"},{ens:r,en:"circle",ans:r,a:"style-name"},{ens:r,en:"connector",ans:r,a:"style-name"},{ens:r,en:"control",ans:r,a:"style-name"},{ens:r,en:"custom-shape",ans:r,a:"style-name"},{ens:r,en:"ellipse",ans:r,a:"style-name"},
{ens:r,en:"frame",ans:r,a:"style-name"},{ens:r,en:"g",ans:r,a:"style-name"},{ens:r,en:"line",ans:r,a:"style-name"},{ens:r,en:"measure",ans:r,a:"style-name"},{ens:r,en:"page-thumbnail",ans:r,a:"style-name"},{ens:r,en:"path",ans:r,a:"style-name"},{ens:r,en:"polygon",ans:r,a:"style-name"},{ens:r,en:"polyline",ans:r,a:"style-name"},{ens:r,en:"rect",ans:r,a:"style-name"},{ens:r,en:"regular-polygon",ans:r,a:"style-name"},{ens:z,en:"annotation",ans:r,a:"style-name"}],presentation:[{ens:k,en:"cube",ans:v,
a:"style-name"},{ens:k,en:"extrude",ans:v,a:"style-name"},{ens:k,en:"rotate",ans:v,a:"style-name"},{ens:k,en:"scene",ans:v,a:"style-name"},{ens:k,en:"sphere",ans:v,a:"style-name"},{ens:r,en:"caption",ans:v,a:"style-name"},{ens:r,en:"circle",ans:v,a:"style-name"},{ens:r,en:"connector",ans:v,a:"style-name"},{ens:r,en:"control",ans:v,a:"style-name"},{ens:r,en:"custom-shape",ans:v,a:"style-name"},{ens:r,en:"ellipse",ans:v,a:"style-name"},{ens:r,en:"frame",ans:v,a:"style-name"},{ens:r,en:"g",ans:v,a:"style-name"},
{ens:r,en:"line",ans:v,a:"style-name"},{ens:r,en:"measure",ans:v,a:"style-name"},{ens:r,en:"page-thumbnail",ans:v,a:"style-name"},{ens:r,en:"path",ans:v,a:"style-name"},{ens:r,en:"polygon",ans:v,a:"style-name"},{ens:r,en:"polyline",ans:v,a:"style-name"},{ens:r,en:"rect",ans:v,a:"style-name"},{ens:r,en:"regular-polygon",ans:v,a:"style-name"},{ens:z,en:"annotation",ans:v,a:"style-name"}],"drawing-page":[{ens:r,en:"page",ans:r,a:"style-name"},{ens:v,en:"notes",ans:r,a:"style-name"},{ens:A,en:"handout-master",
ans:r,a:"style-name"},{ens:A,en:"master-page",ans:r,a:"style-name"}],"list-style":[{ens:w,en:"list",ans:w,a:"style-name"},{ens:w,en:"numbered-paragraph",ans:w,a:"style-name"},{ens:w,en:"list-item",ans:w,a:"style-override"},{ens:A,en:"style",ans:A,a:"list-style-name"}],data:[{ens:A,en:"style",ans:A,a:"data-style-name"},{ens:A,en:"style",ans:A,a:"percentage-data-style-name"},{ens:v,en:"date-time-decl",ans:A,a:"data-style-name"},{ens:w,en:"creation-date",ans:A,a:"data-style-name"},{ens:w,en:"creation-time",
ans:A,a:"data-style-name"},{ens:w,en:"database-display",ans:A,a:"data-style-name"},{ens:w,en:"date",ans:A,a:"data-style-name"},{ens:w,en:"editing-duration",ans:A,a:"data-style-name"},{ens:w,en:"expression",ans:A,a:"data-style-name"},{ens:w,en:"meta-field",ans:A,a:"data-style-name"},{ens:w,en:"modification-date",ans:A,a:"data-style-name"},{ens:w,en:"modification-time",ans:A,a:"data-style-name"},{ens:w,en:"print-date",ans:A,a:"data-style-name"},{ens:w,en:"print-time",ans:A,a:"data-style-name"},{ens:w,
en:"table-formula",ans:A,a:"data-style-name"},{ens:w,en:"time",ans:A,a:"data-style-name"},{ens:w,en:"user-defined",ans:A,a:"data-style-name"},{ens:w,en:"user-field-get",ans:A,a:"data-style-name"},{ens:w,en:"user-field-input",ans:A,a:"data-style-name"},{ens:w,en:"variable-get",ans:A,a:"data-style-name"},{ens:w,en:"variable-input",ans:A,a:"data-style-name"},{ens:w,en:"variable-set",ans:A,a:"data-style-name"}],"page-layout":[{ens:v,en:"notes",ans:A,a:"page-layout-name"},{ens:A,en:"handout-master",ans:A,
a:"page-layout-name"},{ens:A,en:"master-page",ans:A,a:"page-layout-name"}]},D,C=xmldom.XPath;this.collectUsedFontFaces=d;this.changeFontFaceNames=n;this.UsedStyleList=function(a,c){var k={};this.uses=function(a){var c=a.localName,b=a.getAttributeNS(r,"name")||a.getAttributeNS(A,"name");a="style"===c?a.getAttributeNS(A,"family"):a.namespaceURI===y?"data":c;return(a=k[a])?0<a[b]:!1};b(a,k);c&&p(c,k)};this.getStyleName=function(a,c){var b,k,d=D[c.localName];if(d&&(d=d[c.namespaceURI]))for(k=0;k<d.length;k+=
1)if(d[k].keyname===a&&(d=d[k],c.hasAttributeNS(d.ns,d.localname))){b=c.getAttributeNS(d.ns,d.localname);break}return b};this.hasDerivedStyles=function(a,c,b){var k=b.getAttributeNS(A,"name");b=b.getAttributeNS(A,"family");return C.getODFElementsWithXPath(a,'//style:*[@style:parent-style-name="'+k+'"][@style:family="'+b+'"]',c).length?!0:!1};this.prefixStyleNames=function(a,c,b){var k;if(a){for(k=a.firstChild;k;){if(k.nodeType===Node.ELEMENT_NODE){var d=k,f=c,g=d.getAttributeNS(r,"name"),l=void 0;
g?l=r:(g=d.getAttributeNS(A,"name"))&&(l=A);l&&d.setAttributeNS(l,H[l]+"name",f+g)}k=k.nextSibling}m(a,c);b&&m(b,c)}};this.removePrefixFromStyleNames=function(a,c,b){var k=new RegExp("^"+c);if(a){for(c=a.firstChild;c;){if(c.nodeType===Node.ELEMENT_NODE){var d=c,f=k,g=d.getAttributeNS(r,"name"),l=void 0;g?l=r:(g=d.getAttributeNS(A,"name"))&&(l=A);l&&(g=g.replace(f,""),d.setAttributeNS(l,H[l]+"name",g))}c=c.nextSibling}e(a,k);b&&e(b,k)}};this.determineStylesForNode=h;D=function(){var a,c,b,k,d,f={},
r,g,l,e;for(b in I)if(I.hasOwnProperty(b))for(k=I[b],c=k.length,a=0;a<c;a+=1)d=k[a],l=d.en,e=d.ens,f.hasOwnProperty(l)?r=f[l]:f[l]=r={},r.hasOwnProperty(e)?g=r[e]:r[e]=g=[],g.push({ns:d.ans,localname:d.a,keyname:b});return f}()};"function"!==typeof Object.create&&(Object.create=function(m){var e=function(){};e.prototype=m;return new e});
xmldom.LSSerializer=function(){function m(b){var g=b||{},l=function(b){var a={},c;for(c in b)b.hasOwnProperty(c)&&(a[b[c]]=c);return a}(b),e=[g],h=[l],d=0;this.push=function(){d+=1;g=e[d]=Object.create(g);l=h[d]=Object.create(l)};this.pop=function(){e.pop();h.pop();d-=1;g=e[d];l=h[d]};this.getLocalNamespaceDefinitions=function(){return l};this.getQName=function(b){var a=b.namespaceURI,c=0,k;if(!a)return b.localName;if(k=l[a])return k+":"+b.localName;do{k||!b.prefix?(k="ns"+c,c+=1):k=b.prefix;if(g[k]===
a)break;if(!g[k]){g[k]=a;l[a]=k;break}k=null}while(null===k);return k+":"+b.localName}}function e(b){return b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;")}function h(f,g){var l="",q=b.filter?b.filter.acceptNode(g):NodeFilter.FILTER_ACCEPT,p;if(g.getAttribute&&"ok"==g.getAttribute("added"))return l;if(q===NodeFilter.FILTER_ACCEPT&&g.nodeType===Node.ELEMENT_NODE){f.push();p=f.getQName(g);var d,n=g.attributes,a,c,k,r="",m;d="<"+p;a=n.length;
for(c=0;c<a;c+=1)k=n.item(c),"http://www.w3.org/2000/xmlns/"!==k.namespaceURI&&(m=b.filter?b.filter.acceptNode(k):NodeFilter.FILTER_ACCEPT,m===NodeFilter.FILTER_ACCEPT&&(m=f.getQName(k),k="string"===typeof k.value?e(k.value):k.value,r+=" "+(m+'="'+k+'"')));a=f.getLocalNamespaceDefinitions();for(c in a)a.hasOwnProperty(c)&&((n=a[c])?"xmlns"!==n&&(d+=" xmlns:"+a[c]+'="'+c+'"'):d+=' xmlns="'+c+'"');l+=d+(r+">")}if(q===NodeFilter.FILTER_ACCEPT||q===NodeFilter.FILTER_SKIP){for(q=g.firstChild;q;)l+=h(f,
q),q=q.nextSibling;g.nodeValue&&(l+=e(g.nodeValue))}p&&(l+="</"+p+">",f.pop());return l}var b=this;this.filter=null;this.writeToString=function(b,g){if(!b)return"";var l=new m(g);return h(l,b)}};
(function(){function m(b){var a,c=q.length;for(a=0;a<c;a+=1)if("urn:oasis:names:tc:opendocument:xmlns:office:1.0"===b.namespaceURI&&b.localName===q[a])return a;return-1}function e(b,a){var c=new f.UsedStyleList(b,a),k=new odf.OdfNodeFilter;this.acceptNode=function(b){var d=k.acceptNode(b);d===NodeFilter.FILTER_ACCEPT&&b.parentNode===a&&b.nodeType===Node.ELEMENT_NODE&&(d=c.uses(b)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT);return d}}function h(b,a){var c=new e(b,a);this.acceptNode=function(a){var b=
c.acceptNode(a);b!==NodeFilter.FILTER_ACCEPT||!a.parentNode||a.parentNode.namespaceURI!==odf.Namespaces.textns||"s"!==a.parentNode.localName&&"tab"!==a.parentNode.localName||(b=NodeFilter.FILTER_REJECT);return b}}function b(b,a){if(a){var c=m(a),k,d=b.firstChild;if(-1!==c){for(;d;){k=m(d);if(-1!==k&&k>c)break;d=d.nextSibling}b.insertBefore(a,d)}}}var f=new odf.StyleInfo,g=core.DomUtils,l=odf.Namespaces.stylens,q="meta settings scripts font-face-decls styles automatic-styles master-styles body".split(" "),
p=Date.now()+"_webodf_",d=new core.Base64;odf.ODFElement=function(){};odf.ODFDocumentElement=function(){};odf.ODFDocumentElement.prototype=new odf.ODFElement;odf.ODFDocumentElement.prototype.constructor=odf.ODFDocumentElement;odf.ODFDocumentElement.prototype.automaticStyles;odf.ODFDocumentElement.prototype.body;odf.ODFDocumentElement.prototype.fontFaceDecls=null;odf.ODFDocumentElement.prototype.manifest=null;odf.ODFDocumentElement.prototype.masterStyles;odf.ODFDocumentElement.prototype.meta;odf.ODFDocumentElement.prototype.settings=
null;odf.ODFDocumentElement.prototype.styles;odf.ODFDocumentElement.namespaceURI="urn:oasis:names:tc:opendocument:xmlns:office:1.0";odf.ODFDocumentElement.localName="document";odf.AnnotationElement=function(){};odf.AnnotationElement.prototype.annotationEndElement;odf.OdfPart=function(b,a,c,k){var d=this;this.size=0;this.type=null;this.name=b;this.container=c;this.url=null;this.mimetype=a;this.onstatereadychange=this.document=null;this.onchange;this.EMPTY=0;this.LOADING=1;this.DONE=2;this.state=this.EMPTY;
this.data="";this.load=function(){null!==k&&(this.mimetype=a,k.loadAsDataURL(b,a,function(a,c){a&&runtime.log(a);d.url=c;if(d.onchange)d.onchange(d);if(d.onstatereadychange)d.onstatereadychange(d)}))}};odf.OdfPart.prototype.load=function(){};odf.OdfPart.prototype.getUrl=function(){return this.data?"data:;base64,"+d.toBase64(this.data):null};odf.OdfContainer=function a(c,k){function d(a){for(var c=a.firstChild,b;c;)b=c.nextSibling,c.nodeType===Node.ELEMENT_NODE?d(c):c.nodeType===Node.PROCESSING_INSTRUCTION_NODE&&
a.removeChild(c),c=b}function q(a){var c={},b,k,d=a.ownerDocument.createNodeIterator(a,NodeFilter.SHOW_ELEMENT,null,!1);for(a=d.nextNode();a;)"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&("annotation"===a.localName?(b=a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))&&(c.hasOwnProperty(b)?runtime.log("Warning: annotation name used more than once with <office:annotation/>: '"+b+"'"):c[b]=a):"annotation-end"===a.localName&&((b=a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"name"))?c.hasOwnProperty(b)?(k=c[b],k.annotationEndElement?runtime.log("Warning: annotation name used more than once with <office:annotation-end/>: '"+b+"'"):k.annotationEndElement=a):runtime.log("Warning: annotation end without an annotation start, name: '"+b+"'"):runtime.log("Warning: annotation end without a name found"))),a=d.nextNode()}function m(a,c){for(var b=a&&a.firstChild;b;)b.nodeType===Node.ELEMENT_NODE&&b.setAttributeNS("urn:webodf:names:scope","scope",c),b=b.nextSibling}function z(a,
c){for(var b=X.rootElement.meta,b=b&&b.firstChild;b&&(b.namespaceURI!==a||b.localName!==c);)b=b.nextSibling;for(b=b&&b.firstChild;b&&b.nodeType!==Node.TEXT_NODE;)b=b.nextSibling;return b?b.data:null}function v(a){var c={},b;for(a=a.firstChild;a;)a.nodeType===Node.ELEMENT_NODE&&a.namespaceURI===l&&"font-face"===a.localName&&(b=a.getAttributeNS(l,"name"),c[b]=a),a=a.nextSibling;return c}function A(a,c){var b=null,k,d,s;if(a)for(b=a.cloneNode(!0),k=b.firstElementChild;k;)d=k.nextElementSibling,(s=k.getAttributeNS("urn:webodf:names:scope",
"scope"))&&s!==c&&b.removeChild(k),k=d;return b}function t(a,c){var b,k,d,s=null,r={};if(a)for(c.forEach(function(a){f.collectUsedFontFaces(r,a)}),s=a.cloneNode(!0),b=s.firstElementChild;b;)k=b.nextElementSibling,d=b.getAttributeNS(l,"name"),r[d]||s.removeChild(b),b=k;return s}function w(a){var c=X.rootElement.ownerDocument,b;if(a){d(a.documentElement);try{b=c.importNode(a.documentElement,!0)}catch(k){}}return b}function H(a){X.state=a;if(X.onchange)X.onchange(X);if(X.onstatereadychange)X.onstatereadychange(X)}
function I(a){da=null;X.rootElement=a;a.fontFaceDecls=g.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls");a.styles=g.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles");a.automaticStyles=g.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles");a.masterStyles=g.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles");a.body=g.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"body");a.meta=g.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta");a.settings=g.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","settings");a.scripts=g.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","scripts");q(a)}function D(c){var k=w(c),d=X.rootElement,s;k&&"document-styles"===k.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===k.namespaceURI?(d.fontFaceDecls=g.getDirectChild(k,"urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"font-face-decls"),b(d,d.fontFaceDecls),s=g.getDirectChild(k,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),d.styles=s||c.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),b(d,d.styles),s=g.getDirectChild(k,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),d.automaticStyles=s||c.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),m(d.automaticStyles,"document-styles"),b(d,d.automaticStyles),k=g.getDirectChild(k,
"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),d.masterStyles=k||c.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),b(d,d.masterStyles),f.prefixStyleNames(d.automaticStyles,p,d.masterStyles)):H(a.INVALID)}function C(c){c=w(c);var k,d,s,r;if(c&&"document-content"===c.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===c.namespaceURI){k=X.rootElement;s=g.getDirectChild(c,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls");
if(k.fontFaceDecls&&s){r=k.fontFaceDecls;var e,x,h,G,t={};d=v(r);G=v(s);for(s=s.firstElementChild;s;){e=s.nextElementSibling;if(s.namespaceURI===l&&"font-face"===s.localName)if(x=s.getAttributeNS(l,"name"),d.hasOwnProperty(x)){if(!s.isEqualNode(d[x])){h=x;for(var q=d,u=G,p=0,B=void 0,B=h=h.replace(/\d+$/,"");q.hasOwnProperty(B)||u.hasOwnProperty(B);)p+=1,B=h+p;h=B;s.setAttributeNS(l,"style:name",h);r.appendChild(s);d[h]=s;delete G[x];t[x]=h}}else r.appendChild(s),d[x]=s,delete G[x];s=e}r=t}else s&&
(k.fontFaceDecls=s,b(k,s));d=g.getDirectChild(c,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles");m(d,"document-content");r&&f.changeFontFaceNames(d,r);if(k.automaticStyles&&d)for(r=d.firstChild;r;)k.automaticStyles.appendChild(r),r=d.firstChild;else d&&(k.automaticStyles=d,b(k,d));c=g.getDirectChild(c,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body");if(null===c){g_errmsg("An error has occurred. &lt;office:body/&gt; tag is mising.");throw"<office:body/> tag is mising.";}k.body=c;b(k,k.body)}else H(a.INVALID)}function s(a){a=w(a);var c;a&&
"document-meta"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&(c=X.rootElement,c.meta=g.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),b(c,c.meta))}function u(a){a=w(a);var c;a&&"document-settings"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&(c=X.rootElement,c.settings=g.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","settings"),b(c,c.settings))}function x(a){a=w(a);var c;
if(a&&"manifest"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===a.namespaceURI)for(c=X.rootElement,c.manifest=a,a=c.manifest.firstElementChild;a;)"file-entry"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===a.namespaceURI&&(R[a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","full-path")]=a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","media-type")),a=a.nextElementSibling}function G(a,c,b){a=g.getElementsByTagName(a,
c);var k;for(k=0;k<a.length;k+=1)c=a[k],b.hasOwnProperty(c.namespaceURI)||c.parentNode.removeChild(c)}function M(a){G(a,"script",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:office:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:table:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:text:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":!0});G(a,"style",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":!0,
"urn:oasis:names:tc:opendocument:xmlns:style:1.0":!0})}function F(a){var c=a.firstElementChild,b=[],k,d,s,f=a.attributes,r=f.length;for(k=0;k<r;k+=1)s=f.item(k),d=s.localName.substr(0,2).toLowerCase(),null===s.namespaceURI&&"on"===d&&b.push(s);r=b.length;for(k=0;k<r;k+=1)a.removeAttributeNode(b[k]);for(;c;)F(c),c=c.nextElementSibling}function J(c){var b=c.shift();if(b){var k=(new Date).getTime();Z.loadAsDOM(b.path,function(d,s){s&&(M(s),F(s.documentElement));b.handler(s);5E3<(new Date).getTime()-
k?g_errmsg("Sorry, It takes too much time to run."):X.state===a.INVALID?d?runtime.log("ERROR: Unable to load "+b.path+" - "+d):runtime.log("ERROR: Unable to load "+b.path):(d&&runtime.log("DEBUG: Unable to load "+b.path+" - "+d),J(c))})}else q(X.rootElement),H(a.DONE)}function P(a){var c="";odf.Namespaces.forEachPrefix(function(a,b){c+=" xmlns:"+a+'="'+b+'"'});return'<?xml version="1.0" encoding="UTF-8"?><office:'+a+" "+c+' office:version="1.2">'}function E(){var a=new xmldom.LSSerializer,c=P("document-meta");
a.filter=new odf.OdfNodeFilter;c+=a.writeToString(X.rootElement.meta,odf.Namespaces.namespaceMap);return c+"</office:document-meta>"}function aa(a,c){var b=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:file-entry");b.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:full-path",a);b.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:media-type",c);return b}function Q(){var a=runtime.parseXML('<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2"></manifest:manifest>'),
c=a.documentElement,b=new xmldom.LSSerializer,k;for(k in R)R.hasOwnProperty(k)&&c.appendChild(aa(k,R[k]));b.filter=new odf.OdfNodeFilter;return'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n'+b.writeToString(a,odf.Namespaces.namespaceMap)}function U(){var a,c,b,k=odf.Namespaces.namespaceMap,d=new xmldom.LSSerializer,s=P("document-styles");c=A(X.rootElement.automaticStyles,"document-styles");b=X.rootElement.masterStyles.cloneNode(!0);a=t(X.rootElement.fontFaceDecls,[b,X.rootElement.styles,
c]);f.removePrefixFromStyleNames(c,p,b);d.filter=new e(b,c);s+=d.writeToString(a,k);s+=d.writeToString(X.rootElement.styles,k);s+=d.writeToString(c,k);s+=d.writeToString(b,k);return s+"</office:document-styles>"}function W(){var a,c,b=odf.Namespaces.namespaceMap,k=new xmldom.LSSerializer,d=P("document-content");c=A(X.rootElement.automaticStyles,"document-content");a=t(X.rootElement.fontFaceDecls,[c]);k.filter=new h(X.rootElement.body,c);d+=k.writeToString(a,b);d+=k.writeToString(c,b);d+=k.writeToString(X.rootElement.body,
b);return d+"</office:document-content>"}function K(c,b){runtime.loadXML(c,function(c,k){if(c)b(c);else if(k){M(k);F(k.documentElement);var d=w(k);d&&"document"===d.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===d.namespaceURI?(I(d),H(a.DONE)):H(a.INVALID)}else b("No DOM was loaded.")})}function ba(a,c){var k;k=X.rootElement;var d=k.meta;d||(k.meta=d=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),b(k,d));k=d;a&&g.mapKeyValObjOntoNode(k,a,odf.Namespaces.lookupNamespaceURI);
c&&g.removeKeyElementsFromNode(k,c,odf.Namespaces.lookupNamespaceURI)}function Y(c,b){function k(a,c){var b;c||(c=a);b=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",c);f[a]=b;f.appendChild(b)}var d=new core.Zip("",null),s="application/vnd.oasis.opendocument."+c+(!0===b?"-template":""),f=X.rootElement,r=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",c);d.save("mimetype",s,!1,new Date);k("meta");k("settings");k("scripts");k("fontFaceDecls",
"font-face-decls");k("styles");k("automaticStyles","automatic-styles");k("masterStyles","master-styles");k("body");f.body.appendChild(r);R["/"]=s;R["settings.xml"]="text/xml";R["meta.xml"]="text/xml";R["styles.xml"]="text/xml";R["content.xml"]="text/xml";H(a.DONE);return d}function S(){var a=new Date,c,b="";X.rootElement.settings&&X.rootElement.settings.firstElementChild&&(c=new xmldom.LSSerializer,b=P("document-settings"),c.filter=new odf.OdfNodeFilter,b+=c.writeToString(X.rootElement.settings,odf.Namespaces.namespaceMap),
b+="</office:document-settings>");(c=b)?Z.save("settings.xml",c,!0,a):Z.remove("settings.xml");b=runtime.getWindow();c="WebODF/"+webodf.Version;b&&(c=c+" "+b.navigator.userAgent);ba({"meta:generator":c},null);Z.save("meta.xml",E(),!0,a);Z.save("styles.xml",U(),!0,a);Z.save("content.xml",W(),!0,a);Z.save("META-INF/manifest.xml",Q(),!0,a)}function $(a,c){S();Z.writeAs(a,function(a){c(a)})}var X=this,Z,R={},da,L="";this.onstatereadychange=k;this.state=this.onchange=null;this.rootElement;this.getMetadata=
z;this.setRootElement=I;this.getContentElement=function(){var a;da||(a=X.rootElement.body,da=g.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","text")||g.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","presentation")||g.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","spreadsheet"));if(!da){var c="An error has occurred. Please check whether the file format supports. or Reopen a file.";a&&g.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"drawing")&&(c+="<br>This file seems to be a ODG (OpenDocument Graphics document) format.");g_errmsg('<div style="margin:0px 30px">'+c+"</div>");throw"Could not find content element in <office:body/>.";}return da};this.getDocumentType=function(){var a=X.getContentElement();return a&&a.localName};this.isTemplate=function(){return"-template"===R["/"].substr(-9)};this.setIsTemplate=function(a){var c=R["/"],b="-template"===c.substr(-9);a!==b&&(c=a?c+"-template":c.substr(0,c.length-9),R["/"]=c,Z.save("mimetype",
c,!1,new Date))};this.getPart=function(a){return new odf.OdfPart(a,R[a],X,Z)};this.getPartData=function(a,c){Z.load(a,c)};this.getPartData2=function(a,c){Z.loadAsString(a,c)};this.setMetadata=ba;this.incrementEditingCycles=function(){var a=z(odf.Namespaces.metans,"editing-cycles"),a=a?parseInt(a,10):0;isNaN(a)&&(a=0);ba({"meta:editing-cycles":a+1},null);return a+1};this.createByteArray=function(a,c){S();Z.createByteArray(a,c)};this.saveAs=$;this.save=function(a){$(L,a)};this.getUrl=function(){return L};
this.setBlob=function(a,c,b){Z.isexist(a)||(Z.save(a,b,!0,new Date,!0),R.hasOwnProperty(a)&&runtime.log(a+" has been overwritten."),R[a]=c)};this.removeBlob=function(a){var c=Z.remove(a);runtime.assert(c,"file is not found: "+a);delete R[a]};this.state=a.LOADING;this.rootElement=function(a){var c=document.createElementNS(a.namespaceURI,a.localName),b;a=new a.Type;for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c}({Type:odf.ODFDocumentElement,namespaceURI:odf.ODFDocumentElement.namespaceURI,localName:odf.ODFDocumentElement.localName});
c===odf.OdfContainer.DocumentType.TEXT?Z=Y("text"):c===odf.OdfContainer.DocumentType.TEXT_TEMPLATE?Z=Y("text",!0):c===odf.OdfContainer.DocumentType.PRESENTATION?Z=Y("presentation"):c===odf.OdfContainer.DocumentType.PRESENTATION_TEMPLATE?Z=Y("presentation",!0):c===odf.OdfContainer.DocumentType.SPREADSHEET?Z=Y("spreadsheet"):c===odf.OdfContainer.DocumentType.SPREADSHEET_TEMPLATE?Z=Y("spreadsheet",!0):(L=c,Z=new core.Zip(L,function(c,b){Z=b;c?K(L,function(b){c&&(Z.error=c+"\n"+b,H(a.INVALID))}):J([{path:"styles.xml",
handler:D},{path:"content.xml",handler:C},{path:"meta.xml",handler:s},{path:"settings.xml",handler:u},{path:"META-INF/manifest.xml",handler:x}])}))};odf.OdfContainer.EMPTY=0;odf.OdfContainer.LOADING=1;odf.OdfContainer.DONE=2;odf.OdfContainer.INVALID=3;odf.OdfContainer.SAVING=4;odf.OdfContainer.MODIFIED=5;odf.OdfContainer.getContainer=function(a){return new odf.OdfContainer(a,null)}})();odf.OdfContainer.DocumentType={TEXT:1,TEXT_TEMPLATE:2,PRESENTATION:3,PRESENTATION_TEMPLATE:4,SPREADSHEET:5,SPREADSHEET_TEMPLATE:6};
gui.AnnotatableCanvas=function(){};gui.AnnotatableCanvas.prototype.refreshSize=function(){};gui.AnnotatableCanvas.prototype.getZoomLevel=function(){};gui.AnnotatableCanvas.prototype.getSizer=function(){};
gui.AnnotationViewManager=function(m,e,h,b){function f(c){var b=c.annotationEndElement,d=n.createRange(),f=c.getAttributeNS(odf.Namespaces.officens,"name");b&&(d.setStart(c,c.childNodes.length),d.setEnd(b,0),c=a.getTextNodes(d,!1),c.forEach(function(a){var c;a:{for(c=a.parentNode;c.namespaceURI!==odf.Namespaces.officens||"body"!==c.localName;){if("http://www.w3.org/1999/xhtml"===c.namespaceURI&&"webodf-annotationHighlight"===c.className&&c.getAttribute("annotation")===f){c=!0;break a}c=c.parentNode}c=
!1}c||(c=n.createElement("span"),c.className="webodf-annotationHighlight",c.setAttribute("annotation",f),a.parentNode.replaceChild(c,a),c.appendChild(a))}));d.detach()}function g(a){var b=m.getSizer();a?(h.style.display="inline-block",b.style.paddingRight=c.getComputedStyle(h).width):(h.style.display="none",b.style.paddingRight=0);m.refreshSize()}function l(){d.sort(function(a,c){return 0!==(a.compareDocumentPosition(c)&Node.DOCUMENT_POSITION_FOLLOWING)?-1:1})}function q(){var a;for(a=0;a<d.length;a+=
1){var c=d[a],b=c.parentNode,f=b.nextElementSibling,g=f.nextElementSibling,l=b.parentNode,e=0,e=d[d.indexOf(c)-1],n=void 0,c=m.getZoomLevel();b.style.left=(h.getBoundingClientRect().left-l.getBoundingClientRect().left)/c+"px";b.style.width=h.getBoundingClientRect().width/c+"px";f.style.width=parseFloat(b.style.left)-30+"px";e?(n=e.parentNode.getBoundingClientRect(),20>=(l.getBoundingClientRect().top-n.bottom)/c?b.style.top=Math.abs(l.getBoundingClientRect().top-n.bottom)/c+20+"px":b.style.top="0px"):
b.style.top="0px";g.style.left=f.getBoundingClientRect().width/c+"px";var f=g.style,l=g.getBoundingClientRect().left/c,e=g.getBoundingClientRect().top/c,n=b.getBoundingClientRect().left/c,q=b.getBoundingClientRect().top/c,p=0,I=0,p=n-l,p=p*p,I=q-e,I=I*I,l=Math.sqrt(p+I);f.width=l+"px";e=Math.asin((b.getBoundingClientRect().top-g.getBoundingClientRect().top)/(c*parseFloat(g.style.width)));g.style.transform="rotate("+e+"rad)";g.style.MozTransform="rotate("+e+"rad)";g.style.WebkitTransform="rotate("+
e+"rad)";g.style.msTransform="rotate("+e+"rad)"}}function p(a){var c=d.indexOf(a),b=a.parentNode.parentNode;"div"===b.localName&&(b.parentNode.insertBefore(a,b),b.parentNode.removeChild(b));a=a.getAttributeNS(odf.Namespaces.officens,"name");a=n.querySelectorAll('span.webodf-annotationHighlight[annotation="'+a+'"]');for(var f,b=0;b<a.length;b+=1){for(f=a.item(b);f.firstChild;)f.parentNode.insertBefore(f.firstChild,f);f.parentNode.removeChild(f)}-1!==c&&d.splice(c,1);0===d.length&&g(!1)}var d=[],n=
e.ownerDocument,a=odf.OdfUtils,c=runtime.getWindow();runtime.assert(Boolean(c),"Expected to be run in an environment which has a global window, like a browser.");this.rerenderAnnotations=q;this.rehighlightAnnotations=function(){d.forEach(function(a){f(a)})};this.getMinimumHeightForAnnotationPane=function(){return"none"!==h.style.display&&0<d.length?(d[d.length-1].parentNode.getBoundingClientRect().bottom-h.getBoundingClientRect().top)/m.getZoomLevel()+"px":null};this.addAnnotations=function(c){0!==
c.length&&(g(!0),c.forEach(function(c){d.push(c);var k=n.createElement("div"),g=n.createElement("div"),l=n.createElement("div"),e=n.createElement("div"),h;k.className="annotationWrapper";k.setAttribute("creator",a.getAnnotationCreator(c));c.parentNode.insertBefore(k,c);g.className="annotationNote";g.appendChild(c);b&&(h=n.createElement("div"),h.className="annotationRemoveButton",g.appendChild(h));l.className="annotationConnector horizontal";e.className="annotationConnector angular";k.appendChild(g);
k.appendChild(l);k.appendChild(e);c.annotationEndElement&&f(c)}),l(),q())};this.forgetAnnotation=p;this.forgetAnnotations=function(){for(;d.length;)p(d[0])}};gui.Viewport=function(){};gui.Viewport.prototype.scrollIntoView=function(m,e){};
gui.SingleScrollViewport=function(m){this.scrollIntoView=function(e,h){var b,f,g,l;l=m.offsetHeight-m.clientHeight;g=m.offsetWidth-m.clientWidth;var q=m.getBoundingClientRect();if(e&&q){b=q.left+5;f=q.top+5;g=q.right-(g+5);l=q.bottom-(l+5);if(h||e.top<f)m.scrollTop-=f-e.top;else if(e.top>l||e.bottom>l)m.scrollTop=e.bottom-e.top<=l-f?m.scrollTop+(e.bottom-l):m.scrollTop+(e.top-f);e.left<b?m.scrollLeft-=b-e.left:e.right>g&&(m.scrollLeft=e.right-e.left<=g-b?m.scrollLeft+(e.right-g):m.scrollLeft-(b-e.left))}}};
(function(){function m(f,g,l,e,h){var d,n=0,a;for(a in f)if(f.hasOwnProperty(a)){if(n===l){d=a;break}n+=1}d?g.getPartData(f[d].href,function(a,k){if(a)runtime.log(a);else if(k){var r="@font-face { font-family: "+(f[d].family||d)+"; src: url(data:application/x-font-ttf;charset=binary;base64,"+b.convertUTF8ArrayToBase64(k)+') format("truetype"); }';try{e.insertRule(r,e.cssRules.length)}catch(n){runtime.log("Problem inserting rule in CSS: "+runtime.toJson(n)+"\nRule: "+r)}}else runtime.log("missing font data for "+
f[d].href);m(f,g,l+1,e,h)}):h&&h()}var e=xmldom.XPath,h=odf.OdfUtils,b=new core.Base64;odf.FontLoader=function(){this.loadFonts=function(b,g){for(var l=b.rootElement.fontFaceDecls;g.cssRules.length;)g.deleteRule(g.cssRules.length-1);if(l){var q={},p,d,n,a;if(l)for(l=e.getODFElementsWithXPath(l,"style:font-face[svg:font-face-src]",odf.Namespaces.lookupNamespaceURI),p=0;p<l.length;p+=1)d=l[p],n=d.getAttributeNS(odf.Namespaces.stylens,"name"),a=h.getNormalizedFontFamilyName(d.getAttributeNS(odf.Namespaces.svgns,
"font-family")),d=e.getODFElementsWithXPath(d,"svg:font-face-src/svg:font-face-uri",odf.Namespaces.lookupNamespaceURI),0<d.length&&(d=d[0].getAttributeNS(odf.Namespaces.xlinkns,"href"),q[n]={href:d,family:a});m(q,b,0,g)}}}})();
odf.Formatting=function(){function m(a){return(a=H[a])?t.mergeObjects({},a):{}}function e(){for(var c=a.rootElement.fontFaceDecls,b={},d,s,c=c&&c.firstElementChild;c;){if(d=c.getAttributeNS(r,"name"))if((s=c.getAttributeNS(k,"font-family"))||0<c.getElementsByTagNameNS(k,"font-face-uri").length)b[d]=s;c=c.nextElementSibling}return b}function h(c){for(var b=a.rootElement.styles.firstElementChild;b;){if(b.namespaceURI===r&&"default-style"===b.localName&&b.getAttributeNS(r,"family")===c)return b;b=b.nextElementSibling}return null}
function b(c,b,k){var d,f,g;k=k||[a.rootElement.automaticStyles,a.rootElement.styles];for(g=0;g<k.length;g+=1)for(d=k[g],d=d.firstElementChild;d;){f=d.getAttributeNS(r,"name");if(d.namespaceURI===r&&"style"===d.localName&&d.getAttributeNS(r,"family")===b&&f===c||"list-style"===b&&d.namespaceURI===B&&"list-style"===d.localName&&f===c||"data"===b&&d.namespaceURI===y&&f===c)return d;d=d.nextElementSibling}return null}function f(a){for(var c,b,d,k,f={},g=a.firstElementChild;g;){if(g.namespaceURI===r)for(d=
f[g.nodeName]={},b=g.attributes,c=0;c<b.length;c+=1)k=b.item(c),d[k.name]=k.value;g=g.nextElementSibling}b=a.attributes;for(c=0;c<b.length;c+=1)k=b.item(c),f[k.name]=k.value;return f}function g(c,k){for(var d=a.rootElement.styles,s,g={},l=c.getAttributeNS(r,"family"),e=c;e;)s=f(e),g=t.mergeObjects(s,g),e=(s=e.getAttributeNS(r,"parent-style-name"))?b(s,l,[d]):null;if(e=h(l))s=f(e),g=t.mergeObjects(s,g);!1!==k&&(s=m(l),g=t.mergeObjects(s,g));return g}function l(b,k){function d(a){Object.keys(a).forEach(function(c){Object.keys(a[c]).forEach(function(a){r+=
"|"+c+":"+a+"|"})})}for(var s=b.nodeType===Node.TEXT_NODE?b.parentNode:b,f,g=[],r="",l=!1;s&&!v.isInlineRoot(s)&&s.parentNode!==a.rootElement;)!l&&v.isGroupingElement(s)&&(l=!0),(f=c.determineStylesForNode(s))&&g.push(f),s=s.parentNode;l&&(g.forEach(d),k&&(k[r]=g));return l?g:void 0}function q(c){var k={orderedStyles:[],styleProperties:{}};c.forEach(function(c){Object.keys(c).forEach(function(d){var f=Object.keys(c[d])[0],l={name:f,family:d,displayName:void 0,isCommonStyle:!1},e;(e=b(f,d))?(d=g(e),
k.styleProperties=t.mergeObjects(d,k.styleProperties),l.displayName=e.getAttributeNS(r,"display-name")||void 0,l.isCommonStyle=e.parentNode===a.rootElement.styles):runtime.log("No style element found for '"+f+"' of family '"+d+"'");k.orderedStyles.push(l)})});return k}function p(a,c){var b={},k=[];c||(c={});a.forEach(function(a){l(a,b)});Object.keys(b).forEach(function(a){c[a]||(c[a]=q(b[a]));k.push(c[a])});return k}function d(c){for(var b=a.rootElement.masterStyles.firstElementChild;b&&(b.namespaceURI!==
r||"master-page"!==b.localName||b.getAttributeNS(r,"name")!==c);)b=b.nextElementSibling;return b}function n(a,c){var b;a&&(b=w.convertMeasure(a,"px"));void 0===b&&c&&(b=w.convertMeasure(c,"px"));return b}var a,c=new odf.StyleInfo,k=odf.Namespaces.svgns,r=odf.Namespaces.stylens,B=odf.Namespaces.textns,y=odf.Namespaces.numberns,z=odf.Namespaces.fons,v=odf.OdfUtils,A=core.DomUtils,t=new core.Utils,w=new core.CSSUnits,H={paragraph:{"style:paragraph-properties":{"fo:text-align":"left"}}};this.getSystemDefaultStyleAttributes=
m;this.setOdfContainer=function(c){a=c};this.getFontMap=e;this.getAvailableParagraphStyles=function(){for(var c=a.rootElement.styles,b,k,d=[],c=c&&c.firstElementChild;c;)"style"===c.localName&&c.namespaceURI===r&&(b=c.getAttributeNS(r,"family"),"paragraph"===b&&(b=c.getAttributeNS(r,"name"),k=c.getAttributeNS(r,"display-name")||b,b&&k&&d.push({name:b,displayName:k}))),c=c.nextElementSibling;return d};this.isStyleUsed=function(b){var k,d=a.rootElement;k=c.hasDerivedStyles(d,odf.Namespaces.lookupNamespaceURI,
b);b=(new c.UsedStyleList(d.styles)).uses(b)||(new c.UsedStyleList(d.automaticStyles)).uses(b)||(new c.UsedStyleList(d.body)).uses(b);return k||b};this.getDefaultStyleElement=h;this.getStyleElement=b;this.getStyleAttributes=f;this.getInheritedStyleAttributes=g;this.getFirstCommonParentStyleNameOrSelf=function(c){var k=a.rootElement.styles,d;if(d=b(c,"paragraph",[a.rootElement.automaticStyles]))if(c=d.getAttributeNS(r,"parent-style-name"),!c)return null;return(d=b(c,"paragraph",[k]))?c:null};this.hasParagraphStyle=
function(a){return Boolean(b(a,"paragraph"))};this.getAppliedStyles=p;this.getAppliedStylesForElement=function(a,c){return p([a],c)[0]};this.updateStyle=function(c,b){var d,s;A.mapObjOntoNode(c,b,odf.Namespaces.lookupNamespaceURI);(d=(d=b["style:text-properties"])&&d["style:font-name"])&&!e().hasOwnProperty(d)&&(s=c.ownerDocument.createElementNS(r,"style:font-face"),s.setAttributeNS(r,"style:name",d),s.setAttributeNS(k,"svg:font-family",d),a.rootElement.fontFaceDecls.appendChild(s))};this.createDerivedStyleObject=
function(c,d,k){var s=b(c,d);runtime.assert(Boolean(s),"No style element found for '"+c+"' of family '"+d+"'");c=s.parentNode===a.rootElement.styles?{"style:parent-style-name":c}:f(s);c["style:family"]=d;t.mergeObjects(c,k);return c};this.getDefaultTabStopDistance=function(){for(var a=h("paragraph"),a=a&&a.firstElementChild,c;a;)a.namespaceURI===r&&"paragraph-properties"===a.localName&&(c=a.getAttributeNS(r,"tab-stop-distance")),a=a.nextElementSibling;c||(c="1.25cm");return v.parseNonNegativeLength(c)};
this.getMasterPageElement=d;this.getContentSize=function(c,k){var f,s,g,l,e,h,t,q,p,m;a:{s=b(c,k);runtime.assert("paragraph"===k||"table"===k,"styleFamily must be either paragraph or table");if(s){if(s=s.getAttributeNS(r,"master-page-name"))(f=d(s))||runtime.log("WARN: No master page definition found for "+s);f||(f=d("Standard"));f||(f=a.rootElement.masterStyles.getElementsByTagNameNS(r,"master-page")[0])||runtime.log("WARN: Document has no master pages defined");if(f)for(s=f.getAttributeNS(r,"page-layout-name"),
g=a.rootElement.automaticStyles.getElementsByTagNameNS(r,"page-layout"),l=0;l<g.length;l+=1)if(f=g.item(l),f.getAttributeNS(r,"name")===s)break a}f=null}f||(f=A.getDirectChild(a.rootElement.styles,r,"default-page-layout"));(f=A.getDirectChild(f,r,"page-layout-properties"))?("landscape"===f.getAttributeNS(r,"print-orientation")?(s="29.7cm",g="21.001cm"):(s="21.001cm",g="29.7cm"),s=n(f.getAttributeNS(z,"page-width"),s),g=n(f.getAttributeNS(z,"page-height"),g),l=n(f.getAttributeNS(z,"margin")),void 0===
l?(l=n(f.getAttributeNS(z,"margin-left"),"2cm"),e=n(f.getAttributeNS(z,"margin-right"),"2cm"),h=n(f.getAttributeNS(z,"margin-top"),"2cm"),t=n(f.getAttributeNS(z,"margin-bottom"),"2cm")):l=e=h=t=l,q=n(f.getAttributeNS(z,"padding")),void 0===q?(q=n(f.getAttributeNS(z,"padding-left"),"0cm"),p=n(f.getAttributeNS(z,"padding-right"),"0cm"),m=n(f.getAttributeNS(z,"padding-top"),"0cm"),f=n(f.getAttributeNS(z,"padding-bottom"),"0cm")):q=p=m=f=q):(s=n("21.001cm"),g=n("29.7cm"),l=e=h=t=l=n("2cm"),q=p=m=f=q=
n("0cm"));return{width:s-l-e-q-p,height:g-h-t-m-f}}};odf.Formatting.StyleMetadata;odf.Formatting.StyleData;odf.Formatting.AppliedStyle;
(function(){var m=odf.Namespaces.stylens,e=odf.Namespaces.textns,h={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"};odf.StyleTreeNode=function(b){this.derivedStyles={};this.element=b};odf.StyleTree=function(b,f){function g(b){var a,c,d,f={};if(!b)return f;for(b=b.firstElementChild;b;){if(c=b.namespaceURI!==m||"style"!==b.localName&&
"default-style"!==b.localName?b.namespaceURI===e&&"list-style"===b.localName?"list":b.namespaceURI!==m||"page-layout"!==b.localName&&"default-page-layout"!==b.localName?void 0:"page":b.getAttributeNS(m,"family"))(a=b.getAttributeNS(m,"name"))||(a=""),f.hasOwnProperty(c)?d=f[c]:f[c]=d={},d[a]=b;b=b.nextElementSibling}return f}function l(b,a){if(b.hasOwnProperty(a))return b[a];var c=null,d=Object.keys(b),f;for(f=0;f<d.length&&!(c=l(b[d[f]].derivedStyles,a));f+=1);return c}function q(b,a,c){var d,f,
g;if(!a.hasOwnProperty(b))return null;d=new odf.StyleTreeNode(a[b]);f=d.element.getAttributeNS(m,"parent-style-name");g=null;f&&(g=l(c,f)||q(f,a,c));g?g.derivedStyles[b]=d:c[b]=d;delete a[b];return d}function p(b,a){b&&Object.keys(b).forEach(function(c){q(c,b,a)})}var d={};this.getStyleTree=function(){return d};(function(){var l,a,c;a=g(b);c=g(f);Object.keys(h).forEach(function(b){l=d[b]={};p(a[b],l);p(c[b],l)})})()}})();odf.StyleTree.Tree;
(function(){function m(b,d){try{b.insertRule(d,b.cssRules.length)}catch(f){runtime.log("cannot load rule: "+d+" - "+f)}}function e(b,d){this.listCounterCount=0;this.contentRules=b;this.counterIdStack=[];this.continuedCounterIdStack=d}function h(b){function d(c,f,l,e){var h=f.namespaceURI===g&&"list"===f.localName,n=f.namespaceURI===g&&"list-item"===f.localName;if(h||n){if(h){var h=l+=1,q,t,w;e.listCounterCount+=1;n=c+"-level"+h+"-"+e.listCounterCount;f.setAttributeNS("urn:webodf:names:helper","counter-id",
n);q=e.continuedCounterIdStack.shift();q||(q=n,a+=n+" 1 ",t='text|list[webodfhelper|counter-id="'+n+'"] > text|list-item:first-child > :not(text|list):first-child:before',t+="{",t+="counter-increment: "+q+" 0;",t+="}",m(b,t));for(;e.counterIdStack.length>=h;)e.counterIdStack.pop();e.counterIdStack.push(q);w=e.contentRules[h.toString()]||"";for(t=1;t<=h;t+=1)w=w.replace(t+"webodf-listLevel",e.counterIdStack[t-1]);t='text|list[webodfhelper|counter-id="'+n+'"] > text|list-item > :not(text|list):first-child:before';
t+="{";t+=w;t+="counter-increment: "+q+";";t+="}";m(b,t)}for(f=f.firstElementChild;f;)d(c,f,l,e),f=f.nextElementSibling}else e.continuedCounterIdStack=[]}var f=0,a="",c={};this.createCounterRules=function(a,b,g){var h=b.getAttributeNS(l,"id"),q=[];g&&(g=g.getAttributeNS("urn:webodf:names:helper","counter-id"),q=c[g].slice(0));a=new e(a,q);h?h="Y"+h:(f+=1,h="X"+f);d(h,b,0,a);c[h+"-level1-1"]=a.counterIdStack};this.initialiseCreatedCounters=function(){var c;c="office|document{"+("counter-reset: "+a+
";");c+="}";m(b,c)}}var b=odf.Namespaces.fons,f=odf.Namespaces.stylens,g=odf.Namespaces.textns,l=odf.Namespaces.xmlns,q={1:"decimal",a:"lower-latin",A:"upper-latin",i:"lower-roman",I:"upper-roman"};odf.ListStyleToCss=function(){function e(a){var b=k.parseLength(a);return b?c.convert(b.value,b.unit,"px"):(runtime.log("Could not parse value '"+a+"'."),0)}function d(a){return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function n(a,c){var b;a&&(b=a.getAttributeNS(g,"style-name"));return b===c}function a(a,
c,b){c=c.getElementsByTagNameNS(g,"list");a=new h(a);var k,e,m,t,p,H,I,D={},C;for(C=0;C<c.length;C+=1){k=c.item(C);if(!giseditor&&(headers=core.DomUtils.getDirectChild(k,g,"list-header")))try{k.parentNode.insertBefore(headers.cloneNode(!0),k),headers.parentNode.removeChild(headers)}catch(s){}if(H=k.getAttributeNS(g,"style-name")){m=k.getAttributeNS(g,"continue-numbering");t=k.getAttributeNS(g,"continue-list");(p=k.getAttributeNS(l,"id"))&&(D[p]=k);try{var u=b[H].element.firstElementChild;p=void 0;
for(var x={};u;){var G=p=(p=u.getAttributeNS(g,"level"))&&parseInt(p,10),M=u,F="",J=void 0,P=void 0,E=void 0,aa=void 0;if("list-level-style-number"===M.localName){var Q=M.getAttributeNS(f,"num-format"),U=M.getAttributeNS(f,"num-suffix")||"",W=M.getAttributeNS(f,"num-prefix")||"",K="",ba=M.getAttributeNS(g,"level"),Y=M.getAttributeNS(g,"display-levels");W&&(K+='"'+d(W)+'"\n');if(q.hasOwnProperty(Q))for(ba=ba?parseInt(ba,10):1,Y=Y?parseInt(Y,10):1;0<Y;)K+=" counter("+(ba-Y+1)+"webodf-listLevel,"+q[Q]+
")",1<Y&&(K+='"."'),Y-=1;else K=Q?K+(' "'+Q+'"'):K+' ""';F="content:"+K+' "'+d(U)+'"'}else if("list-level-style-image"===M.localName)F="content: none";else if("list-level-style-bullet"===M.localName)var S=M.getAttributeNS(g,"bullet-char"),F='content: "'+d(S)+'"';if(J=M.getElementsByTagNameNS(f,"list-level-properties")[0])P=J.getAttributeNS(g,"list-level-position-and-space-mode"),"label-alignment"===P&&((E=J.getElementsByTagNameNS(f,"list-level-label-alignment")[0])&&(aa=E.getAttributeNS(g,"label-followed-by")),
"space"===aa&&(F+=' "\\a0"'));x[G]="\n"+F+";\n";u=u.nextElementSibling}I=x;m&&!t&&n(e,H)?a.createCounterRules(I,k,e):t&&n(D[t],H)?a.createCounterRules(I,k,D[t]):a.createCounterRules(I,k)}catch($){}e=k}}a.initialiseCreatedCounters()}var c=new core.CSSUnits,k=odf.OdfUtils;this.applyListStyles=function(c,d,k){var l,h;(l=d.list)&&Object.keys(l).forEach(function(a){h=l[a];for(var d=h.element.firstElementChild;d;){if(d.namespaceURI===g){for(var k=c,n=d,q='text|list[text|style-name="'+a+'"]',B=n.getAttributeNS(g,
"level"),C=void 0,s=void 0,u=s=void 0,x=void 0,G=void 0,M=C=void 0,F=void 0,y=void 0,P=void 0,x=void 0,u=(s=n.getElementsByTagNameNS(f,"list-level-properties")[0])&&s.getAttributeNS(g,"list-level-position-and-space-mode"),x=s&&s.getElementsByTagNameNS(f,"list-level-label-alignment")[0],C=B=B&&parseInt(B,10);1<C;)q+=" > text|list-item > text|list",C-=1;C=s&&s.getAttributeNS(b,"text-align")||"left";switch(C){case "end":C="right";break;case "start":C="left"}"label-alignment"===u?(G=x&&x.getAttributeNS(b,
"margin-left")||"0px",y=x&&x.getAttributeNS(b,"text-indent")||"0px",P=x&&x.getAttributeNS(g,"label-followed-by"),x=e(G)):(G=s&&s.getAttributeNS(g,"space-before")||"0px",M=s&&s.getAttributeNS(g,"min-label-width")||"0px",F=s&&s.getAttributeNS(g,"min-label-distance")||"0px",x=e(G)+e(M));s=q+" > text|list-item";s+="{";s+="margin-left: "+x+"px;";s+="}";m(k,s);s=q+" > text|list-item > text|list";s+="{";s+="margin-left: "+-x+"px;";s+="}";m(k,s);s=q+" > text|list-item > :not(text|list):first-child:before";
s+="{";s+="text-align: "+C+";";s+="display: inline-block;";"label-alignment"===u?(s+="margin-left: "+y+";","listtab"===P&&(s+="padding-right: 0.2cm;")):(s+="min-width: "+M+";",s+="margin-left: "+(0===parseFloat(M)?"":"-")+M+";",s+="padding-right: "+F+";");s+="}";m(k,s)}d=d.nextElementSibling}});a(c,k,l)}}})();
odf.LazyStyleProperties=function(m,e){var h={};this.value=function(b){var f;h.hasOwnProperty(b)?f=h[b]:(f=e[b](),void 0===f&&m&&(f=m.value(b)),h[b]=f);return f};this.reset=function(b){m=b;h={}}};
odf.StyleParseUtils=function(){function m(e){var b,f;e=(e=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px))/.exec(e))?{value:parseFloat(e[1]),unit:e[3]}:null;f=e&&e.unit;"px"===f?b=e.value:"cm"===f?b=e.value/2.54*96:"mm"===f?b=e.value/25.4*96:"in"===f?b=96*e.value:"pt"===f?b=e.value/.75:"pc"===f&&(b=16*e.value);return b}var e=odf.Namespaces.stylens;this.parseLength=m;this.parsePositiveLengthOrPercent=function(e,b,f){var g;e&&(g=parseFloat(e.substr(0,
e.indexOf("%"))),isNaN(g)&&(g=void 0));var l;void 0!==g?(f&&(l=f.value(b)),g=void 0===l?void 0:l/100*g):g=m(e);return g};this.getPropertiesElement=function(h,b,f){for(b=f?f.nextElementSibling:b.firstElementChild;null!==b&&(b.localName!==h||b.namespaceURI!==e);)b=b.nextElementSibling;return b};this.parseAttributeList=function(e){e&&(e=e.replace(/^\s*(.*?)\s*$/g,"$1"));return e&&0<e.length?e.split(/\s+/):[]}};
odf.Style2CSS=function(){function m(a,c,b){var d=[];b=b.derivedStyles;var k;var f=z[a],s;void 0===f?c=null:(s=c?"["+f+'|style-name="'+c+'"]':"","presentation"===f&&(f="draw",s=c?'[presentation|style-name="'+c+'"]':""),c=f+"|"+v[a].join(s+","+f+"|")+s);null!==c&&d.push(c);for(k in b)b.hasOwnProperty(k)&&(c=m(a,k,b[k]),d=d.concat(c));return d}function e(a){var c="",b="",c=null;if("default-style"===a.localName)return null;c=a.getAttributeNS(n,"parent-style-name");b=a.getAttributeNS(n,"family");return c=
Q.getODFElementsWithXPath(E,c?"//style:*[@style:name='"+c+"'][@style:family='"+b+"']":"//style:default-style[@style:family='"+b+"']",odf.Namespaces.lookupNamespaceURI)[0]}function h(a,c){var b="",d,k,f;for(d=0;d<c.length;d+=1)if(k=c[d],f=a.getAttributeNS(k[0],k[1])){f=f.trim();if(G.hasOwnProperty(k[1])){var s=f,g=s.indexOf(" "),l=void 0;f=void 0;-1!==g?(l=s.substring(0,g),f=s.substring(g)):(l=s,f="");(l=J.parseLength(l))&&"pt"===l.unit&&.75>l.value&&(s="0.75pt"+f);f=s}else if(M.hasOwnProperty(k[1])){var s=
a,g=k[0],l=k[1],r=J.parseLength(f),h=void 0,x=void 0,q=void 0,t=void 0,q=void 0;if(r&&"%"===r.unit){h=r.value/100;x=e(s.parentNode);for(t="0";x;){if(q=B.getDirectChild(x,n,"paragraph-properties"))if(q=J.parseLength(q.getAttributeNS(g,l))){if("%"!==q.unit){t=q.value*h+q.unit;break}h*=q.value/100}x=e(x)}f=t}}k[2]&&(b+=k[2]+":"+f+";")}return b}function b(a,c,b,d){return c+c+b+b+d+d}function f(a,c){var b=[a],d=c.derivedStyles;Object.keys(d).forEach(function(a){a=f(a,d[a]);b=b.concat(a)});return b}function g(a,
c,b,d){function k(c,b){var d=[],f;c.forEach(function(a){s.forEach(function(c){d.push('draw|page[webodfhelper|page-style-name="'+c+'"] draw|frame[presentation|class="'+a+'"]')})});0<d.length&&(f=d.join(",")+"{visibility:"+b+";}",a.insertRule(f,a.cssRules.length))}var s=f(c,d),g=[],l=[];["page-number","date-time","header","footer"].forEach(function(a){var c;c=b.getAttributeNS(r,"display-"+a);"true"===c?g.push(a):"false"===c&&l.push(a)});k(g,"visible");k(l,"hidden")}function l(a,f,G,v){var M,z;if("page"===
f){var E=v.element,Z="",R,Q;Q=R="";G=B.getDirectChild(E,n,"page-layout-properties");var L;if(G)if(L=E.getAttributeNS(n,"name"),Z+=h(G,u),(R=B.getDirectChild(G,n,"background-image"))&&(Q=R.getAttributeNS(k,"href"))&&(Z=Z+("background-image: url('odfkit:"+Q+"');")+h(R,t)),"presentation"===P)for(E=(E=B.getDirectChild(E.parentNode.parentNode,d,"master-styles"))&&E.firstElementChild;E;){if(E.namespaceURI===n&&"master-page"===E.localName&&E.getAttributeNS(n,"page-layout-name")===L){Q=E.getAttributeNS(n,
"name");R='draw|page[draw|master-page-name="'+Q+'"] {'+Z+"}";Q='office|body, draw|page[draw|master-page-name="'+Q+'"] {'+h(G,x)+" }";try{a.insertRule(R,a.cssRules.length)}catch(fa){console.log(fa)}try{a.insertRule(Q,a.cssRules.length)}catch(ga){console.log(ga)}}E=E.nextElementSibling}else"text"===P&&(R="office|text {"+Z+"}",Q="office|body {width: "+G.getAttributeNS(p,"page-width")+";}",a.insertRule(R,a.cssRules.length),a.insertRule(Q,a.cssRules.length))}else if(Z=m(f,G,v).join(","),L="","Internet_20_link"!=
v.element.getAttributeNS(n,"name")){if(E=B.getDirectChild(v.element,n,"text-properties")){var T=E,ca=z="";R="";Q=1;E=""+h(T,A);M=T.getAttributeNS(n,"text-underline-style");"solid"===M&&(z+=" underline");M=T.getAttributeNS(n,"text-line-through-style");"solid"===M&&(z+=" line-through");z.length&&(E=E+("text-decoration:"+z+";\n")+("text-decoration-line:"+z+";\n"),E+="-moz-text-decoration-line:"+z+";\n");M=T.getAttributeNS(n,"text-line-through-type");switch(M){case "double":ca+=" double";break;case "single":ca+=
" single"}ca&&(E+="text-decoration-style:"+ca+";\n",E+="-moz-text-decoration-style:"+ca+";\n");if(z=T.getAttributeNS(n,"font-name")||T.getAttributeNS(p,"font-family"))M=F[z],E+="font-family: "+(M||z)+";";if(M=T.getAttributeNS(n,"text-position"))z=y.parseAttributeList(M),M=z[0],z=z[1],E+="vertical-align: "+M+"\n; ",z&&(Q=parseFloat(z)/100);T.hasAttributeNS(p,"color")&&(M=T.getAttributeNS(p,"color"),M=(M||"").toLowerCase(),"#ffffff"==M||"white"==M||"ffffff"==M||"#fff"==M||"fff"==M)&&(E+="color: #D8D8D8;");
if(T.hasAttributeNS(p,"font-size")||1!==Q){for(T=T.parentNode;T;){if(M=(M=B.getDirectChild(T,n,"text-properties"))?J.parseFoFontSize(M.getAttributeNS(p,"font-size")):null){if("%"!==M.unit){R="font-size: "+M.value*Q+M.unit+";";break}Q*=M.value/100}T=e(T)}R||(R="font-size: "+parseFloat(aa)*Q+U.getUnits(aa)+";")}E+=R;L+=E}if(E=B.getDirectChild(v.element,n,"paragraph-properties"))R=E,E=""+h(R,w),(Q=B.getDirectChild(R,n,"background-image"))&&(T=Q.getAttributeNS(k,"href"))&&(E=E+("background-image: url('odfkit:"+
T+"');")+h(Q,t)),(R=R.getAttributeNS(p,"line-height"))&&"normal"!==R&&(R=J.parseFoLineHeight(R),E="%"!==R.unit?E+("line-height: "+R.value+R.unit+";"):E+("line-height: "+R.value/100+";")),L+=E;if(E=B.getDirectChild(v.element,n,"graphic-properties"))T=E,E=""+h(T,H),R=T.getAttributeNS(q,"opacity"),Q=T.getAttributeNS(q,"fill"),T=T.getAttributeNS(q,"fill-color"),"solid"===Q||"hatch"===Q||T&&R?T&&"none"!==T?(R=isNaN(parseFloat(R))?1:parseFloat(R)/100,Q=T.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,b),(T=
(Q=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(Q))?{r:parseInt(Q[1],16),g:parseInt(Q[2],16),b:parseInt(Q[3],16)}:null)&&(E+="background-color: rgba("+T.r+","+T.g+","+T.b+","+R+");")):E+="background: none;":"none"===Q&&(E+="background: none;"),L+=E;if(E=B.getDirectChild(v.element,n,"drawing-page-properties"))R=E,Q=""+h(R,H),"true"===R.getAttributeNS(r,"background-visible")&&(Q+="background: none;"),L+=Q,g(a,G,E,v);if(E=B.getDirectChild(v.element,n,"table-cell-properties"))G=L,L=""+h(E,I),L=G+
L;if(E=B.getDirectChild(v.element,n,"table-row-properties"))G=L,L=""+h(E,C),L=G+L;if(E=B.getDirectChild(v.element,n,"table-column-properties"))G=L,L=""+h(E,D),L=G+L;if(E=B.getDirectChild(v.element,n,"table-properties"))G=L,L=""+h(E,s),E=E.getAttributeNS(c,"border-model"),"collapsing"===E?L+="border-collapse:collapse;":"separating"===E&&(L+="border-collapse:separate;"),L=G+L;0!==L.length&&a.insertRule(Z+"{"+L+"}",a.cssRules.length)}for(var ka in v.derivedStyles)v.derivedStyles.hasOwnProperty(ka)&&
l(a,f,ka,v.derivedStyles[ka])}var q=odf.Namespaces.drawns,p=odf.Namespaces.fons,d=odf.Namespaces.officens,n=odf.Namespaces.stylens,a=odf.Namespaces.svgns,c=odf.Namespaces.tablens,k=odf.Namespaces.xlinkns,r=odf.Namespaces.presentationns,B=core.DomUtils,y=new odf.StyleParseUtils,z={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"},
v={graphic:"circle connected control custom-shape ellipse frame g line measure page page-thumbnail path polygon polyline rect regular-polygon".split(" "),paragraph:"alphabetical-index-entry-template h illustration-index-entry-template index-source-style object-index-entry-template p table-index-entry-template table-of-content-entry-template user-index-entry-template".split(" "),presentation:"caption circle connector control custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),
"drawing-page":"caption circle connector control page custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),ruby:["ruby","ruby-text"],section:"alphabetical-index bibliography illustration-index index-title object-index section table-of-content table-index user-index".split(" "),table:["background","table"],"table-cell":"body covered-table-cell even-columns even-rows first-column first-row last-column last-row odd-columns odd-rows table-cell".split(" "),
"table-column":["table-column"],"table-row":["table-row"],text:"a index-entry-chapter index-entry-link-end index-entry-link-start index-entry-page-number index-entry-span index-entry-tab-stop index-entry-text index-title-template linenumbering-configuration list-level-style-number list-level-style-bullet outline-level-style span".split(" "),list:["list-item"]},A=[[p,"color","color"],[p,"background-color","background-color"],[p,"font-weight","font-weight"],[p,"font-style","font-style"]],t=[[n,"repeat",
"background-repeat"]],w=[[p,"background-color","background-color"],[p,"text-align","text-align"],[p,"text-indent","text-indent"],[p,"padding","padding"],[p,"padding-left","padding-left"],[p,"padding-right","padding-right"],[p,"padding-top","padding-top"],[p,"padding-bottom","padding-bottom"],[p,"border-left","border-left"],[p,"border-right","border-right"],[p,"border-top","border-top"],[p,"border-bottom","border-bottom"],[p,"margin","margin"],[p,"margin-left","margin-left"],[p,"margin-right","margin-right"],
[p,"margin-top","margin-top"],[p,"margin-bottom","margin-bottom"],[p,"border","border"]],H=[[p,"background-color","background-color"],[p,"min-height","min-height"],[q,"stroke","border"],[a,"stroke-color","border-color"],[a,"stroke-width","border-width"],[p,"border","border"],[p,"border-left","border-left"],[p,"border-right","border-right"],[p,"border-top","border-top"],[p,"border-bottom","border-bottom"]],I=[[p,"background-color","background-color"],[p,"border-left","border-left"],[p,"border-right",
"border-right"],[p,"border-top","border-top"],[p,"border-bottom","border-bottom"],[p,"border","border"]],D=[[n,"column-width","width"]],C=[[n,"row-height","height"],[p,"keep-together",null]],s=[[n,"width","width"],[p,"margin-left","margin-left"],[p,"margin-right","margin-right"],[p,"margin-top","margin-top"],[p,"margin-bottom","margin-bottom"]],u=[[p,"background-color","background-color"],[p,"padding","padding"],[p,"padding-left","padding-left"],[p,"padding-right","padding-right"],[p,"padding-top",
"padding-top"],[p,"padding-bottom","padding-bottom"],[p,"border","border"],[p,"border-left","border-left"],[p,"border-right","border-right"],[p,"border-top","border-top"],[p,"border-bottom","border-bottom"],[p,"margin","margin"],[p,"margin-left","margin-left"],[p,"margin-right","margin-right"],[p,"margin-top","margin-top"],[p,"margin-bottom","margin-bottom"]],x=[[p,"page-width","width"],[p,"page-height","height"]],G={border:!0,"border-left":!0,"border-right":!0,"border-top":!0,"border-bottom":!0,
"stroke-width":!0},M={margin:!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"margin-bottom":!0},F={},J=odf.OdfUtils,P,E,aa,Q=xmldom.XPath,U=new core.CSSUnits;gstyleParseUtils=y;this.style2css=function(a,c,b,d,k){function f(a,c){s="@namespace "+a+" url("+c+");";try{b.insertRule(s,b.cssRules.length)}catch(d){}}var s,g,e;for(E=c;b.cssRules.length;)b.deleteRule(b.cssRules.length-1);odf.Namespaces.forEachPrefix(f);f("webodfhelper","urn:webodf:names:helper");F=d;P=a;aa=runtime.getWindow().getComputedStyle(document.body,
null).getPropertyValue("font-size")||"12pt";c=0;for(e in z)if(z.hasOwnProperty(e))for(g in a=k[e],a)if(a.hasOwnProperty(g)){c++;if(1E3<c){c=0;break}l(b,e,g,a[g])}}};
(function(){function m(e,h){var b=this;this.getDistance=function(f){var g=b.x-f.x;f=b.y-f.y;return Math.sqrt(g*g+f*f)};this.getCenter=function(f){return new m((b.x+f.x)/2,(b.y+f.y)/2)};this.x;this.y;b.x=e;b.y=h}gui.ZoomHelper=function(){function e(a,b,d,k){a=k?"translate3d("+a+"px, "+b+"px, 0) scale3d("+d+", "+d+", 1)":"translate("+a+"px, "+b+"px) scale("+d+")";c.style.WebkitTransform=a;c.style.MozTransform=a;c.style.msTransform=a;c.style.OTransform=a;c.style.transform=a}function h(a){a?e(-k.x,-k.y,
y,!0):(e(0,0,y,!0),e(0,0,y,!1))}function b(a){if(v&&I){var c=v.style.overflow,b=v.classList.contains("webodf-customScrollbars");a&&b||!a&&!b||(a?(v.classList.add("webodf-customScrollbars"),v.style.overflow="hidden",runtime.requestAnimationFrame(function(){v.style.overflow=c})):v.classList.remove("webodf-customScrollbars"))}}function f(){e(-k.x,-k.y,y,!0);v.scrollLeft=0;v.scrollTop=0;D=A.style.overflow;A.style.overflow="visible";b(!1)}function g(){e(0,0,y,!0);v.scrollLeft=k.x;v.scrollTop=k.y;A.style.overflow=
D||"";b(!0)}function l(a){return new m(a.pageX-c.offsetLeft,a.pageY-c.offsetTop)}function q(a){if(r){k.x-=a.x-r.x;k.y-=a.y-r.y;var b=k;k=new m(Math.min(Math.max(b.x,c.offsetLeft),(c.offsetLeft+c.offsetWidth)*y-v.clientWidth),Math.min(Math.max(b.y,c.offsetTop),(c.offsetTop+c.offsetHeight)*y-v.clientHeight))}r=a}function p(a){var c=a.touches.length,b=0<c?l(a.touches[0]):null;a=1<c?l(a.touches[1]):null;b&&a?(B=b.getDistance(a),z=y,r=b.getCenter(a),f(),H=w.PINCH):b&&(r=b,H=w.SCROLL)}function d(a){var b=
a.touches.length,d=0<b?l(a.touches[0]):null,b=1<b?l(a.touches[1]):null;if(d&&b)if(a.preventDefault(),H===w.SCROLL)H=w.PINCH,f(),B=d.getDistance(b);else{a=d.getCenter(b);d=d.getDistance(b)/B;q(a);var b=y,e=Math.min(4,c.offsetParent.clientWidth/c.offsetWidth);y=z*d;y=Math.min(Math.max(y,e),4);d=y/b;k.x+=(d-1)*(a.x+k.x);k.y+=(d-1)*(a.y+k.y);h(!0)}else d&&(H===w.PINCH?(H=w.SCROLL,g()):q(d))}function n(){H===w.PINCH&&(t.emit(gui.ZoomHelper.signalZoomChanged,y),g(),h(!1));H=w.NONE}function a(){v&&(v.removeEventListener("touchstart",
p,!1),v.removeEventListener("touchmove",d,!1),v.removeEventListener("touchend",n,!1))}var c,k,r,B,y,z,v,A,t=new core.EventNotifier([gui.ZoomHelper.signalZoomChanged]),w={NONE:0,SCROLL:1,PINCH:2},H=w.NONE,I=runtime.getWindow().hasOwnProperty("ontouchstart"),D="";this.subscribe=function(a,c){t.subscribe(a,c)};this.unsubscribe=function(a,c){t.unsubscribe(a,c)};this.getZoomLevel=function(){return y};this.setZoomLevel=function(a){c&&(y=a,h(!1),t.emit(gui.ZoomHelper.signalZoomChanged,y))};this.destroy=
function(c){a();b(!1);c()};this.setZoomableElement=function(k){a();c=k;v=c.offsetParent;A=c.parentNode;h(!1);v&&(v.addEventListener("touchstart",p,!1),v.addEventListener("touchmove",d,!1),v.addEventListener("touchend",n,!1));b(!0)};z=y=1;k=new m(0,0)};gui.ZoomHelper.signalZoomChanged="zoomChanged"})();ops.Canvas=function(){};ops.Canvas.prototype.getZoomLevel=function(){};ops.Canvas.prototype.getElement=function(){};ops.Canvas.prototype.getSizer=function(){};ops.Canvas.prototype.getZoomHelper=function(){};
(function(){function m(){function a(d){b=!0;runtime.setTimeout(function(){try{d()}catch(k){runtime.log(String(k)+"\n"+k.stack)}b=!1;0<c.length&&a(c.pop())},10)}var c=[],b=!1;this.clearQueue=function(){c.length=0};this.addToQueue=function(d){if(0===c.length&&!b)return a(d);c.push(d)}}function e(a){function c(){for(;0<b.cssRules.length;)b.deleteRule(0);b.insertRule("#shadowContent draw|page {display:none;}",0);b.insertRule("office|presentation draw|page {display:none;}",1);b.insertRule("#shadowContent draw|page:nth-of-type("+
d+") {display:block;}",2);b.insertRule("office|presentation draw|page:nth-of-type("+d+") {display:block;}",3)}var b=a.sheet,d=1;this.showFirstPage=function(){d=1;c()};this.showNextPage=function(){d+=1;c()};this.showPreviousPage=function(){1<d&&(d-=1,c())};this.showPage=function(a){0<a&&(d=a,c())};this.css=a;this.destroy=function(c){a.parentNode.removeChild(a);c()}}function h(a){a=a.sheet;for(var c=a.cssRules;c.length;)a.deleteRule(c.length-1)}function b(a,c,b){var d=new odf.Style2CSS,k=new odf.ListStyleToCss;
b=b.sheet;var f=(new odf.StyleTree(a.rootElement.styles,a.rootElement.automaticStyles)).getStyleTree();d.style2css(a.getDocumentType(),a.rootElement,b,c.getFontMap(),f);k.applyListStyles(b,f,a.rootElement.body)}function f(a,c){(new odf.FontLoader).loadFonts(a,c.sheet)}function g(a,c,b){var d=null;a=a.rootElement.body.getElementsByTagNameNS(C,b+"-decl");b=c.getAttributeNS(C,"use-"+b+"-name");var k;if(b&&0<a.length)for(c=0;c<a.length;c+=1)if(k=a[c],k.getAttributeNS(C,"name")===b){d=k.textContent;break}return d}
function l(a,c,b,d){var k=a.ownerDocument;c=u.getElementsByTagNameNS(a,c,b);for(a=0;a<c.length;a+=1)u.removeAllChildNodes(c[a]),d&&(b=c[a],b.appendChild(k.createTextNode(d)))}function q(a,c,b){c.setAttributeNS("urn:webodf:names:helper","styleid",a);var d,k=c.getAttributeNS(I,"anchor-type"),f=c.getAttributeNS(w,"x"),s=c.getAttributeNS(w,"y"),g=c.getAttributeNS(w,"width"),e=c.getAttributeNS(w,"height"),l=c.getAttributeNS(v,"min-height"),r=c.getAttributeNS(v,"min-width");if("as-char"===k||"char"===k||
"paragraph"===k)d="display: inline-block;";else if(k||f||s)d="position: absolute;";else if(g||e||l||r)d="display: block;";var h=c.getAttributeNS(z,"transform"),n,q,t;h&&(k=function(a){(n=h.match(new RegExp(a+"(.*?)\\((.*?)\\)","i")))&&n[2]&&(q=parseFloat(n[2]),isNaN(q)||(arr2=180/Math.PI*q*-1,-360<=arr2&&360>=arr2&&(t+=a+"("+arr2.toFixed(2)+"deg) ")))},t="",(n=h.match(/translate(.*?)\((.*?)\)/i))&&n[2]&&(q=n[2].trim().split(" "),2!=q.length&&(q=n[2].trim().split(",")),2==q.length&&(d="position: absolute;",
t+="translate("+q[0]+","+q[1]+") ")),k("rotate"),k("skewX"),t&&(d+="transform: "+t+"; -webkit-transform: "+t+"; transform-origin: left top; -webkit-transform-origin: left top;"));"custom-shape"==c.localName&&(d+="border-width: 0.028cm; ");f&&(d+="left: "+f+";");s&&(d+="top: "+s+";");g&&(d+="width: "+g+";");e&&(d+="height: "+e+";");l&&(d+="min-height: "+l+";");r&&(d+="min-width: "+r+";");d&&(d="draw|"+c.localName+'[webodfhelper|styleid="'+a+'"] {'+d+"}",b.insertRule(d,b.cssRules.length));!gdocumentType&&
godfcontainer&&(gdocumentType=godfcontainer.getDocumentType());s&&e&&"text"==gdocumentType&&(s=gstyleParseUtils.parseLength(s),e=gstyleParseUtils.parseLength(e),s=parseInt(s+e),!isNaN(s)&&document.getElementsByTagName("document")[0]&&s>document.getElementsByTagName("document")[0].clientHeight&&b.insertRule("office|document{height: "+(s+15)+"px;}",b.cssRules.length))}function p(a){for(a=a.firstChild;a;){if(a.namespaceURI===A&&"binary-data"===a.localName)return"data:image/png;base64,"+a.textContent.replace(/[\r\n\s]/g,
"");a=a.nextSibling}return""}function d(a,c,b,d){function k(c){c&&(c='draw|image[webodfhelper|styleid="'+a+'"] {'+("background-image: url("+c+");")+"}",d.insertRule(c,d.cssRules.length))}function f(a){k(a.url)}b.setAttributeNS("urn:webodf:names:helper","styleid",a);var s=b.getAttributeNS(D,"href"),g;if(s)try{g=c.getPart(s),g.onchange=f,g.load()}catch(e){runtime.log("slight problem: "+String(e))}else s=p(b),k(s)}function n(a){var c=a.ownerDocument;u.getElementsByTagNameNS(a,I,"line-break").forEach(function(a){a.hasChildNodes()||
a.appendChild(c.createElement("br"))})}function a(a){var c=a.ownerDocument;u.getElementsByTagNameNS(a,I,"s").forEach(function(a){var b,d;u.removeAllChildNodes(a);a.appendChild(c.createTextNode(" "));d=parseInt(a.getAttributeNS(I,"c"),10);if(1<d)for(a.removeAttributeNS(I,"c"),b=1;b<d;b+=1)a.parentNode.insertBefore(a.cloneNode(!0),a)})}function c(a){u.getElementsByTagNameNS(a,I,"tab").forEach(function(a){a.textContent="\t"})}function k(a,c){function b(a,d){var s=g.documentElement.namespaceURI;"video/"===
d.substr(0,6)?(k=g.createElementNS(s,"video"),k.setAttribute("controls","controls"),f=g.createElementNS(s,"source"),a&&f.setAttribute("src",a),f.setAttribute("type",d),k.appendChild(f),c.parentNode.appendChild(k)):c.innerHtml="Unrecognised Plugin"}function d(a){b(a.url,a.mimetype)}var k,f,s,g=c.ownerDocument,e;if(s=c.getAttributeNS(D,"href"))try{e=a.getPart(s),e.onchange=d,e.load()}catch(l){runtime.log("slight problem: "+String(l))}else runtime.log("using MP4 data fallback"),s=p(c),b(s,"video/mp4")}
function r(a){var c=a.getElementsByTagName("head")[0],b,d;b=a.styleSheets.length;for(d=c.firstElementChild;d&&("style"!==d.localName||!d.hasAttribute("webodfcss"));)d=d.nextElementSibling;if(d)return b=parseInt(d.getAttribute("webodfcss"),10),d.setAttribute("webodfcss",b+1),d;"string"===String(typeof webodf_css)?b=webodf_css:(d="webodf.css",runtime.currentDirectory&&(d=runtime.currentDirectory(),0<d.length&&"/"!==d.substr(-1)&&(d+="/"),d+="../webodf.css"),b=runtime.readFileSync(d,"utf-8"));d=a.createElementNS(c.namespaceURI,
"style");d.setAttribute("media","screen, print, handheld, projection");d.setAttribute("type","text/css");d.setAttribute("webodfcss","1");d.appendChild(a.createTextNode(b));c.appendChild(d);return d}function B(a){var c=parseInt(a.getAttribute("webodfcss"),10);1===c?a.parentNode.removeChild(a):a.setAttribute("count",c-1)}function y(a){var c=a.getElementsByTagName("head")[0],b=a.createElementNS(c.namespaceURI,"style"),d="";b.setAttribute("type","text/css");b.setAttribute("media","screen, print, handheld, projection");
odf.Namespaces.forEachPrefix(function(a,c){d+="@namespace "+a+" url("+c+");\n"});d+="@namespace webodfhelper url(urn:webodf:names:helper);\n";b.appendChild(a.createTextNode(d));c.appendChild(b);return b}var z=odf.Namespaces.drawns,v=odf.Namespaces.fons,A=odf.Namespaces.officens,t=odf.Namespaces.stylens,w=odf.Namespaces.svgns,H=odf.Namespaces.tablens,I=odf.Namespaces.textns,D=odf.Namespaces.xlinkns,C=odf.Namespaces.presentationns,s=xmldom.XPath,u=core.DomUtils;odf.OdfCanvas=function(x,G){function p(a,
c,b){function k(a,c,b,f){ma.addToQueue(function(){d(a,c,b,f)})}function f(){var a,c;document.body.getElementsByTagNameNS("http://www.w3.org/1998/Math/MathML","math")[0]&&(document.body.insertAdjacentHTML("afterbegin","<div style='border: 0; clip: rect(0 0 0 0); height: 1px; margin: -1px; overflow: hidden; padding: 0; position: absolute; width: 1px;'><math xmlns='http://www.w3.org/1998/Math/MathML'><mspace height='23px' width='77px'></mspace></math></div>"),c=document.body.firstChild,a=c.firstChild.firstChild.getBoundingClientRect(),
document.body.removeChild(c),1<Math.abs(a.height-23)||1<Math.abs(a.width-77))&&(a=document.createElement("link"),a.href="//iblogbox.github.io/js/odfviewer/mathml.css",a.rel="stylesheet",document.head.appendChild(a))}function s(c){c>e.length-1?t&&f():(r=e.item(c),(h=r.getAttributeNS(D,"href"))?a.getPartData2(h+"/content.xml",function(d,f){f&&0<=f.indexOf("</math>")?(t=!0,f=f.replace(/<\?xml(.*?)\?>/gi,""),q=document.createElement("span"),q.setAttribute("style","white-space:nowrap;"),q.setAttribute("added",
"ok"),q.innerHTML=f,r.parentNode.insertBefore(q,r)):(l=r.parentNode.getElementsByTagNameNS(z,"image"))&&l[0]&&(h=l[0].getAttributeNS(D,"href")||"",0!=h.indexOf("ObjectReplacements/")&&0!=h.indexOf("./ObjectReplacements/")||k("imageB"+String(c),a,l[0],b));s(c+1)}):s(c+1))}var g,e,l,r,h;e=c.getElementsByTagNameNS(z,"image");for(g=0;g<e.length;g+=1)r=e.item(g),h=r.getAttributeNS(D,"href")||"",0!=h.indexOf("ObjectReplacements/")&&0!=h.indexOf("./ObjectReplacements/")&&k("image"+String(g),a,r,b);var n,
q,t=!1;e=c.getElementsByTagNameNS(z,"object");s(0);!gdocumentType&&godfcontainer&&(gdocumentType=godfcontainer.getDocumentType());if("presentation"==gdocumentType&&document.getElementsByTagName("document")[0]&&2E3>document.getElementsByTagName("document")[0].clientWidth){var x=function(a){q=document.createElement("canvas");q.setAttribute("style","border:0px solid red; left:0px; top:0px; position: absolute; background: transparent;");q.width=F;q.height=F+Math.floor(.4*F);a.parentNode.insertBefore(q,
a.nextSibling);G=q.getContext("2d");console.log("Canvas Created.")},G,m,u,B,v,F=document.getElementsByTagName("document")[0].clientWidth;e=c.getElementsByTagNameNS(z,"g");for(g=0;g<e.length;g+=1)for(G="",r=e.item(g),c=findChildNode(r,z,"line"),n=0;n<c.length;n+=1)0!=n||G||x(r),m=c[n].getAttributeNS(w,"x1"),u=c[n].getAttributeNS(w,"y1"),B=c[n].getAttributeNS(w,"x2"),v=c[n].getAttributeNS(w,"y2"),m=parseInt(gstyleParseUtils.parseLength(m)),u=parseInt(gstyleParseUtils.parseLength(u)),B=parseInt(gstyleParseUtils.parseLength(B)),
v=parseInt(gstyleParseUtils.parseLength(v)),G.beginPath(),G.moveTo(m,u),G.lineTo(B,v),G.stroke()}}function v(a,c){function b(a,c){ma.addToQueue(function(){k(a,c)})}var d,f,s;f=c.getElementsByTagNameNS(z,"plugin");for(d=0;d<f.length;d+=1)s=f.item(d),b(a,s)}function J(){var a;a=S.firstChild;var c=ea.getZoomLevel();a&&(S.style.WebkitTransformOrigin="0% 0%",S.style.MozTransformOrigin="0% 0%",S.style.msTransformOrigin="0% 0%",S.style.OTransformOrigin="0% 0%",S.style.transformOrigin="0% 0%",R&&((a=R.getMinimumHeightForAnnotationPane())?
S.style.minHeight=a:S.style.removeProperty("min-height")),x.style.width=Math.round(c*S.offsetWidth)+"px",x.style.height=Math.round(c*S.offsetHeight)+"px",x.style.display="inline-block")}function P(b,d){var k=ga.sheet;u.removeAllChildNodes(x);S=W.createElementNS(x.namespaceURI,"div");S.style.display="inline-block";S.style.background="white";S.style.setProperty("float","left","important");S.appendChild(d);x.appendChild(S);$=W.createElementNS(x.namespaceURI,"div");$.id="annotationsPane";T=W.createElementNS(x.namespaceURI,
"div");T.id="shadowContent";T.style.position="absolute";T.style.top=0;T.style.left=0;b.getContentElement().appendChild(T);var f=d.body,e,r=[],h;for(e=f.firstElementChild;e&&e!==f;)if(e.namespaceURI===z&&(r[r.length]=e),e.firstElementChild)e=e.firstElementChild;else{for(;e&&e!==f&&!e.nextElementSibling;)e=e.parentNode;e&&e.nextElementSibling&&(e=e.nextElementSibling)}for(h=0;h<r.length;h+=1)e=r[h],q("frame"+String(h),e,k);r=s.getODFElementsWithXPath(f,".//*[*[@text:anchor-type='paragraph']]",odf.Namespaces.lookupNamespaceURI);
for(e=0;e<r.length;e+=1)f=r[e],f.setAttributeNS&&f.setAttributeNS("urn:webodf:names:helper","containsparagraphanchor",!0);f=ba;e=T;var G,m,B,w,y=0,U;h=b.rootElement.ownerDocument;if((r=d.body.firstElementChild)&&r.namespaceURI===A&&("presentation"===r.localName||"drawing"===r.localName))for(r=r.firstElementChild;r;){if(G=(G=r.getAttributeNS(z,"master-page-name"))?f.getMasterPageElement(G):null){m=r.getAttributeNS("urn:webodf:names:helper","styleid");B=h.createElementNS(z,"draw:page");U=G.firstElementChild;
for(y=0;U;)"true"!==U.getAttributeNS(C,"placeholder")&&(w=U.cloneNode(!0),B.appendChild(w)),U=U.nextElementSibling,y+=1;U=w=y=void 0;for(var J=u.getElementsByTagNameNS(B,z,"frame"),y=0;y<J.length;y+=1)w=J[y],(U=w.getAttributeNS(C,"class"))&&!/^(date-time|footer|header|page-number)$/.test(U)&&w.parentNode.removeChild(w);w=u.getElementsByTagNameNS(B,z,"*");for(y=0;y<w.length;y+=1)q(m+"_"+y,w[y],k);e.appendChild(B);y=String(e.getElementsByTagNameNS(z,"page").length);l(B,I,"page-number",y);l(B,C,"header",
g(b,r,"header"));l(B,C,"footer",g(b,r,"footer"));q(m,B,k);B.setAttributeNS("urn:webodf:names:helper","page-style-name",r.getAttributeNS(z,"style-name"));B.setAttributeNS(z,"draw:master-page-name",G.getAttributeNS(t,"name"))}r=r.nextElementSibling}r=d.body;G=x.namespaceURI;e=u.getElementsByTagNameNS(r,H,"table-cell");if(giseditor)for(f=0;f<e.length;f+=1)r=h=e[f],r.hasAttributeNS(H,"number-columns-spanned")&&r.setAttributeNS(G,"colspan",r.getAttributeNS(H,"number-columns-spanned")),r.hasAttributeNS(H,
"number-rows-spanned")&&r.setAttributeNS(G,"rowspan",r.getAttributeNS(H,"number-rows-spanned"));else{for(f=0;f<e.length;f+=1)if(h=e[f],h.hasAttributeNS(H,"number-columns-repeated")&&(G=h.getAttributeNS(H,"number-columns-repeated"),!(100<G)))for(j=1;j<G;j++)h.parentNode.insertBefore(h.cloneNode(!0),h.nextSibling);e=u.getElementsByTagNameNS(r,H,"covered-table-cell");for(f=0;f<e.length;f+=1)if(h=e[f],G=h.hasAttributeNS(H,"number-columns-repeated")?h.getAttributeNS(H,"number-columns-repeated"):1,!(100<
G)){for(j=0;j<G;j++)m=document.createElementNS(H,"table:table-cell"),h.parentNode.insertBefore(m,h);h.parentNode.removeChild(h)}e=u.getElementsByTagNameNS(r,z,"control");for(f=0;f<e.length;f+=1)h=e[f],h.parentNode.removeChild(h)}n(d.body);a(d.body);c(d.body);p(b,d.body,k);v(b,d.body);S.insertBefore(T,S.firstChild);ea.setZoomableElement(S)}function E(a){X?($.parentNode||S.appendChild($),R&&R.forgetAnnotations(),R=new gui.AnnotationViewManager(U,a.body,$,Z),a=u.getElementsByTagNameNS(a.body,A,"annotation"),
R.addAnnotations(a),J()):$.parentNode&&(S.removeChild($),R.forgetAnnotations(),J())}function aa(a){function c(){h(L);h(fa);h(ga);u.removeAllChildNodes(x);x.style.display="inline-block";var d=K.rootElement;x.ownerDocument.importNode(d,!0);ba.setOdfContainer(K);f(K,L);b(K,ba,fa);P(K,d);E(d);a||ma.addToQueue(function(){var a=[K];if(ca.hasOwnProperty("statereadychange")){var c=ca.statereadychange,b;for(b=0;b<c.length;b+=1)c[b].apply(null,a)}})}K.state===odf.OdfContainer.DONE?c():(runtime.log("WARNING: refreshOdf called but ODF was not DONE."),
ka=runtime.setTimeout(function V(){K.state===odf.OdfContainer.DONE?c():(g_errmsg(),ka=runtime.setTimeout(V,1E3))},300))}function Q(a){ma.clearQueue();u.removeAllChildNodes(x);var c=document.getElementById("webodfeditor-canvas1");if(giseditor&&c){if(c.innerHTML='<div style="font-size:14px;padding:10px">Loading the file... Please wait...</div>',c=document.getElementById("webodfeditor-canvascontainer1"))c.scrollTop=0}else x.innerHTML=runtime.tr("Loading")+"...",x.removeAttribute("style");setTimeout(function(){godfcontainer=
K=new odf.OdfContainer(a,function(a){K=a;aa(!1)});newaddlist=[]},50)}runtime.assert(null!==x&&void 0!==x,"odf.OdfCanvas constructor needs DOM element");runtime.assert(null!==x.ownerDocument&&void 0!==x.ownerDocument,"odf.OdfCanvas constructor needs DOM");var U=this,W=x.ownerDocument,K,ba=new odf.Formatting,Y,S=null,$=null,X=!1,Z=!1,R=null,da,L,fa,ga,T,ca={},ka,ja,ha=!1,la=!1,ma=new m,ea=new gui.ZoomHelper,ia=G||new gui.SingleScrollViewport(x.parentNode);this.refreshCSS=function(){ha=!0;ja.trigger()};
this.refreshSize=function(){ja.trigger()};this.odfContainer=function(){return K};this.setOdfContainer=function(a,c){K=a;aa(!0===c)};this.load=this.load=Q;this.save=function(a){K.save(a)};this.addListener=function(a,c){switch(a){case "click":var b=a;x.addEventListener?x.addEventListener(b,c,!1):x.attachEvent?x.attachEvent("on"+b,c):x["on"+b]=c;break;default:b=ca.hasOwnProperty(a)?ca[a]:ca[a]=[],c&&-1===b.indexOf(c)&&b.push(c)}};this.getFormatting=function(){return ba};this.getAnnotationViewManager=
function(){return R};this.refreshAnnotations=function(){E(K.rootElement)};this.rerenderAnnotations=function(){R&&(la=!0,ja.trigger())};this.getSizer=function(){return S};this.enableAnnotations=function(a,c){a!==X&&(X=a,Z=c,K&&E(K.rootElement))};this.addAnnotation=function(a){R&&(R.addAnnotations([a]),J())};this.forgetAnnotation=function(a){R&&(R.forgetAnnotation(a),J())};this.getZoomHelper=function(){return ea};this.setZoomLevel=function(a){ea.setZoomLevel(a)};this.getZoomLevel=function(){return ea.getZoomLevel()};
this.fitToContainingElement=function(a,c){var b=ea.getZoomLevel(),d=x.offsetHeight/b,b=a/(x.offsetWidth/b);c/d<b&&(b=c/d);ea.setZoomLevel(b)};this.fitToWidth=function(a){var c=x.offsetWidth/ea.getZoomLevel();ea.setZoomLevel(a/c)};this.fitSmart=function(a,c){var b,d;d=ea.getZoomLevel();b=x.offsetWidth/d;d=x.offsetHeight/d;b=a/b;void 0!==c&&c/d<b&&(b=c/d);ea.setZoomLevel(Math.min(1,b))};this.fitToHeight=function(a){var c=x.offsetHeight/ea.getZoomLevel();ea.setZoomLevel(a/c)};this.showFirstPage=function(){Y.showFirstPage()};
this.showNextPage=function(){Y.showNextPage()};this.showPreviousPage=function(){Y.showPreviousPage()};this.showPage=function(a){Y.showPage(a);godfcontainer&&"spreadsheet"==godfcontainer.getDocumentType()||J()};this.getElement=function(){return x};this.getViewport=function(){return ia};this.addCssForFrameWithImage=function(a){var c=a.getAttributeNS(z,"name"),b=a.firstElementChild;q(c,a,ga.sheet);b&&d(c+"img",K,b,ga.sheet)};this.destroy=function(a){var c=W.getElementsByTagName("head")[0],b=[Y.destroy,
ja.destroy];runtime.clearTimeout(ka);$&&$.parentNode&&$.parentNode.removeChild($);ea.destroy(function(){S&&(x.removeChild(S),S=null)});B(da);c.removeChild(L);c.removeChild(fa);c.removeChild(ga);core.Async.destroyAll(b,a)};da=r(W);Y=new e(y(W));L=y(W);fa=y(W);ga=y(W);ja=core.Task.createRedrawTask(function(){ha&&(b(K,ba,fa),ha=!1);la&&(R&&R.rerenderAnnotations(),la=!1);J()});ea.subscribe(gui.ZoomHelper.signalZoomChanged,J)}})();
odf.StepUtils=function(){this.getContentBounds=function(m){var e=m.container(),h,b;runtime.assert(m.isStep(),"Step iterator must be on a step");e.nodeType===Node.TEXT_NODE&&0<m.offset()?h=m.offset():(e=m.leftNode())&&e.nodeType===Node.TEXT_NODE&&(h=e.length);e&&(e.nodeType===Node.TEXT_NODE?(runtime.assert(0<h,"Empty text node found"),b={container:e,startOffset:h-1,endOffset:h}):b={container:e,startOffset:0,endOffset:e.childNodes.length});return b}};
ops.MemberProperties=function(){this.fullName;this.color;this.imageUrl};
ops.Member=function(m,e){var h=new ops.MemberProperties;this.getMemberId=function(){return m};this.getProperties=function(){return h};this.setProperties=function(b){Object.keys(b).forEach(function(f){h[f]=b[f]})};this.removeProperties=function(b){Object.keys(b).forEach(function(b){"fullName"!==b&&"color"!==b&&"imageUrl"!==b&&h.hasOwnProperty(b)&&delete h[b]})};runtime.assert(Boolean(m),"No memberId was supplied!");e.fullName||(e.fullName=runtime.tr("Unknown Author"));e.color||(e.color="black");e.imageUrl||
(e.imageUrl="avatar-joe.png");h=e};ops.Document=function(){};ops.Document.prototype.getMemberIds=function(){};ops.Document.prototype.removeCursor=function(m){};ops.Document.prototype.getDocumentElement=function(){};ops.Document.prototype.getRootNode=function(){};ops.Document.prototype.getDOMDocument=function(){};ops.Document.prototype.cloneDocumentElement=function(){};ops.Document.prototype.setDocumentElement=function(m){};ops.Document.prototype.subscribe=function(m,e){};
ops.Document.prototype.unsubscribe=function(m,e){};ops.Document.prototype.getCanvas=function(){};ops.Document.prototype.createRootFilter=function(m){};ops.Document.prototype.createPositionIterator=function(m){};ops.Document.prototype.hasCursor=function(m){};ops.Document.signalCursorAdded="cursor/added";ops.Document.signalCursorRemoved="cursor/removed";ops.Document.signalCursorMoved="cursor/moved";ops.Document.signalMemberAdded="member/added";ops.Document.signalMemberUpdated="member/updated";
ops.Document.signalMemberRemoved="member/removed";
ops.OdtCursor=function(m,e){var h=this,b={},f,g,l=new core.EventNotifier([ops.OdtCursor.signalCursorUpdated]);this.removeFromDocument=function(){g.remove()};this.subscribe=function(b,f){l.subscribe(b,f)};this.unsubscribe=function(b,f){l.unsubscribe(b,f)};this.getMemberId=function(){return m};this.getNode=function(){return g.getNode()};this.getAnchorNode=function(){return g.getAnchorNode()};this.getSelectedRange=function(){return g.getSelectedRange()};this.setSelectedRange=function(b,f){g.setSelectedRange(b,
f);l.emit(ops.OdtCursor.signalCursorUpdated,h)};this.hasForwardSelection=function(){return g.hasForwardSelection()};this.getDocument=function(){return e};this.getSelectionType=function(){return f};this.setSelectionType=function(g){b.hasOwnProperty(g)?f=g:runtime.log("Invalid selection type: "+g)};this.resetSelectionType=function(){h.setSelectionType(ops.OdtCursor.RangeSelection)};g=new core.Cursor(e.getDOMDocument(),m);b[ops.OdtCursor.RangeSelection]=!0;b[ops.OdtCursor.RegionSelection]=!0;h.resetSelectionType()};
ops.OdtCursor.RangeSelection="Range";ops.OdtCursor.RegionSelection="Region";ops.OdtCursor.signalCursorUpdated="cursorUpdated";
(function(){var m=0;ops.StepsCache=function(e,h,b){function f(a,c){var d=this;this.nodeId=a;this.steps=-1;this.node=c;this.previousBookmark=this.nextBookmark=null;this.setIteratorPosition=function(a){a.setPositionBeforeElement(c);b(d.steps,a)}}function g(a,c,d){var k=this;this.nodeId=a;this.steps=c;this.node=d;this.previousBookmark=this.nextBookmark=null;this.setIteratorPosition=function(a){a.setUnfilteredPosition(d,0);b(k.steps,a)}}function l(a,c){var b="["+a.nodeId;c&&(b+=" => "+c.nodeId);return b+
"]"}function q(){if(!0===ops.StepsCache.ENABLE_CACHE_VERIFICATION){for(var a=y,c,b,d,f=new core.LoopWatchDog(0,1E5),g={};a;){f.check();(c=a.previousBookmark)?runtime.assert(c.nextBookmark===a,"Broken bookmark link to previous @"+l(c,a)):(runtime.assert(a===y,"Broken bookmark link @"+l(a)),runtime.assert(void 0===z||y===y||y.steps<=z,"Base point is damaged @"+l(a)));(b=a.nextBookmark)&&runtime.assert(b.previousBookmark===a,"Broken bookmark link to next @"+l(a,b));if(void 0===z||a===y||a.steps<=z)runtime.assert(B.containsNode(e,
a.node),"Disconnected node is being reported as undamaged @"+l(a)),c&&(d=a.node.compareDocumentPosition(c.node),runtime.assert(0===d||0!==(d&A),"Bookmark order with previous does not reflect DOM order @"+l(c,a))),b&&B.containsNode(e,b.node)&&(d=a.node.compareDocumentPosition(b.node),runtime.assert(0===d||0!==(d&v),"Bookmark order with next does not reflect DOM order @"+l(a,b)));a=a.nextBookmark}Object.keys(k).forEach(function(a){var c=k[a];(void 0===z||a<=z)&&runtime.assert(c.steps<=a,"Bookmark step of "+
c.steps+" exceeds cached step lookup for "+a+" @"+l(c));runtime.assert(!1===g.hasOwnProperty(c.nodeId),"Bookmark "+l(c)+" appears twice in cached step lookup at steps "+g[c.nodeId]+" and "+a);g[c.nodeId]=a})}}function p(a){var c="";a.nodeType===Node.ELEMENT_NODE&&(c=a.getAttributeNS("urn:webodf:names:steps","nodeId")||"");return c}function d(a){var c=m.toString();a.setAttributeNS("urn:webodf:names:steps","nodeId",c);m+=1;return c}function n(a){var c,b,d=new core.LoopWatchDog(0,1E4);void 0!==z&&a>
z&&(a=z);for(c=Math.floor(a/h)*h;!b&&0<=c;)b=k[c],c-=h;for(b=b||y;b.nextBookmark&&b.nextBookmark.steps<=a;)d.check(),b=b.nextBookmark;runtime.assert(-1===a||b.steps<=a,"Bookmark @"+l(b)+" at step "+b.steps+" exceeds requested step of "+a);return b}function a(a){a.previousBookmark&&(a.previousBookmark.nextBookmark=a.nextBookmark);a.nextBookmark&&(a.nextBookmark.previousBookmark=a.previousBookmark)}function c(a){for(var c,b=null;!b&&a&&a!==e;)(c=p(a))&&(b=r[c])&&b.node!==a&&(runtime.log("Cloned node detected. Creating new bookmark"),
b=null,a.removeAttributeNS("urn:webodf:names:steps","nodeId")),a=a.parentNode;return b}var k={},r={},B=core.DomUtils,y,z,v=Node.DOCUMENT_POSITION_FOLLOWING,A=Node.DOCUMENT_POSITION_PRECEDING;this.updateBookmark=function(c,b){var g,l=Math.ceil(c/h)*h,m,C,s;if(void 0!==z&&z<c){m=n(z);for(C=m.nextBookmark;C&&C.steps<=c;)g=C.nextBookmark,s=Math.ceil(C.steps/h)*h,k[s]===C&&delete k[s],B.containsNode(e,C.node)?C.steps=c+1:(a(C),delete r[C.nodeId]),C=g;z=c}else m=n(c);C=p(b)||d(b);g=r[C];g?g.node!==b&&(runtime.log("Cloned node detected. Creating new bookmark"),
C=d(b),g=r[C]=new f(C,b)):g=r[C]=new f(C,b);C=g;C.steps!==c&&(g=Math.ceil(C.steps/h)*h,g!==l&&k[g]===C&&delete k[g],C.steps=c);if(m!==C&&m.nextBookmark!==C){if(m.steps===C.steps)for(;0!==(C.node.compareDocumentPosition(m.node)&v)&&m!==y;)m=m.previousBookmark;m!==C&&m.nextBookmark!==C&&(a(C),g=m.nextBookmark,C.nextBookmark=m.nextBookmark,C.previousBookmark=m,m.nextBookmark=C,g&&(g.previousBookmark=C))}m=k[l];if(!m||C.steps>m.steps)k[l]=C;q()};this.setToClosestStep=function(a,c){var b;q();b=n(a);b.setIteratorPosition(c);
return b.steps};this.setToClosestDomPoint=function(a,b,d){var f,g;q();if(a===e&&0===b)f=y;else if(a===e&&b===e.childNodes.length)for(g in f=y,k)k.hasOwnProperty(g)&&(a=k[g],a.steps>f.steps&&(f=a));else if(f=c(a.childNodes.item(b)||a),!f)for(d.setUnfilteredPosition(a,b);!f&&d.previousNode();)f=c(d.getCurrentNode());f=f||y;void 0!==z&&f.steps>z&&(f=n(z));f.setIteratorPosition(d);return f.steps};this.damageCacheAfterStep=function(a){0>a&&(a=-1);void 0===z?z=a:a<z&&(z=a);q()};(function(){var a=p(e)||
d(e);y=new g(a,0,e)})()};ops.StepsCache.ENABLE_CACHE_VERIFICATION=!1;ops.StepsCache.Bookmark=function(){};ops.StepsCache.Bookmark.prototype.nodeId;ops.StepsCache.Bookmark.prototype.node;ops.StepsCache.Bookmark.prototype.steps;ops.StepsCache.Bookmark.prototype.previousBookmark;ops.StepsCache.Bookmark.prototype.nextBookmark;ops.StepsCache.Bookmark.prototype.setIteratorPosition=function(e){}})();
(function(){ops.OdtStepsTranslator=function(m,e,h,b){function f(a,b,d){var f=b.getCurrentNode();b.isBeforeNode()&&q.isParagraph(f)&&(d||(a+=1),l.updateBookmark(a,f))}function g(c,b){if(!b||h.acceptPosition(c)===d)return!0;for(;c.previousPosition();)if(h.acceptPosition(c)===d){if(b(n,c.container(),c.unfilteredDomOffset()))return!0;break}for(;c.nextPosition();)if(h.acceptPosition(c)===d){if(b(a,c.container(),c.unfilteredDomOffset()))return!0;break}return!1}var l,q=odf.OdfUtils,p=core.DomUtils,d=core.PositionFilter.FilterResult.FILTER_ACCEPT,
n=core.StepDirection.PREVIOUS,a=core.StepDirection.NEXT;this.convertStepsToDomPoint=function(a){var b,g;if(isNaN(a))throw new TypeError("Requested steps is not numeric ("+a+")");if(0>a)throw new RangeError("Requested steps is negative ("+a+")");for(b=l.setToClosestStep(a,e);b<a&&e.nextPosition();)(g=h.acceptPosition(e)===d)&&(b+=1),f(b,e,g);if(b!==a)throw new RangeError("Requested steps ("+a+") exceeds available steps ("+b+")");return{node:e.container(),offset:e.unfilteredDomOffset()}};this.convertDomPointToSteps=
function(a,b,r){var n;p.containsNode(m,a)||(b=0>p.comparePoints(m,0,a,b),a=m,b=b?0:m.childNodes.length);e.setUnfilteredPosition(a,b);g(e,r)||e.setUnfilteredPosition(a,b);r=e.container();b=e.unfilteredDomOffset();a=l.setToClosestDomPoint(r,b,e);if(0>p.comparePoints(e.container(),e.unfilteredDomOffset(),r,b))return 0<a?a-1:a;for(;(e.container()!==r||e.unfilteredDomOffset()!==b)&&e.nextPosition();)(n=h.acceptPosition(e)===d)&&(a+=1),f(a,e,n);return a+0};this.prime=function(){var a,b;for(a=l.setToClosestStep(0,
e);e.nextPosition();)(b=h.acceptPosition(e)===d)&&(a+=1),f(a,e,b)};this.handleStepsInserted=function(a){l.damageCacheAfterStep(a.position)};this.handleStepsRemoved=function(a){l.damageCacheAfterStep(a.position-1)};l=new ops.StepsCache(m,b,function(a,b){do{if(h.acceptPosition(b)===d){f(a,b,!0);break}f(a-1,b,!1)}while(b.nextPosition())})}})();ops.Operation=function(){};ops.Operation.prototype.init=function(m){};ops.Operation.prototype.isEdit;ops.Operation.prototype.group;
ops.Operation.prototype.execute=function(m){};ops.Operation.prototype.spec=function(){};
ops.TextPositionFilter=function(){function m(b,f){for(;b&&f(b)!==g;)b=b.previousSibling;return b}function e(b,f,d,e){var a;if(f){if(h.isInlineRoot(f)&&h.isGroupingElement(d))return l;e=h.lookLeftForCharacter(f);if(1===e||2===e&&(h.scanRightForAnyCharacter(d)||h.scanRightForAnyCharacter(h.nextNode(b))))return g}else if(h.isGroupingElement(b)&&h.isInlineRoot(m(b.previousSibling,e)))return g;e=null===f&&h.isParagraph(b);a=h.lookRightForCharacter(d);if(e)return a?g:h.scanRightForAnyCharacter(d)?l:g;if(!a)return l;
f=f||h.previousNode(b);return h.scanLeftForAnyCharacter(f)?l:g}var h=odf.OdfUtils,b=Node.ELEMENT_NODE,f=Node.TEXT_NODE,g=core.PositionFilter.FilterResult.FILTER_ACCEPT,l=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(q){var m=q.container(),d=m.nodeType,n,a,c;if(d!==b&&d!==f)return l;if(d===f){d=q.unfilteredDomOffset();n=m.data;runtime.assert(d!==n.length,"Unexpected offset.");if(0<d){q=n[d-1];if(!h.isODFWhitespace(q))return g;if(1<d)if(q=n[d-2],!h.isODFWhitespace(q))c=
g;else{if(!h.isODFWhitespace(n.substr(0,d)))return l}else a=h.previousNode(m),h.scanLeftForNonSpace(a)&&(c=g);if(c===g)return h.isTrailingWhitespace(m,d)?l:g;q=n[d];return h.isODFWhitespace(q)?l:h.scanLeftForAnyCharacter(h.previousNode(m))?l:g}a=q.leftNode();c=m;m=m.parentNode;c=e(m,a,c,q.getNodeFilter())}else h.isGroupingElement(m)?(a=q.leftNode(),c=q.rightNode(),c=e(m,a,c,q.getNodeFilter())):c=l;return c}};
function RootFilter(m,e,h){var b=core.PositionFilter.FilterResult.FILTER_ACCEPT,f=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(g){g=g.container();var l;l="string"===typeof m?e[m].getNode():m;return h(g)===h(l)?b:f}}
ops.OdtDocument=function(m){function e(a){return new core.PositionIterator(a,H,C,!1)}function h(){var a=m.odfContainer().getContentElement(),c=a&&a.localName;runtime.assert("text"===c,"Unsupported content element type '"+c+"' for OdtDocument");return a}function b(){return a.getDocumentElement().ownerDocument}function f(a){for(;a&&!(a.namespaceURI===odf.Namespaces.officens&&"text"===a.localName||a.namespaceURI===odf.Namespaces.officens&&"annotation"===a.localName);)a=a.parentNode;return a}function g(a,
c,b,d){d=e(d);var f;1===b.length?f=b[0]:(f=new core.PositionFilterChain,b.forEach(f.addFilter));b=new core.StepIterator(f,d);b.setPosition(a,c);return b}function l(a){var c=e(h());a=t.convertStepsToDomPoint(a);c.setUnfilteredPosition(a.node,a.offset);return c}function q(a){return a===v}function p(c){var b=c.spec(),d=b.memberid,f=(new Date(b.timestamp)).toISOString(),b=m.odfContainer();c.isEdit&&(d=a.getMember(d).getProperties().fullName,b.setMetadata({"dc:creator":d,"dc:date":f},null),d={setProperties:{"dc:creator":d,
"dc:date":f},removedProperties:[]},w||(d.setProperties["meta:editing-cycles"]=b.incrementEditingCycles(),b.setMetadata(null,["meta:editing-duration","meta:document-statistic"])),w=c,a.emit(ops.OdtDocument.signalMetadataUpdated,d))}function d(a){var b,d=[],f,g=2;runtime.assert(a.isStep(),"positionIterator is not at a step");do{if(b=c.getContentBounds(a))if(b=b.container,k.isDowngradableSpaceElement(b)){for(f=b.lastChild;b.firstChild;)d.push(b.firstChild),b.parentNode.insertBefore(b.firstChild,b);b.parentNode.removeChild(b);
a.setPosition(f,f.nodeType===Node.TEXT_NODE?f.length:f.childNodes.length);a.roundToPreviousStep()}g-=1}while(0<g&&a.nextStep());d.forEach(r.normalizeTextNodes)}function n(a,c,b){a=a.childNodes.item(c)||a;return(a=k.getParagraphElement(a))&&r.containsNode(b,a)?a:b}var a=this,c,k=odf.OdfUtils,r=core.DomUtils,B={},y={},z=new core.EventNotifier([ops.Document.signalMemberAdded,ops.Document.signalMemberUpdated,ops.Document.signalMemberRemoved,ops.Document.signalCursorAdded,ops.Document.signalCursorRemoved,
ops.Document.signalCursorMoved,ops.OdtDocument.signalParagraphChanged,ops.OdtDocument.signalParagraphStyleModified,ops.OdtDocument.signalCommonStyleCreated,ops.OdtDocument.signalCommonStyleDeleted,ops.OdtDocument.signalTableAdded,ops.OdtDocument.signalOperationStart,ops.OdtDocument.signalOperationEnd,ops.OdtDocument.signalProcessingBatchStart,ops.OdtDocument.signalProcessingBatchEnd,ops.OdtDocument.signalUndoStackChanged,ops.OdtDocument.signalStepsInserted,ops.OdtDocument.signalStepsRemoved,ops.OdtDocument.signalMetadataUpdated,
ops.OdtDocument.signalAnnotationAdded]),v=core.StepDirection.NEXT,A,t,w,H=NodeFilter.SHOW_ALL,I=new gui.BlacklistNamespaceNodeFilter(["urn:webodf:names:cursor","urn:webodf:names:editinfo"]),D=new gui.OdfTextBodyNodeFilter,C=new core.NodeFilterChain([I,D]);this.createPositionIterator=e;this.getDocumentElement=function(){return m.odfContainer().rootElement};this.cloneDocumentElement=function(){var c=a.getDocumentElement(),b=m.getAnnotationViewManager();b&&b.forgetAnnotations();c=c.cloneNode(!0);m.refreshAnnotations();
a.fixCursorPositions();return c};this.setDocumentElement=function(a){var c=m.odfContainer();z.unsubscribe(ops.OdtDocument.signalStepsInserted,t.handleStepsInserted);z.unsubscribe(ops.OdtDocument.signalStepsRemoved,t.handleStepsRemoved);c.setRootElement(a);m.setOdfContainer(c,!0);m.refreshCSS();a=h();t=new ops.OdtStepsTranslator(a,e(a),A,500);z.subscribe(ops.OdtDocument.signalStepsInserted,t.handleStepsInserted);z.subscribe(ops.OdtDocument.signalStepsRemoved,t.handleStepsRemoved)};this.getDOMDocument=
b;this.getRootElement=f;this.createStepIterator=g;this.getIteratorAtPosition=l;this.convertCursorStepToDomPoint=function(a){return t.convertStepsToDomPoint(a)};this.convertDomPointToCursorStep=function(a,c,b){var d;b===v&&(d=q);return t.convertDomPointToSteps(a,c,d)};this.convertDomToCursorRange=function(a){var c;c=t.convertDomPointToSteps(a.anchorNode,a.anchorOffset);a=a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset?c:t.convertDomPointToSteps(a.focusNode,a.focusOffset);return{position:c,
length:a-c}};this.convertCursorToDomRange=function(a,c){var d=b().createRange(),f,k;f=t.convertStepsToDomPoint(a);c?(k=t.convertStepsToDomPoint(a+c),0<c?(d.setStart(f.node,f.offset),d.setEnd(k.node,k.offset)):(d.setStart(k.node,k.offset),d.setEnd(f.node,f.offset))):d.setStart(f.node,f.offset);return d};this.upgradeWhitespacesAtPosition=function(a){var b=l(a),b=new core.StepIterator(A,b),d,f=2;runtime.assert(b.isStep(),"positionIterator is not at a step (requested step: "+a+")");do{if(d=c.getContentBounds(b))if(a=
d.container,d=d.startOffset,a.nodeType===Node.TEXT_NODE&&k.isSignificantWhitespace(a,d)){runtime.assert(" "===a.data[d],"upgradeWhitespaceToElement: textNode.data[offset] should be a literal space");var g=a.ownerDocument.createElementNS(odf.Namespaces.textns,"text:s"),e=a.parentNode,r=a;g.appendChild(a.ownerDocument.createTextNode(" "));1===a.length?e.replaceChild(g,a):(a.deleteData(d,1),0<d&&(d<a.length&&a.splitText(d),r=a.nextSibling),e.insertBefore(g,r));a=g;b.setPosition(a,a.childNodes.length);
b.roundToPreviousStep()}f-=1}while(0<f&&b.nextStep())};this.downgradeWhitespaces=d;this.downgradeWhitespacesAtPosition=function(a){a=l(a);a=new core.StepIterator(A,a);d(a)};this.getTextNodeAtStep=function(c,d){var f=l(c),k=f.container(),g,e=0,r=null;k.nodeType===Node.TEXT_NODE?(g=k,e=f.unfilteredDomOffset(),0<g.length&&(0<e&&(g=g.splitText(e)),g.parentNode.insertBefore(b().createTextNode(""),g),g=g.previousSibling,e=0)):(g=b().createTextNode(""),e=0,k.insertBefore(g,f.rightNode()));if(d){if(B[d]&&
a.getCursorPosition(d)===c){for(r=B[d].getNode();r.nextSibling&&"cursor"===r.nextSibling.localName;)r.parentNode.insertBefore(r.nextSibling,r);0<g.length&&g.nextSibling!==r&&(g=b().createTextNode(""),e=0);r.parentNode.insertBefore(g,r)}}else for(;g.nextSibling&&"cursor"===g.nextSibling.localName;)g.parentNode.insertBefore(g.nextSibling,g);for(;g.previousSibling&&g.previousSibling.nodeType===Node.TEXT_NODE;)f=g.previousSibling,f.appendData(g.data),e=f.length,g=f,g.parentNode.removeChild(g.nextSibling);
for(;g.nextSibling&&g.nextSibling.nodeType===Node.TEXT_NODE;)f=g.nextSibling,g.appendData(f.data),g.parentNode.removeChild(f);return{textNode:g,offset:e}};this.fixCursorPositions=function(){Object.keys(B).forEach(function(c){var b=B[c],d=f(b.getNode()),k=a.createRootFilter(d),e,r,l,h=!1;l=b.getSelectedRange();e=n(l.startContainer,l.startOffset,d);r=g(l.startContainer,l.startOffset,[A,k],e);l.collapsed?d=r:(e=n(l.endContainer,l.endOffset,d),d=g(l.endContainer,l.endOffset,[A,k],e));r.isStep()&&d.isStep()?
r.container()!==d.container()||r.offset()!==d.offset()||l.collapsed&&b.getAnchorNode()===b.getNode()||(h=!0,l.setStart(r.container(),r.offset()),l.collapse(!0)):(h=!0,runtime.assert(r.roundToClosestStep(),"No walkable step found for cursor owned by "+c),l.setStart(r.container(),r.offset()),runtime.assert(d.roundToClosestStep(),"No walkable step found for cursor owned by "+c),l.setEnd(d.container(),d.offset()));h&&(b.setSelectedRange(l,b.hasForwardSelection()),a.emit(ops.Document.signalCursorMoved,
b))})};this.getCursorPosition=function(a){return(a=B[a])?t.convertDomPointToSteps(a.getNode(),0):0};this.getCursorSelection=function(a){a=B[a];var c=0,b=0;a&&(c=t.convertDomPointToSteps(a.getNode(),0),b=t.convertDomPointToSteps(a.getAnchorNode(),0));return{position:b,length:c-b}};this.getPositionFilter=function(){return A};this.getOdfCanvas=function(){return m};this.getCanvas=function(){return m};this.getRootNode=h;this.addMember=function(a){runtime.assert(void 0===y[a.getMemberId()],"This member already exists");
y[a.getMemberId()]=a};this.getMember=function(a){return y.hasOwnProperty(a)?y[a]:null};this.removeMember=function(a){delete y[a]};this.getCursor=function(a){return B[a]};this.hasCursor=function(a){return B.hasOwnProperty(a)};this.getMemberIds=function(){return Object.keys(y)};this.addCursor=function(c){runtime.assert(Boolean(c),"OdtDocument::addCursor without cursor");var b=c.getMemberId(),d=a.convertCursorToDomRange(0,0);runtime.assert("string"===typeof b,"OdtDocument::addCursor has cursor without memberid");
runtime.assert(!B[b],"OdtDocument::addCursor is adding a duplicate cursor with memberid "+b);c.setSelectedRange(d,!0);B[b]=c};this.removeCursor=function(c){var b=B[c];return b?(b.removeFromDocument(),delete B[c],a.emit(ops.Document.signalCursorRemoved,c),!0):!1};this.moveCursor=function(c,b,d,f){c=B[c];b=a.convertCursorToDomRange(b,d);c&&(c.setSelectedRange(b,0<=d),c.setSelectionType(f||ops.OdtCursor.RangeSelection))};this.getFormatting=function(){return m.getFormatting()};this.emit=function(a,c){z.emit(a,
c)};this.subscribe=function(a,c){z.subscribe(a,c)};this.unsubscribe=function(a,c){z.unsubscribe(a,c)};this.createRootFilter=function(a){return new RootFilter(a,B,f)};this.close=function(a){a()};this.destroy=function(a){a()};(function(){var a=h();A=new ops.TextPositionFilter;c=new odf.StepUtils;t=new ops.OdtStepsTranslator(a,e(a),A,500);z.subscribe(ops.OdtDocument.signalStepsInserted,t.handleStepsInserted);z.subscribe(ops.OdtDocument.signalStepsRemoved,t.handleStepsRemoved);z.subscribe(ops.OdtDocument.signalOperationEnd,
p);z.subscribe(ops.OdtDocument.signalProcessingBatchEnd,core.Task.processTasks)})()};ops.OdtDocument.signalParagraphChanged="paragraph/changed";ops.OdtDocument.signalTableAdded="table/added";ops.OdtDocument.signalCommonStyleCreated="style/created";ops.OdtDocument.signalCommonStyleDeleted="style/deleted";ops.OdtDocument.signalParagraphStyleModified="paragraphstyle/modified";ops.OdtDocument.signalOperationStart="operation/start";ops.OdtDocument.signalOperationEnd="operation/end";
ops.OdtDocument.signalProcessingBatchStart="router/batchstart";ops.OdtDocument.signalProcessingBatchEnd="router/batchend";ops.OdtDocument.signalUndoStackChanged="undo/changed";ops.OdtDocument.signalStepsInserted="steps/inserted";ops.OdtDocument.signalStepsRemoved="steps/removed";ops.OdtDocument.signalMetadataUpdated="metadata/updated";ops.OdtDocument.signalAnnotationAdded="annotation/added";
ops.OpAddAnnotation=function(){function m(b,f,d){var g=b.getTextNodeAtStep(d,e);g&&(b=g.textNode,d=b.parentNode,g.offset!==b.length&&b.splitText(g.offset),d.insertBefore(f,b.nextSibling),0===b.length&&d.removeChild(b))}var e,h,b,f,g,l;this.init=function(l){e=l.memberid;h=parseInt(l.timestamp,10);b=parseInt(l.position,10);f=void 0!==l.length?parseInt(l.length,10)||0:void 0;g=l.name};this.isEdit=!0;this.group=void 0;this.execute=function(q){var p=q.getCursor(e),d,n;l=q.getDOMDocument();var a=new Date(h),
c,k,r;c=l.createElementNS(odf.Namespaces.officens,"office:annotation");c.setAttributeNS(odf.Namespaces.officens,"office:name",g);d=l.createElementNS(odf.Namespaces.dcns,"dc:creator");d.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",e);d.textContent=q.getMember(e).getProperties().fullName;n=l.createElementNS(odf.Namespaces.dcns,"dc:date");n.appendChild(l.createTextNode(a.toISOString()));a=l.createElementNS(odf.Namespaces.textns,"text:list");k=l.createElementNS(odf.Namespaces.textns,
"text:list-item");r=l.createElementNS(odf.Namespaces.textns,"text:p");k.appendChild(r);a.appendChild(k);c.appendChild(d);c.appendChild(n);c.appendChild(a);void 0!==f&&(d=l.createElementNS(odf.Namespaces.officens,"office:annotation-end"),d.setAttributeNS(odf.Namespaces.officens,"office:name",g),c.annotationEndElement=d,m(q,d,b+f));m(q,c,b);q.emit(ops.OdtDocument.signalStepsInserted,{position:b});p&&(d=l.createRange(),n=c.getElementsByTagNameNS(odf.Namespaces.textns,"p")[0],d.selectNodeContents(n),
p.setSelectedRange(d,!1),p.setSelectionType(ops.OdtCursor.RangeSelection),q.emit(ops.Document.signalCursorMoved,p));q.getOdfCanvas().addAnnotation(c);q.fixCursorPositions();q.emit(ops.OdtDocument.signalAnnotationAdded,{memberId:e,annotation:c});return!0};this.spec=function(){return{optype:"AddAnnotation",memberid:e,timestamp:h,position:b,length:f,name:g}}};ops.OpAddAnnotation.Spec;ops.OpAddAnnotation.InitSpec;
ops.OpAddCursor=function(){var m,e;this.init=function(h){m=h.memberid;e=h.timestamp};this.isEdit=!1;this.group=void 0;this.execute=function(e){var b=e.getCursor(m);if(b)return!1;b=new ops.OdtCursor(m,e);e.addCursor(b);e.emit(ops.Document.signalCursorAdded,b);return!0};this.spec=function(){return{optype:"AddCursor",memberid:m,timestamp:e}}};ops.OpAddCursor.Spec;ops.OpAddCursor.InitSpec;
ops.OpAddMember=function(){var m,e,h;this.init=function(b){m=b.memberid;e=parseInt(b.timestamp,10);h=b.setProperties};this.isEdit=!1;this.group=void 0;this.execute=function(b){var f;if(b.getMember(m))return!1;f=new ops.Member(m,h);b.addMember(f);b.emit(ops.Document.signalMemberAdded,f);return!0};this.spec=function(){return{optype:"AddMember",memberid:m,timestamp:e,setProperties:h}}};ops.OpAddMember.Spec;ops.OpAddMember.InitSpec;
ops.OpAddStyle=function(){var m,e,h,b,f,g,l=odf.Namespaces.stylens;this.init=function(l){m=l.memberid;e=l.timestamp;h=l.styleName;b=l.styleFamily;f="true"===l.isAutomaticStyle||!0===l.isAutomaticStyle;g=l.setProperties};this.isEdit=!0;this.group=void 0;this.execute=function(e){var m=e.getOdfCanvas().odfContainer(),d=e.getFormatting(),n=e.getDOMDocument().createElementNS(l,"style:style");if(!n)return!1;g&&d.updateStyle(n,g);n.setAttributeNS(l,"style:family",b);n.setAttributeNS(l,"style:name",h);f?
m.rootElement.automaticStyles.appendChild(n):m.rootElement.styles.appendChild(n);e.getOdfCanvas().refreshCSS();f||e.emit(ops.OdtDocument.signalCommonStyleCreated,{name:h,family:b});return!0};this.spec=function(){return{optype:"AddStyle",memberid:m,timestamp:e,styleName:h,styleFamily:b,isAutomaticStyle:f,setProperties:g}}};ops.OpAddStyle.Spec;ops.OpAddStyle.InitSpec;
odf.ObjectNameGenerator=function(m,e){function h(a,c){var b={};this.generateName=function(){var d=c(),f=0,g;do g=a+f,f+=1;while(b[g]||d[g]);b[g]=!0;return g}}function b(){var a={};[m.rootElement.automaticStyles,m.rootElement.styles].forEach(function(c){for(c=c.firstElementChild;c;)c.namespaceURI===f&&"style"===c.localName&&(a[c.getAttributeNS(f,"name")]=!0),c=c.nextElementSibling});return a}var f=odf.Namespaces.stylens,g=odf.Namespaces.drawns,l=odf.Namespaces.xlinkns,q=(new core.Utils).hashString(e),
p=null,d=null,n=null,a={},c={};this.generateStyleName=function(){null===p&&(p=new h("auto"+q+"_",function(){return b()}));return p.generateName()};this.generateFrameName=function(){var c,b,f;if(null===d){b=m.rootElement.body.getElementsByTagNameNS(g,"frame");for(c=0;c<b.length;c+=1)f=b.item(c),a[f.getAttributeNS(g,"name")]=!0;d=new h("fr"+q+"_",function(){return a})}return d.generateName()};this.generateImageName=function(){var a,b,d;if(null===n){d=m.rootElement.body.getElementsByTagNameNS(g,"image");
for(a=0;a<d.length;a+=1)b=d.item(a),b=b.getAttributeNS(l,"href"),b=b.substring(9,b.lastIndexOf(".")),c[b]=!0;n=new h("img"+q+"_",function(){return c})}return n.generateName()}};
odf.TextStyleApplicator=function(m,e,h){function b(b){function f(a,b){return"object"===typeof a&&"object"===typeof b?Object.keys(a).every(function(d){return f(a[d],b[d])}):a===b}var a={};this.isStyleApplied=function(c){c=e.getAppliedStylesForElement(c,a).styleProperties;return f(b,c)}}function f(b){var f={};this.applyStyleToContainer=function(a){var c;c=a.getAttributeNS(q,"style-name");var k=a.ownerDocument;c=c||"";if(!f.hasOwnProperty(c)){var g=c,l;l=c?e.createDerivedStyleObject(c,"text",b):b;k=
k.createElementNS(p,"style:style");e.updateStyle(k,l);k.setAttributeNS(p,"style:name",m.generateStyleName());k.setAttributeNS(p,"style:family","text");k.setAttributeNS("urn:webodf:names:scope","scope","document-content");h.appendChild(k);f[g]=k}c=f[c].getAttributeNS(p,"name");a.setAttributeNS(q,"text:style-name",c)}}function g(b,f){var a=b.ownerDocument,c=b.parentNode,k,g,e,h=new core.LoopWatchDog(1E4);g=[];g.push(b);for(e=b.nextSibling;e&&l.rangeContainsNode(f,e);)h.check(),g.push(e),e=e.nextSibling;
"span"!==c.localName||c.namespaceURI!==q?(k=a.createElementNS(q,"text:span"),c.insertBefore(k,b),a=!1):(b.previousSibling&&!l.rangeContainsNode(f,c.firstChild)?(k=c.cloneNode(!1),c.parentNode.insertBefore(k,c.nextSibling)):k=c,a=!0);g.forEach(function(a){a.parentNode!==k&&k.appendChild(a)});if(e&&a)for(g=k.cloneNode(!1),k.parentNode.insertBefore(g,k.nextSibling);e;)h.check(),a=e.nextSibling,g.appendChild(e),e=a;return k}var l=core.DomUtils,q=odf.Namespaces.textns,p=odf.Namespaces.stylens;this.applyStyle=
function(d,e,a){var c={},k,l,h,m;runtime.assert(a&&a.hasOwnProperty("style:text-properties"),"applyStyle without any text properties");c["style:text-properties"]=a["style:text-properties"];h=new f(c);m=new b(c);d.forEach(function(a){k=m.isStyleApplied(a);!1===k&&(l=g(a,e),h.applyStyleToContainer(l))})}};
ops.OpApplyDirectStyling=function(){function m(b,d,f){var a=b.getOdfCanvas().odfContainer(),c=q.splitBoundaries(d),k=l.getTextNodes(d,!1);(new odf.TextStyleApplicator(new odf.ObjectNameGenerator(a,e),b.getFormatting(),a.rootElement.automaticStyles)).applyStyle(k,d,f);c.forEach(q.normalizeTextNodes)}var e,h,b,f,g,l=odf.OdfUtils,q=core.DomUtils;this.init=function(l){e=l.memberid;h=l.timestamp;b=parseInt(l.position,10);f=parseInt(l.length,10);g=l.setProperties};this.isEdit=!0;this.group=void 0;this.execute=
function(q){var d=q.convertCursorToDomRange(b,f),n=l.getParagraphElements(d);m(q,d,g);d.detach();q.getOdfCanvas().refreshCSS();q.fixCursorPositions();n.forEach(function(a){q.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:a,memberId:e,timeStamp:h})});q.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"ApplyDirectStyling",memberid:e,timestamp:h,position:b,length:f,setProperties:g}}};ops.OpApplyDirectStyling.Spec;ops.OpApplyDirectStyling.InitSpec;
ops.OpApplyHyperlink=function(){function m(b){for(;b;){if(q.isHyperlink(b))return!0;b=b.parentNode}return!1}var e,h,b,f,g,l=core.DomUtils,q=odf.OdfUtils;this.init=function(l){e=l.memberid;h=l.timestamp;b=l.position;f=l.length;g=l.hyperlink};this.isEdit=!0;this.group=void 0;this.execute=function(p){var d=p.getDOMDocument(),n=p.convertCursorToDomRange(b,f),a=l.splitBoundaries(n),c=[],k=q.getTextNodes(n,!1);if(0===k.length)return!1;k.forEach(function(a){var b=q.getParagraphElement(a);runtime.assert(!1===
m(a),"The given range should not contain any link.");var f=g,k=d.createElementNS(odf.Namespaces.textns,"text:a");k.setAttributeNS(odf.Namespaces.xlinkns,"xlink:type","simple");k.setAttributeNS(odf.Namespaces.xlinkns,"xlink:href",f);a.parentNode.insertBefore(k,a);k.appendChild(a);-1===c.indexOf(b)&&c.push(b)});a.forEach(l.normalizeTextNodes);n.detach();p.fixCursorPositions();p.getOdfCanvas().refreshSize();p.getOdfCanvas().rerenderAnnotations();c.forEach(function(a){p.emit(ops.OdtDocument.signalParagraphChanged,
{paragraphElement:a,memberId:e,timeStamp:h})});return!0};this.spec=function(){return{optype:"ApplyHyperlink",memberid:e,timestamp:h,position:b,length:f,hyperlink:g}}};ops.OpApplyHyperlink.Spec;ops.OpApplyHyperlink.InitSpec;
ops.OpInsertImage=function(){var m,e,h,b,f,g,l,q,p=odf.Namespaces.drawns,d=odf.Namespaces.svgns,n=odf.Namespaces.textns,a=odf.Namespaces.xlinkns,c=odf.OdfUtils;this.init=function(a){m=a.memberid;e=a.timestamp;h=a.position;b=a.filename;f=a.frameWidth;g=a.frameHeight;l=a.frameStyleName;q=a.frameName};this.isEdit=!0;this.group=void 0;this.execute=function(k){var r=k.getOdfCanvas(),B=k.getTextNodeAtStep(h,m),y,z;if(!B)return!1;y=B.textNode;z=c.getParagraphElement(y);var B=B.offset!==y.length?y.splitText(B.offset):
y.nextSibling,v=k.getDOMDocument(),A=v.createElementNS(p,"draw:image"),v=v.createElementNS(p,"draw:frame");A.setAttributeNS(a,"xlink:href",b);A.setAttributeNS(a,"xlink:type","simple");A.setAttributeNS(a,"xlink:show","embed");A.setAttributeNS(a,"xlink:actuate","onLoad");newaddlist.push(b);v.setAttributeNS(p,"draw:style-name",l);v.setAttributeNS(p,"draw:name",q);v.setAttributeNS(n,"text:anchor-type","as-char");v.setAttributeNS(d,"svg:width",f);v.setAttributeNS(d,"svg:height",g);v.appendChild(A);y.parentNode.insertBefore(v,
B);k.emit(ops.OdtDocument.signalStepsInserted,{position:h});0===y.length&&y.parentNode.removeChild(y);r.addCssForFrameWithImage(v);r.refreshCSS();k.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:z,memberId:m,timeStamp:e});r.rerenderAnnotations();return!0};this.spec=function(){return{optype:"InsertImage",memberid:m,timestamp:e,filename:b,position:h,frameWidth:f,frameHeight:g,frameStyleName:l,frameName:q}}};ops.OpInsertImage.Spec;ops.OpInsertImage.InitSpec;
ops.OpInsertTable=function(){function m(a,c){var k;if(1===d.length)k=d[0];else if(3===d.length)switch(a){case 0:k=d[0];break;case b-1:k=d[2];break;default:k=d[1]}else k=d[a];if(1===k.length)return k[0];if(3===k.length)switch(c){case 0:return k[0];case f-1:return k[2];default:return k[1]}return k[c]}var e,h,b,f,g,l,q,p,d,n=odf.OdfUtils;this.init=function(a){e=a.memberid;h=a.timestamp;g=a.position;b=a.initialRows;f=a.initialColumns;l=a.tableName;q=a.tableStyleName;p=a.tableColumnStyleName;d=a.tableCellStyleMatrix};
this.isEdit=!0;this.group=void 0;this.execute=function(a){var c=a.getTextNodeAtStep(g),d=a.getRootNode();if(c){var r=a.getDOMDocument(),B=r.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table"),y=r.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-column"),z,v,A,t;q&&B.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",q);l&&B.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:name",l);y.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0",
"table:number-columns-repeated",f);p&&y.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",p);B.appendChild(y);for(A=0;A<b;A+=1){y=r.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-row");for(t=0;t<f;t+=1)z=r.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-cell"),(v=m(A,t))&&z.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",v),v=r.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0",
"text:p"),z.appendChild(v),y.appendChild(z);B.appendChild(y)}c=n.getParagraphElement(c.textNode);d.insertBefore(B,c.nextSibling);a.emit(ops.OdtDocument.signalStepsInserted,{position:g});a.getOdfCanvas().refreshSize();a.emit(ops.OdtDocument.signalTableAdded,{tableElement:B,memberId:e,timeStamp:h});a.getOdfCanvas().rerenderAnnotations();return!0}return!1};this.spec=function(){return{optype:"InsertTable",memberid:e,timestamp:h,position:g,initialRows:b,initialColumns:f,tableName:l,tableStyleName:q,tableColumnStyleName:p,
tableCellStyleMatrix:d}}};ops.OpInsertTable.Spec;ops.OpInsertTable.InitSpec;
ops.OpInsertText=function(){function m(b){return"\t"!==b&&l.isODFWhitespace(b)}var e,h,b,f,g,l=odf.OdfUtils;this.init=function(l){e=l.memberid;h=l.timestamp;b=l.position;g=l.text;f="true"===l.moveCursor||!0===l.moveCursor};this.isEdit=!0;this.group=void 0;this.execute=function(q){var p,d,n,a=null,c=q.getDOMDocument(),k,r=0,B,y=q.getCursor(e),z;q.upgradeWhitespacesAtPosition(b);if(p=q.getTextNodeAtStep(b)){d=p.textNode;a=d.nextSibling;n=d.parentNode;k=l.getParagraphElement(d);for(z=0;z<g.length;z+=
1){if(!(B="\t"===g[z])){B=g;var v=z;B=m(B[v])&&(0===v||v===B.length-1||m(B[v-1]))}B&&(0===r?(p.offset!==d.length&&(a=d.splitText(p.offset)),0<z&&d.appendData(g.substring(0,z))):r<z&&(r=g.substring(r,z),n.insertBefore(c.createTextNode(r),a)),r=z+1,"\t"===g[z]?(B=c.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:tab"),B.appendChild(c.createTextNode("\t"))):(" "!==g[z]&&runtime.log("WARN: InsertText operation contains non-tab, non-space whitespace character (character code "+g.charCodeAt(z)+
")"),B=c.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:s"),B.appendChild(c.createTextNode(" "))),n.insertBefore(B,a))}0===r?d.insertData(p.offset,g):r<g.length&&(p=g.substring(r),n.insertBefore(c.createTextNode(p),a));n=d.parentNode;a=d.nextSibling;n.removeChild(d);n.insertBefore(d,a);0===d.length&&d.parentNode.removeChild(d);q.emit(ops.OdtDocument.signalStepsInserted,{position:b});y&&f&&(q.moveCursor(e,b+g.length,0),q.emit(ops.Document.signalCursorMoved,y));q.downgradeWhitespacesAtPosition(b);
q.downgradeWhitespacesAtPosition(b+g.length);q.getOdfCanvas().refreshSize();q.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:k,memberId:e,timeStamp:h});q.getOdfCanvas().rerenderAnnotations();return!0}return!1};this.spec=function(){return{optype:"InsertText",memberid:e,timestamp:h,position:b,text:g,moveCursor:f}}};ops.OpInsertText.Spec;ops.OpInsertText.InitSpec;
odf.CollapsingRules=function(m){function e(f){return b.isODFNode(f)||"br"===f.localName&&b.isLineBreak(f.parentNode)||f.nodeType===Node.TEXT_NODE&&b.isODFNode(f.parentNode)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}function h(g){var l;g.nodeType===Node.TEXT_NODE?(l=g.parentNode,l.removeChild(g)):l=f.removeUnwantedNodes(g,e);if(g=l)g=l,g=!b.isParagraph(g)&&g!==m&&b.hasNoODFContent(g);return g?h(l):l}var b=odf.OdfUtils,f=core.DomUtils;this.mergeChildrenIntoParent=h};
ops.OpMergeParagraph=function(){function m(a){return odf.OdfUtils.isInlineRoot(a)?NodeFilter.FILTER_SKIP:n.isGroupingElement(a)&&n.hasNoODFContent(a)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}function e(a){if(a.nodeType===Node.TEXT_NODE){if(0===a.length)return runtime.log("WARN: Empty text node found during merge operation"),!0;if(n.isODFWhitespace(a.data)&&!1===n.isSignificantWhitespace(a,0))return!0;a="#text"}else a=(a.prefix?a.prefix+":":"")+a.localName;runtime.log("WARN: Unexpected text element found near paragraph boundary ["+
a+"]");return!1}function h(c){c.collapsed||(a.splitBoundaries(c),c=n.getTextElements(c,!1,!0).filter(e),c.forEach(function(a){a.parentNode.removeChild(a)}))}function b(a,c,b){a=a.convertCursorStepToDomPoint(c);var d=n.getParagraphElement(a.node,a.offset);runtime.assert(Boolean(d),"Paragraph not found at step "+c);b&&b.setPosition(a.node,a.offset);return d}var f,g,l,q,p,d,n=odf.OdfUtils,a=core.DomUtils,c=odf.Namespaces.textns;this.init=function(a){f=a.memberid;g=a.timestamp;l=a.moveCursor;q=a.paragraphStyleName;
p=parseInt(a.sourceStartPosition,10);d=parseInt(a.destinationStartPosition,10)};this.isEdit=!0;this.group=void 0;this.execute=function(k){var e,n,y=k.getCursor(f);e=k.getRootNode();var z=new odf.CollapsingRules(e),v=k.createStepIterator(e,0,[k.getPositionFilter()],e),A;runtime.assert(d<p,"Destination paragraph ("+d+") must be before source paragraph ("+p+")");n=b(k,d);e=b(k,p,v);v.previousStep();runtime.assert(a.containsNode(n,v.container()),"Destination paragraph must be adjacent to the source paragraph");
A=n.ownerDocument.createRange();v.setPosition(n,n.childNodes.length);v.roundToPreviousStep();A.setStart(v.container(),v.offset());A.setEnd(n,n.childNodes.length);h(A);A=n.childNodes.length;var t=e.ownerDocument.createRange();v.setPosition(e,0);v.roundToNextStep();t.setStart(e,0);t.setEnd(v.container(),v.offset());h(t);for(t=e.firstChild;t;)"editinfo"===t.localName?e.removeChild(t):(n.appendChild(t),a.removeUnwantedNodes(t,m)),t=e.firstChild;runtime.assert(0===e.childNodes.length,"Source paragraph should be empty before it is removed");
z.mergeChildrenIntoParent(e);k.emit(ops.OdtDocument.signalStepsRemoved,{position:p-1});v.setPosition(n,A);v.roundToClosestStep();v.previousStep()||v.roundToNextStep();k.downgradeWhitespaces(v);q?n.setAttributeNS(c,"text:style-name",q):n.removeAttributeNS(c,"style-name");y&&l&&(k.moveCursor(f,p-1,0),k.emit(ops.Document.signalCursorMoved,y));k.fixCursorPositions();k.getOdfCanvas().refreshSize();k.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:n,memberId:f,timeStamp:g});k.getOdfCanvas().rerenderAnnotations();
return!0};this.spec=function(){return{optype:"MergeParagraph",memberid:f,timestamp:g,moveCursor:l,paragraphStyleName:q,sourceStartPosition:p,destinationStartPosition:d}}};ops.OpMergeParagraph.Spec;ops.OpMergeParagraph.InitSpec;
ops.OpMoveCursor=function(){var m,e,h,b,f;this.init=function(g){m=g.memberid;e=g.timestamp;h=g.position;b=g.length||0;f=g.selectionType||ops.OdtCursor.RangeSelection};this.isEdit=!1;this.group=void 0;this.execute=function(g){var e=g.getCursor(m),q;if(!e)return!1;q=g.convertCursorToDomRange(h,b);e.setSelectedRange(q,0<=b);e.setSelectionType(f);g.emit(ops.Document.signalCursorMoved,e);return!0};this.spec=function(){return{optype:"MoveCursor",memberid:m,timestamp:e,position:h,length:b,selectionType:f}}};
ops.OpMoveCursor.Spec;ops.OpMoveCursor.InitSpec;
ops.OpRemoveAnnotation=function(){var m,e,h,b,f=core.DomUtils;this.init=function(f){m=f.memberid;e=f.timestamp;h=parseInt(f.position,10);b=parseInt(f.length,10)};this.isEdit=!0;this.group=void 0;this.execute=function(b){function e(b){p.parentNode.insertBefore(b,p)}for(var m=b.getIteratorAtPosition(h).container(),p;m.namespaceURI!==odf.Namespaces.officens||"annotation"!==m.localName;)m=m.parentNode;if(null===m)return!1;p=m;m=p.annotationEndElement;b.getOdfCanvas().forgetAnnotation(p);f.getElementsByTagNameNS(p,
"urn:webodf:names:cursor","cursor").forEach(e);f.getElementsByTagNameNS(p,"urn:webodf:names:cursor","anchor").forEach(e);p.parentNode.removeChild(p);m&&m.parentNode.removeChild(m);b.emit(ops.OdtDocument.signalStepsRemoved,{position:0<h?h-1:h});b.getOdfCanvas().rerenderAnnotations();b.fixCursorPositions();return!0};this.spec=function(){return{optype:"RemoveAnnotation",memberid:m,timestamp:e,position:h,length:b}}};ops.OpRemoveAnnotation.Spec;ops.OpRemoveAnnotation.InitSpec;
ops.OpRemoveBlob=function(){var m,e,h;this.init=function(b){m=b.memberid;e=b.timestamp;h=b.filename};this.isEdit=!0;this.group=void 0;this.execute=function(b){b.getOdfCanvas().odfContainer().removeBlob(h);return!0};this.spec=function(){return{optype:"RemoveBlob",memberid:m,timestamp:e,filename:h}}};ops.OpRemoveBlob.Spec;ops.OpRemoveBlob.InitSpec;
ops.OpRemoveCursor=function(){var m,e;this.init=function(h){m=h.memberid;e=h.timestamp};this.isEdit=!1;this.group=void 0;this.execute=function(e){return e.removeCursor(m)?!0:!1};this.spec=function(){return{optype:"RemoveCursor",memberid:m,timestamp:e}}};ops.OpRemoveCursor.Spec;ops.OpRemoveCursor.InitSpec;
ops.OpRemoveHyperlink=function(){var m,e,h,b,f=core.DomUtils,g=odf.OdfUtils;this.init=function(f){m=f.memberid;e=f.timestamp;h=f.position;b=f.length};this.isEdit=!0;this.group=void 0;this.execute=function(l){var q=l.convertCursorToDomRange(h,b),p=g.getHyperlinkElements(q);runtime.assert(1===p.length,"The given range should only contain a single link.");p=f.mergeIntoParent(p[0]);q.detach();l.fixCursorPositions();l.getOdfCanvas().refreshSize();l.getOdfCanvas().rerenderAnnotations();l.emit(ops.OdtDocument.signalParagraphChanged,
{paragraphElement:g.getParagraphElement(p),memberId:m,timeStamp:e});return!0};this.spec=function(){return{optype:"RemoveHyperlink",memberid:m,timestamp:e,position:h,length:b}}};ops.OpRemoveHyperlink.Spec;ops.OpRemoveHyperlink.InitSpec;
ops.OpRemoveMember=function(){var m,e;this.init=function(h){m=h.memberid;e=parseInt(h.timestamp,10)};this.isEdit=!1;this.group=void 0;this.execute=function(e){if(!e.getMember(m))return!1;e.removeMember(m);e.emit(ops.Document.signalMemberRemoved,m);return!0};this.spec=function(){return{optype:"RemoveMember",memberid:m,timestamp:e}}};ops.OpRemoveMember.Spec;ops.OpRemoveMember.InitSpec;
ops.OpRemoveStyle=function(){var m,e,h,b;this.init=function(f){m=f.memberid;e=f.timestamp;h=f.styleName;b=f.styleFamily};this.isEdit=!0;this.group=void 0;this.execute=function(f){var g=f.getFormatting().getStyleElement(h,b);if(!g)return!1;g.parentNode.removeChild(g);f.getOdfCanvas().refreshCSS();f.emit(ops.OdtDocument.signalCommonStyleDeleted,{name:h,family:b});return!0};this.spec=function(){return{optype:"RemoveStyle",memberid:m,timestamp:e,styleName:h,styleFamily:b}}};ops.OpRemoveStyle.Spec;ops.OpRemoveStyle.InitSpec;
ops.OpRemoveText=function(){var m,e,h,b,f=odf.OdfUtils,g=core.DomUtils;this.init=function(f){runtime.assert(0<=f.length,"OpRemoveText only supports positive lengths");m=f.memberid;e=f.timestamp;h=parseInt(f.position,10);b=parseInt(f.length,10)};this.isEdit=!0;this.group=void 0;this.execute=function(l){var q,p,d,n=l.getCursor(m),a=new odf.CollapsingRules(l.getRootNode());l.upgradeWhitespacesAtPosition(h);l.upgradeWhitespacesAtPosition(h+b);q=l.convertCursorToDomRange(h,b);g.splitBoundaries(q);p=f.getTextElements(q,
!1,!0);d=f.getParagraphElement(q.startContainer,q.startOffset);runtime.assert(void 0!==d,"Attempting to remove text outside a paragraph element");q.detach();p.forEach(function(c){c.parentNode?(runtime.assert(g.containsNode(d,c),"RemoveText only supports removing elements within the same paragraph"),a.mergeChildrenIntoParent(c)):runtime.log("WARN: text element has already been removed from it's container")});l.emit(ops.OdtDocument.signalStepsRemoved,{position:h});l.downgradeWhitespacesAtPosition(h);
l.fixCursorPositions();l.getOdfCanvas().refreshSize();l.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:d,memberId:m,timeStamp:e});n&&(n.resetSelectionType(),l.emit(ops.Document.signalCursorMoved,n));l.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"RemoveText",memberid:m,timestamp:e,position:h,length:b}}};ops.OpRemoveText.Spec;ops.OpRemoveText.InitSpec;
ops.OpSetBlob=function(){var m,e,h,b,f;this.init=function(g){m=g.memberid;e=g.timestamp;h=g.filename;b=g.mimetype;f=g.content};this.isEdit=!0;this.group=void 0;this.execute=function(g){g.getOdfCanvas().odfContainer().setBlob(h,b,f);return!0};this.spec=function(){return{optype:"SetBlob",memberid:m,timestamp:e,filename:h,mimetype:b,content:f}}};ops.OpSetBlob.Spec;ops.OpSetBlob.InitSpec;
ops.OpSetParagraphStyle=function(){function m(b,f,g){var d=[b.getPositionFilter()],e=g.container();g=g.unfilteredDomOffset();return!1===b.createStepIterator(e,g,d,f).previousStep()}var e,h,b,f,g=odf.OdfUtils;this.init=function(g){e=g.memberid;h=g.timestamp;b=g.position;f=g.styleName};this.isEdit=!0;this.group=void 0;this.execute=function(l){var q,p;q=l.getIteratorAtPosition(b);return(p=g.getParagraphElement(q.container()))?(runtime.assert(m(l,p,q),"SetParagraphStyle position should be the first position in the paragraph"),
f?p.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:style-name",f):p.removeAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","style-name"),l.getOdfCanvas().refreshSize(),l.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:p,timeStamp:h,memberId:e}),l.getOdfCanvas().rerenderAnnotations(),!0):!1};this.spec=function(){return{optype:"SetParagraphStyle",memberid:e,timestamp:h,position:b,styleName:f}}};ops.OpSetParagraphStyle.Spec;ops.OpSetParagraphStyle.InitSpec;
ops.OpSplitParagraph=function(){var m,e,h,b,f,g,l=odf.OdfUtils,q=odf.Namespaces.textns;this.init=function(l){m=l.memberid;e=l.timestamp;b=l.position;h=l.sourceParagraphPosition;g=l.paragraphStyleName;f="true"===l.moveCursor||!0===l.moveCursor};this.isEdit=!0;this.group=void 0;this.execute=function(h){var d,n,a,c,k,r,B,y=h.getCursor(m);h.upgradeWhitespacesAtPosition(b);d=h.getTextNodeAtStep(b);if(!d)return!1;n=l.getParagraphElement(d.textNode);if(!n)return!1;a=l.isListItem(n.parentNode)?n.parentNode:
n;0===d.offset?(B=d.textNode.previousSibling,r=null):(B=d.textNode,r=d.offset>=d.textNode.length?null:d.textNode.splitText(d.offset));for(c=d.textNode;c!==a;){c=c.parentNode;k=c.cloneNode(!1);r&&k.appendChild(r);if(B)for(;B&&B.nextSibling;)k.appendChild(B.nextSibling);else for(;c.firstChild;)k.appendChild(c.firstChild);c.parentNode.insertBefore(k,c.nextSibling);B=c;r=k}l.isListItem(r)&&(r=r.childNodes.item(0));g?r.setAttributeNS(q,"text:style-name",g):r.removeAttributeNS(q,"style-name");0===d.textNode.length&&
d.textNode.parentNode.removeChild(d.textNode);h.emit(ops.OdtDocument.signalStepsInserted,{position:b});y&&f&&(h.moveCursor(m,b+1,0),h.emit(ops.Document.signalCursorMoved,y));h.fixCursorPositions();h.getOdfCanvas().refreshSize();h.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:n,memberId:m,timeStamp:e});h.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:r,memberId:m,timeStamp:e});h.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"SplitParagraph",
memberid:m,timestamp:e,position:b,sourceParagraphPosition:h,paragraphStyleName:g,moveCursor:f}}};ops.OpSplitParagraph.Spec;ops.OpSplitParagraph.InitSpec;
ops.OpUpdateMember=function(){function m(f){var l="//dc:creator[@editinfo:memberid='"+e+"']";f=xmldom.XPath.getODFElementsWithXPath(f.getRootNode(),l,function(b){return"editinfo"===b?"urn:webodf:names:editinfo":odf.Namespaces.lookupNamespaceURI(b)});for(l=0;l<f.length;l+=1)f[l].textContent=b.fullName}var e,h,b,f;this.init=function(g){e=g.memberid;h=parseInt(g.timestamp,10);b=g.setProperties;f=g.removedProperties};this.isEdit=!1;this.group=void 0;this.execute=function(g){var l=g.getMember(e);if(!l)return!1;
f&&l.removeProperties(f);b&&(l.setProperties(b),b.fullName&&m(g));g.emit(ops.Document.signalMemberUpdated,l);return!0};this.spec=function(){return{optype:"UpdateMember",memberid:e,timestamp:h,setProperties:b,removedProperties:f}}};ops.OpUpdateMember.Spec;ops.OpUpdateMember.InitSpec;
ops.OpUpdateMetadata=function(){var m,e,h,b;this.init=function(f){m=f.memberid;e=parseInt(f.timestamp,10);h=f.setProperties;b=f.removedProperties};this.isEdit=!0;this.group=void 0;this.execute=function(f){var g=f.getOdfCanvas().odfContainer(),e=null;b&&(e=b.attributes.split(","));g.setMetadata(h,e);f.emit(ops.OdtDocument.signalMetadataUpdated,{setProperties:null!==h?h:{},removedProperties:null!==e?e:[]});return!0};this.spec=function(){return{optype:"UpdateMetadata",memberid:m,timestamp:e,setProperties:h,
removedProperties:b}}};ops.OpUpdateMetadata.Spec;ops.OpUpdateMetadata.InitSpec;
ops.OpUpdateParagraphStyle=function(){function m(b,f){var d,g,a=f?f.split(","):[];for(d=0;d<a.length;d+=1)g=a[d].split(":"),b.removeAttributeNS(odf.Namespaces.lookupNamespaceURI(g[0]),g[1])}var e,h,b,f,g,l=odf.Namespaces.stylens;this.init=function(l){e=l.memberid;h=l.timestamp;b=l.styleName;f=l.setProperties;g=l.removedProperties};this.isEdit=!0;this.group=void 0;this.execute=function(e){var h=e.getFormatting(),d,n,a;return(d=""!==b?h.getStyleElement(b,"paragraph"):h.getDefaultStyleElement("paragraph"))?
(n=d.getElementsByTagNameNS(l,"paragraph-properties").item(0),a=d.getElementsByTagNameNS(l,"text-properties").item(0),f&&h.updateStyle(d,f),g&&(h=g["style:paragraph-properties"],n&&h&&(m(n,h.attributes),0===n.attributes.length&&d.removeChild(n)),h=g["style:text-properties"],a&&h&&(m(a,h.attributes),0===a.attributes.length&&d.removeChild(a)),m(d,g.attributes)),e.getOdfCanvas().refreshCSS(),e.emit(ops.OdtDocument.signalParagraphStyleModified,b),e.getOdfCanvas().rerenderAnnotations(),!0):!1};this.spec=
function(){return{optype:"UpdateParagraphStyle",memberid:e,timestamp:h,styleName:b,setProperties:f,removedProperties:g}}};ops.OpUpdateParagraphStyle.Spec;ops.OpUpdateParagraphStyle.InitSpec;
ops.OperationFactory=function(){function m(e){return function(b){return new e}}var e;this.register=function(h,b){e[h]=b};this.create=function(h){var b=null,f=e[h.optype];f&&(b=f(h),b.init(h));return b};e={AddMember:m(ops.OpAddMember),UpdateMember:m(ops.OpUpdateMember),RemoveMember:m(ops.OpRemoveMember),AddCursor:m(ops.OpAddCursor),ApplyDirectStyling:m(ops.OpApplyDirectStyling),SetBlob:m(ops.OpSetBlob),RemoveBlob:m(ops.OpRemoveBlob),InsertImage:m(ops.OpInsertImage),InsertTable:m(ops.OpInsertTable),
InsertText:m(ops.OpInsertText),RemoveText:m(ops.OpRemoveText),MergeParagraph:m(ops.OpMergeParagraph),SplitParagraph:m(ops.OpSplitParagraph),SetParagraphStyle:m(ops.OpSetParagraphStyle),UpdateParagraphStyle:m(ops.OpUpdateParagraphStyle),AddStyle:m(ops.OpAddStyle),RemoveStyle:m(ops.OpRemoveStyle),MoveCursor:m(ops.OpMoveCursor),RemoveCursor:m(ops.OpRemoveCursor),AddAnnotation:m(ops.OpAddAnnotation),RemoveAnnotation:m(ops.OpRemoveAnnotation),UpdateMetadata:m(ops.OpUpdateMetadata),ApplyHyperlink:m(ops.OpApplyHyperlink),
RemoveHyperlink:m(ops.OpRemoveHyperlink)}};ops.OperationFactory.SpecConstructor;ops.OperationRouter=function(){};ops.OperationRouter.prototype.setOperationFactory=function(m){};ops.OperationRouter.prototype.setPlaybackFunction=function(m){};ops.OperationRouter.prototype.push=function(m){};ops.OperationRouter.prototype.close=function(m){};ops.OperationRouter.prototype.subscribe=function(m,e){};ops.OperationRouter.prototype.unsubscribe=function(m,e){};
ops.OperationRouter.prototype.hasLocalUnsyncedOps=function(){};ops.OperationRouter.prototype.hasSessionHostConnection=function(){};ops.OperationRouter.signalProcessingBatchStart="router/batchstart";ops.OperationRouter.signalProcessingBatchEnd="router/batchend";
ops.TrivialOperationRouter=function(){var m=new core.EventNotifier([ops.OperationRouter.signalProcessingBatchStart,ops.OperationRouter.signalProcessingBatchEnd]),e,h,b=0;this.setOperationFactory=function(b){e=b};this.setPlaybackFunction=function(b){h=b};this.push=function(f){b+=1;m.emit(ops.OperationRouter.signalProcessingBatchStart,{});f.forEach(function(f){f=f.spec();f.timestamp=Date.now();f=e.create(f);f.group="g"+b;h(f)});m.emit(ops.OperationRouter.signalProcessingBatchEnd,{})};this.close=function(b){b()};
this.subscribe=function(b,g){m.subscribe(b,g)};this.unsubscribe=function(b,g){m.unsubscribe(b,g)};this.hasLocalUnsyncedOps=function(){return!1};this.hasSessionHostConnection=function(){return!0}};
ops.Session=function(m){function e(b){f.emit(ops.OdtDocument.signalProcessingBatchStart,b)}function h(b){f.emit(ops.OdtDocument.signalProcessingBatchEnd,b)}var b=new ops.OperationFactory,f=new ops.OdtDocument(m),g=null;this.setOperationFactory=function(f){b=f;g&&g.setOperationFactory(b)};this.setOperationRouter=function(l){g&&(g.unsubscribe(ops.OperationRouter.signalProcessingBatchStart,e),g.unsubscribe(ops.OperationRouter.signalProcessingBatchEnd,h));g=l;g.subscribe(ops.OperationRouter.signalProcessingBatchStart,
e);g.subscribe(ops.OperationRouter.signalProcessingBatchEnd,h);l.setPlaybackFunction(function(b){f.emit(ops.OdtDocument.signalOperationStart,b);return b.execute(f)?(f.emit(ops.OdtDocument.signalOperationEnd,b),!0):!1});l.setOperationFactory(b)};this.getOperationFactory=function(){return b};this.getOdtDocument=function(){return f};this.enqueue=function(b){g.push(b)};this.close=function(b){g.close(function(g){g?b(g):f.close(b)})};this.destroy=function(b){f.destroy(b)};this.setOperationRouter(new ops.TrivialOperationRouter)};
gui.AnnotationController=function(m,e,h){function b(){var a=q.getCursor(h),a=a&&a.getNode(),b=!1;a&&(b=!n.isWithinAnnotation(a,q.getRootNode()));b!==p&&(p=b,d.emit(gui.AnnotationController.annotatableChanged,p))}function f(a){a.getMemberId()===h&&b()}function g(a){a===h&&b()}function l(a){a.getMemberId()===h&&b()}var q=m.getOdtDocument(),p=!1,d=new core.EventNotifier([gui.AnnotationController.annotatableChanged]),n=odf.OdfUtils,a=core.StepDirection.NEXT;this.isAnnotatable=function(){return p};this.addAnnotation=
function(){var a=new ops.OpAddAnnotation,b=q.getCursorSelection(h),d=b.length,b=b.position;p&&(0===d?d=void 0:(b=0<=d?b:b+d,d=Math.abs(d)),a.init({memberid:h,position:b,length:d,name:h+Date.now()}),m.enqueue([a]))};this.removeAnnotation=function(c){var b,d;b=q.getMember(h).getProperties().fullName;if(!0!==e.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)||b===n.getAnnotationCreator(c))b=q.convertDomPointToCursorStep(c,0,a),d=q.convertDomPointToCursorStep(c,c.childNodes.length),c=
new ops.OpRemoveAnnotation,c.init({memberid:h,position:b,length:d-b}),d=new ops.OpMoveCursor,d.init({memberid:h,position:0<b?b-1:b,length:0}),m.enqueue([c,d])};this.subscribe=function(a,b){d.subscribe(a,b)};this.unsubscribe=function(a,b){d.unsubscribe(a,b)};this.destroy=function(a){q.unsubscribe(ops.Document.signalCursorAdded,f);q.unsubscribe(ops.Document.signalCursorRemoved,g);q.unsubscribe(ops.Document.signalCursorMoved,l);a()};e.registerConstraint(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN);
q.subscribe(ops.Document.signalCursorAdded,f);q.subscribe(ops.Document.signalCursorRemoved,g);q.subscribe(ops.Document.signalCursorMoved,l);b()};gui.AnnotationController.annotatableChanged="annotatable/changed";
gui.Avatar=function(m,e){var h=this,b,f,g;this.setColor=function(b){f.style.borderColor=b};this.setImageUrl=function(b){h.isVisible()?f.src=b:g=b};this.isVisible=function(){return"block"===b.style.display};this.show=function(){g&&(f.src=g,g=void 0);b.style.display="block"};this.hide=function(){b.style.display="none"};this.markAsFocussed=function(f){f?b.classList.add("active"):b.classList.remove("active")};this.destroy=function(f){m.removeChild(b);f()};(function(){var g=m.ownerDocument;b=g.createElement("div");
f=g.createElement("img");b.appendChild(f);b.style.display=e?"block":"none";b.className="handle";m.appendChild(b)})()};gui.StepInfo=function(){};gui.StepInfo.VisualDirection={LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1};gui.StepInfo.prototype.token;gui.StepInfo.prototype.container=function(){};gui.StepInfo.prototype.offset=function(){};gui.StepInfo.prototype.direction;gui.StepInfo.prototype.visualDirection;gui.VisualStepScanner=function(){};gui.VisualStepScanner.prototype.token;
gui.VisualStepScanner.prototype.process=function(m,e,h){};
gui.GuiStepUtils=function(){function m(f){f=h.getContentBounds(f);var g,d=null;if(f)if(f.container.nodeType===Node.TEXT_NODE)g=f.container.ownerDocument.createRange(),g.setStart(f.container,f.startOffset),g.setEnd(f.container,f.endOffset),(d=0<g.getClientRects().length?g.getBoundingClientRect():null)&&" "===f.container.data.substring(f.startOffset,f.endOffset)&&1>=d.width&&(d=null),g.detach();else if(e.isCharacterElement(f.container)||e.isCharacterFrame(f.container))d=b.getBoundingClientRect(f.container);
return d}var e=odf.OdfUtils,h=new odf.StepUtils,b=core.DomUtils,f=core.StepDirection.NEXT,g=gui.StepInfo.VisualDirection.LEFT_TO_RIGHT,l=gui.StepInfo.VisualDirection.RIGHT_TO_LEFT;this.getContentRect=m;this.moveToFilteredStep=function(b,e,d){function h(a,c){c.process(v,r,B)&&(a=!0,!y&&c.token&&(y=c.token));return a}var a=e===f,c,k,r,B,y,z=b.snapshot();c=!1;var v;do c=m(b),v={token:b.snapshot(),container:b.container,offset:b.offset,direction:e,visualDirection:e===f?g:l},k=b.nextStep()?m(b):null,b.restore(v.token),
a?(r=c,B=k):(r=k,B=c),c=d.reduce(h,!1);while(!c&&b.advanceStep(e));c||d.forEach(function(a){!y&&a.token&&(y=a.token)});b.restore(y||z);return Boolean(y)}};
gui.Caret=function(m,e,h,b){function f(){a.style.opacity="0"===a.style.opacity?"1":"0";w.trigger()}function g(){B.selectNodeContents(r);return B.getBoundingClientRect()}function l(a){return s[a]!==C[a]}function q(){Object.keys(C).forEach(function(a){s[a]=C[a]})}function p(){if(!1===C.isShown||m.getSelectionType()!==ops.OdtCursor.RangeSelection||!b&&!m.getSelectedRange().collapsed)C.visibility="hidden",a.style.visibility="hidden",w.cancel();else if(C.visibility="visible",a.style.visibility="visible",
!1===C.isFocused)a.style.opacity="1",w.cancel();else{if(H||l("visibility"))a.style.opacity="1",w.cancel();w.trigger()}if(D||I){var d;d=m.getNode();var f,s,r=z.getBoundingClientRect(y.getSizer()),h=!1,t=0;d.removeAttributeNS("urn:webodf:names:cursor","caret-sizer-active");if(0<d.getClientRects().length)s=g(),t=s.left-z.getBoundingClientRect(d).left,h=!0;else if(A.setPosition(d,0),s=v.getContentRect(A),!s&&A.nextStep()&&(f=v.getContentRect(A))&&(s=f,h=!0),s||(d.setAttributeNS("urn:webodf:names:cursor",
"caret-sizer-active","true"),s=g(),h=!0),!s)for(runtime.log("WARN: No suitable client rectangle found for visual caret for "+m.getMemberId());d;){if(0<d.getClientRects().length){s=z.getBoundingClientRect(d);h=!0;break}d=d.parentNode}s=z.translateRect(s,r,y.getZoomLevel());d={top:s.top,height:s.height,right:h?s.left:s.right,width:z.adaptRangeDifferenceToZoomLevel(t,y.getZoomLevel())};8>d.height&&(d={top:d.top-(8-d.height)/2,height:8,right:d.right});n.style.height=d.height+"px";n.style.top=d.top+"px";
n.style.left=d.right-d.width+"px";n.style.width=d.width?d.width+"px":"";k&&(d=runtime.getWindow().getComputedStyle(m.getNode(),null),d.font?k.style.font=d.font:(k.style.fontStyle=d.fontStyle,k.style.fontVariant=d.fontVariant,k.style.fontWeight=d.fontWeight,k.style.fontSize=d.fontSize,k.style.lineHeight=d.lineHeight,k.style.fontFamily=d.fontFamily))}C.isShown&&I&&e.scrollIntoView(a.getBoundingClientRect());l("isFocused")&&c.markAsFocussed(C.isFocused);q();D=I=H=!1}function d(a){n.parentNode.removeChild(n);
r.parentNode.removeChild(r);a()}var n,a,c,k,r,B,y=m.getDocument().getCanvas(),z=core.DomUtils,v=new gui.GuiStepUtils,A,t,w,H=!1,I=!1,D=!1,C={isFocused:!1,isShown:!0,visibility:"hidden"},s={isFocused:!C.isFocused,isShown:!C.isShown,visibility:"hidden"};this.handleUpdate=function(){D=!0;t.trigger()};this.refreshCursorBlinking=function(){H=!0;t.trigger()};this.setFocus=function(){C.isFocused=!0;t.trigger()};this.removeFocus=function(){C.isFocused=!1;t.trigger()};this.show=function(){C.isShown=!0;t.trigger()};
this.hide=function(){C.isShown=!1;t.trigger()};this.setAvatarImageUrl=function(a){c.setImageUrl(a)};this.setColor=function(b){a.style.borderColor=b;c.setColor(b)};this.getCursor=function(){return m};this.getFocusElement=function(){return a};this.toggleHandleVisibility=function(){c.isVisible()?c.hide():c.show()};this.showHandle=function(){c.show()};this.hideHandle=function(){c.hide()};this.setOverlayElement=function(a){k=a;n.appendChild(a);D=!0;t.trigger()};this.ensureVisible=function(){I=!0;t.trigger()};
this.getBoundingClientRect=function(){return z.getBoundingClientRect(n)};this.destroy=function(a){core.Async.destroyAll([t.destroy,w.destroy,c.destroy,d],a)};(function(){var b=m.getDocument(),d=[b.createRootFilter(m.getMemberId()),b.getPositionFilter()],k=b.getDOMDocument();B=k.createRange();r=k.createElement("span");r.className="webodf-caretSizer";r.textContent="|";m.getNode().appendChild(r);n=k.createElement("div");n.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",m.getMemberId());
n.className="webodf-caretOverlay";a=k.createElement("div");a.className="caret";n.appendChild(a);c=new gui.Avatar(n,h);y.getSizer().appendChild(n);A=b.createStepIterator(m.getNode(),0,d,b.getRootNode());t=core.Task.createRedrawTask(p);w=core.Task.createTimeoutTask(f,500);t.triggerImmediate()})()};
odf.TextSerializer=function(){function m(b){var f="",g=e.filter?e.filter.acceptNode(b):NodeFilter.FILTER_ACCEPT,l=b.nodeType,q;if((g===NodeFilter.FILTER_ACCEPT||g===NodeFilter.FILTER_SKIP)&&h.isTextContentContainingNode(b))for(q=b.firstChild;q;)f+=m(q),q=q.nextSibling;g===NodeFilter.FILTER_ACCEPT&&(l===Node.ELEMENT_NODE&&h.isParagraph(b)?f+="\n":l===Node.TEXT_NODE&&b.textContent&&(f+=b.textContent));return f}var e=this,h=odf.OdfUtils;this.filter=null;this.writeToString=function(b){if(!b)return"";
b=m(b);"\n"===b[b.length-1]&&(b=b.substr(0,b.length-1));return b}};gui.MimeDataExporter=function(){var m;this.exportRangeToDataTransfer=function(e,h){var b;b=h.startContainer.ownerDocument.createElement("span");b.appendChild(h.cloneContents());b=m.writeToString(b);try{e.setData("text/plain",b)}catch(f){e.setData("Text",b)}};m=new odf.TextSerializer;m.filter=new odf.OdfNodeFilter};
gui.Clipboard=function(m){this.setDataFromRange=function(e,h){var b,f=e.clipboardData;b=runtime.getWindow();!f&&b&&(f=b.clipboardData);f?(b=!0,m.exportRangeToDataTransfer(f,h),e.preventDefault()):b=!1;return b}};
gui.SessionContext=function(m,e){var h=m.getOdtDocument(),b=odf.OdfUtils;this.isLocalCursorWithinOwnAnnotation=function(){var f=h.getCursor(e),g;if(!f)return!1;g=f&&f.getNode();f=h.getMember(e).getProperties().fullName;return(g=b.getParentAnnotation(g,h.getRootNode()))&&b.getAnnotationCreator(g)===f?!0:!1}};
gui.StyleSummary=function(m){function e(b,e){var h=b+"|"+e,p;f.hasOwnProperty(h)||(p=[],m.forEach(function(d){d=(d=d.styleProperties[b])&&d[e];-1===p.indexOf(d)&&p.push(d)}),f[h]=p);return f[h]}function h(b,f,h){return function(){var m=e(b,f);return h.length>=m.length&&m.every(function(b){return-1!==h.indexOf(b)})}}function b(b,f){var h=e(b,f);return 1===h.length?h[0]:void 0}var f={};this.getPropertyValues=e;this.getCommonValue=b;this.isBold=h("style:text-properties","fo:font-weight",["bold"]);this.isItalic=
h("style:text-properties","fo:font-style",["italic"]);this.hasUnderline=h("style:text-properties","style:text-underline-style",["solid"]);this.hasStrikeThrough=h("style:text-properties","style:text-line-through-style",["solid"]);this.fontSize=function(){var f=b("style:text-properties","fo:font-size");return f&&parseFloat(f)};this.fontName=function(){return b("style:text-properties","style:font-name")};this.isAlignedLeft=h("style:paragraph-properties","fo:text-align",["left","start"]);this.isAlignedCenter=
h("style:paragraph-properties","fo:text-align",["center"]);this.isAlignedRight=h("style:paragraph-properties","fo:text-align",["right","end"]);this.isAlignedJustified=h("style:paragraph-properties","fo:text-align",["justify"]);this.text={isBold:this.isBold,isItalic:this.isItalic,hasUnderline:this.hasUnderline,hasStrikeThrough:this.hasStrikeThrough,fontSize:this.fontSize,fontName:this.fontName};this.paragraph={isAlignedLeft:this.isAlignedLeft,isAlignedCenter:this.isAlignedCenter,isAlignedRight:this.isAlignedRight,
isAlignedJustified:this.isAlignedJustified}};
gui.DirectFormattingController=function(m,e,h,b,f,g,l){function q(){return S.value().styleSummary}function p(){return S.value().enabledFeatures}function d(a){var c;a.collapsed?(c=a.startContainer,c.hasChildNodes()&&a.startOffset<c.childNodes.length&&(c=c.childNodes.item(a.startOffset)),a=[c]):a=Q.getTextElements(a,!0,!1);return a}function n(){var a=E.getCursor(b),c=a&&a.getSelectedRange(),f=[],f=[],k=!0,g={directTextStyling:!0,directParagraphStyling:!0};c&&(f=d(c),0===f.length&&(f=[c.startContainer,
c.endContainer],k=!1),f=E.getFormatting().getAppliedStyles(f));void 0!==f[0]&&ba&&(f[0].styleProperties=aa.mergeObjects(f[0].styleProperties,ba));!0===e.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(g.directTextStyling=g.directParagraphStyling=h.isLocalCursorWithinOwnAnnotation());g.directTextStyling&&(g.directTextStyling=k&&void 0!==a&&a.getSelectionType()===ops.OdtCursor.RangeSelection);return{enabledFeatures:g,appliedStyles:f,styleSummary:new gui.StyleSummary(f)}}function a(a,c){var b={};
Object.keys(a).forEach(function(d){var f=a[d](),k=c[d]();f!==k&&(b[d]=k)});return b}function c(){var c,b;b=Y.styleSummary;var d=S.value(),f=d.styleSummary,k=Y.enabledFeatures,g=d.enabledFeatures;c=a(b.text,f.text);b=a(b.paragraph,f.paragraph);k=!(g.directTextStyling===k.directTextStyling&&g.directParagraphStyling===k.directParagraphStyling);Y=d;k&&U.emit(gui.DirectFormattingController.enabledChanged,g);0<Object.keys(c).length&&U.emit(gui.DirectFormattingController.textStylingChanged,c);0<Object.keys(b).length&&
U.emit(gui.DirectFormattingController.paragraphStylingChanged,b)}function k(){S.reset();c()}function r(a){("string"===typeof a?a:a.getMemberId())===b&&S.reset()}function B(){S.reset()}function y(a){var c=E.getCursor(b);a=a.paragraphElement;c&&Q.getParagraphElement(c.getNode())===a&&S.reset()}function z(a,c){c(!a());return!0}function v(a){if(p().directTextStyling){var c=E.getCursorSelection(b),d={"style:text-properties":a};0!==c.length?(a=new ops.OpApplyDirectStyling,a.init({memberid:b,position:c.position,
length:c.length,setProperties:d}),m.enqueue([a])):(ba=aa.mergeObjects(ba||{},d),S.reset())}}function A(a,c){var b={};b[a]=c;v(b)}function t(a){a=a.spec();ba&&a.memberid===b&&"SplitParagraph"!==a.optype&&(ba=null,S.reset())}function w(a){A("fo:font-weight",a?"bold":"normal")}function H(a){A("fo:font-style",a?"italic":"normal")}function I(a){A("style:text-underline-style",a?"solid":"none")}function D(a){A("style:text-line-through-style",a?"solid":"none")}function C(a){if(p().directParagraphStyling){var c=
E.getCursor(b).getSelectedRange(),c=Q.getParagraphElements(c),d=E.getFormatting(),k=[],g={},e;c.forEach(function(c){var s=E.convertDomPointToCursorStep(c,0,K),l=c.getAttributeNS(odf.Namespaces.textns,"style-name"),r;c=l?g.hasOwnProperty(l)?g[l]:void 0:e;c||(c=f.generateStyleName(),l?(g[l]=c,r=d.createDerivedStyleObject(l,"paragraph",{})):(e=c,r={}),r=a(r),l=new ops.OpAddStyle,l.init({memberid:b,styleName:c.toString(),styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:r}),k.push(l));l=new ops.OpSetParagraphStyle;
l.init({memberid:b,styleName:c.toString(),position:s});k.push(l)});m.enqueue(k)}}function s(a){C(function(c){return aa.mergeObjects(c,a)})}function u(a){s({"style:paragraph-properties":{"fo:text-align":a}})}function x(a,c){var b=E.getFormatting().getDefaultTabStopDistance(),d=c["style:paragraph-properties"],f;d&&(d=d["fo:margin-left"],f=Q.parseLength(d));return aa.mergeObjects(c,{"style:paragraph-properties":{"fo:margin-left":f&&f.unit===b.unit?f.value+a*b.value+f.unit:a*b.value+b.unit}})}function G(a,
c){var b=d(a),b=0===b.length?[a.startContainer]:b,b=E.getFormatting().getAppliedStyles(b),f=0<b.length?b[0].styleProperties:void 0,k=E.getFormatting().getAppliedStylesForElement(c).styleProperties;if(!f||"text"!==f["style:family"]||!f["style:text-properties"])return!1;if(!k||!k["style:text-properties"])return!0;f=f["style:text-properties"];k=k["style:text-properties"];return!Object.keys(f).every(function(a){return f[a]===k[a]})}function M(){}function F(){return!1}function J(){return!1}var P=this,
E=m.getOdtDocument(),aa=new core.Utils,Q=odf.OdfUtils,U=new core.EventNotifier([gui.DirectFormattingController.enabledChanged,gui.DirectFormattingController.textStylingChanged,gui.DirectFormattingController.paragraphStylingChanged]),W=odf.Namespaces.textns,K=core.StepDirection.NEXT,ba=null,Y,S;this.enabledFeatures=p;this.formatTextSelection=v;this.createCursorStyleOp=function(a,c,d){var f=null,k=ba;d&&(k=(d=S.value().appliedStyles[0])&&d.styleProperties);k&&k["style:text-properties"]&&(f=new ops.OpApplyDirectStyling,
f.init({memberid:b,position:a,length:c,setProperties:{"style:text-properties":k["style:text-properties"]}}),ba=null,S.reset());return f};this.setBold=w;this.setItalic=H;this.setHasUnderline=I;this.setHasStrikethrough=D;this.setFontSize=function(a){A("fo:font-size",a+"pt")};this.setFontName=function(a){A("style:font-name",a)};this.getAppliedStyles=function(){return S.value().appliedStyles};this.toggleBold=z.bind(P,function(){return q().isBold()},w);this.toggleItalic=z.bind(P,function(){return q().isItalic()},
H);this.toggleUnderline=z.bind(P,function(){return q().hasUnderline()},I);this.toggleStrikethrough=z.bind(P,function(){return q().hasStrikeThrough()},D);this.isBold=function(){return q().isBold()};this.isItalic=function(){return q().isItalic()};this.hasUnderline=function(){return q().hasUnderline()};this.hasStrikeThrough=function(){return q().hasStrikeThrough()};this.fontSize=function(){return q().fontSize()};this.fontName=function(){return q().fontName()};this.isAlignedLeft=function(){return q().isAlignedLeft()};
this.isAlignedCenter=function(){return q().isAlignedCenter()};this.isAlignedRight=function(){return q().isAlignedRight()};this.isAlignedJustified=function(){return q().isAlignedJustified()};this.alignParagraphLeft=function(){u("left");return!0};this.alignParagraphCenter=function(){u("center");return!0};this.alignParagraphRight=function(){u("right");return!0};this.alignParagraphJustified=function(){u("justify");return!0};this.indent=function(){C(x.bind(null,1));return!0};this.outdent=function(){C(x.bind(null,
-1));return!0};this.createParagraphStyleOps=function(a){if(!p().directParagraphStyling)return[];var c=E.getCursor(b),d=c.getSelectedRange(),k=[],g,e;c.hasForwardSelection()?(g=c.getAnchorNode(),e=c.getNode()):(g=c.getNode(),e=c.getAnchorNode());c=Q.getParagraphElement(e);runtime.assert(Boolean(c),"DirectFormattingController: Cursor outside paragraph");var s=c,l=[E.getPositionFilter(),E.createRootFilter(b)];if(!1!==E.createStepIterator(d.endContainer,d.endOffset,l,s).nextStep())return k;e!==g&&(c=
Q.getParagraphElement(g));if(!ba&&!G(d,c))return k;d=(d=S.value().appliedStyles[0])&&d.styleProperties;if(!d)return k;if(c=c.getAttributeNS(W,"style-name"))d={"style:text-properties":d["style:text-properties"]},d=E.getFormatting().createDerivedStyleObject(c,"paragraph",d);g=f.generateStyleName();c=new ops.OpAddStyle;c.init({memberid:b,styleName:g,styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:d});k.push(c);c=new ops.OpSetParagraphStyle;c.init({memberid:b,styleName:g,position:a});k.push(c);
return k};this.subscribe=function(a,c){U.subscribe(a,c)};this.unsubscribe=function(a,c){U.unsubscribe(a,c)};this.destroy=function(a){E.unsubscribe(ops.Document.signalCursorAdded,r);E.unsubscribe(ops.Document.signalCursorRemoved,r);E.unsubscribe(ops.Document.signalCursorMoved,r);E.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,B);E.unsubscribe(ops.OdtDocument.signalParagraphChanged,y);E.unsubscribe(ops.OdtDocument.signalOperationEnd,t);E.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,
c);e.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,k);a()};(function(){E.subscribe(ops.Document.signalCursorAdded,r);E.subscribe(ops.Document.signalCursorRemoved,r);E.subscribe(ops.Document.signalCursorMoved,r);E.subscribe(ops.OdtDocument.signalParagraphStyleModified,B);E.subscribe(ops.OdtDocument.signalParagraphChanged,y);E.subscribe(ops.OdtDocument.signalOperationEnd,t);E.subscribe(ops.OdtDocument.signalProcessingBatchEnd,c);e.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,k);S=new core.LazyProperty(n);
Y=S.value();g||(P.formatTextSelection=M,P.setBold=M,P.setItalic=M,P.setHasUnderline=M,P.setHasStrikethrough=M,P.setFontSize=M,P.setFontName=M,P.toggleBold=J,P.toggleItalic=J,P.toggleUnderline=J,P.toggleStrikethrough=J);l||(P.alignParagraphCenter=F,P.alignParagraphJustified=F,P.alignParagraphLeft=F,P.alignParagraphRight=F,P.createParagraphStyleOps=function(){return[]},P.indent=F,P.outdent=F)})()};gui.DirectFormattingController.enabledChanged="enabled/changed";
gui.DirectFormattingController.textStylingChanged="textStyling/changed";gui.DirectFormattingController.paragraphStylingChanged="paragraphStyling/changed";gui.DirectFormattingController.SelectionInfo=function(){this.enabledFeatures;this.appliedStyles;this.styleSummary};
gui.KeyboardHandler=function(){function m(b,g){g||(g=e.None);switch(b){case gui.KeyboardHandler.KeyCode.LeftMeta:case gui.KeyboardHandler.KeyCode.RightMeta:case gui.KeyboardHandler.KeyCode.MetaInMozilla:g|=e.Meta;break;case gui.KeyboardHandler.KeyCode.Ctrl:g|=e.Ctrl;break;case gui.KeyboardHandler.KeyCode.Alt:g|=e.Alt;break;case gui.KeyboardHandler.KeyCode.Shift:g|=e.Shift}return b+":"+g}var e=gui.KeyboardHandler.Modifier,h=null,b={};this.setDefault=function(b){h=b};this.bind=function(f,g,e,h){f=m(f,
g);runtime.assert(h||!1===b.hasOwnProperty(f),"tried to overwrite the callback handler of key combo: "+f);b[f]=e};this.unbind=function(f,g){var e=m(f,g);delete b[e]};this.reset=function(){h=null;b={}};this.handleEvent=function(f){var g=f.keyCode,l=e.None;f.metaKey&&(l|=e.Meta);f.ctrlKey&&(l|=e.Ctrl);f.altKey&&(l|=e.Alt);f.shiftKey&&(l|=e.Shift);g=m(g,l);g=b[g];l=!1;g?l=g():null!==h&&(l=h(f));l&&(f.preventDefault?f.preventDefault():f.returnValue=!1)}};
gui.KeyboardHandler.Modifier={None:0,Meta:1,Ctrl:2,Alt:4,CtrlAlt:6,Shift:8,MetaShift:9,CtrlShift:10,AltShift:12};gui.KeyboardHandler.KeyCode={Backspace:8,Tab:9,Clear:12,Enter:13,Shift:16,Ctrl:17,Alt:18,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Delete:46,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftMeta:91,RightMeta:93,MetaInMozilla:224};
gui.HyperlinkClickHandler=function(m,e,h){function b(c){for(;null!==c;){if(a.isHyperlink(c))return c;if(a.isParagraph(c))break;c=c.parentNode}return null}function f(){var a=m();runtime.assert(Boolean(a.classList),"Document container has no classList element");a.classList.remove("webodf-inactiveLinks")}function g(){var a=m();runtime.assert(Boolean(a.classList),"Document container has no classList element");a.classList.add("webodf-inactiveLinks")}function l(){c.removeEventListener("focus",g,!1);r.forEach(function(a){e.unbind(a.keyCode,
a.modifier);h.unbind(a.keyCode,a.modifier)});r.length=0}function q(a){l();if(a!==p.None){c.addEventListener("focus",g,!1);switch(a){case p.Ctrl:r.push({keyCode:d.Ctrl,modifier:p.None});break;case p.Meta:r.push({keyCode:d.LeftMeta,modifier:p.None}),r.push({keyCode:d.RightMeta,modifier:p.None}),r.push({keyCode:d.MetaInMozilla,modifier:p.None})}r.forEach(function(a){e.bind(a.keyCode,a.modifier,f);h.bind(a.keyCode,a.modifier,g)})}}var p=gui.KeyboardHandler.Modifier,d=gui.KeyboardHandler.KeyCode,n=xmldom.XPath,
a=odf.OdfUtils,c=runtime.getWindow(),k=p.None,r=[];runtime.assert(null!==c,"Expected to be run in an environment which has a global window, like a browser.");this.handleClick=function(d){var f=d.target||d.srcElement,g,e,l;d.ctrlKey?g=p.Ctrl:d.metaKey&&(g=p.Meta);if(k===p.None||k===g)if(g=b(f))e=a.getHyperlinkTarget(g),""!==e&&("#"===e[0]?(e=e.substring(1),g=m(),l=n.getODFElementsWithXPath(g,"//text:bookmark-start[@text:name='"+e+"']",odf.Namespaces.lookupNamespaceURI),0===l.length&&(l=n.getODFElementsWithXPath(g,
"//text:bookmark[@text:name='"+e+"']",odf.Namespaces.lookupNamespaceURI)),0<l.length&&(clearTimeout(clicktimer),clicktimer=setTimeout(function(){function a(c){for(var b=0;b<=historylist.length-1;b++)if(historylist[b].url==c.url)return;historylist.push(c)}a({url:"#S"+e,node:f});a({url:"#"+e,node:l[0]});history.pushState(null,null,"#S"+e);history.pushState(null,null,"#"+e);l[0].scrollIntoView(!0)},100))):/^\s*(javascript|data):/.test(e)?runtime.log("WARN:","potentially malicious URL ignored"):c.open(e),
d.preventDefault?d.preventDefault():d.returnValue=!1)};this.setModifier=function(a){k!==a&&(runtime.assert(a===p.None||a===p.Ctrl||a===p.Meta,"Unsupported KeyboardHandler.Modifier value: "+a),k=a,k!==p.None?g():f(),q(k))};this.getModifier=function(){return k};this.destroy=function(a){g();l();a()}};
gui.EventManager=function(m){function e(a){function c(a,b,d){var f,k=!1;f="on"+b;a.attachEvent&&(a.attachEvent(f,d),k=!0);!k&&a.addEventListener&&(a.addEventListener(b,d,!1),k=!0);k&&!t[b]||!a.hasOwnProperty(f)||(a[f]=d)}function b(a,c,d){var f="on"+c;a.detachEvent&&a.detachEvent(f,d);a.removeEventListener&&a.removeEventListener(c,d,!1);a[f]===d&&(a[f]=null)}function d(c){if(-1===k.indexOf(c)){k.push(c);if(f.filters.every(function(a){return a(c)}))try{g.emit(a,c)}catch(b){runtime.log("Error occurred while processing "+
a+":\n"+b.message+"\n"+b.stack)}runtime.setTimeout(function(){k.splice(k.indexOf(c),1)},0)}}var f=this,k=[],g=new core.EventNotifier([a]);this.filters=[];this.subscribe=function(c){g.subscribe(a,c)};this.unsubscribe=function(c){g.unsubscribe(a,c)};this.destroy=function(){b(A,a,d);b(D,a,d);b(C,a,d)};w[a]&&c(A,a,d);c(D,a,d);c(C,a,d)}function h(a,c,b){function d(c){b(c,f,function(c){c.type=a;k.emit(a,c)})}var f={},k=new core.EventNotifier([a]);this.subscribe=function(c){k.subscribe(a,c)};this.unsubscribe=
function(c){k.unsubscribe(a,c)};this.destroy=function(){c.forEach(function(a){s.unsubscribe(a,d)})};(function(){c.forEach(function(a){s.subscribe(a,d)})})()}function b(a){runtime.clearTimeout(a);delete u[a]}function f(a,c){var d=runtime.setTimeout(function(){a();b(d)},c);u[d]=!0;return d}function g(a,c,d){var k=a.touches.length,g=a.touches[0],e=c.timer;"touchmove"===a.type||"touchend"===a.type?e&&b(e):"touchstart"===a.type&&(1!==k?runtime.clearTimeout(e):e=f(function(){d({clientX:g.clientX,clientY:g.clientY,
pageX:g.pageX,pageY:g.pageY,target:a.target||a.srcElement||null,detail:1})},400));c.timer=e}function l(a,c,b){var d=a.touches[0],f=a.target||a.srcElement||null,k=c.target;1!==a.touches.length||"touchend"===a.type?k=null:"touchstart"===a.type&&"webodf-draggable"===f.getAttribute("class")?k=f:"touchmove"===a.type&&k&&(a.preventDefault(),a.stopPropagation(),b({clientX:d.clientX,clientY:d.clientY,pageX:d.pageX,pageY:d.pageY,target:k,detail:1}));c.target=k}function q(a,c,b){var d=a.target||a.srcElement||
null,f=c.dragging;"drag"===a.type?f=!0:"touchend"===a.type&&f&&(f=!1,a=a.changedTouches[0],b({clientX:a.clientX,clientY:a.clientY,pageX:a.pageX,pageY:a.pageY,target:d,detail:1}));c.dragging=f}function p(){C.classList.add("webodf-touchEnabled");s.unsubscribe("touchstart",p)}function d(a){var c=a.scrollX,b=a.scrollY;this.restore=function(){a.scrollX===c&&a.scrollY===b||a.scrollTo(c,b)}}function n(a){var c=a.scrollTop,b=a.scrollLeft;this.restore=function(){if(a.scrollTop!==c||a.scrollLeft!==b)a.scrollTop=
c,a.scrollLeft=b}}function a(a,c){var b=I[a]||H[a]||null;!b&&c&&(b=I[a]=new e(a));return b}function c(c,b){a(c,!0).subscribe(b)}function k(c,b){var d=a(c,!1);d&&d.unsubscribe(b)}function r(){return m.getDOMDocument().activeElement===D}function B(){r()&&D.blur();D.setAttribute("disabled","true")}function y(){D.removeAttribute("disabled")}function z(a){for(var c=[];a;)(a.scrollWidth>a.clientWidth||a.scrollHeight>a.clientHeight)&&c.push(new n(a)),a=a.parentNode;c.push(new d(A));return c}function v(){var a;
r()||(a=z(D),y(),D.focus(),a.forEach(function(a){a.restore()}))}var A=runtime.getWindow(),t={beforecut:!0,beforepaste:!0,longpress:!0,drag:!0,dragstop:!0},w={mousedown:!0,mouseup:!0,focus:!0},H={},I={},D,C=m.getCanvas().getElement(),s=this,u={};this.addFilter=function(c,b){a(c,!0).filters.push(b)};this.removeFilter=function(c,b){var d=a(c,!0),f=d.filters.indexOf(b);-1!==f&&d.filters.splice(f,1)};this.subscribe=c;this.unsubscribe=k;this.hasFocus=r;this.focus=v;this.getEventTrap=function(){return D};
this.setEditing=function(a){var c=r();c&&D.blur();a?D.removeAttribute("readOnly"):D.setAttribute("readOnly","true");c&&v()};this.destroy=function(a){k("touchstart",p);Object.keys(u).forEach(function(a){b(parseInt(a,10))});u.length=0;Object.keys(H).forEach(function(a){H[a].destroy()});H={};k("mousedown",B);k("mouseup",y);k("contextmenu",y);Object.keys(I).forEach(function(a){I[a].destroy()});I={};D.parentNode.removeChild(D);a()};(function(){var a=m.getOdfCanvas().getSizer(),b=a.ownerDocument;runtime.assert(Boolean(A),
"EventManager requires a window object to operate correctly");D=b.createElement("textarea");D.id="eventTrap";D.setAttribute("tabindex","-1");D.setAttribute("readOnly","true");D.setAttribute("rows","1");a.appendChild(D);c("mousedown",B);c("mouseup",y);c("contextmenu",y);H.longpress=new h("longpress",["touchstart","touchmove","touchend"],g);H.drag=new h("drag",["touchstart","touchmove","touchend"],l);H.dragstop=new h("dragstop",["drag","touchend"],q);c("touchstart",p)})()};
gui.IOSSafariSupport=function(m){function e(){h.innerHeight!==h.outerHeight&&(b.style.display="none",runtime.requestAnimationFrame(function(){b.style.display="block"}))}var h=runtime.getWindow(),b=m.getEventTrap();this.destroy=function(f){m.unsubscribe("focus",e);b.removeAttribute("autocapitalize");b.style.WebkitTransform="";f()};m.subscribe("focus",e);b.setAttribute("autocapitalize","off");b.style.WebkitTransform="translateX(-10000px)"};
gui.HyperlinkController=function(m,e,h,b){function f(){var b=!0;!0===e.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(b=h.isLocalCursorWithinOwnAnnotation());b!==d&&(d=b,p.emit(gui.HyperlinkController.enabledChanged,d))}function g(d){d.getMemberId()===b&&f()}var l=odf.OdfUtils,q=m.getOdtDocument(),p=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),d=!1;this.isEnabled=function(){return d};this.subscribe=function(b,a){p.subscribe(b,a)};this.unsubscribe=function(b,a){p.unsubscribe(b,
a)};this.addHyperlink=function(f,a){if(d){var c=q.getCursorSelection(b),k=new ops.OpApplyHyperlink,g=[];if(0===c.length||a)a=a||f,k=new ops.OpInsertText,k.init({memberid:b,position:c.position,text:a}),c.length=a.length,g.push(k);k=new ops.OpApplyHyperlink;k.init({memberid:b,position:c.position,length:c.length,hyperlink:f});g.push(k);m.enqueue(g)}};this.removeHyperlinks=function(){if(d){var f=q.createPositionIterator(q.getRootNode()),a=q.getCursor(b).getSelectedRange(),c=l.getHyperlinkElements(a),
k=a.collapsed&&1===c.length,g=q.getDOMDocument().createRange(),e=[],h,p;0!==c.length&&(c.forEach(function(a){g.selectNodeContents(a);h=q.convertDomToCursorRange({anchorNode:g.startContainer,anchorOffset:g.startOffset,focusNode:g.endContainer,focusOffset:g.endOffset});p=new ops.OpRemoveHyperlink;p.init({memberid:b,position:h.position,length:h.length});e.push(p)}),k||(k=c[0],-1===a.comparePoint(k,0)&&(g.setStart(k,0),g.setEnd(a.startContainer,a.startOffset),h=q.convertDomToCursorRange({anchorNode:g.startContainer,
anchorOffset:g.startOffset,focusNode:g.endContainer,focusOffset:g.endOffset}),0<h.length&&(p=new ops.OpApplyHyperlink,p.init({memberid:b,position:h.position,length:h.length,hyperlink:l.getHyperlinkTarget(k)}),e.push(p))),c=c[c.length-1],f.moveToEndOfNode(c),f=f.unfilteredDomOffset(),1===a.comparePoint(c,f)&&(g.setStart(a.endContainer,a.endOffset),g.setEnd(c,f),h=q.convertDomToCursorRange({anchorNode:g.startContainer,anchorOffset:g.startOffset,focusNode:g.endContainer,focusOffset:g.endOffset}),0<h.length&&
(p=new ops.OpApplyHyperlink,p.init({memberid:b,position:h.position,length:h.length,hyperlink:l.getHyperlinkTarget(c)}),e.push(p)))),m.enqueue(e),g.detach())}};this.destroy=function(b){q.unsubscribe(ops.Document.signalCursorMoved,g);e.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,f);b()};q.subscribe(ops.Document.signalCursorMoved,g);e.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,f);f()};gui.HyperlinkController.enabledChanged="enabled/changed";
gui.ImageController=function(m,e,h,b,f){function g(){var a=!0;!0===e.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(a=h.isLocalCursorWithinOwnAnnotation());a!==k&&(k=a,c.emit(gui.ImageController.enabledChanged,k))}function l(a){a.getMemberId()===b&&g()}function q(a){a=a.toLowerCase();if(0<a.indexOf("gif"))return".gif";if(0<a.indexOf("jpg")||0<a.indexOf("jpeg"))return".jpg";if(0<a.indexOf("png"))return".png";if(0<a.indexOf("bmp"))return".bmp"}var p=odf.Namespaces.textns,d=m.getOdtDocument(),n=
odf.OdfUtils,a=d.getFormatting(),c=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),k=!1;this.isEnabled=function(){return k};this.subscribe=function(a,b){c.subscribe(a,b)};this.unsubscribe=function(a,b){c.unsubscribe(a,b)};this.insertImage=function(c,g,e,l){if(k){var h=new core.CSSUnits;runtime.assert(0<e&&0<l,"Both width and height of the image should be greater than 0px.");l={width:e,height:l};if(e=n.getParagraphElement(d.getCursor(b).getNode()).getAttributeNS(p,"style-name")){e=
a.getContentSize(e,"paragraph");var A=1,t=1;l.width>e.width&&(A=e.width/l.width);l.height>e.height&&(t=e.height/l.height);e=Math.min(A,t);l={width:l.width*e,height:l.height*e}}e=h.convert(l.width,"px","cm")+"cm";var h=h.convert(l.height,"px","cm")+"cm",t=d.getOdfCanvas().odfContainer().rootElement.styles,A=q(c),w;l=[];runtime.assert(null!==A,"Image type is not supported: "+c);A="Pictures/"+f.generateImageName()+A;w=new ops.OpSetBlob;w.init({memberid:b,filename:A,mimetype:c,content:g});l.push(w);a.getStyleElement("Graphics",
"graphic",[t])||(c=new ops.OpAddStyle,c.init({memberid:b,styleName:"Graphics",styleFamily:"graphic",isAutomaticStyle:!1,setProperties:{"style:graphic-properties":{"text:anchor-type":"paragraph","svg:x":"0cm","svg:y":"0cm","style:wrap":"dynamic","style:number-wrapped-paragraphs":"no-limit","style:wrap-contour":"false","style:vertical-pos":"top","style:vertical-rel":"paragraph","style:horizontal-pos":"center","style:horizontal-rel":"paragraph"}}}),l.push(c));c=f.generateStyleName();g=new ops.OpAddStyle;
g.init({memberid:b,styleName:c,styleFamily:"graphic",isAutomaticStyle:!0,setProperties:{"style:parent-style-name":"Graphics","style:graphic-properties":{"style:vertical-pos":"top","style:vertical-rel":"baseline","style:horizontal-pos":"center","style:horizontal-rel":"paragraph","fo:background-color":"transparent","style:background-transparency":"100%","style:shadow":"none","style:mirror":"none","fo:clip":"rect(0cm, 0cm, 0cm, 0cm)","draw:luminance":"0%","draw:contrast":"0%","draw:red":"0%","draw:green":"0%",
"draw:blue":"0%","draw:gamma":"100%","draw:color-inversion":"false","draw:image-opacity":"100%","draw:color-mode":"standard"}}});l.push(g);w=new ops.OpInsertImage;w.init({memberid:b,position:d.getCursorPosition(b),filename:A,frameWidth:e,frameHeight:h,frameStyleName:c,frameName:f.generateFrameName()});l.push(w);m.enqueue(l)}};this.destroy=function(a){d.unsubscribe(ops.Document.signalCursorMoved,l);e.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,g);a()};d.subscribe(ops.Document.signalCursorMoved,
l);e.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,g);g()};gui.ImageController.enabledChanged="enabled/changed";
gui.ImageSelector=function(m){function e(){var g=m.getSizer(),e=f.createElement("div");e.id="imageSelector";e.style.borderWidth="1px";g.appendChild(e);b.forEach(function(b){var d=f.createElement("div");d.className=b;e.appendChild(d)});return e}var h=odf.Namespaces.svgns,b="topLeft topRight bottomRight bottomLeft topMiddle rightMiddle bottomMiddle leftMiddle".split(" "),f=m.getElement().ownerDocument,g=!1;this.select=function(b){var q,p,d=f.getElementById("imageSelector");d||(d=e());g=!0;q=d.parentNode;
p=b.getBoundingClientRect();var n=q.getBoundingClientRect(),a=m.getZoomLevel();q=(p.left-n.left)/a-1;p=(p.top-n.top)/a-1;d.style.display="block";d.style.left=q+"px";d.style.top=p+"px";d.style.width=b.getAttributeNS(h,"width");d.style.height=b.getAttributeNS(h,"height")};this.clearSelection=function(){var b;g&&(b=f.getElementById("imageSelector"))&&(b.style.display="none");g=!1};this.isSelectorElement=function(b){var g=f.getElementById("imageSelector");return g?b===g||b.parentNode===g:!1}};
(function(){function m(e){function h(b){l=b.which&&String.fromCharCode(b.which)===g;g=void 0;return!1===l}function b(){l=!1}function f(b){g=b.data;l=!1}var g,l=!1;this.destroy=function(g){e.unsubscribe("textInput",b);e.unsubscribe("compositionend",f);e.removeFilter("keypress",h);g()};e.subscribe("textInput",b);e.subscribe("compositionend",f);e.addFilter("keypress",h)}gui.InputMethodEditor=function(e,h){function b(a){k&&(a?(s=!0,k.getNode().setAttributeNS("urn:webodf:names:cursor","composing","true")):
(s=!1,k.getNode().removeAttributeNS("urn:webodf:names:cursor","composing"),y.textContent=""))}function f(a){a&&(A||u)&&(37<=a.keyCode&&40>=a.keyCode||65==a.keyCode)&&q()}function g(){v&&(v=!1,b(!1),0<u.length&&(A=u),t.emit(gui.InputMethodEditor.signalCompositionEnd,{data:A}),u=A="")}function l(a,c){v=!0;A+=a;c&&(u+=a);z.trigger()}function q(){C||(C=!0,g(),k&&k.getSelectedRange().collapsed?r.value="":r.value=H.writeToString(k.getSelectedRange().cloneContents()),r.setSelectionRange(0,r.value.length),
C=!1)}function p(){h.hasFocus()&&z.trigger()}function d(a){w=void 0;z.cancel();b(!0);v||t.emit(gui.InputMethodEditor.signalCompositionStart,{data:""})}function n(a){s=!1;w=a.data;l(a.data)}function a(a){a.data!==w&&(s?l(a.data,!0):l(a.data));w=void 0}function c(){y.textContent=r.value}var k=null,r=h.getEventTrap(),B=r.ownerDocument,y,z,v=!1,A="",t=new core.EventNotifier([gui.InputMethodEditor.signalCompositionStart,gui.InputMethodEditor.signalCompositionEnd]),w,H,I=[],D,C=!1;this.subscribe=t.subscribe;
this.unsubscribe=t.unsubscribe;var s=!1,u="";this.registerCursor=function(a){a.getMemberId()===e&&(k=a,k.getNode().appendChild(y),a.subscribe(ops.OdtCursor.signalCursorUpdated,p),h.subscribe("input",c),h.subscribe("compositionupdate",c))};this.removeCursor=function(a){k&&a===e&&(k.getNode().removeChild(y),k.unsubscribe(ops.OdtCursor.signalCursorUpdated,p),h.unsubscribe("input",c),h.unsubscribe("compositionupdate",c),k=null)};this.destroy=function(c){h.unsubscribe("compositionstart",d);h.unsubscribe("compositionend",
n);h.unsubscribe("textInput",a);h.unsubscribe("keypress",g);h.unsubscribe("keydown",f);h.unsubscribe("focus",q);core.Async.destroyAll(D,c)};(function(){H=new odf.TextSerializer;H.filter=new odf.OdfNodeFilter;h.subscribe("compositionstart",d);h.subscribe("compositionend",n);h.subscribe("textInput",a);h.subscribe("keypress",g);h.subscribe("keydown",f);h.subscribe("focus",q);I.push(new m(h));D=I.map(function(a){return a.destroy});y=B.createElement("span");y.setAttribute("id","composer");z=core.Task.createTimeoutTask(q,
1);D.push(z.destroy)})()};gui.InputMethodEditor.signalCompositionStart="input/compositionstart";gui.InputMethodEditor.signalCompositionEnd="input/compositionend"})();
gui.MetadataController=function(m,e){function h(b){g.emit(gui.MetadataController.signalMetadataChanged,b)}function b(b){var f=-1===l.indexOf(b);f||runtime.log("Setting "+b+" is restricted.");return f}var f=m.getOdtDocument(),g=new core.EventNotifier([gui.MetadataController.signalMetadataChanged]),l=["dc:creator","dc:date","meta:editing-cycles","meta:editing-duration","meta:document-statistic"];this.setMetadata=function(f,g){var d={},l="",a;f&&Object.keys(f).filter(b).forEach(function(a){d[a]=f[a]});
g&&(l=g.filter(b).join(","));if(0<l.length||0<Object.keys(d).length)a=new ops.OpUpdateMetadata,a.init({memberid:e,setProperties:d,removedProperties:0<l.length?{attributes:l}:null}),m.enqueue([a])};this.getMetadata=function(b){var g;runtime.assert("string"===typeof b,"Property must be a string");g=b.split(":");runtime.assert(2===g.length,"Property must be a namespace-prefixed string");b=odf.Namespaces.lookupNamespaceURI(g[0]);runtime.assert(Boolean(b),"Prefix must be for an ODF namespace.");return f.getOdfCanvas().odfContainer().getMetadata(b,
g[1])};this.subscribe=function(b,f){g.subscribe(b,f)};this.unsubscribe=function(b,f){g.unsubscribe(b,f)};this.destroy=function(b){f.unsubscribe(ops.OdtDocument.signalMetadataUpdated,h);b()};f.subscribe(ops.OdtDocument.signalMetadataUpdated,h)};gui.MetadataController.signalMetadataChanged="metadata/changed";
gui.PasteController=function(m,e,h,b){function f(){q=!0===e.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)?h.isLocalCursorWithinOwnAnnotation():!0}function g(a){a.getMemberId()===b&&f()}var l=m.getOdtDocument(),q=!1,p=odf.Namespaces.textns,d=core.StepDirection.NEXT,n=odf.OdfUtils;this.isEnabled=function(){return q};this.paste=function(a){if(q){var c=l.getCursorPosition(b),f=l.getCursor(b).getNode(),f=n.getParagraphElement(f),g=f.getAttributeNS(p,"style-name")||"",e=c,h=[],z=l.convertDomPointToCursorStep(f,
0,d);a.replace(/\r/g,"").split("\n").forEach(function(a){var c=new ops.OpInsertText,d=new ops.OpSplitParagraph;c.init({memberid:b,position:e,text:a,moveCursor:!0});h.push(c);e+=a.length;d.init({memberid:b,position:e,paragraphStyleName:g,sourceParagraphPosition:z,moveCursor:!0});h.push(d);z=e+=1});h.pop();m.enqueue(h)}};this.destroy=function(a){l.unsubscribe(ops.Document.signalCursorMoved,g);e.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,f);a()};l.subscribe(ops.Document.signalCursorMoved,g);
e.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,f);f()};gui.ClosestXOffsetScanner=function(m){function e(b){return null!==b&&void 0!==f?Math.abs(b-m)>f:!1}function h(b){null!==b&&!1===e(b)&&(f=Math.abs(b-m))}var b=this,f,g=gui.StepInfo.VisualDirection.LEFT_TO_RIGHT;this.token=void 0;this.process=function(f,m,p){var d,n;f.visualDirection===g?(d=m&&m.right,n=p&&p.left):(d=m&&m.left,n=p&&p.right);if(e(d)||e(n))return!0;if(m||p)h(d),h(n),b.token=f.token;return!1}};
gui.LineBoundaryScanner=function(){var m=this,e=null;this.token=void 0;this.process=function(h,b,f){var g;if(g=f)if(e){var l=e;g=Math.min(l.bottom-l.top,f.bottom-f.top);var q=Math.max(l.top,f.top),l=Math.min(l.bottom,f.bottom)-q;g=.4>=(0<g?l/g:0)}else g=!1;!b||f&&!g||(m.token=h.token);if(g)return!0;e=(h=e)&&b?{left:Math.min(h.left,b.left),right:Math.max(h.right,b.right),top:Math.min(h.top,b.top),bottom:Math.min(h.bottom,b.bottom)}:h||b;return!1}};
gui.ParagraphBoundaryScanner=function(){var m=this,e=!1,h,b=odf.OdfUtils;this.token=void 0;this.process=function(f){var g=b.getParagraphElement(f.container());e||(h=g,e=!0);if(h!==g)return!0;m.token=f.token;return!1}};
odf.WordBoundaryFilter=function(m,e){function h(a,c,b){for(var d=null,f=m.getRootNode(),k;a!==f&&null!==a&&null===d;)k=0>c?a.previousSibling:a.nextSibling,b(k)===NodeFilter.FILTER_ACCEPT&&(d=k),a=a.parentNode;return d}function b(a,c){var b;return null===a?k.NO_NEIGHBOUR:l.isCharacterElement(a)?k.SPACE_CHAR:a.nodeType===f||l.isTextSpan(a)||l.isHyperlink(a)?(b=a.textContent.charAt(c()),p.test(b)?k.SPACE_CHAR:q.test(b)?k.PUNCTUATION_CHAR:k.WORD_CHAR):k.OTHER}var f=Node.TEXT_NODE,g=Node.ELEMENT_NODE,
l=odf.OdfUtils,q=/[!-#%-*,-\/:-;?-@\[-\]_{}\u00a1\u00ab\u00b7\u00bb\u00bf;\u00b7\u055a-\u055f\u0589-\u058a\u05be\u05c0\u05c3\u05c6\u05f3-\u05f4\u0609-\u060a\u060c-\u060d\u061b\u061e-\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0964-\u0965\u0970\u0df4\u0e4f\u0e5a-\u0e5b\u0f04-\u0f12\u0f3a-\u0f3d\u0f85\u0fd0-\u0fd4\u104a-\u104f\u10fb\u1361-\u1368\u166d-\u166e\u169b-\u169c\u16eb-\u16ed\u1735-\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u180a\u1944-\u1945\u19de-\u19df\u1a1e-\u1a1f\u1b5a-\u1b60\u1c3b-\u1c3f\u1c7e-\u1c7f\u2000-\u206e\u207d-\u207e\u208d-\u208e\u3008-\u3009\u2768-\u2775\u27c5-\u27c6\u27e6-\u27ef\u2983-\u2998\u29d8-\u29db\u29fc-\u29fd\u2cf9-\u2cfc\u2cfe-\u2cff\u2e00-\u2e7e\u3000-\u303f\u30a0\u30fb\ua60d-\ua60f\ua673\ua67e\ua874-\ua877\ua8ce-\ua8cf\ua92e-\ua92f\ua95f\uaa5c-\uaa5f\ufd3e-\ufd3f\ufe10-\ufe19\ufe30-\ufe52\ufe54-\ufe61\ufe63\ufe68\ufe6a-\ufe6b\uff01-\uff03\uff05-\uff0a\uff0c-\uff0f\uff1a-\uff1b\uff1f-\uff20\uff3b-\uff3d\uff3f\uff5b\uff5d\uff5f-\uff65]|\ud800[\udd00-\udd01\udf9f\udfd0]|\ud802[\udd1f\udd3f\ude50-\ude58]|\ud809[\udc00-\udc7e]/,
p=/\s/,d=core.PositionFilter.FilterResult.FILTER_ACCEPT,n=core.PositionFilter.FilterResult.FILTER_REJECT,a=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,c=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,k={NO_NEIGHBOUR:0,SPACE_CHAR:1,PUNCTUATION_CHAR:2,WORD_CHAR:3,OTHER:4};this.acceptPosition=function(f){var l=f.container(),m=f.leftNode(),q=f.rightNode(),p=f.unfilteredDomOffset,A=function(){return f.unfilteredDomOffset()-1};l.nodeType===g&&(null===q&&(q=h(l,1,f.getNodeFilter())),null===m&&(m=
h(l,-1,f.getNodeFilter())));l!==q&&(p=function(){return 0});l!==m&&null!==m&&(A=function(){return m.textContent.length-1});l=b(m,A);q=b(q,p);return l===k.WORD_CHAR&&q===k.WORD_CHAR||l===k.PUNCTUATION_CHAR&&q===k.PUNCTUATION_CHAR||e===a&&l!==k.NO_NEIGHBOUR&&q===k.SPACE_CHAR||e===c&&l===k.SPACE_CHAR&&q!==k.NO_NEIGHBOUR?n:d}};odf.WordBoundaryFilter.IncludeWhitespace={None:0,TRAILING:1,LEADING:2};
gui.SelectionController=function(m,e){function h(a){var c=a.spec();if(a.isEdit||c.memberid===e)I=void 0,D.cancel()}function b(){var a=y.getCursor(e).getNode();return y.createStepIterator(a,0,[A,w],y.getRootElement(a))}function f(a,c,b){b=new odf.WordBoundaryFilter(y,b);var d=y.getRootElement(a)||y.getRootNode(),f=y.createRootFilter(d);return y.createStepIterator(a,c,[A,f,b],d)}function g(a,c){return c?{anchorNode:a.startContainer,anchorOffset:a.startOffset,focusNode:a.endContainer,focusOffset:a.endOffset}:
{anchorNode:a.endContainer,anchorOffset:a.endOffset,focusNode:a.startContainer,focusOffset:a.startOffset}}function l(a,c,b){var d=new ops.OpMoveCursor;d.init({memberid:e,position:a,length:c||0,selectionType:b});return d}function q(a,c,b){var d;d=y.getCursor(e);d=g(d.getSelectedRange(),d.hasForwardSelection());d.focusNode=a;d.focusOffset=c;b||(d.anchorNode=d.focusNode,d.anchorOffset=d.focusOffset);a=y.convertDomToCursorRange(d);m.enqueue([l(a.position,a.length)])}function p(a){var c;c=f(a.startContainer,
a.startOffset,C);c.roundToPreviousStep()&&a.setStart(c.container(),c.offset());c=f(a.endContainer,a.endOffset,s);c.roundToNextStep()&&a.setEnd(c.container(),c.offset())}function d(a){var c=v.getParagraphElements(a),b=c[0],c=c[c.length-1];b&&a.setStart(b,0);c&&(v.isParagraph(a.endContainer)&&0===a.endOffset?a.setEndBefore(c):a.setEnd(c,c.childNodes.length))}function n(a,c,b,d){var f,k;d?(f=b.startContainer,k=b.startOffset):(f=b.endContainer,k=b.endOffset);z.containsNode(a,f)||(k=0>z.comparePoints(a,
0,f,k)?0:a.childNodes.length,f=a);a=y.createStepIterator(f,k,c,v.getParagraphElement(f)||a);a.roundToClosestStep()||runtime.assert(!1,"No step found in requested range");d?b.setStart(a.container(),a.offset()):b.setEnd(a.container(),a.offset())}function a(a,c){var d=b();d.advanceStep(a)&&q(d.container(),d.offset(),c)}function c(a,c){var d,f=I,k=[new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner];void 0===f&&H&&(f=H());isNaN(f)||(d=b(),t.moveToFilteredStep(d,a,k)&&d.advanceStep(a)&&(k=[new gui.ClosestXOffsetScanner(f),
new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner],t.moveToFilteredStep(d,a,k)&&(q(d.container(),d.offset(),c),I=f,D.restart())))}function k(a,c){var d=b(),f=[new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner];t.moveToFilteredStep(d,a,f)&&q(d.container(),d.offset(),c)}function r(a,c){var b=y.getCursor(e),b=g(b.getSelectedRange(),b.hasForwardSelection()),b=f(b.focusNode,b.focusOffset,C);b.advanceStep(a)&&q(b.container(),b.offset(),c)}function B(a,c,b){var d=!1,f=y.getCursor(e),
f=g(f.getSelectedRange(),f.hasForwardSelection()),d=y.getRootElement(f.focusNode);runtime.assert(Boolean(d),"SelectionController: Cursor outside root");f=y.createStepIterator(f.focusNode,f.focusOffset,[A,w],d);f.roundToClosestStep();f.advanceStep(a)&&(b=b(f.container()))&&(a===u?(f.setPosition(b,0),d=f.roundToNextStep()):(f.setPosition(b,b.childNodes.length),d=f.roundToPreviousStep()),d&&q(f.container(),f.offset(),c))}var y=m.getOdtDocument(),z=core.DomUtils,v=odf.OdfUtils,A=y.getPositionFilter(),
t=new gui.GuiStepUtils,w=y.createRootFilter(e),H=null,I,D,C=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,s=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,u=core.StepDirection.PREVIOUS,x=core.StepDirection.NEXT;this.selectionToRange=function(a){var c=0<=z.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset),b=a.focusNode.ownerDocument.createRange();c?(b.setStart(a.anchorNode,a.anchorOffset),b.setEnd(a.focusNode,a.focusOffset)):(b.setStart(a.focusNode,a.focusOffset),b.setEnd(a.anchorNode,
a.anchorOffset));return{range:b,hasForwardSelection:c}};this.rangeToSelection=g;this.selectImage=function(a){var c=y.getRootElement(a),b=y.createRootFilter(c),c=y.createStepIterator(a,0,[b,y.getPositionFilter()],c),d;c.roundToPreviousStep()&&(b=c.container(),d=c.offset(),c.setPosition(a,a.childNodes.length),c.roundToNextStep()&&(a=y.convertDomToCursorRange({anchorNode:b,anchorOffset:d,focusNode:c.container(),focusOffset:c.offset()}),a=l(a.position,a.length,ops.OdtCursor.RegionSelection),m.enqueue([a])))};
this.expandToWordBoundaries=p;this.expandToParagraphBoundaries=d;this.selectRange=function(a,c,b){var f=y.getOdfCanvas().getElement(),k,s=[A];k=z.containsNode(f,a.startContainer);f=z.containsNode(f,a.endContainer);if(k||f)if(k&&f&&(2===b?p(a):3<=b&&d(a)),(b=c?y.getRootElement(a.startContainer):y.getRootElement(a.endContainer))||(b=y.getRootNode()),s.push(y.createRootFilter(b)),n(b,s,a,!0),n(b,s,a,!1),a=g(a,c),c=y.convertDomToCursorRange(a),a=y.getCursorSelection(e),c.position!==a.position||c.length!==
a.length)a=l(c.position,c.length,ops.OdtCursor.RangeSelection),m.enqueue([a])};this.moveCursorToLeft=function(){a(u,!1);return!0};this.moveCursorToRight=function(){a(x,!1);return!0};this.extendSelectionToLeft=function(){a(u,!0);return!0};this.extendSelectionToRight=function(){a(x,!0);return!0};this.setCaretXPositionLocator=function(a){H=a};this.moveCursorUp=function(){c(u,!1);return!0};this.moveCursorDown=function(){c(x,!1);return!0};this.extendSelectionUp=function(){c(u,!0);return!0};this.extendSelectionDown=
function(){c(x,!0);return!0};this.moveCursorBeforeWord=function(){r(u,!1);return!0};this.moveCursorPastWord=function(){r(x,!1);return!0};this.extendSelectionBeforeWord=function(){r(u,!0);return!0};this.extendSelectionPastWord=function(){r(x,!0);return!0};this.moveCursorToLineStart=function(){k(u,!1);return!0};this.moveCursorToLineEnd=function(){k(x,!1);return!0};this.extendSelectionToLineStart=function(){k(u,!0);return!0};this.extendSelectionToLineEnd=function(){k(x,!0);return!0};this.extendSelectionToParagraphStart=
function(){B(u,!0,v.getParagraphElement);return!0};this.extendSelectionToParagraphEnd=function(){B(x,!0,v.getParagraphElement);return!0};this.moveCursorToParagraphStart=function(){B(u,!1,v.getParagraphElement);return!0};this.moveCursorToParagraphEnd=function(){B(x,!1,v.getParagraphElement);return!0};this.moveCursorToDocumentStart=function(){B(u,!1,y.getRootElement);return!0};this.moveCursorToDocumentEnd=function(){B(x,!1,y.getRootElement);return!0};this.extendSelectionToDocumentStart=function(){B(u,
!0,y.getRootElement);return!0};this.extendSelectionToDocumentEnd=function(){B(x,!0,y.getRootElement);return!0};this.extendSelectionToEntireDocument=function(){var a=y.getCursor(e),a=y.getRootElement(a.getNode()),c,b,d;runtime.assert(Boolean(a),"SelectionController: Cursor outside root");d=y.createStepIterator(a,0,[A,w],a);d.roundToClosestStep();c=d.container();b=d.offset();d.setPosition(a,a.childNodes.length);d.roundToClosestStep();a=y.convertDomToCursorRange({anchorNode:c,anchorOffset:b,focusNode:d.container(),
focusOffset:d.offset()});m.enqueue([l(a.position,a.length)]);return!0};this.destroy=function(a){y.unsubscribe(ops.OdtDocument.signalOperationStart,h);core.Async.destroyAll([D.destroy],a)};(function(){D=core.Task.createTimeoutTask(function(){I=void 0},2E3);y.subscribe(ops.OdtDocument.signalOperationStart,h)})()};
gui.TextController=function(m,e,h,b,f,g){function l(){B=!0===e.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)?h.isLocalCursorWithinOwnAnnotation():!0}function q(a){a.getMemberId()===b&&l()}function p(a,b,d){var f=[c.getPositionFilter()];d&&f.push(c.createRootFilter(a.startContainer));d=c.createStepIterator(a.startContainer,a.startOffset,f,b);d.roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range start");b=c.convertDomPointToCursorStep(d.container(),d.offset());
a.collapsed?a=b:(d.setPosition(a.endContainer,a.endOffset),d.roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range end"),a=c.convertDomPointToCursorStep(d.container(),d.offset()));return{position:b,length:a-b}}function d(a){var c,d,f,g=k.getParagraphElements(a),e=a.cloneRange(),l=[];c=g[0];1<g.length&&(k.hasNoODFContent(c)&&(c=g[g.length-1]),d=c.getAttributeNS(odf.Namespaces.textns,"style-name")||"");g.forEach(function(c,k){var g,h;e.setStart(c,0);e.collapse(!0);
g=p(e,c,!1).position;0<k&&(h=new ops.OpMergeParagraph,h.init({memberid:b,paragraphStyleName:d,destinationStartPosition:f,sourceStartPosition:g,moveCursor:1===k}),l.unshift(h));f=g;e.selectNodeContents(c);if(g=r.rangeIntersection(e,a))g=p(g,c,!0),0<g.length&&(h=new ops.OpRemoveText,h.init({memberid:b,position:g.position,length:g.length}),l.unshift(h))});return l}function n(a){0>a.length&&(a.position+=a.length,a.length=-a.length);return a}function a(a){if(!B)return!1;var f,k=c.getCursor(b).getSelectedRange().cloneRange(),
g=n(c.getCursorSelection(b)),e;if(0===g.length){g=void 0;f=c.getCursor(b).getNode();e=c.getRootElement(f);var l=[c.getPositionFilter(),c.createRootFilter(e)];e=c.createStepIterator(f,0,l,e);e.roundToClosestStep()&&(a?e.nextStep():e.previousStep())&&(g=n(c.convertDomToCursorRange({anchorNode:f,anchorOffset:0,focusNode:e.container(),focusOffset:e.offset()})),a?(k.setStart(f,0),k.setEnd(e.container(),e.offset())):(k.setStart(e.container(),e.offset()),k.setEnd(f,0)))}g&&m.enqueue(d(k));return void 0!==
g}var c=m.getOdtDocument(),k=odf.OdfUtils,r=core.DomUtils,B=!1,y=odf.Namespaces.textns,z=core.StepDirection.NEXT;this.isEnabled=function(){return B};this.enqueueParagraphSplittingOps=function(){if(!B)return!1;var a=c.getCursor(b),f=a.getSelectedRange(),e=n(c.getCursorSelection(b)),l=[],a=k.getParagraphElement(a.getNode()),h=a.getAttributeNS(y,"style-name")||"";0<e.length&&(l=l.concat(d(f)));f=new ops.OpSplitParagraph;f.init({memberid:b,position:e.position,paragraphStyleName:h,sourceParagraphPosition:c.convertDomPointToCursorStep(a,
0,z),moveCursor:!0});l.push(f);g&&(e=g(e.position+1),l=l.concat(e));m.enqueue(l);return!0};this.removeTextByBackspaceKey=function(){return a(!1)};this.removeTextByDeleteKey=function(){return a(!0)};this.removeCurrentSelection=function(){if(!B)return!1;var a=c.getCursor(b).getSelectedRange();m.enqueue(d(a));return!0};this.insertText=function(a){if(B){var k=c.getCursor(b).getSelectedRange(),g=n(c.getCursorSelection(b)),e=[],l=!1;0<g.length&&(e=e.concat(d(k)),l=!0);k=new ops.OpInsertText;k.init({memberid:b,
position:g.position,text:a,moveCursor:!0});e.push(k);f&&(a=f(g.position,a.length,l))&&e.push(a);m.enqueue(e)}};this.destroy=function(a){c.unsubscribe(ops.Document.signalCursorMoved,q);e.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,l);a()};c.subscribe(ops.Document.signalCursorMoved,q);e.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,l);l()};gui.UndoManager=function(){};gui.UndoManager.prototype.subscribe=function(m,e){};gui.UndoManager.prototype.unsubscribe=function(m,e){};
gui.UndoManager.prototype.setDocument=function(m){};gui.UndoManager.prototype.setInitialState=function(){};gui.UndoManager.prototype.initialize=function(){};gui.UndoManager.prototype.purgeInitialState=function(){};gui.UndoManager.prototype.setPlaybackFunction=function(m){};gui.UndoManager.prototype.hasUndoStates=function(){};gui.UndoManager.prototype.hasRedoStates=function(){};gui.UndoManager.prototype.moveForward=function(m){};gui.UndoManager.prototype.moveBackward=function(m){};
gui.UndoManager.prototype.onOperationExecuted=function(m){};gui.UndoManager.prototype.isDocumentModified=function(){};gui.UndoManager.prototype.setDocumentModified=function(m){};gui.UndoManager.signalUndoStackChanged="undoStackChanged";gui.UndoManager.signalUndoStateCreated="undoStateCreated";gui.UndoManager.signalUndoStateModified="undoStateModified";gui.UndoManager.signalDocumentModifiedChanged="documentModifiedChanged";
gui.SessionControllerOptions=function(){this.annotationsEnabled=this.directParagraphStylingEnabled=this.directTextStylingEnabled=!1};
(function(){var m=core.PositionFilter.FilterResult.FILTER_ACCEPT;gui.SessionController=function(e,h,b,f){function g(a,c){var b=J.getDOMDocument(),d=null;b.caretRangeFromPoint?(b=b.caretRangeFromPoint(a,c),d={container:b.startContainer,offset:b.startOffset}):b.caretPositionFromPoint&&(b=b.caretPositionFromPoint(a,c))&&b.offsetNode&&(d={container:b.offsetNode,offset:b.offset});return d}function l(a){var c=J.getCursor(h).getSelectedRange();c.collapsed?a.preventDefault():W.setDataFromRange(a,c)?ca.removeCurrentSelection():
runtime.log("Cut operation failed")}function q(){return!1!==J.getCursor(h).getSelectedRange().collapsed}function p(a){var c=J.getCursor(h).getSelectedRange();c.collapsed?a.preventDefault():W.setDataFromRange(a,c)||runtime.log("Copy operation failed")}function d(a){var c;F.clipboardData&&F.clipboardData.getData?c=F.clipboardData.getData("Text"):a.clipboardData&&a.clipboardData.getData&&(c=a.clipboardData.getData("text/plain"));c&&(ca.removeCurrentSelection(),ea.paste(c));a.preventDefault?a.preventDefault():
a.returnValue=!1}function n(){return!1}function a(a){if(da)da.onOperationExecuted(a)}function c(a){J.emit(ops.OdtDocument.signalUndoStackChanged,a)}function k(){var a;return da?(a=L.hasFocus(),da.moveBackward(1),a&&L.focus(),!0):!1}function r(){var a;return da?(a=L.hasFocus(),da.moveForward(1),a&&L.focus(),!0):!1}function B(a){var c=J.getCursor(h).getSelectedRange(),d=(a.target||a.srcElement||null).getAttribute("end");c&&d&&(a=g(a.clientX,a.clientY))&&(ha.setUnfilteredPosition(a.container,a.offset),
Z.acceptPosition(ha)===m&&(c=c.cloneRange(),"left"===d?c.setStart(ha.container(),ha.unfilteredDomOffset()):c.setEnd(ha.container(),ha.unfilteredDomOffset()),b.setSelectedRange(c,"right"===d),J.emit(ops.Document.signalCursorMoved,b)))}function y(){V.selectRange(b.getSelectedRange(),b.hasForwardSelection(),1)}function z(){var a=F.getSelection(),c=0<a.rangeCount&&V.selectionToRange(a);S&&c&&(X=!0,ja.clearSelection(),ha.setUnfilteredPosition(a.focusNode,a.focusOffset),Z.acceptPosition(ha)===m&&(2===na?
V.expandToWordBoundaries(c.range):3<=na&&V.expandToParagraphBoundaries(c.range),b.setSelectedRange(c.range,c.hasForwardSelection),J.emit(ops.Document.signalCursorMoved,b)))}function v(a){var c=a.target||a.srcElement||null,b=J.getCursor(h);if(S=null!==c&&aa.containsNode(J.getOdfCanvas().getElement(),c))X=!1,c=J.getRootElement(c)||J.getRootNode(),Z=J.createRootFilter(c),na=0===a.button?a.detail:0,b&&a.shiftKey?F.getSelection().collapse(b.getAnchorNode(),0):(a=F.getSelection(),c=b.getSelectedRange(),
a.extend?b.hasForwardSelection()?(a.collapse(c.startContainer,c.startOffset),a.extend(c.endContainer,c.endOffset)):(a.collapse(c.endContainer,c.endOffset),a.extend(c.startContainer,c.startOffset)):(a.removeAllRanges(),a.addRange(c.cloneRange()))),1<na&&z()}function A(a){var c=J.getRootElement(a),b=J.createRootFilter(c),c=J.createStepIterator(a,0,[b,J.getPositionFilter()],c);c.setPosition(a,a.childNodes.length);return c.roundToNextStep()?{container:c.container(),offset:c.offset()}:null}function t(a){var c;
c=(c=F.getSelection())?{anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}:null;var b=F.getSelection().isCollapsed,d,f;c.anchorNode||c.focusNode||!(d=g(a.clientX,a.clientY))||(c.anchorNode=d.container,c.anchorOffset=d.offset,c.focusNode=c.anchorNode,c.focusOffset=c.anchorOffset);if(c.focusNode)if(Q.isImage(c.focusNode)&&0===c.focusOffset&&Q.isCharacterFrame(c.focusNode.parentNode)){if(f=c.focusNode.parentNode,d=f.getBoundingClientRect(),a.clientX>
d.left&&(d=A(f)))c.focusNode=d.container,c.focusOffset=d.offset,b&&(c.anchorNode=c.focusNode,c.anchorOffset=c.focusOffset)}else Q.isImage(c.focusNode.firstChild)&&1===c.focusOffset&&Q.isCharacterFrame(c.focusNode)&&(d=A(c.focusNode))&&(c.anchorNode=c.focusNode=d.container,c.anchorOffset=c.focusOffset=d.offset);c.anchorNode&&c.focusNode&&(c=V.selectionToRange(c),V.selectRange(c.range,c.hasForwardSelection,0===a.button?a.detail:0));L.focus()}function w(a){var c;if(c=g(a.clientX,a.clientY))a=c.container,
c=c.offset,a={anchorNode:a,anchorOffset:c,focusNode:a,focusOffset:c},a=V.selectionToRange(a),V.selectRange(a.range,a.hasForwardSelection,2),L.focus()}function H(a){var c=a.target||a.srcElement||null,d,f,k;la.processRequests();S&&(Q.isImage(c)&&Q.isCharacterFrame(c.parentNode)&&F.getSelection().isCollapsed?(V.selectImage(c.parentNode),L.focus()):ja.isSelectorElement(c)?L.focus():X?(X=S=!1,c=b.getSelectedRange(),f=c.collapsed,Q.isImage(c.endContainer)&&0===c.endOffset&&Q.isCharacterFrame(c.endContainer.parentNode)&&
(k=c.endContainer.parentNode,k=A(k))&&(c.setEnd(k.container,k.offset),f&&c.collapse(!1)),V.selectRange(c,b.hasForwardSelection(),0===a.button?a.detail:0),L.focus()):ta?t(a):(d=aa.cloneEvent(a),R=runtime.setTimeout(function(){t(d)},0)),na=0,X=S=!1)}function I(a){var c=J.getCursor(h).getSelectedRange();c.collapsed||U.exportRangeToDataTransfer(a.dataTransfer,c)}function D(){S&&L.focus();na=0;X=S=!1}function C(a){H(a)}function s(a){var c=a.target||a.srcElement||null,b=null;"annotationRemoveButton"===
c.className?(runtime.assert(fa,"Remove buttons are displayed on annotations while annotation editing is disabled in the controller."),b=c.parentNode.getElementsByTagNameNS(odf.Namespaces.officens,"annotation").item(0),ga.removeAnnotation(b),L.focus()):"webodf-draggable"!==c.getAttribute("class")&&H(a)}function u(a){(a=a.data)&&(-1===a.indexOf("\n")?ca.insertText(a):ea.paste(a))}function x(a){return function(){a();return!0}}function G(a){return function(c){return J.getCursor(h).getSelectionType()===
ops.OdtCursor.RangeSelection?a(c):!0}}function M(c){L.unsubscribe("keydown",K.handleEvent);L.unsubscribe("keypress",ba.handleEvent);L.unsubscribe("keyup",Y.handleEvent);L.unsubscribe("copy",p);L.unsubscribe("mousedown",v);L.unsubscribe("mousemove",la.trigger);L.unsubscribe("mouseup",s);L.unsubscribe("contextmenu",C);L.unsubscribe("dragstart",I);L.unsubscribe("dragend",D);L.unsubscribe("click",oa.handleClick);L.unsubscribe("longpress",w);L.unsubscribe("drag",B);L.unsubscribe("dragstop",y);J.unsubscribe(ops.OdtDocument.signalOperationEnd,
ma.trigger);J.unsubscribe(ops.Document.signalCursorAdded,ia.registerCursor);J.unsubscribe(ops.Document.signalCursorRemoved,ia.removeCursor);J.unsubscribe(ops.OdtDocument.signalOperationEnd,a);c()}var F=runtime.getWindow(),J=e.getOdtDocument(),P=new gui.SessionConstraints,E=new gui.SessionContext(e,h),aa=core.DomUtils,Q=odf.OdfUtils,U=new gui.MimeDataExporter,W=new gui.Clipboard(U),K=new gui.KeyboardHandler,ba=new gui.KeyboardHandler,Y=new gui.KeyboardHandler,S=!1,$=new odf.ObjectNameGenerator(J.getOdfCanvas().odfContainer(),
h),X=!1,Z=null,R,da=null,L=new gui.EventManager(J),fa=f.annotationsEnabled,ga=new gui.AnnotationController(e,P,h),T=new gui.DirectFormattingController(e,P,E,h,$,f.directTextStylingEnabled,f.directParagraphStylingEnabled),ca=new gui.TextController(e,P,E,h,T.createCursorStyleOp,T.createParagraphStyleOps),ka=new gui.ImageController(e,P,E,h,$),ja=new gui.ImageSelector(J.getOdfCanvas()),ha=J.createPositionIterator(J.getRootNode()),la,ma,ea=new gui.PasteController(e,P,E,h),ia=new gui.InputMethodEditor(h,
L),na=0,oa=new gui.HyperlinkClickHandler(J.getOdfCanvas().getElement,K,Y),ra=new gui.HyperlinkController(e,P,E,h),V=new gui.SelectionController(e,h),sa=new gui.MetadataController(e,h),N=gui.KeyboardHandler.Modifier,O=gui.KeyboardHandler.KeyCode,pa=-1!==F.navigator.appVersion.toLowerCase().indexOf("mac"),ta=-1!==["iPad","iPod","iPhone"].indexOf(F.navigator.platform),qa;runtime.assert(null!==F,"Expected to be run in an environment which has a global window, like a browser.");this.undo=k;this.redo=r;
this.insertLocalCursor=function(){runtime.assert(void 0===e.getOdtDocument().getCursor(h),"Inserting local cursor a second time.");var a=new ops.OpAddCursor;a.init({memberid:h});e.enqueue([a]);L.focus()};this.removeLocalCursor=function(){runtime.assert(void 0!==e.getOdtDocument().getCursor(h),"Removing local cursor without inserting before.");var a=new ops.OpRemoveCursor;a.init({memberid:h});e.enqueue([a])};this.startEditing=function(){ia.subscribe(gui.InputMethodEditor.signalCompositionStart,ca.removeCurrentSelection);
ia.subscribe(gui.InputMethodEditor.signalCompositionEnd,u);L.subscribe("beforecut",q);L.subscribe("cut",l);L.subscribe("beforepaste",n);L.subscribe("paste",d);da&&da.initialize();L.setEditing(!0);oa.setModifier(pa?N.Meta:N.Ctrl);K.bind(O.Backspace,N.None,x(ca.removeTextByBackspaceKey),!0);K.bind(O.Delete,N.None,ca.removeTextByDeleteKey);K.bind(O.Tab,N.None,G(function(){ca.insertText("\t");return!0}));pa?(K.bind(O.Clear,N.None,ca.removeCurrentSelection),K.bind(O.B,N.Meta,G(T.toggleBold)),K.bind(O.I,
N.Meta,G(T.toggleItalic)),K.bind(O.U,N.Meta,G(T.toggleUnderline)),K.bind(O.L,N.MetaShift,G(T.alignParagraphLeft)),K.bind(O.E,N.MetaShift,G(T.alignParagraphCenter)),K.bind(O.R,N.MetaShift,G(T.alignParagraphRight)),K.bind(O.J,N.MetaShift,G(T.alignParagraphJustified)),fa&&K.bind(O.C,N.MetaShift,ga.addAnnotation),K.bind(O.Z,N.Meta,k),K.bind(O.Z,N.MetaShift,r)):(K.bind(O.B,N.Ctrl,G(T.toggleBold)),K.bind(O.I,N.Ctrl,G(T.toggleItalic)),K.bind(O.U,N.Ctrl,G(T.toggleUnderline)),K.bind(O.L,N.CtrlShift,G(T.alignParagraphLeft)),
K.bind(O.E,N.CtrlShift,G(T.alignParagraphCenter)),K.bind(O.R,N.CtrlShift,G(T.alignParagraphRight)),K.bind(O.J,N.CtrlShift,G(T.alignParagraphJustified)),fa&&K.bind(O.C,N.CtrlAlt,ga.addAnnotation),K.bind(O.Z,N.Ctrl,k),K.bind(O.Z,N.CtrlShift,r));ba.setDefault(G(function(a){var c;c=null===a.which||void 0===a.which?String.fromCharCode(a.keyCode):0!==a.which&&0!==a.charCode?String.fromCharCode(a.which):null;return!c||a.altKey||a.ctrlKey||a.metaKey?!1:(ca.insertText(c),!0)}));ba.bind(O.Enter,N.None,G(ca.enqueueParagraphSplittingOps))};
this.endEditing=function(){ia.unsubscribe(gui.InputMethodEditor.signalCompositionStart,ca.removeCurrentSelection);ia.unsubscribe(gui.InputMethodEditor.signalCompositionEnd,u);L.unsubscribe("cut",l);L.unsubscribe("beforecut",q);L.unsubscribe("paste",d);L.unsubscribe("beforepaste",n);L.setEditing(!1);oa.setModifier(N.None);K.bind(O.Backspace,N.None,function(){return!0},!0);K.unbind(O.Delete,N.None);K.unbind(O.Tab,N.None);pa?(K.unbind(O.Clear,N.None),K.unbind(O.B,N.Meta),K.unbind(O.I,N.Meta),K.unbind(O.U,
N.Meta),K.unbind(O.L,N.MetaShift),K.unbind(O.E,N.MetaShift),K.unbind(O.R,N.MetaShift),K.unbind(O.J,N.MetaShift),fa&&K.unbind(O.C,N.MetaShift),K.unbind(O.Z,N.Meta),K.unbind(O.Z,N.MetaShift)):(K.unbind(O.B,N.Ctrl),K.unbind(O.I,N.Ctrl),K.unbind(O.U,N.Ctrl),K.unbind(O.L,N.CtrlShift),K.unbind(O.E,N.CtrlShift),K.unbind(O.R,N.CtrlShift),K.unbind(O.J,N.CtrlShift),fa&&K.unbind(O.C,N.CtrlAlt),K.unbind(O.Z,N.Ctrl),K.unbind(O.Z,N.CtrlShift));ba.setDefault(null);ba.unbind(O.Enter,N.None)};this.getInputMemberId=
function(){return h};this.getSession=function(){return e};this.getSessionConstraints=function(){return P};this.setUndoManager=function(a){da&&da.unsubscribe(gui.UndoManager.signalUndoStackChanged,c);if(da=a)da.setDocument(J),da.setPlaybackFunction(e.enqueue),da.subscribe(gui.UndoManager.signalUndoStackChanged,c)};this.getUndoManager=function(){return da};this.getMetadataController=function(){return sa};this.getAnnotationController=function(){return ga};this.getDirectFormattingController=function(){return T};
this.getHyperlinkClickHandler=function(){return oa};this.getHyperlinkController=function(){return ra};this.getImageController=function(){return ka};this.getSelectionController=function(){return V};this.getTextController=function(){return ca};this.getEventManager=function(){return L};this.getKeyboardHandlers=function(){return{keydown:K,keypress:ba}};this.destroy=function(a){var c=[la.destroy,ma.destroy,T.destroy,ia.destroy,L.destroy,oa.destroy,ra.destroy,sa.destroy,V.destroy,ca.destroy,M];qa&&c.unshift(qa.destroy);
runtime.clearTimeout(R);core.Async.destroyAll(c,a)};la=core.Task.createRedrawTask(z);ma=core.Task.createRedrawTask(function(){var a=J.getCursor(h);if(a&&a.getSelectionType()===ops.OdtCursor.RegionSelection&&(a=Q.getImageElements(a.getSelectedRange())[0])){ja.select(a.parentNode);return}ja.clearSelection()});K.bind(O.Left,N.None,G(V.moveCursorToLeft));K.bind(O.Right,N.None,G(V.moveCursorToRight));K.bind(O.Up,N.None,G(V.moveCursorUp));K.bind(O.Down,N.None,G(V.moveCursorDown));K.bind(O.Left,N.Shift,
G(V.extendSelectionToLeft));K.bind(O.Right,N.Shift,G(V.extendSelectionToRight));K.bind(O.Up,N.Shift,G(V.extendSelectionUp));K.bind(O.Down,N.Shift,G(V.extendSelectionDown));K.bind(O.Home,N.None,G(V.moveCursorToLineStart));K.bind(O.End,N.None,G(V.moveCursorToLineEnd));K.bind(O.Home,N.Ctrl,G(V.moveCursorToDocumentStart));K.bind(O.End,N.Ctrl,G(V.moveCursorToDocumentEnd));K.bind(O.Home,N.Shift,G(V.extendSelectionToLineStart));K.bind(O.End,N.Shift,G(V.extendSelectionToLineEnd));K.bind(O.Up,N.CtrlShift,
G(V.extendSelectionToParagraphStart));K.bind(O.Down,N.CtrlShift,G(V.extendSelectionToParagraphEnd));K.bind(O.Home,N.CtrlShift,G(V.extendSelectionToDocumentStart));K.bind(O.End,N.CtrlShift,G(V.extendSelectionToDocumentEnd));pa?(K.bind(O.Left,N.Alt,G(V.moveCursorBeforeWord)),K.bind(O.Right,N.Alt,G(V.moveCursorPastWord)),K.bind(O.Left,N.Meta,G(V.moveCursorToLineStart)),K.bind(O.Right,N.Meta,G(V.moveCursorToLineEnd)),K.bind(O.Home,N.Meta,G(V.moveCursorToDocumentStart)),K.bind(O.End,N.Meta,G(V.moveCursorToDocumentEnd)),
K.bind(O.Left,N.AltShift,G(V.extendSelectionBeforeWord)),K.bind(O.Right,N.AltShift,G(V.extendSelectionPastWord)),K.bind(O.Left,N.MetaShift,G(V.extendSelectionToLineStart)),K.bind(O.Right,N.MetaShift,G(V.extendSelectionToLineEnd)),K.bind(O.Up,N.AltShift,G(V.extendSelectionToParagraphStart)),K.bind(O.Down,N.AltShift,G(V.extendSelectionToParagraphEnd)),K.bind(O.Up,N.MetaShift,G(V.extendSelectionToDocumentStart)),K.bind(O.Down,N.MetaShift,G(V.extendSelectionToDocumentEnd)),K.bind(O.A,N.Meta,G(V.extendSelectionToEntireDocument))):
(K.bind(O.Left,N.Ctrl,G(V.moveCursorBeforeWord)),K.bind(O.Right,N.Ctrl,G(V.moveCursorPastWord)),K.bind(O.Left,N.CtrlShift,G(V.extendSelectionBeforeWord)),K.bind(O.Right,N.CtrlShift,G(V.extendSelectionPastWord)),K.bind(O.A,N.Ctrl,G(V.extendSelectionToEntireDocument)));ta&&(qa=new gui.IOSSafariSupport(L));L.subscribe("keydown",K.handleEvent);L.subscribe("keypress",ba.handleEvent);L.subscribe("keyup",Y.handleEvent);L.subscribe("copy",p);L.subscribe("mousedown",v);L.subscribe("mousemove",la.trigger);
L.subscribe("mouseup",s);L.subscribe("contextmenu",C);L.subscribe("dragstart",I);L.subscribe("dragend",D);L.subscribe("click",oa.handleClick);L.subscribe("longpress",w);L.subscribe("drag",B);L.subscribe("dragstop",y);J.subscribe(ops.OdtDocument.signalOperationEnd,ma.trigger);J.subscribe(ops.Document.signalCursorAdded,ia.registerCursor);J.subscribe(ops.Document.signalCursorRemoved,ia.removeCursor);J.subscribe(ops.OdtDocument.signalOperationEnd,a)}})();
gui.CaretManager=function(m,e){function h(b){return g.hasOwnProperty(b)?g[b]:null}function b(){return Object.keys(g).map(function(b){return g[b]})}function f(b){var f=g[b];f&&(delete g[b],b===m.getInputMemberId()?(q.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,f.ensureVisible),q.unsubscribe(ops.Document.signalCursorMoved,f.refreshCursorBlinking),p.unsubscribe("compositionupdate",f.handleUpdate),p.unsubscribe("compositionend",f.handleUpdate),p.unsubscribe("focus",f.setFocus),p.unsubscribe("blur",
f.removeFocus),l.removeEventListener("focus",f.show,!1),l.removeEventListener("blur",f.hide,!1)):q.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,f.handleUpdate),f.destroy(function(){}))}var g={},l=runtime.getWindow(),q=m.getSession().getOdtDocument(),p=m.getEventManager();this.registerCursor=function(b,f,a){var c=b.getMemberId();b=new gui.Caret(b,e,f,a);g[c]=b;c===m.getInputMemberId()?(runtime.log("Starting to track input on new cursor of "+c),q.subscribe(ops.OdtDocument.signalProcessingBatchEnd,
b.ensureVisible),q.subscribe(ops.Document.signalCursorMoved,b.refreshCursorBlinking),p.subscribe("compositionupdate",b.handleUpdate),p.subscribe("compositionend",b.handleUpdate),p.subscribe("focus",b.setFocus),p.subscribe("blur",b.removeFocus),l.addEventListener("focus",b.show,!1),l.addEventListener("blur",b.hide,!1),b.setOverlayElement(p.getEventTrap())):q.subscribe(ops.OdtDocument.signalProcessingBatchEnd,b.handleUpdate);return b};this.getCaret=h;this.getCarets=b;this.destroy=function(d){var e=
b().map(function(a){return a.destroy});m.getSelectionController().setCaretXPositionLocator(null);q.unsubscribe(ops.Document.signalCursorRemoved,f);g={};core.Async.destroyAll(e,d)};m.getSelectionController().setCaretXPositionLocator(function(){var b=h(m.getInputMemberId()),f;b&&(f=b.getBoundingClientRect());return f?f.right:void 0});q.subscribe(ops.Document.signalCursorRemoved,f)};
gui.EditInfoHandle=function(m){var e=[],h,b=m.ownerDocument,f=b.documentElement.namespaceURI;this.setEdits=function(g){e=g;var l,m,p,d;core.DomUtils.removeAllChildNodes(h);for(g=0;g<e.length;g+=1)l=b.createElementNS(f,"div"),l.className="editInfo",m=b.createElementNS(f,"span"),m.className="editInfoColor",m.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",e[g].memberid),p=b.createElementNS(f,"span"),p.className="editInfoAuthor",p.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",
e[g].memberid),d=b.createElementNS(f,"span"),d.className="editInfoTime",d.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",e[g].memberid),d.appendChild(b.createTextNode(e[g].time.toString())),l.appendChild(m),l.appendChild(p),l.appendChild(d),h.appendChild(l)};this.show=function(){h.style.display="block"};this.hide=function(){h.style.display="none"};this.destroy=function(b){m.removeChild(h);b()};h=b.createElementNS(f,"div");h.setAttribute("class","editInfoHandle");h.style.display="none";
m.appendChild(h)};
ops.EditInfo=function(m,e){function h(){var b=[],e;for(e in f)f.hasOwnProperty(e)&&b.push({memberid:e,time:f[e].time});b.sort(function(b,f){return b.time-f.time});return b}var b,f={};this.getNode=function(){return b};this.getOdtDocument=function(){return e};this.getEdits=function(){return f};this.getSortedEdits=function(){return h()};this.addEdit=function(b,e){f[b]={time:e}};this.clearEdits=function(){f={}};this.destroy=function(f){m.parentNode&&m.removeChild(b);f()};b=e.getDOMDocument().createElementNS("urn:webodf:names:editinfo","editinfo");
m.insertBefore(b,m.firstChild)};
gui.EditInfoMarker=function(m,e){function h(b,a){return runtime.setTimeout(function(){l.style.opacity=b},a)}var b=this,f,g,l,q,p,d;this.addEdit=function(b,a){var c=Date.now()-a;m.addEdit(b,a);g.setEdits(m.getSortedEdits());l.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",b);runtime.clearTimeout(p);runtime.clearTimeout(d);1E4>c?(q=h(1,0),p=h(.5,1E4-c),d=h(.2,2E4-c)):1E4<=c&&2E4>c?(q=h(.5,0),d=h(.2,2E4-c)):q=h(.2,0)};this.getEdits=function(){return m.getEdits()};this.clearEdits=function(){m.clearEdits();
g.setEdits([]);l.hasAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")&&l.removeAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")};this.getEditInfo=function(){return m};this.show=function(){l.style.display="block"};this.hide=function(){b.hideHandle();l.style.display="none"};this.showHandle=function(){g.show()};this.hideHandle=function(){g.hide()};this.destroy=function(b){runtime.clearTimeout(q);runtime.clearTimeout(p);runtime.clearTimeout(d);f.removeChild(l);g.destroy(function(a){a?
b(a):m.destroy(b)})};(function(){var d=m.getOdtDocument().getDOMDocument();l=d.createElementNS(d.documentElement.namespaceURI,"div");l.setAttribute("class","editInfoMarker");l.onmouseover=function(){b.showHandle()};l.onmouseout=function(){b.hideHandle()};f=m.getNode();f.appendChild(l);g=new gui.EditInfoHandle(f);e||b.hide()})()};
gui.HyperlinkTooltipView=function(m,e){var h=core.DomUtils,b=odf.OdfUtils,f=runtime.getWindow(),g,l,q;runtime.assert(null!==f,"Expected to be run in an environment which has a global window, like a browser.");this.showTooltip=function(p){var d=p.target||p.srcElement,n=m.getSizer(),a=m.getZoomLevel(),c;a:{for(;d;){if(b.isHyperlink(d))break a;if(b.isParagraph(d)||b.isInlineRoot(d))break;d=d.parentNode}d=null}if(d){h.containsNode(n,q)||n.appendChild(q);c=l;var k;switch(e()){case gui.KeyboardHandler.Modifier.Ctrl:k=
runtime.tr("Ctrl-click to follow link");break;case gui.KeyboardHandler.Modifier.Meta:k=runtime.tr("\u2318-click to follow link");break;default:k=""}c.textContent=k;g.textContent=b.getHyperlinkTarget(d);q.style.display="block";c=f.innerWidth-q.offsetWidth-15;d=p.clientX>c?c:p.clientX+15;c=f.innerHeight-q.offsetHeight-10;p=p.clientY>c?c:p.clientY+10;n=n.getBoundingClientRect();d=(d-n.left)/a;p=(p-n.top)/a;q.style.left=d+"px";q.style.top=p+"px"}};this.hideTooltip=function(){q.style.display="none"};this.destroy=
function(b){q.parentNode&&q.parentNode.removeChild(q);b()};(function(){var b=m.getElement().ownerDocument;g=b.createElement("span");l=b.createElement("span");g.className="webodf-hyperlinkTooltipLink";l.className="webodf-hyperlinkTooltipText";q=b.createElement("div");q.className="webodf-hyperlinkTooltip";q.appendChild(g);q.appendChild(l);m.getElement().appendChild(q)})()};
gui.OdfFieldView=function(m){function e(){var b=odf.OdfSchema.getFields().map(function(b){return b.replace(":","|")}),g=b.join(",\n")+"\n{ background-color: #D0D0D0; }\n",b=b.map(function(b){return b+":empty::after"}).join(",\n")+"\n{ content:' '; white-space: pre; }\n";return g+"\n"+b}var h,b=m.getElement().ownerDocument;this.showFieldHighlight=function(){h.appendChild(b.createTextNode(e()))};this.hideFieldHighlight=function(){for(var b=h.sheet,g=b.cssRules;g.length;)b.deleteRule(g.length-1)};this.destroy=
function(b){h.parentNode&&h.parentNode.removeChild(h);b()};h=function(){var f=b.getElementsByTagName("head").item(0),g=b.createElement("style"),e="";g.type="text/css";g.media="screen, print, handheld, projection";odf.Namespaces.forEachPrefix(function(b,f){e+="@namespace "+b+" url("+f+");\n"});g.appendChild(b.createTextNode(e));f.appendChild(g);return g}()};
gui.ShadowCursor=function(m){var e=m.getDOMDocument().createRange(),h=!0;this.removeFromDocument=function(){};this.getMemberId=function(){return gui.ShadowCursor.ShadowCursorMemberId};this.getSelectedRange=function(){return e};this.setSelectedRange=function(b,f){e=b;h=!1!==f};this.hasForwardSelection=function(){return h};this.getDocument=function(){return m};this.getSelectionType=function(){return ops.OdtCursor.RangeSelection};e.setStart(m.getRootNode(),0)};gui.ShadowCursor.ShadowCursorMemberId="";
gui.SelectionView=function(m){};gui.SelectionView.prototype.rerender=function(){};gui.SelectionView.prototype.show=function(){};gui.SelectionView.prototype.hide=function(){};gui.SelectionView.prototype.destroy=function(m){};
gui.SelectionViewManager=function(m){function e(){return Object.keys(h).map(function(b){return h[b]})}var h={};this.getSelectionView=function(b){return h.hasOwnProperty(b)?h[b]:null};this.getSelectionViews=e;this.removeSelectionView=function(b){h.hasOwnProperty(b)&&(h[b].destroy(function(){}),delete h[b])};this.hideSelectionView=function(b){h.hasOwnProperty(b)&&h[b].hide()};this.showSelectionView=function(b){h.hasOwnProperty(b)&&h[b].show()};this.rerenderSelectionViews=function(){Object.keys(h).forEach(function(b){h[b].rerender()})};
this.registerCursor=function(b,f){var g=b.getMemberId(),e=new m(b);f?e.show():e.hide();return h[g]=e};this.destroy=function(b){function f(e,h){h?b(h):e<g.length?g[e].destroy(function(b){f(e+1,b)}):b()}var g=e();f(0,void 0)}};gui.SessionViewOptions=function(){this.caretBlinksOnRangeSelect=this.caretAvatarsInitiallyVisible=this.editInfoMarkersInitiallyVisible=!0};
(function(){function m(e,h){return void 0!==e?Boolean(e):h}gui.SessionView=function(e,h,b,f,g,l){function q(a){a.memberId===h&&I.getViewport().scrollIntoView(a.annotation.getBoundingClientRect())}function p(){var a=document.getElementsByTagName("head").item(0),c=document.createElement("style");c.type="text/css";c.media="screen, print, handheld, projection";a.appendChild(c);return c}function d(a,c,b){function d(c,b,f){b=c+'[editinfo|memberid="'+a+'"]'+f+b;a:{var k=A.firstChild;for(c=c+'[editinfo|memberid="'+
a+'"]'+f+"{";k;){if(k.nodeType===Node.TEXT_NODE&&0===k.data.indexOf(c)){c=k;break a}k=k.nextSibling}c=null}c?c.data=b:A.appendChild(document.createTextNode(b))}d("div.editInfoMarker","{ background-color: "+b+"; }","");d("span.editInfoColor","{ background-color: "+b+"; }","");d("span.editInfoAuthor",'{ content: "'+c+'"; }',":before");d("dc|creator","{ background-color: "+b+"; }","");d(".webodf-selectionOverlay","{ fill: "+b+"; stroke: "+b+";}","");a===h&&(d(".webodf-touchEnabled .webodf-selectionOverlay",
"{ display: block; }"," > .webodf-draggable"),a=gui.ShadowCursor.ShadowCursorMemberId,d(".webodf-selectionOverlay","{ fill: "+b+"; stroke: "+b+";}",""),d(".webodf-touchEnabled .webodf-selectionOverlay","{ display: block; }"," > .webodf-draggable"))}function n(a){var c,b;for(b in w)w.hasOwnProperty(b)&&(c=w[b],a?c.show():c.hide())}function a(a){g.getCarets().forEach(function(c){a?c.showHandle():c.hideHandle()})}function c(a){var c=a.getMemberId();a=a.getProperties();d(c,a.fullName,a.color)}function k(a){var c=
a.getMemberId(),d=b.getOdtDocument().getMember(c).getProperties();g.registerCursor(a,s,u);l.registerCursor(a,!0);if(a=g.getCaret(c))a.setAvatarImageUrl(d.imageUrl),a.setColor(d.color);runtime.log("+++ View here +++ eagerly created an Caret for '"+c+"'! +++")}function r(a){a=a.getMemberId();var c=l.getSelectionView(h),b=l.getSelectionView(gui.ShadowCursor.ShadowCursorMemberId),d=g.getCaret(h);a===h?(b.hide(),c&&c.show(),d&&d.show()):a===gui.ShadowCursor.ShadowCursorMemberId&&(b.show(),c&&c.hide(),
d&&d.hide())}function B(a){l.removeSelectionView(a)}function y(a){var c=a.paragraphElement,d=a.memberId;a=a.timeStamp;var f,k="",e=c.getElementsByTagNameNS("urn:webodf:names:editinfo","editinfo").item(0);e?(k=e.getAttributeNS("urn:webodf:names:editinfo","id"),f=w[k]):(k=Math.random().toString(),f=new ops.EditInfo(c,b.getOdtDocument()),f=new gui.EditInfoMarker(f,C),e=c.getElementsByTagNameNS("urn:webodf:names:editinfo","editinfo").item(0),e.setAttributeNS("urn:webodf:names:editinfo","id",k),w[k]=f);
f.addEdit(d,new Date(a));D.trigger()}function z(){var a;t.hasChildNodes()&&core.DomUtils.removeAllChildNodes(t);!0===f.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)&&(a=b.getOdtDocument().getMember(h))&&(a=a.getProperties().fullName,t.appendChild(document.createTextNode(".annotationWrapper:not([creator = '"+a+"']) .annotationRemoveButton { display: none; }")))}function v(a){var b=Object.keys(w).map(function(a){return w[a]});H.unsubscribe(ops.Document.signalMemberAdded,c);H.unsubscribe(ops.Document.signalMemberUpdated,
c);H.unsubscribe(ops.Document.signalCursorAdded,k);H.unsubscribe(ops.Document.signalCursorRemoved,B);H.unsubscribe(ops.OdtDocument.signalParagraphChanged,y);H.unsubscribe(ops.Document.signalCursorMoved,r);H.unsubscribe(ops.OdtDocument.signalParagraphChanged,l.rerenderSelectionViews);H.unsubscribe(ops.OdtDocument.signalTableAdded,l.rerenderSelectionViews);H.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,l.rerenderSelectionViews);f.unsubscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,
z);H.unsubscribe(ops.Document.signalMemberAdded,z);H.unsubscribe(ops.Document.signalMemberUpdated,z);A.parentNode.removeChild(A);t.parentNode.removeChild(t);(function F(c,d){d?a(d):c<b.length?b[c].destroy(function(a){F(c+1,a)}):a()})(0,void 0)}var A,t,w={},H,I,D,C=m(e.editInfoMarkersInitiallyVisible,!0),s=m(e.caretAvatarsInitiallyVisible,!0),u=m(e.caretBlinksOnRangeSelect,!0);this.showEditInfoMarkers=function(){C||(C=!0,n(C))};this.hideEditInfoMarkers=function(){C&&(C=!1,n(C))};this.showCaretAvatars=
function(){s||(s=!0,a(s))};this.hideCaretAvatars=function(){s&&(s=!1,a(s))};this.getSession=function(){return b};this.getCaret=function(a){return g.getCaret(a)};this.destroy=function(a){var c=[D.destroy,v];H.unsubscribe(ops.OdtDocument.signalAnnotationAdded,q);core.Async.destroyAll(c,a)};H=b.getOdtDocument();I=H.getOdfCanvas();H.subscribe(ops.OdtDocument.signalAnnotationAdded,q);H.subscribe(ops.Document.signalMemberAdded,c);H.subscribe(ops.Document.signalMemberUpdated,c);H.subscribe(ops.Document.signalCursorAdded,
k);H.subscribe(ops.Document.signalCursorRemoved,B);H.subscribe(ops.OdtDocument.signalParagraphChanged,y);H.subscribe(ops.Document.signalCursorMoved,r);H.subscribe(ops.OdtDocument.signalParagraphChanged,l.rerenderSelectionViews);H.subscribe(ops.OdtDocument.signalTableAdded,l.rerenderSelectionViews);H.subscribe(ops.OdtDocument.signalParagraphStyleModified,l.rerenderSelectionViews);f.subscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,z);H.subscribe(ops.Document.signalMemberAdded,z);H.subscribe(ops.Document.signalMemberUpdated,
z);A=p();A.appendChild(document.createTextNode("@namespace editinfo url(urn:webodf:names:editinfo);"));A.appendChild(document.createTextNode("@namespace dc url(http://purl.org/dc/elements/1.1/);"));t=p();z();D=core.Task.createRedrawTask(function(){var a=I.getAnnotationViewManager();a&&(a.rehighlightAnnotations(),H.fixCursorPositions())})}})();
gui.SvgSelectionView=function(m){function e(){var a=c.getRootNode();k!==a&&(k=a,r=c.getCanvas().getSizer(),r.appendChild(y),y.setAttribute("class","webodf-selectionOverlay"),v.setAttribute("class","webodf-draggable"),A.setAttribute("class","webodf-draggable"),v.setAttribute("end","left"),A.setAttribute("end","right"),v.setAttribute("r",8),A.setAttribute("r",8),y.appendChild(z),y.appendChild(v),y.appendChild(A))}function h(a){a=a.getBoundingClientRect();return Boolean(a&&0!==a.height)}function b(a){var c=
t.getTextElements(a,!0,!1),b=a.cloneRange(),d=a.cloneRange();a=a.cloneRange();if(!c.length)return null;var f;a:{f=0;var k=c[f],e=b.startContainer===k?b.startOffset:0,g=e;b.setStart(k,e);for(b.setEnd(k,g);!h(b);){if(k.nodeType===Node.ELEMENT_NODE&&g<k.childNodes.length)g=k.childNodes.length;else if(k.nodeType===Node.TEXT_NODE&&g<k.length)g+=1;else if(c[f])k=c[f],f+=1,e=g=0;else{f=!1;break a}b.setStart(k,e);b.setEnd(k,g)}f=!0}if(!f)return null;a:{f=c.length-1;k=c[f];g=e=d.endContainer===k?d.endOffset:
k.nodeType===Node.TEXT_NODE?k.length:k.childNodes.length;d.setStart(k,e);for(d.setEnd(k,g);!h(d);){if(k.nodeType===Node.ELEMENT_NODE&&0<e)e=0;else if(k.nodeType===Node.TEXT_NODE&&0<e)e-=1;else if(c[f])k=c[f],f-=1,e=g=k.length||k.childNodes.length;else{c=!1;break a}d.setStart(k,e);d.setEnd(k,g)}c=!0}if(!c)return null;a.setStart(b.startContainer,b.startOffset);a.setEnd(d.endContainer,d.endOffset);return{firstRange:b,lastRange:d,fillerRange:a}}function f(a,c){var b={};b.top=Math.min(a.top,c.top);b.left=
Math.min(a.left,c.left);b.right=Math.max(a.right,c.right);b.bottom=Math.max(a.bottom,c.bottom);b.width=b.right-b.left;b.height=b.bottom-b.top;return b}function g(a,c){c&&0<c.width&&0<c.height&&(a=a?f(a,c):c);return a}function l(a){function b(a){D.setUnfilteredPosition(a,0);return v.acceptNode(a)===C&&u.acceptPosition(D)===C?C:s}function d(a){var c=null;b(a)===C&&(c=w.getBoundingClientRect(a));return c}var f=a.commonAncestorContainer,k=a.startContainer,e=a.endContainer,l=a.startOffset,h=a.endOffset,
r,m,n=null,q,p=B.createRange(),u,v=new odf.OdfNodeFilter,y;if(k===f||e===f)return p=a.cloneRange(),n=p.getBoundingClientRect(),p.detach(),n;for(a=k;a.parentNode!==f;)a=a.parentNode;for(m=e;m.parentNode!==f;)m=m.parentNode;u=c.createRootFilter(k);for(f=a.nextSibling;f&&f!==m;)q=d(f),n=g(n,q),f=f.nextSibling;if(t.isParagraph(a))n=g(n,w.getBoundingClientRect(a));else if(a.nodeType===Node.TEXT_NODE)f=a,p.setStart(f,l),p.setEnd(f,f===m?h:f.length),q=p.getBoundingClientRect(),n=g(n,q);else for(y=B.createTreeWalker(a,
NodeFilter.SHOW_TEXT,b,!1),f=y.currentNode=k;f&&f!==e;)p.setStart(f,l),p.setEnd(f,f.length),q=p.getBoundingClientRect(),n=g(n,q),r=f,l=0,f=y.nextNode();r||(r=k);if(t.isParagraph(m))n=g(n,w.getBoundingClientRect(m));else if(m.nodeType===Node.TEXT_NODE)f=m,p.setStart(f,f===a?l:0),p.setEnd(f,h),q=p.getBoundingClientRect(),n=g(n,q);else for(y=B.createTreeWalker(m,NodeFilter.SHOW_TEXT,b,!1),f=y.currentNode=e;f&&f!==r;)if(p.setStart(f,0),p.setEnd(f,h),q=p.getBoundingClientRect(),n=g(n,q),f=y.previousNode())h=
f.length;return n}function q(a,c){var b=a.getBoundingClientRect(),d={width:0};d.top=b.top;d.bottom=b.bottom;d.height=b.height;d.left=d.right=c?b.right:b.left;return d}function p(){var a=m.getSelectedRange(),c;if(c=I&&m.getSelectionType()===ops.OdtCursor.RangeSelection&&!a.collapsed){e();var d=w.getBoundingClientRect(r),k=H.getZoomLevel(),a=b(a),g,s,h,n,t,p;if(a){c=a.firstRange;g=a.lastRange;s=a.fillerRange;h=w.translateRect(q(c,!1),d,k);t=w.translateRect(q(g,!0),d,k);n=(n=l(s))?w.translateRect(n,
d,k):f(h,t);p=n.left;n=h.left+Math.max(0,n.width-(h.left-n.left));d=Math.min(h.top,t.top);k=t.top+t.height;p=[{x:h.left,y:d+h.height},{x:h.left,y:d},{x:n,y:d},{x:n,y:k-t.height},{x:t.right,y:k-t.height},{x:t.right,y:k},{x:p,y:k},{x:p,y:d+h.height},{x:h.left,y:d+h.height}];n="";var u;for(u=0;u<p.length;u+=1)n+=p[u].x+","+p[u].y+" ";z.setAttribute("points",n);v.setAttribute("cx",h.left);v.setAttribute("cy",d+h.height/2);A.setAttribute("cx",t.right);A.setAttribute("cy",k-t.height/2);c.detach();g.detach();
s.detach()}c=Boolean(a)}y.style.display=c?"block":"none"}function d(a){I&&a===m&&u.trigger()}function n(a){a=8/a;v.setAttribute("r",a);A.setAttribute("r",a)}function a(a){r.removeChild(y);r.classList.remove("webodf-virtualSelections");m.getDocument().unsubscribe(ops.Document.signalCursorMoved,d);H.unsubscribe(gui.ZoomHelper.signalZoomChanged,n);a()}var c=m.getDocument(),k,r,B=c.getDOMDocument(),y=B.createElementNS("http://www.w3.org/2000/svg","svg"),z=B.createElementNS("http://www.w3.org/2000/svg",
"polygon"),v=B.createElementNS("http://www.w3.org/2000/svg","circle"),A=B.createElementNS("http://www.w3.org/2000/svg","circle"),t=odf.OdfUtils,w=core.DomUtils,H=c.getCanvas().getZoomHelper(),I=!0,D=m.getDocument().createPositionIterator(c.getRootNode()),C=NodeFilter.FILTER_ACCEPT,s=NodeFilter.FILTER_REJECT,u;this.rerender=function(){I&&u.trigger()};this.show=function(){I=!0;u.trigger()};this.hide=function(){I=!1;u.trigger()};this.destroy=function(c){core.Async.destroyAll([u.destroy,a],c)};(function(){var a=
m.getMemberId();u=core.Task.createRedrawTask(p);e();y.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",a);r.classList.add("webodf-virtualSelections");m.getDocument().subscribe(ops.Document.signalCursorMoved,d);H.subscribe(gui.ZoomHelper.signalZoomChanged,n);n(H.getZoomLevel())})()};
gui.UndoStateRules=function(){function m(b,e){var l=b.length;this.previous=function(){for(l-=1;0<=l;l-=1)if(e(b[l]))return b[l];return null}}function e(b){b=b.spec();var e;b.hasOwnProperty("position")&&(e=b.position);return e}function h(b){return b.isEdit}function b(b,g,l){if(!l)return l=e(b)-e(g),0===l||1===Math.abs(l);b=e(b);g=e(g);l=e(l);return b-g===g-l}this.isEditOperation=h;this.isPartOfOperationSet=function(f,e){var l=void 0!==f.group,q;if(!f.isEdit||0===e.length)return!0;q=e[e.length-1];if(l&&
f.group===q.group)return!0;a:switch(f.spec().optype){case "RemoveText":case "InsertText":q=!0;break a;default:q=!1}if(q&&e.some(h)){if(l){var p;l=f.spec().optype;q=new m(e,h);var d=q.previous(),n=null,a,c;runtime.assert(Boolean(d),"No edit operations found in state");c=d.group;runtime.assert(void 0!==c,"Operation has no group");for(a=1;d&&d.group===c;){if(l===d.spec().optype){p=d;break}d=q.previous()}if(p){for(d=q.previous();d;){if(d.group!==c){if(2===a)break;c=d.group;a+=1}if(l===d.spec().optype){n=
d;break}d=q.previous()}p=b(f,p,n)}else p=!1;return p}p=f.spec().optype;l=new m(e,h);q=l.previous();runtime.assert(Boolean(q),"No edit operations found in state");p=p===q.spec().optype?b(f,q,l.previous()):!1;return p}return!1}};
(function(){function m(b,f){this.mainId=void 0!==b?b:-1;this.subId=void 0!==f?f:-1}function e(b,f,e){function l(d,a){return d+(b.isEditOperation(a)?1:0)}var q,p,d;this.addOperation=function(f){b.isEditOperation(f)&&(d+=1);p.push(f)};this.isNextStateId=function(b){return b.mainId===q&&b.subId===d};this.getNextStateId=function(){return new m(q,d)};this.getOperations=function(){return p};q=h+=1;p=f||[];d=f&&e?f.reduce(l,0):0}var h=0;gui.TrivialUndoManager=function(b){function f(){return!0!==t.isNextStateId(A)}
function g(a){a=a.getOperations();0<a.length&&(C=!0,z(a),C=!1)}function l(){I.emit(gui.UndoManager.signalUndoStackChanged,{undoAvailable:k.hasUndoStates(),redoAvailable:k.hasRedoStates()})}function h(a){var c=f();a!==c&&I.emit(gui.UndoManager.signalDocumentModifiedChanged,c)}function p(){t!==y&&t!==w[w.length-1]&&w.push(t)}function d(a){var c=a.previousSibling||a.nextSibling;a.parentNode.removeChild(a);r.normalizeTextNodes(c)}function n(a){return Object.keys(a).map(function(c){return a[c]})}function a(a){function c(a){var e=
a.spec();if(f[e.memberid])switch(e.optype){case "AddCursor":b[e.memberid]||(b[e.memberid]=a,delete f[e.memberid],k-=1);break;case "MoveCursor":d[e.memberid]||(d[e.memberid]=a)}}var b={},d={},f={},k,g;g=a.pop();v.getMemberIds().forEach(function(a){f[a]=!0});for(k=Object.keys(f).length;g&&0<k;)g=g.getOperations(),g.reverse(),g.forEach(c),g=a.pop();return new e(D,n(b).concat(n(d)))}function c(){var c=f(),b=B=v.cloneDocumentElement();r.getElementsByTagNameNS(b,"urn:webodf:names:cursor","cursor").forEach(d);
r.getElementsByTagNameNS(b,"urn:webodf:names:cursor","anchor").forEach(d);p();t=y=a([y].concat(w));w.length=0;H.length=0;c||(A=t.getNextStateId());l();h(c)}var k=this,r=core.DomUtils,B,y,z,v,A,t,w=[],H=[],I=new core.EventNotifier([gui.UndoManager.signalUndoStackChanged,gui.UndoManager.signalUndoStateCreated,gui.UndoManager.signalUndoStateModified,gui.UndoManager.signalDocumentModifiedChanged,gui.TrivialUndoManager.signalDocumentRootReplaced]),D=b||new gui.UndoStateRules,C=!1;this.subscribe=function(a,
c){I.subscribe(a,c)};this.unsubscribe=function(a,c){I.unsubscribe(a,c)};this.isDocumentModified=f;this.setDocumentModified=function(a){f()!==a&&(A=a?new m:t.getNextStateId(),I.emit(gui.UndoManager.signalDocumentModifiedChanged,a))};this.hasUndoStates=function(){return 0<w.length};this.hasRedoStates=function(){return 0<H.length};this.setDocument=function(a){v=a};this.purgeInitialState=function(){var a=f();w.length=0;H.length=0;t=y=new e(D);A=t.getNextStateId();B=null;l();h(a)};this.setInitialState=
c;this.initialize=function(){B||c()};this.setPlaybackFunction=function(a){z=a};this.onOperationExecuted=function(a){if(!C){var c=f();D.isEditOperation(a)&&(t===y||0<H.length)||!D.isPartOfOperationSet(a,t.getOperations())?(H.length=0,p(),t=new e(D,[a],!0),w.push(t),I.emit(gui.UndoManager.signalUndoStateCreated,{operations:t.getOperations()}),l()):(t.addOperation(a),I.emit(gui.UndoManager.signalUndoStateModified,{operations:t.getOperations()}));h(c)}};this.moveForward=function(a){for(var c=0,b=f(),
d;a&&H.length;)d=H.pop(),w.push(d),g(d),a-=1,c+=1;c&&(t=w[w.length-1],l(),h(b));return c};this.moveBackward=function(a){for(var c=0,b=f();a&&w.length;)H.push(w.pop()),a-=1,c+=1;c&&(v.getMemberIds().forEach(function(a){v.hasCursor(a)&&v.removeCursor(a)}),v.setDocumentElement(B.cloneNode(!0)),I.emit(gui.TrivialUndoManager.signalDocumentRootReplaced,{}),g(y),w.forEach(g),t=w[w.length-1]||y,l(),h(b));return c};t=y=new e(D);A=t.getNextStateId()};gui.TrivialUndoManager.signalDocumentRootReplaced="documentRootReplaced"})();
odf.GraphicProperties=function(m,e,h){var b=this,f=odf.Namespaces.stylens,g=odf.Namespaces.svgns;this.verticalPos=function(){return b.data.value("verticalPos")};this.verticalRel=function(){return b.data.value("verticalRel")};this.horizontalPos=function(){return b.data.value("horizontalPos")};this.horizontalRel=function(){return b.data.value("horizontalRel")};this.strokeWidth=function(){return b.data.value("strokeWidth")};this.data;b.data=new odf.LazyStyleProperties(void 0===h?void 0:h.data,{verticalPos:function(){var b=
m.getAttributeNS(f,"vertical-pos");return""===b?void 0:b},verticalRel:function(){var b=m.getAttributeNS(f,"vertical-rel");return""===b?void 0:b},horizontalPos:function(){var b=m.getAttributeNS(f,"horizontal-pos");return""===b?void 0:b},horizontalRel:function(){var b=m.getAttributeNS(f,"horizontal-rel");return""===b?void 0:b},strokeWidth:function(){var b=m.getAttributeNS(g,"stroke-width");return e.parseLength(b)}})};
odf.ComputedGraphicProperties=function(){var m;this.setGraphicProperties=function(e){m=e};this.verticalPos=function(){return m&&m.verticalPos()||"from-top"};this.verticalRel=function(){return m&&m.verticalRel()||"page"};this.horizontalPos=function(){return m&&m.horizontalPos()||"from-left"};this.horizontalRel=function(){return m&&m.horizontalRel()||"page"}};
odf.PageLayoutProperties=function(m,e,h){var b=this,f=odf.Namespaces.fons;this.pageHeight=function(){return b.data.value("pageHeight")||1123};this.pageWidth=function(){return b.data.value("pageWidth")||794};this.data;b.data=new odf.LazyStyleProperties(void 0===h?void 0:h.data,{pageHeight:function(){var b;m&&(b=m.getAttributeNS(f,"page-height"),b=e.parseLength(b));return b},pageWidth:function(){var b;m&&(b=m.getAttributeNS(f,"page-width"),b=e.parseLength(b));return b}})};
odf.PageLayout=function(m,e,h){this.pageLayout;var b=null;m&&(b=e.getPropertiesElement("page-layout-properties",m));this.pageLayout=new odf.PageLayoutProperties(b,e,h&&h.pageLayout)};odf.PageLayoutCache=function(){};odf.PageLayoutCache.prototype.getPageLayout=function(m){};odf.PageLayoutCache.prototype.getDefaultPageLayout=function(){};
odf.ParagraphProperties=function(m,e,h){var b=this,f=odf.Namespaces.fons;this.marginTop=function(){return b.data.value("marginTop")};this.data;b.data=new odf.LazyStyleProperties(void 0===h?void 0:h.data,{marginTop:function(){var b=m.getAttributeNS(f,"margin-top");return e.parsePositiveLengthOrPercent(b,"marginTop",h&&h.data)}})};
odf.ComputedParagraphProperties=function(){var m={},e=[];this.setStyleChain=function(h){e=h;m={}};this.marginTop=function(){var h,b;if(m.hasOwnProperty("marginTop"))h=m.marginTop;else{for(b=0;void 0===h&&b<e.length;b+=1)h=e[b].marginTop();m.marginTop=h}return h||0}};
odf.TextProperties=function(m,e,h){var b=this,f=odf.Namespaces.fons;this.fontSize=function(){return b.data.value("fontSize")};this.data;b.data=new odf.LazyStyleProperties(void 0===h?void 0:h.data,{fontSize:function(){var b=m.getAttributeNS(f,"font-size");return e.parsePositiveLengthOrPercent(b,"fontSize",h&&h.data)}})};
odf.ComputedTextProperties=function(){var m={},e=[];this.setStyleChain=function(h){e=h;m={}};this.fontSize=function(){var h,b;if(m.hasOwnProperty("fontSize"))h=m.fontSize;else{for(b=0;void 0===h&&b<e.length;b+=1)h=e[b].fontSize();m.fontSize=h}return h||12}};odf.MasterPage=function(m,e){this.pageLayout;var h;m?(h=m.getAttributeNS(odf.Namespaces.stylens,"page-layout-name"),this.pageLayout=e.getPageLayout(h)):this.pageLayout=e.getDefaultPageLayout()};odf.MasterPageCache=function(){};
odf.MasterPageCache.prototype.getMasterPage=function(m){};
odf.StylePileEntry=function(m,e,h,b){this.text;this.paragraph;this.graphic;this.masterPage=function(){var b=m.getAttributeNS(odf.Namespaces.stylens,"master-page-name"),e=null;b&&(e=h.getMasterPage(b));return e};(function(f){var g=m.getAttributeNS(odf.Namespaces.stylens,"family"),l=null;if("graphic"===g||"chart"===g)f.graphic=void 0===b?void 0:b.graphic,l=e.getPropertiesElement("graphic-properties",m,l),null!==l&&(f.graphic=new odf.GraphicProperties(l,e,f.graphic));if("paragraph"===g||"table-cell"===
g||"graphic"===g||"presentation"===g||"chart"===g)f.paragraph=void 0===b?void 0:b.paragraph,l=e.getPropertiesElement("paragraph-properties",m,l),null!==l&&(f.paragraph=new odf.ParagraphProperties(l,e,f.paragraph));if("text"===g||"paragraph"===g||"table-cell"===g||"graphic"===g||"presentation"===g||"chart"===g)f.text=void 0===b?void 0:b.text,l=e.getPropertiesElement("text-properties",m,l),null!==l&&(f.text=new odf.TextProperties(l,e,f.text))})(this)};
odf.StylePile=function(m,e){function h(f,a){var c,k;f.hasAttributeNS(b,"parent-style-name")&&(k=f.getAttributeNS(b,"parent-style-name"),-1===a.indexOf(k)&&(c=d(k,a)));return new odf.StylePileEntry(f,m,e,c)}var b=odf.Namespaces.stylens,f={},g={},l,q={},p={},d;d=function(b,a){var c=q[b],d;!c&&(d=f[b])&&(a.push(b),c=h(d,a),q[b]=c);return c};this.getStyle=function(b){var a=p[b]||q[b],c,d=[];a||(c=g[b],c||(c=f[b])&&d.push(b),c&&(a=h(c,d)));return a};this.addCommonStyle=function(d){var a;d.hasAttributeNS(b,
"name")&&(a=d.getAttributeNS(b,"name"),f.hasOwnProperty(a)||(f[a]=d))};this.addAutomaticStyle=function(d){var a;d.hasAttributeNS(b,"name")&&(a=d.getAttributeNS(b,"name"),g.hasOwnProperty(a)||(g[a]=d))};this.setDefaultStyle=function(b){void 0===l&&(l=h(b,[]))};this.getDefaultStyle=function(){return l}};odf.ComputedGraphicStyle=function(){this.text=new odf.ComputedTextProperties;this.paragraph=new odf.ComputedParagraphProperties;this.graphic=new odf.ComputedGraphicProperties};
odf.ComputedParagraphStyle=function(){this.text=new odf.ComputedTextProperties;this.paragraph=new odf.ComputedParagraphProperties};odf.ComputedTextStyle=function(){this.text=new odf.ComputedTextProperties};
odf.StyleCache=function(m){function e(a,c,b,d){c=b.getAttributeNS(c,"class-names");var f;if(c)for(c=c.split(" "),f=0;f<c.length;f+=1)if(b=c[f])d.push(a),d.push(b)}function h(a,c){var b=y.getStyleName("paragraph",a);void 0!==b&&(c.push("paragraph"),c.push(b));a.namespaceURI!==r||"h"!==a.localName&&"p"!==a.localName||e("paragraph",r,a,c);return c}function b(a,c,b){var d=[],f,k,e,g;for(f=0;f<a.length;f+=2)e=a[f],g=a[f+1],e=q[e],g=e.getStyle(g),void 0!==g&&(g=g[c],void 0!==g&&g!==k&&(d.push(g),k=g));
e=q[b];if(g=e.getDefaultStyle())g=g[c],void 0!==g&&g!==k&&d.push(g);return d}function f(a,c){var b=y.getStyleName("text",a),d=a.parentNode;void 0!==b&&(c.push("text"),c.push(b));"span"===a.localName&&a.namespaceURI===r&&e("text",r,a,c);if(!d||d===m)return c;d.namespaceURI!==r||"p"!==d.localName&&"h"!==d.localName?f(d,c):h(d,c);return c}function g(a){a=a.getAttributeNS(B,"family");return q[a]}var l=this,q,p,d,n,a,c,k,r=odf.Namespaces.textns,B=odf.Namespaces.stylens,y=new odf.StyleInfo,z=new odf.StyleParseUtils,
v,A,t,w,H,I;this.getComputedGraphicStyle=function(a){var c=[];a=y.getStyleName("graphic",a);void 0!==a&&(c.push("graphic"),c.push(a));a=c.join("/");var d=n[a];runtime.assert(0===c.length%2,"Invalid style chain.");void 0===d&&(d=new odf.ComputedGraphicStyle,d.graphic.setGraphicProperties(b(c,"graphic","graphic")[0]),d.text.setStyleChain(b(c,"text","graphic")),d.paragraph.setStyleChain(b(c,"paragraph","graphic")),n[a]=d);return d};this.getComputedParagraphStyle=function(a){a=h(a,[]);var c=a.join("/"),
f=d[c];runtime.assert(0===a.length%2,"Invalid style chain.");void 0===f&&(f=new odf.ComputedParagraphStyle,f.text.setStyleChain(b(a,"text","paragraph")),f.paragraph.setStyleChain(b(a,"paragraph","paragraph")),d[c]=f);return f};this.getComputedTextStyle=function(a){a=f(a,[]);var c=a.join("/"),d=p[c];runtime.assert(0===a.length%2,"Invalid style chain.");void 0===d&&(d=new odf.ComputedTextStyle,d.text.setStyleChain(b(a,"text","text")),p[c]=d);return d};this.getPageLayout=function(a){var c=I[a];c||((c=
H[a])?(c=new odf.PageLayout(c,z,w),I[a]=c):c=w);return c};this.getDefaultPageLayout=function(){return w};this.getMasterPage=function(a){var c=A[a];void 0===c&&((c=v[a])?(c=new odf.MasterPage(c,l),A[a]=c):c=null);return c};this.getDefaultMasterPage=function(){return t};this.update=function(){var b,f,e=null,h=null;p={};d={};n={};v={};A={};I={};H={};a=new odf.StylePile(z,l);c=new odf.StylePile(z,l);k=new odf.StylePile(z,l);q={text:a,paragraph:c,graphic:k};for(b=m.styles.firstElementChild;b;)b.namespaceURI===
B&&((f=g(b))?"style"===b.localName?f.addCommonStyle(b):"default-style"===b.localName&&f.setDefaultStyle(b):"default-page-layout"===b.localName&&(e=b)),b=b.nextElementSibling;w=new odf.PageLayout(e,z);for(b=m.automaticStyles.firstElementChild;b;)b.namespaceURI===B&&((f=g(b))&&"style"===b.localName?f.addAutomaticStyle(b):"page-layout"===b.localName&&(H[b.getAttributeNS(B,"name")]=b)),b=b.nextElementSibling;for(b=m.masterStyles.firstElementChild;b;)b.namespaceURI===B&&"master-page"===b.localName&&(h=
h||b,f=b,e=f.getAttributeNS(B,"name"),0<e.length&&!v.hasOwnProperty(e)&&(v[e]=f)),b=b.nextElementSibling;t=new odf.MasterPage(h,l)}};
ops.OperationTransformMatrix=function(){function m(a){a.position+=a.length;a.length*=-1}function e(a){var c=0>a.length;c&&m(a);return c}function h(a,c){function b(f){a[f]===c&&d.push(f)}var d=[];a&&["style:parent-style-name","style:next-style-name"].forEach(b);return d}function b(a,c){function b(d){a[d]===c&&delete a[d]}a&&["style:parent-style-name","style:next-style-name"].forEach(b)}function f(a){var c={};Object.keys(a).forEach(function(b){c[b]="object"===typeof a[b]?f(a[b]):a[b]});return c}function g(a,
c,b,d){var f,e=!1,g=!1,l,h=[];d&&d.attributes&&(h=d.attributes.split(","));a&&(b||0<h.length)&&Object.keys(a).forEach(function(c){var d=a[c],f;"object"!==typeof d&&(b&&(f=b[c]),void 0!==f?(delete a[c],g=!0,f===d&&(delete b[c],e=!0)):-1!==h.indexOf(c)&&(delete a[c],g=!0))});if(c&&c.attributes&&(b||0<h.length)){l=c.attributes.split(",");for(d=0;d<l.length;d+=1)if(f=l[d],b&&void 0!==b[f]||h&&-1!==h.indexOf(f))l.splice(d,1),d-=1,g=!0;0<l.length?c.attributes=l.join(","):delete c.attributes}return{majorChanged:e,
minorChanged:g}}function l(a){for(var c in a)if(a.hasOwnProperty(c))return!0;return!1}function q(a){for(var c in a)if(a.hasOwnProperty(c)&&("attributes"!==c||0<a.attributes.length))return!0;return!1}function p(a,c,b,d,f){var e=a?a[f]:null,h=c?c[f]:null,m=b?b[f]:null,n=d?d[f]:null,t;t=g(e,h,m,n);e&&!l(e)&&delete a[f];h&&!q(h)&&delete c[f];m&&!l(m)&&delete b[f];n&&!q(n)&&delete d[f];return t}function d(a,c){return{opSpecsA:[a],opSpecsB:[c]}}var n;n={AddAnnotation:{AddAnnotation:function(a,c,b){var d;
a.position<c.position?(d=a,b=c):c.position<a.position?(d=c,b=a):(d=b?a:c,b=b?c:a);b.position<d.position+d.length&&(d.length+=2);b.position+=2;return{opSpecsA:[a],opSpecsB:[c]}},AddCursor:d,AddMember:d,AddStyle:d,ApplyDirectStyling:function(a,c){a.position<=c.position?c.position+=2:a.position<=c.position+c.length&&(c.length+=2);return{opSpecsA:[a],opSpecsB:[c]}},InsertText:function(a,c){c.position<=a.position?a.position+=c.text.length:(void 0!==a.length&&c.position<=a.position+a.length&&(a.length+=
c.text.length),c.position+=2);return{opSpecsA:[a],opSpecsB:[c]}},MergeParagraph:function(a,c){c.sourceStartPosition<=a.position?a.position-=1:(void 0!==a.length&&c.sourceStartPosition<=a.position+a.length&&(a.length-=1),c.sourceStartPosition+=2,a.position<c.destinationStartPosition&&(c.destinationStartPosition+=2));return{opSpecsA:[a],opSpecsB:[c]}},MoveCursor:function(a,c){var b=e(c);a.position<c.position?c.position+=2:a.position<c.position+c.length&&(c.length+=2);b&&m(c);return{opSpecsA:[a],opSpecsB:[c]}},
RemoveAnnotation:function(a,c){a.position<c.position?(c.position<a.position+a.length&&(a.length-=c.length+2),c.position+=2):a.position-=c.length+2;return{opSpecsA:[a],opSpecsB:[c]}},RemoveCursor:d,RemoveMember:d,RemoveStyle:d,RemoveText:function(a,c){var b=c.position,d=c.position+c.length,f,e=[a],g=[c];a.position<=c.position?c.position+=2:a.position<d&&(c.length=a.position-c.position,f={optype:"RemoveText",memberid:c.memberid,timestamp:c.timestamp,position:a.position+2,length:d-a.position},g.unshift(f));
c.position+c.length<=a.position?(a.position-=c.length,void 0!==a.length&&f&&(a.length=f.length>=a.length?0:a.length-f.length)):void 0!==a.length&&(f=a.position+a.length,d<=f?a.length-=c.length:b<f&&(a.length=b-a.position));return{opSpecsA:e,opSpecsB:g}},SetParagraphStyle:function(a,c){a.position<c.position&&(c.position+=2);return{opSpecsA:[a],opSpecsB:[c]}},SplitParagraph:function(a,c){a.position<c.sourceParagraphPosition&&(c.sourceParagraphPosition+=2);c.position<=a.position?a.position+=1:(void 0!==
a.length&&c.position<=a.position+a.length&&(a.length+=1),c.position+=2);return{opSpecsA:[a],opSpecsB:[c]}},UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:d},AddCursor:{AddCursor:d,AddMember:d,AddStyle:d,ApplyDirectStyling:d,InsertText:d,MergeParagraph:d,MoveCursor:d,RemoveAnnotation:d,RemoveCursor:d,RemoveMember:d,RemoveStyle:d,RemoveText:d,SetParagraphStyle:d,SplitParagraph:d,UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:d},AddMember:{AddStyle:d,ApplyDirectStyling:d,InsertText:d,MergeParagraph:d,
MoveCursor:d,RemoveAnnotation:d,RemoveCursor:d,RemoveStyle:d,RemoveText:d,SetParagraphStyle:d,SplitParagraph:d,UpdateMetadata:d,UpdateParagraphStyle:d},AddStyle:{AddStyle:d,ApplyDirectStyling:d,InsertText:d,MergeParagraph:d,MoveCursor:d,RemoveAnnotation:d,RemoveCursor:d,RemoveMember:d,RemoveStyle:function(a,c){var d,f=[a],e=[c];a.styleFamily===c.styleFamily&&(d=h(a.setProperties,c.styleName),0<d.length&&(d={optype:"UpdateParagraphStyle",memberid:c.memberid,timestamp:c.timestamp,styleName:a.styleName,
removedProperties:{attributes:d.join(",")}},e.unshift(d)),b(a.setProperties,c.styleName));return{opSpecsA:f,opSpecsB:e}},RemoveText:d,SetParagraphStyle:d,SplitParagraph:d,UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:d},ApplyDirectStyling:{ApplyDirectStyling:function(a,c,b){var d,e,g,h,m,n,t,q;h=[a];g=[c];if(!(a.position+a.length<=c.position||a.position>=c.position+c.length)){d=b?a:c;e=b?c:a;if(a.position!==c.position||a.length!==c.length)n=f(d),t=f(e);c=p(e.setProperties,null,d.setProperties,
null,"style:text-properties");if(c.majorChanged||c.minorChanged)g=[],a=[],h=d.position+d.length,m=e.position+e.length,e.position<d.position?c.minorChanged&&(q=f(t),q.length=d.position-e.position,a.push(q),e.position=d.position,e.length=m-e.position):d.position<e.position&&c.majorChanged&&(q=f(n),q.length=e.position-d.position,g.push(q),d.position=e.position,d.length=h-d.position),m>h?c.minorChanged&&(n=t,n.position=h,n.length=m-h,a.push(n),e.length=h-e.position):h>m&&c.majorChanged&&(n.position=m,
n.length=h-m,g.push(n),d.length=m-d.position),d.setProperties&&l(d.setProperties)&&g.push(d),e.setProperties&&l(e.setProperties)&&a.push(e),b?(h=g,g=a):h=a}return{opSpecsA:h,opSpecsB:g}},InsertText:function(a,c){c.position<=a.position?a.position+=c.text.length:c.position<=a.position+a.length&&(a.length+=c.text.length);return{opSpecsA:[a],opSpecsB:[c]}},MergeParagraph:function(a,c){var b=a.position,d=a.position+a.length;b>=c.sourceStartPosition&&(b-=1);d>=c.sourceStartPosition&&(d-=1);a.position=b;
a.length=d-b;return{opSpecsA:[a],opSpecsB:[c]}},MoveCursor:d,RemoveAnnotation:function(a,c){var b=a.position,d=a.position+a.length,f=c.position+c.length,e=[a],g=[c];c.position<=b&&d<=f?e=[]:(f<b&&(b-=c.length+2),f<d&&(d-=c.length+2),a.position=b,a.length=d-b);return{opSpecsA:e,opSpecsB:g}},RemoveCursor:d,RemoveMember:d,RemoveStyle:d,RemoveText:function(a,c){var b=a.position+a.length,d=c.position+c.length,f=[a],e=[c];d<=a.position?a.position-=c.length:c.position<b&&(a.position<c.position?a.length=
d<b?a.length-c.length:c.position-a.position:(a.position=c.position,d<b?a.length=b-d:f=[]));return{opSpecsA:f,opSpecsB:e}},SetParagraphStyle:d,SplitParagraph:function(a,c){c.position<a.position?a.position+=1:c.position<a.position+a.length&&(a.length+=1);return{opSpecsA:[a],opSpecsB:[c]}},UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:d},InsertText:{InsertText:function(a,c,b){a.position<c.position?c.position+=a.text.length:a.position>c.position?a.position+=c.text.length:b?c.position+=a.text.length:
a.position+=c.text.length;return{opSpecsA:[a],opSpecsB:[c]}},MergeParagraph:function(a,c){a.position>=c.sourceStartPosition?a.position-=1:(a.position<c.sourceStartPosition&&(c.sourceStartPosition+=a.text.length),a.position<c.destinationStartPosition&&(c.destinationStartPosition+=a.text.length));return{opSpecsA:[a],opSpecsB:[c]}},MoveCursor:function(a,c){var b=e(c);a.position<c.position?c.position+=a.text.length:a.position<c.position+c.length&&(c.length+=a.text.length);b&&m(c);return{opSpecsA:[a],
opSpecsB:[c]}},RemoveAnnotation:function(a,c){var b=a.position,d=c.position+c.length,f=[a],e=[c];c.position<=b&&b<=d?(f=[],c.length+=a.text.length):d<a.position?a.position-=c.length+2:c.position+=a.text.length;return{opSpecsA:f,opSpecsB:e}},RemoveCursor:d,RemoveMember:d,RemoveStyle:d,RemoveText:function(a,c){var b;b=c.position+c.length;var d=[a],f=[c];b<=a.position?a.position-=c.length:a.position<=c.position?c.position+=a.text.length:(c.length=a.position-c.position,b={optype:"RemoveText",memberid:c.memberid,
timestamp:c.timestamp,position:a.position+a.text.length,length:b-a.position},f.unshift(b),a.position=c.position);return{opSpecsA:d,opSpecsB:f}},SetParagraphStyle:function(a,c){c.position>a.position&&(c.position+=a.text.length);return{opSpecsA:[a],opSpecsB:[c]}},SplitParagraph:function(a,c){a.position<c.sourceParagraphPosition&&(c.sourceParagraphPosition+=a.text.length);a.position<=c.position?c.position+=a.text.length:a.position+=1;return{opSpecsA:[a],opSpecsB:[c]}},UpdateMember:d,UpdateMetadata:d,
UpdateParagraphStyle:d},MergeParagraph:{MergeParagraph:function(a,c,b){var d=[a],f=[c],e;a.destinationStartPosition===c.destinationStartPosition?(d=[],f=[],a.moveCursor&&(e={optype:"MoveCursor",memberid:a.memberid,timestamp:a.timestamp,position:a.sourceStartPosition-1},d.push(e)),c.moveCursor&&(e={optype:"MoveCursor",memberid:c.memberid,timestamp:c.timestamp,position:c.sourceStartPosition-1},f.push(e)),a=b?a:c,a={optype:"SetParagraphStyle",memberid:a.memberid,timestamp:a.timestamp,position:a.destinationStartPosition,
styleName:a.paragraphStyleName},b?d.push(a):f.push(a)):c.sourceStartPosition===a.destinationStartPosition?(a.destinationStartPosition=c.destinationStartPosition,a.sourceStartPosition-=1,a.paragraphStyleName=c.paragraphStyleName):a.sourceStartPosition===c.destinationStartPosition?(c.destinationStartPosition=a.destinationStartPosition,c.sourceStartPosition-=1,c.paragraphStyleName=a.paragraphStyleName):a.destinationStartPosition<c.destinationStartPosition?(c.destinationStartPosition-=1,c.sourceStartPosition-=
1):(a.destinationStartPosition-=1,a.sourceStartPosition-=1);return{opSpecsA:d,opSpecsB:f}},MoveCursor:function(a,c){var b=c.position,d=c.position+c.length,f=Math.min(b,d),b=Math.max(b,d);f>=a.sourceStartPosition&&(f-=1);b>=a.sourceStartPosition&&(b-=1);0<=c.length?(c.position=f,c.length=b-f):(c.position=b,c.length=f-b);return{opSpecsA:[a],opSpecsB:[c]}},RemoveAnnotation:function(a,c){var b=c.position+c.length,d=[a],f=[c];c.position<=a.destinationStartPosition&&a.sourceStartPosition<=b?(d=[],c.length-=
1):a.sourceStartPosition<c.position?c.position-=1:(b<a.destinationStartPosition&&(a.destinationStartPosition-=c.length+2),b<a.sourceStartPosition&&(a.sourceStartPosition-=c.length+2));return{opSpecsA:d,opSpecsB:f}},RemoveCursor:d,RemoveMember:d,RemoveStyle:d,RemoveText:function(a,c){c.position>=a.sourceStartPosition?c.position-=1:(c.position<a.destinationStartPosition&&(a.destinationStartPosition-=c.length),c.position<a.sourceStartPosition&&(a.sourceStartPosition-=c.length));return{opSpecsA:[a],opSpecsB:[c]}},
SetParagraphStyle:function(a,c){var b=[a],d=[c];if(c.position>a.sourceStartPosition)c.position-=1;else if(c.position===a.destinationStartPosition||c.position===a.sourceStartPosition)c.position=a.destinationStartPosition,a.paragraphStyleName=c.styleName;return{opSpecsA:b,opSpecsB:d}},SplitParagraph:function(a,c){var b,d=[a],f=[c];c.position<a.destinationStartPosition?(a.destinationStartPosition+=1,a.sourceStartPosition+=1):c.position>=a.destinationStartPosition&&c.position<a.sourceStartPosition?(c.paragraphStyleName=
a.paragraphStyleName,b={optype:"SetParagraphStyle",memberid:a.memberid,timestamp:a.timestamp,position:a.destinationStartPosition,styleName:a.paragraphStyleName},d.push(b),c.position===a.sourceStartPosition-1&&a.moveCursor&&(b={optype:"MoveCursor",memberid:a.memberid,timestamp:a.timestamp,position:c.position,length:0},d.push(b)),a.destinationStartPosition=c.position+1,a.sourceStartPosition+=1):c.position>=a.sourceStartPosition&&(c.position-=1,c.sourceParagraphPosition-=1);return{opSpecsA:d,opSpecsB:f}},
UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:d},MoveCursor:{MoveCursor:d,RemoveAnnotation:function(a,c){var b=e(a),d=a.position+a.length,f=c.position+c.length;c.position<=a.position&&d<=f?(a.position=c.position-1,a.length=0):(f<a.position?a.position-=c.length+2:f<d&&(a.length-=c.length+2),b&&m(a));return{opSpecsA:[a],opSpecsB:[c]}},RemoveCursor:function(a,c){return{opSpecsA:a.memberid===c.memberid?[]:[a],opSpecsB:[c]}},RemoveMember:d,RemoveStyle:d,RemoveText:function(a,c){var b=e(a),d=a.position+
a.length,f=c.position+c.length;f<=a.position?a.position-=c.length:c.position<d&&(a.position<c.position?a.length=f<d?a.length-c.length:c.position-a.position:(a.position=c.position,a.length=f<d?d-f:0));b&&m(a);return{opSpecsA:[a],opSpecsB:[c]}},SetParagraphStyle:d,SplitParagraph:function(a,c){var b=e(a);c.position<a.position?a.position+=1:c.position<a.position+a.length&&(a.length+=1);b&&m(a);return{opSpecsA:[a],opSpecsB:[c]}},UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:d},RemoveAnnotation:{RemoveAnnotation:function(a,
c){var b=[a],d=[c];a.position===c.position&&a.length===c.length?(b=[],d=[]):a.position<c.position?c.position-=a.length+2:a.position-=c.length+2;return{opSpecsA:b,opSpecsB:d}},RemoveCursor:d,RemoveMember:d,RemoveStyle:d,RemoveText:function(a,c){var b=a.position+a.length,d=c.position+c.length,f=[a],e=[c];a.position<=c.position&&d<=b?(e=[],a.length-=c.length):d<a.position?a.position-=c.length:c.position<a.position?(a.position=c.position+1,c.length-=a.length+2):c.position-=a.length+2;return{opSpecsA:f,
opSpecsB:e}},SetParagraphStyle:function(a,c){var b=c.position,d=a.position+a.length,f=[a],e=[c];a.position<=b&&b<=d?e=[]:d<b&&(c.position-=a.length+2);return{opSpecsA:f,opSpecsB:e}},SplitParagraph:function(a,c){var b=c.position,d=a.position+a.length,f=[a],e=[c];a.position<=b&&b<=d?(e=[],a.length+=1):(d<c.sourceParagraphPosition&&(c.sourceParagraphPosition-=a.length+2),d<b?c.position-=a.length+2:a.position+=1);return{opSpecsA:f,opSpecsB:e}},UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:d},RemoveCursor:{RemoveCursor:function(a,
c){var b=a.memberid===c.memberid;return{opSpecsA:b?[]:[a],opSpecsB:b?[]:[c]}},RemoveMember:d,RemoveStyle:d,RemoveText:d,SetParagraphStyle:d,SplitParagraph:d,UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:d},RemoveMember:{RemoveStyle:d,RemoveText:d,SetParagraphStyle:d,SplitParagraph:d,UpdateMetadata:d,UpdateParagraphStyle:d},RemoveStyle:{RemoveStyle:function(a,c){var b=a.styleName===c.styleName&&a.styleFamily===c.styleFamily;return{opSpecsA:b?[]:[a],opSpecsB:b?[]:[c]}},RemoveText:d,SetParagraphStyle:function(a,
c){var b,d=[a],f=[c];"paragraph"===a.styleFamily&&a.styleName===c.styleName&&(b={optype:"SetParagraphStyle",memberid:a.memberid,timestamp:a.timestamp,position:c.position,styleName:""},d.unshift(b),c.styleName="");return{opSpecsA:d,opSpecsB:f}},SplitParagraph:d,UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:function(a,c){var d,f=[a],e=[c];"paragraph"===a.styleFamily&&(d=h(c.setProperties,a.styleName),0<d.length&&(d={optype:"UpdateParagraphStyle",memberid:a.memberid,timestamp:a.timestamp,styleName:c.styleName,
removedProperties:{attributes:d.join(",")}},f.unshift(d)),a.styleName===c.styleName?e=[]:b(c.setProperties,a.styleName));return{opSpecsA:f,opSpecsB:e}}},RemoveText:{RemoveText:function(a,c){var b=a.position+a.length,d=c.position+c.length,f=[a],e=[c];d<=a.position?a.position-=c.length:b<=c.position?c.position-=a.length:c.position<b&&(a.position<c.position?(a.length=d<b?a.length-c.length:c.position-a.position,b<d?(c.position=a.position,c.length=d-b):e=[]):(b<d?c.length-=a.length:c.position<a.position?
c.length=a.position-c.position:e=[],d<b?(a.position=c.position,a.length=b-d):f=[]));return{opSpecsA:f,opSpecsB:e}},SetParagraphStyle:function(a,c){a.position<c.position&&(c.position-=a.length);return{opSpecsA:[a],opSpecsB:[c]}},SplitParagraph:function(a,c){var b=a.position+a.length,d=[a],f=[c];c.position<=a.position?a.position+=1:c.position<b&&(a.length=c.position-a.position,b={optype:"RemoveText",memberid:a.memberid,timestamp:a.timestamp,position:c.position+1,length:b-c.position},d.unshift(b));a.position+
a.length<=c.position?c.position-=a.length:a.position<c.position&&(c.position=a.position);a.position+a.length<c.sourceParagraphPosition&&(c.sourceParagraphPosition-=a.length);return{opSpecsA:d,opSpecsB:f}},UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:d},SetParagraphStyle:{SetParagraphStyle:function(a,c,b){a.position===c.position&&(b?c.styleName=a.styleName:a.styleName=c.styleName);return{opSpecsA:[a],opSpecsB:[c]}},SplitParagraph:function(a,c){var b=[a],d=[c],e;a.position>c.position?a.position+=
1:a.position===c.sourceParagraphPosition&&(c.paragraphStyleName=a.styleName,e=f(a),e.position=c.position+1,b.push(e));return{opSpecsA:b,opSpecsB:d}},UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:d},SplitParagraph:{SplitParagraph:function(a,c,b){var d,f;a.position<c.position?d=!0:c.position<a.position?f=!0:a.position===c.position&&(b?d=!0:f=!0);d?(c.position+=1,c.sourceParagraphPosition=a.position<c.sourceParagraphPosition?c.sourceParagraphPosition+1:a.position+1):f&&(a.position+=1,a.sourceParagraphPosition=
c.position<c.sourceParagraphPosition?a.sourceParagraphPosition+1:c.position+1);return{opSpecsA:[a],opSpecsB:[c]}},UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:d},UpdateMember:{UpdateMetadata:d,UpdateParagraphStyle:d},UpdateMetadata:{UpdateMetadata:function(a,c,b){var d,f=[a],e=[c];d=b?a:c;a=b?c:a;g(a.setProperties||null,a.removedProperties||null,d.setProperties||null,d.removedProperties||null);d.setProperties&&l(d.setProperties)||d.removedProperties&&q(d.removedProperties)||(b?f=[]:e=[]);
a.setProperties&&l(a.setProperties)||a.removedProperties&&q(a.removedProperties)||(b?e=[]:f=[]);return{opSpecsA:f,opSpecsB:e}},UpdateParagraphStyle:d},UpdateParagraphStyle:{UpdateParagraphStyle:function(a,c,b){var d,f=[a],e=[c];a.styleName===c.styleName&&(d=b?a:c,a=b?c:a,p(a.setProperties,a.removedProperties,d.setProperties,d.removedProperties,"style:paragraph-properties"),p(a.setProperties,a.removedProperties,d.setProperties,d.removedProperties,"style:text-properties"),g(a.setProperties||null,a.removedProperties||
null,d.setProperties||null,d.removedProperties||null),d.setProperties&&l(d.setProperties)||d.removedProperties&&q(d.removedProperties)||(b?f=[]:e=[]),a.setProperties&&l(a.setProperties)||a.removedProperties&&q(a.removedProperties)||(b?e=[]:f=[]));return{opSpecsA:f,opSpecsB:e}}}};this.passUnchanged=d;this.extendTransformations=function(a){Object.keys(a).forEach(function(b){var d=a[b],f,e=n.hasOwnProperty(b);runtime.log((e?"Extending":"Adding")+" map for optypeA: "+b);e||(n[b]={});f=n[b];Object.keys(d).forEach(function(a){var e=
f.hasOwnProperty(a);runtime.assert(b<=a,"Wrong order:"+b+", "+a);runtime.log("  "+(e?"Overwriting":"Adding")+" entry for optypeB: "+a);f[a]=d[a]})})};this.transformOpspecVsOpspec=function(a,b){var d=a.optype<=b.optype,f;runtime.log("Crosstransforming:");runtime.log(runtime.toJson(a));runtime.log(runtime.toJson(b));d||(f=a,a=b,b=f);(f=(f=n[a.optype])&&f[b.optype])?(f=f(a,b,!d),d||null===f||(f={opSpecsA:f.opSpecsB,opSpecsB:f.opSpecsA})):f=null;runtime.log("result:");f?(runtime.log(runtime.toJson(f.opSpecsA)),
runtime.log(runtime.toJson(f.opSpecsB))):runtime.log("null");return f}};
ops.OperationTransformer=function(){function m(h,b){for(var f,g,l=[],q=[];0<h.length&&b;){f=h.shift();f=e.transformOpspecVsOpspec(f,b);if(!f)return null;l=l.concat(f.opSpecsA);if(0===f.opSpecsB.length){l=l.concat(h);b=null;break}for(;1<f.opSpecsB.length;){g=m(h,f.opSpecsB.shift());if(!g)return null;q=q.concat(g.opSpecsB);h=g.opSpecsA}b=f.opSpecsB.pop()}b&&q.push(b);return{opSpecsA:l,opSpecsB:q}}var e=new ops.OperationTransformMatrix;this.getOperationTransformMatrix=function(){return e};this.transform=
function(e,b){for(var f,g=[];0<b.length;){f=m(e,b.shift());if(!f)return null;e=f.opSpecsA;g=g.concat(f.opSpecsB)}return{opSpecsA:e,opSpecsB:g}}};var webodf_css='@namespace draw url(urn:oasis:names:tc:opendocument:xmlns:drawing:1.0);@namespace fo url(urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0);@namespace office url(urn:oasis:names:tc:opendocument:xmlns:office:1.0);@namespace presentation url(urn:oasis:names:tc:opendocument:xmlns:presentation:1.0);@namespace style url(urn:oasis:names:tc:opendocument:xmlns:style:1.0);@namespace svg url(urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0);@namespace table url(urn:oasis:names:tc:opendocument:xmlns:table:1.0);@namespace text url(urn:oasis:names:tc:opendocument:xmlns:text:1.0);@namespace webodfhelper url(urn:webodf:names:helper);@namespace cursor url(urn:webodf:names:cursor);@namespace editinfo url(urn:webodf:names:editinfo);@namespace annotation url(urn:webodf:names:annotation);@namespace dc url(http://purl.org/dc/elements/1.1/);@namespace svgns url(http://www.w3.org/2000/svg);office|document > *, office|document-content > * {display: none;}office|body, office|document {display: inline-block;position: relative;}text|p, text|h {display: block;padding: 0;margin: 0;line-height: normal;position: relative;}text|p::after, text|h::after {content: "\\200B";white-space: pre;}*[webodfhelper|containsparagraphanchor] {position: relative;}text|s {white-space: pre;}text|tab {display: inline;white-space: pre;}text|tracked-changes {display: none;}office|binary-data {display: none;}office|text {display: block;text-align: left;overflow: visible;word-wrap: break-word;}office|text::selection {background: transparent;}.webodf-virtualSelections *::selection {background: transparent;}.webodf-virtualSelections *::-moz-selection {background: transparent;}office|text * draw|text-box {display: block;border: 1px solid #d3d3d3;}office|text draw|frame {z-index: 1;}office|spreadsheet {display: block;border-collapse: collapse;empty-cells: show;font-family: sans-serif;font-size: 10pt;text-align: left;page-break-inside: avoid;overflow: hidden;}office|presentation {display: inline-block;text-align: left;}#shadowContent {display: inline-block;text-align: left;}draw|page {display: block;position: relative;overflow: hidden;}presentation|notes, presentation|footer-decl, presentation|date-time-decl {display: none;}@media print {draw|page {border: 1pt solid black;page-break-inside: avoid;}presentation|notes {}}office|spreadsheet text|p {border: 0px;padding: 1px;margin: 0px;}office|spreadsheet table|table {margin: 3px;}office|spreadsheet table|table:after {}office|spreadsheet table|table-row {counter-increment: row;}office|spreadsheet table|table-row:before {width: 3em;background: #cccccc;border: 1px solid black;text-align: center;content: counter(row);display: table-cell;}office|spreadsheet table|table-cell {border: 1px solid #cccccc;}table|table {display: table;}draw|frame table|table {width: 100%;height: 100%;background: white;}table|table-header-rows {display: table-header-group;}table|table-row {display: table-row;}table|table-column {display: table-column;}table|table-cell {width: 0.889in;display: table-cell;word-break: break-all;}draw|frame {display: block;}draw|image {display: block;width: 100%;height: 100%;top: 0px;left: 0px;background-repeat: no-repeat;background-size: 100% 100%;-moz-background-size: 100% 100%;}draw|frame > draw|image:nth-of-type(n+2) {display: none;}text|list:before {display: none;content:"";}text|list {display: block;}text|list-item {display: block;}text|number {display:none;}text|a {color: blue;text-decoration: underline;cursor: pointer;}.webodf-inactiveLinks text|a {cursor: text;}text|note-citation {vertical-align: super;font-size: smaller;}text|note-body {display: none;}text|note:hover text|note-citation {background: #dddddd;}text|note:hover text|note-body {display: block;left:1em;max-width: 80%;position: absolute;background: #ffffaa;}text|bibliography-source {display: none;}svg|title, svg|desc {display: none;}video {width: 100%;height: 100%}cursor|anchor {display: none;}cursor|cursor {display: none;}.webodf-caretOverlay {position: absolute;top: 5%;height: 1em;z-index: 10;padding-left: 1px;pointer-events: none;}.webodf-caretOverlay .caret {position: absolute;border-left: 2px solid black;top: 0;bottom: 0;right: 0;}.webodf-caretOverlay .handle {position: absolute;margin-top: 5px;padding-top: 3px;margin-left: auto;margin-right: auto;width: 64px;height: 68px;border-radius: 5px;opacity: 0.3;text-align: center;background-color: black;box-shadow: 0px 0px 5px rgb(90, 90, 90);border: 1px solid black;top: -85px;right: -32px;}.webodf-caretOverlay .handle > img {box-shadow: 0px 0px 5px rgb(90, 90, 90) inset;background-color: rgb(200, 200, 200);border-radius: 5px;border: 2px solid;height: 60px;width: 60px;display: block;margin: auto;}.webodf-caretOverlay .handle.active {opacity: 0.8;}.webodf-caretOverlay .handle:after {content: " ";position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: black transparent transparent transparent;top: 100%;left: 43%;}.webodf-caretSizer {display: inline-block;width: 0;visibility: hidden;}#eventTrap {display: block;position: absolute;bottom: 0;left: 0;outline: none;opacity: 0;color: rgba(255, 255, 255, 0);pointer-events: none;white-space: pre;overflow: hidden;}cursor|cursor > #composer {text-decoration: underline;}cursor|cursor[cursor|caret-sizer-active="true"],cursor|cursor[cursor|composing="true"] {display: inline;}editinfo|editinfo {display: inline-block;}.editInfoMarker {position: absolute;width: 10px;height: 100%;left: -20px;opacity: 0.8;top: 0;border-radius: 5px;background-color: transparent;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);}.editInfoMarker:hover {box-shadow: 0px 0px 8px rgba(0, 0, 0, 1);}.editInfoHandle {position: absolute;background-color: black;padding: 5px;border-radius: 5px;opacity: 0.8;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);bottom: 100%;margin-bottom: 10px;z-index: 3;left: -25px;}.editInfoHandle:after {content: " ";position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: black transparent transparent transparent;top: 100%;left: 5px;}.editInfo {font-family: sans-serif;font-weight: normal;font-style: normal;text-decoration: none;color: white;width: 100%;height: 12pt;}.editInfoColor {float: left;width: 10pt;height: 10pt;border: 1px solid white;}.editInfoAuthor {float: left;margin-left: 5pt;font-size: 10pt;text-align: left;height: 12pt;line-height: 12pt;}.editInfoTime {float: right;margin-left: 30pt;font-size: 8pt;font-style: italic;color: yellow;height: 12pt;line-height: 12pt;}.annotationWrapper {display: inline;position: relative;}.annotationRemoveButton:before {content: "\u00d7";color: white;padding: 5px;line-height: 1em;}.annotationRemoveButton {width: 20px;height: 20px;border-radius: 10px;background-color: black;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);position: absolute;top: -10px;left: -10px;z-index: 3;text-align: center;font-family: sans-serif;font-style: normal;font-weight: normal;text-decoration: none;font-size: 15px;}.annotationRemoveButton:hover {cursor: pointer;box-shadow: 0px 0px 5px rgba(0, 0, 0, 1);}.annotationNote {width: 4cm;position: absolute;display: inline;z-index: 10;top: 0;}.annotationNote > office|annotation {display: block;text-align: left;}.annotationConnector {position: absolute;display: inline;top: 0;z-index: 2;border-top: 1px dashed brown;}.annotationConnector.angular {-moz-transform-origin: left top;-webkit-transform-origin: left top;-ms-transform-origin: left top;transform-origin: left top;}.annotationConnector.horizontal {left: 0;}.annotationConnector.horizontal:before {content: "";display: inline;position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: brown transparent transparent transparent;top: -1px;left: -5px;}office|annotation {width: 100%;height: 100%;display: none;background: rgb(198, 238, 184);background: -moz-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -webkit-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -o-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -ms-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: linear-gradient(180deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);box-shadow: 0 3px 4px -3px #ccc;}office|annotation > dc|creator {display: block;font-size: 10pt;font-weight: normal;font-style: normal;font-family: sans-serif;color: white;background-color: brown;padding: 4px;}office|annotation > dc|date {display: block;font-size: 10pt;font-weight: normal;font-style: normal;font-family: sans-serif;border: 4px solid transparent;color: black;}office|annotation > text|list {display: block;padding: 5px;}office|annotation text|p {font-size: 10pt;color: black;font-weight: normal;font-style: normal;text-decoration: none;font-family: sans-serif;}#annotationsPane {background-color: #EAEAEA;width: 4cm;height: 100%;display: none;position: absolute;outline: 1px solid #ccc;}.webodf-annotationHighlight {background-color: yellow;position: relative;}.webodf-selectionOverlay {position: absolute;pointer-events: none;top: 0;left: 0;top: 0;left: 0;width: 100%;height: 100%;z-index: 15;}.webodf-selectionOverlay > polygon {fill-opacity: 0.3;stroke-opacity: 0.8;stroke-width: 1;fill-rule: evenodd;}.webodf-selectionOverlay > .webodf-draggable {fill-opacity: 0.8;stroke-opacity: 0;stroke-width: 8;pointer-events: all;display: none;-moz-transform-origin: center center;-webkit-transform-origin: center center;-ms-transform-origin: center center;transform-origin: center center;}#imageSelector {display: none;position: absolute;border-style: solid;border-color: black;}#imageSelector > div {width: 5px;height: 5px;display: block;position: absolute;border: 1px solid black;background-color: #ffffff;}#imageSelector > .topLeft {top: -4px;left: -4px;}#imageSelector > .topRight {top: -4px;right: -4px;}#imageSelector > .bottomRight {right: -4px;bottom: -4px;}#imageSelector > .bottomLeft {bottom: -4px;left: -4px;}#imageSelector > .topMiddle {top: -4px;left: 50%;margin-left: -2.5px;}#imageSelector > .rightMiddle {top: 50%;right: -4px;margin-top: -2.5px;}#imageSelector > .bottomMiddle {bottom: -4px;left: 50%;margin-left: -2.5px;}#imageSelector > .leftMiddle {top: 50%;left: -4px;margin-top: -2.5px;}div.webodf-customScrollbars::-webkit-scrollbar{width: 8px;height: 8px;background-color: transparent;}div.webodf-customScrollbars::-webkit-scrollbar-track{background-color: transparent;}div.webodf-customScrollbars::-webkit-scrollbar-thumb{background-color: #444;border-radius: 4px;}.webodf-hyperlinkTooltip {display: none;color: white;background-color: black;border-radius: 5px;box-shadow: 2px 2px 5px gray;padding: 3px;position: absolute;max-width: 210px;text-align: left;word-break: break-all;z-index: 16;}.webodf-hyperlinkTooltipText {display: block;font-weight: bold;}';
!function(m){var e="undefined"!==typeof window?window:"undefined"!==typeof global?global:{};(e.externs||(e.externs={})).JSZip=m()}(function(){return function e(h,b,f){function g(q,d){if(!b[q]){if(!h[q]){var n="function"==typeof require&&require;if(!d&&n)return n(q,!0);if(l)return l(q,!0);throw Error("Cannot find module '"+q+"'");}n=b[q]={exports:{}};h[q][0].call(n.exports,function(a){var b=h[q][1][a];return g(b?b:a)},n,n.exports,e,h,b,f)}return b[q].exports}for(var l="function"==typeof require&&require,
q=0;q<f.length;q++)g(f[q]);return g}({1:[function(e,h,b){b.encode=function(b,e){for(var l="",h,p,d,n,a,c,k=0;k<b.length;)h=b.charCodeAt(k++),p=b.charCodeAt(k++),d=b.charCodeAt(k++),n=h>>2,h=(h&3)<<4|p>>4,a=(p&15)<<2|d>>6,c=d&63,isNaN(p)?a=c=64:isNaN(d)&&(c=64),l=l+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(n)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(a)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c);
return l};b.decode=function(b,e){var l="",h,p,d,n,a,c=0;for(b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<b.length;)h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(c++)),p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(c++)),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(c++)),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(c++)),h=h<<2|p>>4,p=(p&15)<<
4|n>>2,d=(n&3)<<6|a,l+=String.fromCharCode(h),64!=n&&(l+=String.fromCharCode(p)),64!=a&&(l+=String.fromCharCode(d));return l}},{}],2:[function(e,h,b){function f(){this.crc32=this.uncompressedSize=this.compressedSize=0;this.compressedContent=this.compressionMethod=null}f.prototype={getContent:function(){return null},getCompressedContent:function(){return null}};h.exports=f},{}],3:[function(e,h,b){b.STORE={magic:"\x00\x00",compress:function(b){return b},uncompress:function(b){return b},compressInputType:null,
uncompressInputType:null};b.DEFLATE=e("./flate")},{"./flate":8}],4:[function(e,h,b){var f=e("./utils"),g=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,
3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,
453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,
3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,
1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,
1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];h.exports=function(b,e){if("undefined"===typeof b||!b.length)return 0;var h="string"!==f.getTypeOf(b);"undefined"==typeof e&&(e=0);var d=0,d=d=0;e^=-1;for(var n=0,a=b.length;n<a;n++)d=
h?b[n]:b.charCodeAt(n),d=(e^d)&255,d=g[d],e=e>>>8^d;return e^-1}},{"./utils":21}],5:[function(e,h,b){function f(b){this.data=null;this.index=this.length=0}var g=e("./utils");f.prototype={checkOffset:function(b){this.checkIndex(this.index+b)},checkIndex:function(b){if(this.length<b||0>b)throw Error("End of data reached (data length = "+this.length+", asked index = "+b+"). Corrupted zip ?");},setIndex:function(b){this.checkIndex(b);this.index=b},skip:function(b){this.setIndex(this.index+b)},byteAt:function(b){},
readInt:function(b){var f=0,e;this.checkOffset(b);for(e=this.index+b-1;e>=this.index;e--)f=(f<<8)+this.byteAt(e);this.index+=b;return f},readString:function(b){return g.transformTo("string",this.readData(b))},readData:function(b){},lastIndexOfSignature:function(b){},readDate:function(){var b=this.readInt(4);return new Date((b>>25&127)+1980,(b>>21&15)-1,b>>16&31,b>>11&31,b>>5&63,(b&31)<<1)}};h.exports=f},{"./utils":21}],6:[function(e,h,b){b.base64=!1;b.binary=!1;b.dir=!1;b.createFolders=!1;b.date=
null;b.compression=null;b.comment=null},{}],7:[function(e,h,b){var f=e("./utils");b.string2binary=function(b){return f.string2binary(b)};b.string2Uint8Array=function(b){return f.transformTo("uint8array",b)};b.uint8Array2String=function(b){return f.transformTo("string",b)};b.string2Blob=function(b){b=f.transformTo("arraybuffer",b);return f.arrayBuffer2Blob(b)};b.arrayBuffer2Blob=function(b){return f.arrayBuffer2Blob(b)};b.transformTo=function(b,e){return f.transformTo(b,e)};b.getTypeOf=function(b){return f.getTypeOf(b)};
b.checkSupport=function(b){return f.checkSupport(b)};b.MAX_VALUE_16BITS=f.MAX_VALUE_16BITS;b.MAX_VALUE_32BITS=f.MAX_VALUE_32BITS;b.pretty=function(b){return f.pretty(b)};b.findCompression=function(b){return f.findCompression(b)};b.isRegExp=function(b){return f.isRegExp(b)}},{"./utils":21}],8:[function(e,h,b){h="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array;var f=e("pako");b.uncompressInputType=h?"uint8array":"array";b.compressInputType=h?"uint8array":
"array";b.magic="\b\x00";b.compress=function(b){return f.deflateRaw(b)};b.uncompress=function(b){return f.inflateRaw(b)}},{pako:24}],9:[function(e,h,b){function f(b,e){if(!(this instanceof f))return new f(b,e);this.files={};this.comment=null;this.root="";b&&this.load(b,e);this.clone=function(){var b=new f,d;for(d in this)"function"!==typeof this[d]&&(b[d]=this[d]);return b}}var g=e("./base64");f.prototype=e("./object");f.prototype.load=e("./load");f.support=e("./support");f.defaults=e("./defaults");
f.utils=e("./deprecatedPublicUtils");f.base64={encode:function(b){return g.encode(b)},decode:function(b){return g.decode(b)}};f.compressions=e("./compressions");h.exports=f},{"./base64":1,"./compressions":3,"./defaults":6,"./deprecatedPublicUtils":7,"./load":10,"./object":13,"./support":17}],10:[function(e,h,b){var f=e("./base64"),g=e("./zipEntries");h.exports=function(b,e){var h,d,n,a;e=e||{};e.base64&&(b=f.decode(b));d=new g(b,e);h=d.files;for(n=0;n<h.length;n++)a=h[n],this.file(a.fileName,a.decompressed,
{binary:!0,optimizedBinaryString:!0,date:a.date,dir:a.dir,comment:a.fileComment.length?a.fileComment:null,createFolders:e.createFolders});d.zipComment.length&&(this.comment=d.zipComment);return this}},{"./base64":1,"./zipEntries":22}],11:[function(e,h,b){(function(b){h.exports=function(e,h){return new b(e,h)};h.exports.test=function(e){return b.isBuffer(e)}}).call(this,"undefined"!==typeof Buffer?Buffer:void 0)},{}],12:[function(e,h,b){function f(b){this.data=b;this.length=this.data.length;this.index=
0}e=e("./uint8ArrayReader");f.prototype=new e;f.prototype.readData=function(b){this.checkOffset(b);var f=this.data.slice(this.index,this.index+b);this.index+=b;return f};h.exports=f},{"./uint8ArrayReader":18}],13:[function(e,h,b){var f=e("./support"),g=e("./utils"),l=e("./crc32"),q=e("./signature"),p=e("./defaults"),d=e("./base64"),n=e("./compressions"),a=e("./compressedObject"),c=e("./nodeBuffer"),k=e("./utf8"),r=e("./stringWriter"),B=e("./uint8ArrayWriter"),y=function(b){if(b._data instanceof a&&
(b._data=b._data.getContent(),b.options.binary=!0,b.options.base64=!1,"uint8array"===g.getTypeOf(b._data))){var c=b._data;b._data=new Uint8Array(c.length);0!==c.length&&b._data.set(c,0)}return b._data},z=function(a){var b=y(a);return"string"===g.getTypeOf(b)?!a.options.binary&&f.nodebuffer?c(b,"utf-8"):a.asBinary():b},v=function(a){var b=y(this);if(null===b||"undefined"===typeof b)return"";this.options.base64&&(b=d.decode(b));b=a&&this.options.binary?D.utf8decode(b):g.transformTo("string",b);a||this.options.binary||
(b=g.transformTo("string",D.utf8encode(b)));return b},A=function(a,b,c){this.name=a;this.dir=c.dir;this.date=c.date;this.comment=c.comment;this._data=b;this.options=c;this._initialMetadata={dir:c.dir,date:c.date}};A.prototype={asText:function(){return v.call(this,!0)},asBinary:function(){return v.call(this,!1)},asNodeBuffer:function(){var a=z(this);return g.transformTo("nodebuffer",a)},asUint8Array:function(){var a=z(this);return g.transformTo("uint8array",a)},asArrayBuffer:function(){return this.asUint8Array().buffer}};
var t=function(a,b){var c="",d;for(d=0;d<b;d++)c+=String.fromCharCode(a&255),a>>>=8;return c},w=function(){var a={},b,c;for(b=0;b<arguments.length;b++)for(c in arguments[b])arguments[b].hasOwnProperty(c)&&"undefined"===typeof a[c]&&(a[c]=arguments[b][c]);return a},H=function(b,c,d){var f=g.getTypeOf(c),e;d=d||{};!0!==d.base64||null!==d.binary&&void 0!==d.binary||(d.binary=!0);d=w(d,p);d.date=d.date||new Date;null!==d.compression&&(d.compression=d.compression.toUpperCase());var k;if(k=d.createFolders)e=
b,"/"==e.slice(-1)&&(e=e.substring(0,e.length-1)),k=e.lastIndexOf("/"),k=e=0<k?e.substring(0,k):"";k&&I.call(this,e,!0);if(d.dir||null===c||"undefined"===typeof c)d.base64=!1,d.binary=!1,c=null;else if("string"===f)d.binary&&!d.base64&&!0!==d.optimizedBinaryString&&(c=g.string2binary(c));else{d.base64=!1;d.binary=!0;if(!(f||c instanceof a))throw Error("The data of '"+b+"' is in an unsupported format !");"arraybuffer"===f&&(c=g.transformTo("uint8array",c))}c=new A(b,c,d);return this.files[b]=c},I=
function(a,b){"/"!=a.slice(-1)&&(a+="/");this.files[a]||H.call(this,a,null,{dir:!0,createFolders:"undefined"!==typeof b?b:!1});return this.files[a]},D={load:function(a,b){throw Error("Load method is not defined. Is the file jszip-load.js included ?");},filter:function(a){var b=[],c,d,f;for(c in this.files)this.files.hasOwnProperty(c)&&(d=this.files[c],f=new A(d.name,d._data,w(d.options)),d=c.slice(this.root.length,c.length),c.slice(0,this.root.length)===this.root&&a(d,f)&&b.push(f));return b},file:function(a,
b,c){if(1===arguments.length){if(g.isRegExp(a)){var d=a;return this.filter(function(a,b){return!b.dir&&d.test(a)})}return this.filter(function(b,c){return!c.dir&&b===a})[0]||null}a=this.root+a;H.call(this,a,b,c);return this},folder:function(a){if(!a)return this;if(g.isRegExp(a))return this.filter(function(b,c){return c.dir&&a.test(b)});var b=I.call(this,this.root+a),c=this.clone();c.root=b.name;return c},remove:function(a){a=this.root+a;var b=this.files[a];b||("/"!=a.slice(-1)&&(a+="/"),b=this.files[a]);
if(b&&!b.dir)delete this.files[a];else for(var b=this.filter(function(b,c){return c.name.slice(0,a.length)===a}),c=0;c<b.length;c++)delete this.files[b[c].name];return this},generate:function(b){b=w(b||{},{base64:!0,compression:"STORE",type:"base64",comment:null});g.checkSupport(b.type);var c=[],f=0,e=0,h=g.transformTo("string",this.utf8encode(b.comment||this.comment||"")),p;for(p in this.files)if(this.files.hasOwnProperty(p)){var v=this.files[p],y=v.options.compression||b.compression.toUpperCase(),
A=n[y];if(!A)throw Error(y+" is not a valid compression method !");var y=v,E=new a,I=void 0;if(y._data instanceof a)E.uncompressedSize=y._data.uncompressedSize,E.crc32=y._data.crc32,0===E.uncompressedSize||y.dir?(A=n.STORE,E.compressedContent="",E.crc32=0):y._data.compressionMethod===A.magic?E.compressedContent=y._data.getCompressedContent():(I=y._data.getContent(),E.compressedContent=A.compress(g.transformTo(A.compressInputType,I)));else{I=z(y);if(!I||0===I.length||y.dir)A=n.STORE,I="";E.uncompressedSize=
I.length;E.crc32=l(I);E.compressedContent=A.compress(g.transformTo(A.compressInputType,I))}E.compressedSize=E.compressedContent.length;E.compressionMethod=A.magic;var y=E,D=v,v=y,A=f,E=g.transformTo("string",k.utf8encode(D.name)),U=D.comment||"",I=g.transformTo("string",k.utf8encode(U)),W=E.length!==D.name.length,K=I.length!==U.length,H=D.options,Y=void 0,S=void 0,$=U="",$="",X=void 0,$=void 0,X=D._initialMetadata.dir!==D.dir?D.dir:H.dir,$=D._initialMetadata.date!==D.date?D.date:H.date,Y=$.getHours(),
Y=Y<<6,Y=Y|$.getMinutes(),Y=Y<<5,Y=Y|$.getSeconds()/2,S=$.getFullYear()-1980,S=S<<4,S=S|$.getMonth()+1,S=S<<5,S=S|$.getDate();W&&($=t(1,1)+t(l(E),4)+E,U+="up"+t($.length,2)+$);K&&($=t(1,1)+t(this.crc32(I),4)+I,U+="uc"+t($.length,2)+$);D="";D+="\n\x00";D+=W||K?"\x00\b":"\x00\x00";D+=v.compressionMethod;D+=t(Y,2);D+=t(S,2);D+=t(v.crc32,4);D+=t(v.compressedSize,4);D+=t(v.uncompressedSize,4);D+=t(E.length,2);D+=t(U.length,2);W=q.LOCAL_FILE_HEADER+D+E+U;A=q.CENTRAL_FILE_HEADER+"\u0014\x00"+D+t(I.length,
2)+"\x00\x00\x00\x00"+(!0===X?"\u0010\x00\x00\x00":"\x00\x00\x00\x00")+t(A,4)+E+U+I;v={fileRecord:W,dirRecord:A,compressedObject:v};f+=v.fileRecord.length+y.compressedSize;e+=v.dirRecord.length;c.push(v)}p="";p=q.CENTRAL_DIRECTORY_END+"\x00\x00\x00\x00"+t(c.length,2)+t(c.length,2)+t(e,4)+t(f,4)+t(h.length,2)+h;h=b.type.toLowerCase();f="uint8array"===h||"arraybuffer"===h||"blob"===h||"nodebuffer"===h?new B(f+e+p.length):new r(f+e+p.length);for(e=0;e<c.length;e++)f.append(c[e].fileRecord),f.append(c[e].compressedObject.compressedContent);
for(e=0;e<c.length;e++)f.append(c[e].dirRecord);f.append(p);c=f.finalize();switch(b.type.toLowerCase()){case "uint8array":case "arraybuffer":case "nodebuffer":return g.transformTo(b.type.toLowerCase(),c);case "blob":return g.arrayBuffer2Blob(g.transformTo("arraybuffer",c));case "base64":return b.base64?d.encode(c):c;default:return c}},crc32:function(a,b){return l(a,b)},utf8encode:function(a){return g.transformTo("string",k.utf8encode(a))},utf8decode:function(a){return k.utf8decode(a)}};h.exports=
D},{"./base64":1,"./compressedObject":2,"./compressions":3,"./crc32":4,"./defaults":6,"./nodeBuffer":11,"./signature":14,"./stringWriter":16,"./support":17,"./uint8ArrayWriter":19,"./utf8":20,"./utils":21}],14:[function(e,h,b){b.LOCAL_FILE_HEADER="PK\u0003\u0004";b.CENTRAL_FILE_HEADER="PK\u0001\u0002";b.CENTRAL_DIRECTORY_END="PK\u0005\u0006";b.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\u0006\u0007";b.ZIP64_CENTRAL_DIRECTORY_END="PK\u0006\u0006";b.DATA_DESCRIPTOR="PK\u0007\b"},{}],15:[function(e,h,b){function f(b,
f){this.data=b;f||(this.data=g.string2binary(this.data));this.length=this.data.length;this.index=0}b=e("./dataReader");var g=e("./utils");f.prototype=new b;f.prototype.byteAt=function(b){return this.data.charCodeAt(b)};f.prototype.lastIndexOfSignature=function(b){return this.data.lastIndexOf(b)};f.prototype.readData=function(b){this.checkOffset(b);var f=this.data.slice(this.index,this.index+b);this.index+=b;return f};h.exports=f},{"./dataReader":5,"./utils":21}],16:[function(e,h,b){var f=e("./utils");
e=function(){this.data=[]};e.prototype={append:function(b){b=f.transformTo("string",b);this.data.push(b)},finalize:function(){return this.data.join("")}};h.exports=e},{"./utils":21}],17:[function(e,h,b){e="undefined"!==typeof Buffer?Buffer:void 0;b.base64=!0;b.array=!0;b.string=!0;b.arraybuffer="undefined"!==typeof ArrayBuffer&&"undefined"!==typeof Uint8Array;b.nodebuffer="undefined"!==typeof e;b.uint8array="undefined"!==typeof Uint8Array;if("undefined"===typeof ArrayBuffer)b.blob=!1;else{e=new ArrayBuffer(0);
try{b.blob=0===(new Blob([e],{type:"application/zip"})).size}catch(f){try{var g=new (window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);g.append(e);b.blob=0===g.getBlob("application/zip").size}catch(l){b.blob=!1}}}},{}],18:[function(e,h,b){function f(b){b&&(this.data=b,this.length=this.data.length,this.index=0)}e=e("./dataReader");f.prototype=new e;f.prototype.byteAt=function(b){return this.data[b]};f.prototype.lastIndexOfSignature=function(b){var f=b.charCodeAt(0),
e=b.charCodeAt(1),h=b.charCodeAt(2);b=b.charCodeAt(3);for(var d=this.length-4;0<=d;--d)if(this.data[d]===f&&this.data[d+1]===e&&this.data[d+2]===h&&this.data[d+3]===b)return d;return-1};f.prototype.readData=function(b){this.checkOffset(b);if(0===b)return new Uint8Array(0);var f=this.data.subarray(this.index,this.index+b);this.index+=b;return f};h.exports=f},{"./dataReader":5}],19:[function(e,h,b){var f=e("./utils");e=function(b){this.data=new Uint8Array(b);this.index=0};e.prototype={append:function(b){0!==
b.length&&(b=f.transformTo("uint8array",b),this.data.set(b,this.index),this.index+=b.length)},finalize:function(){return this.data}};h.exports=e},{"./utils":21}],20:[function(e,h,b){var f=e("./utils"),g=e("./support"),l=e("./nodeBuffer"),q=Array(256);for(e=0;256>e;e++)q[e]=252<=e?6:248<=e?5:240<=e?4:224<=e?3:192<=e?2:1;q[254]=q[254]=1;var p=function(b){var e,a,c,k,g=b.length,h=Array(2*g);for(e=a=0;e<g;)if(c=b[e++],128>c)h[a++]=c;else if(k=q[c],4<k)h[a++]=65533,e+=k-1;else{for(c&=2===k?31:3===k?15:
7;1<k&&e<g;)c=c<<6|b[e++]&63,k--;1<k?h[a++]=65533:65536>c?h[a++]=c:(c-=65536,h[a++]=55296|c>>10&1023,h[a++]=56320|c&1023)}h.length!==a&&(h.subarray?h=h.subarray(0,a):h.length=a);return f.applyFromCharCode(h)};b.utf8encode=function(b){if(g.nodebuffer)return l(b,"utf-8");var f,a,c,e,h,q=b.length,p=0;for(e=0;e<q;e++)a=b.charCodeAt(e),55296===(a&64512)&&e+1<q&&(c=b.charCodeAt(e+1),56320===(c&64512)&&(a=65536+(a-55296<<10)+(c-56320),e++)),p+=128>a?1:2048>a?2:65536>a?3:4;f=g.uint8array?new Uint8Array(p):
Array(p);for(e=h=0;h<p;e++)a=b.charCodeAt(e),55296===(a&64512)&&e+1<q&&(c=b.charCodeAt(e+1),56320===(c&64512)&&(a=65536+(a-55296<<10)+(c-56320),e++)),128>a?f[h++]=a:(2048>a?f[h++]=192|a>>>6:(65536>a?f[h++]=224|a>>>12:(f[h++]=240|a>>>18,f[h++]=128|a>>>12&63),f[h++]=128|a>>>6&63),f[h++]=128|a&63);return f};b.utf8decode=function(b){if(g.nodebuffer)return f.transformTo("nodebuffer",b).toString("utf-8");b=f.transformTo(g.uint8array?"uint8array":"array",b);for(var e=[],a=0,c=b.length;a<c;){var k;k=Math.min(a+
65536,c);var h=void 0;k=k||b.length;k>b.length&&(k=b.length);for(h=k-1;0<=h&&128===(b[h]&192);)h--;k=0>h?k:0===h?k:h+q[b[h]]>k?h:k;g.uint8array?e.push(p(b.subarray(a,k))):e.push(p(b.slice(a,k)));a=k}return e.join("")}},{"./nodeBuffer":11,"./support":17,"./utils":21}],21:[function(e,h,b){function f(a){return a}function g(a,b){for(var d=0;d<a.length;++d)b[d]=a.charCodeAt(d)&255;return b}function l(a){var d=65536,f=[],e=a.length,g=b.getTypeOf(a),h=0,l=!0;try{switch(g){case "uint8array":String.fromCharCode.apply(null,
new Uint8Array(0));break;case "nodebuffer":String.fromCharCode.apply(null,n(0))}}catch(q){l=!1}if(!l){d="";for(f=0;f<a.length;f++)d+=String.fromCharCode(a[f]);return d}for(;h<e&&1<d;)try{"array"===g||"nodebuffer"===g?f.push(String.fromCharCode.apply(null,a.slice(h,Math.min(h+d,e)))):f.push(String.fromCharCode.apply(null,a.subarray(h,Math.min(h+d,e)))),h+=d}catch(t){d=Math.floor(d/2)}return f.join("")}function q(a,b){for(var d=0;d<a.length;d++)b[d]=a[d];return b}var p=e("./support"),d=e("./compressions"),
n=e("./nodeBuffer");b.string2binary=function(a){for(var b="",d=0;d<a.length;d++)b+=String.fromCharCode(a.charCodeAt(d)&255);return b};b.arrayBuffer2Blob=function(a){b.checkSupport("blob");try{return new Blob([a],{type:"application/zip"})}catch(d){try{var f=new (window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);f.append(a);return f.getBlob("application/zip")}catch(e){throw Error("Bug : can't construct the Blob.");}}};b.applyFromCharCode=l;var a={};a.string=
{string:f,array:function(a){return g(a,Array(a.length))},arraybuffer:function(b){return a.string.uint8array(b).buffer},uint8array:function(a){return g(a,new Uint8Array(a.length))},nodebuffer:function(a){return g(a,n(a.length))}};a.array={string:l,array:f,arraybuffer:function(a){return(new Uint8Array(a)).buffer},uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return n(a)}};a.arraybuffer={string:function(a){return l(new Uint8Array(a))},array:function(a){return q(new Uint8Array(a),
Array(a.byteLength))},arraybuffer:f,uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return n(new Uint8Array(a))}};a.uint8array={string:l,array:function(a){return q(a,Array(a.length))},arraybuffer:function(a){return a.buffer},uint8array:f,nodebuffer:function(a){return n(a)}};a.nodebuffer={string:l,array:function(a){return q(a,Array(a.length))},arraybuffer:function(b){return a.nodebuffer.uint8array(b).buffer},uint8array:function(a){return q(a,new Uint8Array(a.length))},nodebuffer:f};
b.transformTo=function(c,d){d||(d="");if(!c)return d;b.checkSupport(c);var f=b.getTypeOf(d);return a[f][c](d)};b.getTypeOf=function(a){if("string"===typeof a)return"string";if("[object Array]"===Object.prototype.toString.call(a))return"array";if(p.nodebuffer&&n.test(a))return"nodebuffer";if(p.uint8array&&a instanceof Uint8Array)return"uint8array";if(p.arraybuffer&&a instanceof ArrayBuffer)return"arraybuffer"};b.checkSupport=function(a){if(!p[a.toLowerCase()])throw Error(a+" is not supported by this browser");
};b.MAX_VALUE_16BITS=65535;b.MAX_VALUE_32BITS=-1;b.pretty=function(a){var b="",d,f;for(f=0;f<(a||"").length;f++)d=a.charCodeAt(f),b+="\\x"+(16>d?"0":"")+d.toString(16).toUpperCase();return b};b.findCompression=function(a){for(var b in d)if(d.hasOwnProperty(b)&&d[b].magic===a)return d[b];return null};b.isRegExp=function(a){return"[object RegExp]"===Object.prototype.toString.call(a)}},{"./compressions":3,"./nodeBuffer":11,"./support":17}],22:[function(e,h,b){function f(a,b){this.files=[];this.loadOptions=
b;a&&this.load(a)}var g=e("./stringReader"),l=e("./nodeBufferReader"),q=e("./uint8ArrayReader"),p=e("./utils"),d=e("./signature"),n=e("./zipEntry"),a=e("./support"),c=e("./object");f.prototype={checkSignature:function(a){var b=this.reader.readString(4);if(b!==a)throw Error("Corrupted zip or bug : unexpected signature ("+p.pretty(b)+", expected "+p.pretty(a)+")");},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2);this.diskWithCentralDirStart=this.reader.readInt(2);this.centralDirRecordsOnThisDisk=
this.reader.readInt(2);this.centralDirRecords=this.reader.readInt(2);this.centralDirSize=this.reader.readInt(4);this.centralDirOffset=this.reader.readInt(4);this.zipCommentLength=this.reader.readInt(2);this.zipComment=this.reader.readString(this.zipCommentLength);this.zipComment=c.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8);this.versionMadeBy=this.reader.readString(2);this.versionNeeded=this.reader.readInt(2);this.diskNumber=
this.reader.readInt(4);this.diskWithCentralDirStart=this.reader.readInt(4);this.centralDirRecordsOnThisDisk=this.reader.readInt(8);this.centralDirRecords=this.reader.readInt(8);this.centralDirSize=this.reader.readInt(8);this.centralDirOffset=this.reader.readInt(8);this.zip64ExtensibleData={};for(var a=this.zip64EndOfCentralSize-44,b,c,d;0<a;)b=this.reader.readInt(2),c=this.reader.readInt(4),d=this.reader.readString(c),this.zip64ExtensibleData[b]={id:b,length:c,value:d}},readBlockZip64EndOfCentralLocator:function(){this.diskWithZip64CentralDirStart=
this.reader.readInt(4);this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8);this.disksCount=this.reader.readInt(4);if(1<this.disksCount)throw Error("Multi-volumes zip are not supported");},readLocalFiles:function(){var a,b;for(a=0;a<this.files.length;a++)b=this.files[a],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(d.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8()},readCentralDir:function(){var a;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===
d.CENTRAL_FILE_HEADER;)a=new n({zip64:this.zip64},this.loadOptions),a.readCentralPart(this.reader),this.files.push(a)},readEndOfCentral:function(){var a=this.reader.lastIndexOfSignature(d.CENTRAL_DIRECTORY_END);if(-1===a)throw Error("Corrupted zip : can't find end of central directory");this.reader.setIndex(a);this.checkSignature(d.CENTRAL_DIRECTORY_END);this.readBlockEndOfCentral();if(this.diskNumber===p.MAX_VALUE_16BITS||this.diskWithCentralDirStart===p.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===
p.MAX_VALUE_16BITS||this.centralDirRecords===p.MAX_VALUE_16BITS||this.centralDirSize===p.MAX_VALUE_32BITS||this.centralDirOffset===p.MAX_VALUE_32BITS){this.zip64=!0;a=this.reader.lastIndexOfSignature(d.ZIP64_CENTRAL_DIRECTORY_LOCATOR);if(-1===a)throw Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(a);this.checkSignature(d.ZIP64_CENTRAL_DIRECTORY_LOCATOR);this.readBlockZip64EndOfCentralLocator();this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir);
this.checkSignature(d.ZIP64_CENTRAL_DIRECTORY_END);this.readBlockZip64EndOfCentral()}},prepareReader:function(b){var c=p.getTypeOf(b);this.reader="string"!==c||a.uint8array?"nodebuffer"===c?new l(b):new q(p.transformTo("uint8array",b)):new g(b,this.loadOptions.optimizedBinaryString)},load:function(a){this.prepareReader(a);this.readEndOfCentral();this.readCentralDir();this.readLocalFiles()}};h.exports=f},{"./nodeBufferReader":12,"./object":13,"./signature":14,"./stringReader":15,"./support":17,"./uint8ArrayReader":18,
"./utils":21,"./zipEntry":23}],23:[function(e,h,b){function f(b,f){this.options=b;this.loadOptions=f}var g=e("./stringReader"),l=e("./utils"),q=e("./compressedObject"),p=e("./object");f.prototype={isEncrypted:function(){return 1===(this.bitFlag&1)},useUTF8:function(){return 2048===(this.bitFlag&2048)},prepareCompressedContent:function(b,f,a){return function(){var c=b.index;b.setIndex(f);var e=b.readData(a);b.setIndex(c);return e}},prepareContent:function(b,f,a,c,e){return function(){var a=l.transformTo(c.uncompressInputType,
this.getCompressedContent()),a=c.uncompress(a);if(a.length!==e)throw Error("Bug : uncompressed data size mismatch");return a}},readLocalPart:function(b){var f;b.skip(22);this.fileNameLength=b.readInt(2);f=b.readInt(2);this.fileName=b.readString(this.fileNameLength);b.skip(f);if(-1==this.compressedSize||-1==this.uncompressedSize)throw Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");f=l.findCompression(this.compressionMethod);
if(null===f)throw Error("Corrupted zip : compression "+l.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");this.decompressed=new q;this.decompressed.compressedSize=this.compressedSize;this.decompressed.uncompressedSize=this.uncompressedSize;this.decompressed.crc32=this.crc32;this.decompressed.compressionMethod=this.compressionMethod;this.decompressed.getCompressedContent=this.prepareCompressedContent(b,b.index,this.compressedSize,f);this.decompressed.getContent=this.prepareContent(b,
b.index,this.compressedSize,f,this.uncompressedSize);if(this.loadOptions.checkCRC32&&(this.decompressed=l.transformTo("string",this.decompressed.getContent()),p.crc32(this.decompressed)!==this.crc32))throw Error("Corrupted zip : CRC32 mismatch");},readCentralPart:function(b){this.versionMadeBy=b.readString(2);this.versionNeeded=b.readInt(2);this.bitFlag=b.readInt(2);this.compressionMethod=b.readString(2);this.date=b.readDate();this.crc32=b.readInt(4);this.compressedSize=b.readInt(4);this.uncompressedSize=
b.readInt(4);this.fileNameLength=b.readInt(2);this.extraFieldsLength=b.readInt(2);this.fileCommentLength=b.readInt(2);this.diskNumberStart=b.readInt(2);this.internalFileAttributes=b.readInt(2);this.externalFileAttributes=b.readInt(4);this.localHeaderOffset=b.readInt(4);if(this.isEncrypted())throw Error("Encrypted zip are not supported");this.fileName=b.readString(this.fileNameLength);this.readExtraFields(b);this.parseZIP64ExtraField(b);this.fileComment=b.readString(this.fileCommentLength);this.dir=
this.externalFileAttributes&16?!0:!1},parseZIP64ExtraField:function(b){this.extraFields[1]&&(b=new g(this.extraFields[1].value),this.uncompressedSize===l.MAX_VALUE_32BITS&&(this.uncompressedSize=b.readInt(8)),this.compressedSize===l.MAX_VALUE_32BITS&&(this.compressedSize=b.readInt(8)),this.localHeaderOffset===l.MAX_VALUE_32BITS&&(this.localHeaderOffset=b.readInt(8)),this.diskNumberStart===l.MAX_VALUE_32BITS&&(this.diskNumberStart=b.readInt(4)))},readExtraFields:function(b){var f=b.index,a,c,e;for(this.extraFields=
this.extraFields||{};b.index<f+this.extraFieldsLength;)a=b.readInt(2),c=b.readInt(2),e=b.readString(c),this.extraFields[a]={id:a,length:c,value:e}},handleUTF8:function(){if(this.useUTF8())this.fileName=p.utf8decode(this.fileName),this.fileComment=p.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();null!==b&&(this.fileName=b);b=this.findExtraFieldUnicodeComment();null!==b&&(this.fileComment=b)}},findExtraFieldUnicodePath:function(){var b=this.extraFields[28789];if(b){var f=new g(b.value);
return 1!==f.readInt(1)||p.crc32(this.fileName)!==f.readInt(4)?null:p.utf8decode(f.readString(b.length-5))}return null},findExtraFieldUnicodeComment:function(){var b=this.extraFields[25461];if(b){var f=new g(b.value);return 1!==f.readInt(1)||p.crc32(this.fileComment)!==f.readInt(4)?null:p.utf8decode(f.readString(b.length-5))}return null}};h.exports=f},{"./compressedObject":2,"./object":13,"./stringReader":15,"./utils":21}],24:[function(e,h,b){b=e("./lib/utils/common").assign;var f=e("./lib/deflate"),
g=e("./lib/inflate");e=e("./lib/zlib/constants");var l={};b(l,f,g,e);h.exports=l},{"./lib/deflate":25,"./lib/inflate":26,"./lib/utils/common":27,"./lib/zlib/constants":30}],25:[function(e,h,b){function f(a,b){var d=new n(b);d.push(a,!0);if(d.err)throw d.msg;return d.result}var g=e("./zlib/deflate.js"),l=e("./utils/common"),q=e("./utils/strings"),p=e("./zlib/messages"),d=e("./zlib/zstream"),n=function(a){a=this.options=l.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,
to:""},a||{});a.raw&&0<a.windowBits?a.windowBits=-a.windowBits:a.gzip&&0<a.windowBits&&16>a.windowBits&&(a.windowBits+=16);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new d;this.strm.avail_out=0;var b=g.deflateInit2(this.strm,a.level,a.method,a.windowBits,a.memLevel,a.strategy);if(0!==b)throw Error(p[b]);a.header&&g.deflateSetHeader(this.strm,a.header)};n.prototype.push=function(a,b){var d=this.strm,f=this.options.chunkSize,e,h;if(this.ended)return!1;h=b===~~b?b:!0===b?4:0;d.input=
"string"===typeof a?q.string2buf(a):a;d.next_in=0;d.avail_in=d.input.length;do{0===d.avail_out&&(d.output=new l.Buf8(f),d.next_out=0,d.avail_out=f);e=g.deflate(d,h);if(1!==e&&0!==e)return this.onEnd(e),this.ended=!0,!1;if(0===d.avail_out||0===d.avail_in&&4===h)if("string"===this.options.to)this.onData(q.buf2binstring(l.shrinkBuf(d.output,d.next_out)));else this.onData(l.shrinkBuf(d.output,d.next_out))}while((0<d.avail_in||0===d.avail_out)&&1!==e);return 4===h?(e=g.deflateEnd(this.strm),this.onEnd(e),
this.ended=!0,0===e):!0};n.prototype.onData=function(a){this.chunks.push(a)};n.prototype.onEnd=function(a){0===a&&(this.result="string"===this.options.to?this.chunks.join(""):l.flattenChunks(this.chunks));this.chunks=[];this.err=a;this.msg=this.strm.msg};b.Deflate=n;b.deflate=f;b.deflateRaw=function(a,b){b=b||{};b.raw=!0;return f(a,b)};b.gzip=function(a,b){b=b||{};b.gzip=!0;return f(a,b)}},{"./utils/common":27,"./utils/strings":28,"./zlib/deflate.js":32,"./zlib/messages":37,"./zlib/zstream":39}],
26:[function(e,h,b){function f(a,b){var d=new c(b);d.push(a,!0);if(d.err)throw d.msg;return d.result}var g=e("./zlib/inflate.js"),l=e("./utils/common"),q=e("./utils/strings"),p=e("./zlib/constants"),d=e("./zlib/messages"),n=e("./zlib/zstream"),a=e("./zlib/gzheader"),c=function(b){var c=this.options=l.assign({chunkSize:16384,windowBits:0,to:""},b||{});c.raw&&0<=c.windowBits&&16>c.windowBits&&(c.windowBits=-c.windowBits,0===c.windowBits&&(c.windowBits=-15));!(0<=c.windowBits&&16>c.windowBits)||b&&b.windowBits||
(c.windowBits+=32);15<c.windowBits&&48>c.windowBits&&0===(c.windowBits&15)&&(c.windowBits|=15);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new n;this.strm.avail_out=0;b=g.inflateInit2(this.strm,c.windowBits);if(b!==p.Z_OK)throw Error(d[b]);this.header=new a;g.inflateGetHeader(this.strm,this.header)};c.prototype.push=function(a,b){var c=this.strm,d=this.options.chunkSize,f,e,h,n,w;if(this.ended)return!1;e=b===~~b?b:!0===b?p.Z_FINISH:p.Z_NO_FLUSH;c.input="string"===typeof a?q.binstring2buf(a):
a;c.next_in=0;c.avail_in=c.input.length;do{0===c.avail_out&&(c.output=new l.Buf8(d),c.next_out=0,c.avail_out=d);f=g.inflate(c,p.Z_NO_FLUSH);if(f!==p.Z_STREAM_END&&f!==p.Z_OK)return this.onEnd(f),this.ended=!0,!1;if(c.next_out&&(0===c.avail_out||f===p.Z_STREAM_END||0===c.avail_in&&e===p.Z_FINISH))if("string"===this.options.to)h=q.utf8border(c.output,c.next_out),n=c.next_out-h,w=q.buf2string(c.output,h),c.next_out=n,c.avail_out=d-n,n&&l.arraySet(c.output,c.output,h,n,0),this.onData(w);else this.onData(l.shrinkBuf(c.output,
c.next_out))}while(0<c.avail_in&&f!==p.Z_STREAM_END);f===p.Z_STREAM_END&&(e=p.Z_FINISH);return e===p.Z_FINISH?(f=g.inflateEnd(this.strm),this.onEnd(f),this.ended=!0,f===p.Z_OK):!0};c.prototype.onData=function(a){this.chunks.push(a)};c.prototype.onEnd=function(a){a===p.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):l.flattenChunks(this.chunks));this.chunks=[];this.err=a;this.msg=this.strm.msg};b.Inflate=c;b.inflate=f;b.inflateRaw=function(a,b){b=b||{};b.raw=!0;return f(a,b)};b.ungzip=
f},{"./utils/common":27,"./utils/strings":28,"./zlib/constants":30,"./zlib/gzheader":33,"./zlib/inflate.js":35,"./zlib/messages":37,"./zlib/zstream":39}],27:[function(e,h,b){e="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Int32Array;b.assign=function(b){for(var f=Array.prototype.slice.call(arguments,1);f.length;){var e=f.shift();if(e){if("object"!==typeof e)throw new TypeError(e+"must be non-object");for(var d in e)e.hasOwnProperty(d)&&(b[d]=e[d])}}return b};
b.shrinkBuf=function(b,f){if(b.length===f)return b;if(b.subarray)return b.subarray(0,f);b.length=f;return b};var f={arraySet:function(b,f,e,d,g){if(f.subarray&&b.subarray)b.set(f.subarray(e,e+d),g);else for(var a=0;a<d;a++)b[g+a]=f[e+a]},flattenChunks:function(b){var f,e,d,g,a;f=d=0;for(e=b.length;f<e;f++)d+=b[f].length;a=new Uint8Array(d);f=d=0;for(e=b.length;f<e;f++)g=b[f],a.set(g,d),d+=g.length;return a}},g={arraySet:function(b,f,e,d,g){for(var a=0;a<d;a++)b[g+a]=f[e+a]},flattenChunks:function(b){return[].concat.apply([],
b)}};b.setTyped=function(e){e?(b.Buf8=Uint8Array,b.Buf16=Uint16Array,b.Buf32=Int32Array,b.assign(b,f)):(b.Buf8=Array,b.Buf16=Array,b.Buf32=Array,b.assign(b,g))};b.setTyped(e)},{}],28:[function(e,h,b){function f(a,b){if(65537>b&&(a.subarray&&q||!a.subarray&&l))return String.fromCharCode.apply(null,g.shrinkBuf(a,b));for(var d="",f=0;f<b;f++)d+=String.fromCharCode(a[f]);return d}var g=e("./common"),l=!0,q=!0;try{String.fromCharCode.apply(null,[0])}catch(p){l=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(d){q=
!1}var n=new g.Buf8(256);for(e=0;256>e;e++)n[e]=252<=e?6:248<=e?5:240<=e?4:224<=e?3:192<=e?2:1;n[254]=n[254]=1;b.string2buf=function(a){var b,d,f,e,h,l=a.length,n=0;for(e=0;e<l;e++)d=a.charCodeAt(e),55296===(d&64512)&&e+1<l&&(f=a.charCodeAt(e+1),56320===(f&64512)&&(d=65536+(d-55296<<10)+(f-56320),e++)),n+=128>d?1:2048>d?2:65536>d?3:4;b=new g.Buf8(n);for(e=h=0;h<n;e++)d=a.charCodeAt(e),55296===(d&64512)&&e+1<l&&(f=a.charCodeAt(e+1),56320===(f&64512)&&(d=65536+(d-55296<<10)+(f-56320),e++)),128>d?b[h++]=
d:(2048>d?b[h++]=192|d>>>6:(65536>d?b[h++]=224|d>>>12:(b[h++]=240|d>>>18,b[h++]=128|d>>>12&63),b[h++]=128|d>>>6&63),b[h++]=128|d&63);return b};b.buf2binstring=function(a){return f(a,a.length)};b.binstring2buf=function(a){for(var b=new g.Buf8(a.length),d=0,f=b.length;d<f;d++)b[d]=a.charCodeAt(d);return b};b.buf2string=function(a,b){var d,e,g,h,l=b||a.length,q=Array(2*l);for(d=e=0;d<l;)if(g=a[d++],128>g)q[e++]=g;else if(h=n[g],4<h)q[e++]=65533,d+=h-1;else{for(g&=2===h?31:3===h?15:7;1<h&&d<l;)g=g<<6|
a[d++]&63,h--;1<h?q[e++]=65533:65536>g?q[e++]=g:(g-=65536,q[e++]=55296|g>>10&1023,q[e++]=56320|g&1023)}return f(q,e)};b.utf8border=function(a,b){var d;b=b||a.length;b>a.length&&(b=a.length);for(d=b-1;0<=d&&128===(a[d]&192);)d--;return 0>d||0===d?b:d+n[a[d]]>b?d:b}},{"./common":27}],29:[function(e,h,b){h.exports=function(b,e,h,q){var p=b&65535|0;b=b>>>16&65535|0;for(var d=0;0!==h;){d=2E3<h?2E3:h;h-=d;do p=p+e[q++]|0,b=b+p|0;while(--d);p%=65521;b%=65521}return p|b<<16|0}},{}],30:[function(e,h,b){h.exports=
{Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],31:[function(e,h,b){var f=function(){for(var b,f=[],e=0;256>e;e++){b=e;for(var h=0;8>h;h++)b=b&1?3988292384^b>>>
1:b>>>1;f[e]=b}return f}();h.exports=function(b,e,h,p){h=p+h;for(b^=-1;p<h;p++)b=b>>>8^f[(b^e[p])&255];return b^-1}},{}],32:[function(e,h,b){function f(a,b){a.msg=D[b];return b}function g(a){for(var b=a.length;0<=--b;)a[b]=0}function l(a){var b=a.state,c=b.pending;c>a.avail_out&&(c=a.avail_out);0!==c&&(t.arraySet(a.output,b.pending_buf,b.pending_out,c,a.next_out),a.next_out+=c,b.pending_out+=c,a.total_out+=c,a.avail_out-=c,b.pending-=c,0===b.pending&&(b.pending_out=0))}function q(a,b){w._tr_flush_block(a,
0<=a.block_start?a.block_start:-1,a.strstart-a.block_start,b);a.block_start=a.strstart;l(a.strm)}function p(a,b){a.pending_buf[a.pending++]=b}function d(a,b){a.pending_buf[a.pending++]=b>>>8&255;a.pending_buf[a.pending++]=b&255}function n(a,b){var c=a.max_chain_length,d=a.strstart,f,e=a.prev_length,g=a.nice_match,h=a.strstart>a.w_size-262?a.strstart-(a.w_size-262):0,k=a.window,l=a.w_mask,n=a.prev,t=a.strstart+258,q=k[d+e-1],p=k[d+e];a.prev_length>=a.good_match&&(c>>=2);g>a.lookahead&&(g=a.lookahead);
do if(f=b,k[f+e]===p&&k[f+e-1]===q&&k[f]===k[d]&&k[++f]===k[d+1]){d+=2;for(f++;k[++d]===k[++f]&&k[++d]===k[++f]&&k[++d]===k[++f]&&k[++d]===k[++f]&&k[++d]===k[++f]&&k[++d]===k[++f]&&k[++d]===k[++f]&&k[++d]===k[++f]&&d<t;);f=258-(t-d);d=t-258;if(f>e){a.match_start=b;e=f;if(f>=g)break;q=k[d+e-1];p=k[d+e]}}while((b=n[b&l])>h&&0!==--c);return e<=a.lookahead?e:a.lookahead}function a(a){var b=a.w_size,c,d,f,e;do{e=a.window_size-a.lookahead-a.strstart;if(a.strstart>=b+(b-262)){t.arraySet(a.window,a.window,
b,b,0);a.match_start-=b;a.strstart-=b;a.block_start-=b;c=d=a.hash_size;do f=a.head[--c],a.head[c]=f>=b?f-b:0;while(--d);c=d=b;do f=a.prev[--c],a.prev[c]=f>=b?f-b:0;while(--d);e+=b}if(0===a.strm.avail_in)break;c=a.strm;d=a.window;f=a.strstart+a.lookahead;var g=c.avail_in;g>e&&(g=e);0===g?d=0:(c.avail_in-=g,t.arraySet(d,c.input,c.next_in,g,f),1===c.state.wrap?c.adler=H(c.adler,d,g,f):2===c.state.wrap&&(c.adler=I(c.adler,d,g,f)),c.next_in+=g,c.total_in+=g,d=g);a.lookahead+=d;if(3<=a.lookahead+a.insert)for(e=
a.strstart-a.insert,a.ins_h=a.window[e],a.ins_h=(a.ins_h<<a.hash_shift^a.window[e+1])&a.hash_mask;a.insert&&!(a.ins_h=(a.ins_h<<a.hash_shift^a.window[e+3-1])&a.hash_mask,a.prev[e&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=e,e++,a.insert--,3>a.lookahead+a.insert););}while(262>a.lookahead&&0!==a.strm.avail_in)}function c(b,c){for(var d;;){if(262>b.lookahead){a(b);if(262>b.lookahead&&0===c)return 1;if(0===b.lookahead)break}d=0;3<=b.lookahead&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+3-1])&
b.hash_mask,d=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart);0!==d&&b.strstart-d<=b.w_size-262&&(b.match_length=n(b,d));if(3<=b.match_length)if(d=w._tr_tally(b,b.strstart-b.match_start,b.match_length-3),b.lookahead-=b.match_length,b.match_length<=b.max_lazy_match&&3<=b.lookahead){b.match_length--;do b.strstart++,b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+3-1])&b.hash_mask,b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart;while(0!==--b.match_length);
b.strstart++}else b.strstart+=b.match_length,b.match_length=0,b.ins_h=b.window[b.strstart],b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+1])&b.hash_mask;else d=w._tr_tally(b,0,b.window[b.strstart]),b.lookahead--,b.strstart++;if(d&&(q(b,!1),0===b.strm.avail_out))return 1}b.insert=2>b.strstart?b.strstart:2;return 4===c?(q(b,!0),0===b.strm.avail_out?3:4):b.last_lit&&(q(b,!1),0===b.strm.avail_out)?1:2}function k(b,c){for(var d,f;;){if(262>b.lookahead){a(b);if(262>b.lookahead&&0===c)return 1;if(0===
b.lookahead)break}d=0;3<=b.lookahead&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+3-1])&b.hash_mask,d=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart);b.prev_length=b.match_length;b.prev_match=b.match_start;b.match_length=2;0!==d&&b.prev_length<b.max_lazy_match&&b.strstart-d<=b.w_size-262&&(b.match_length=n(b,d),5>=b.match_length&&(1===b.strategy||3===b.match_length&&4096<b.strstart-b.match_start)&&(b.match_length=2));if(3<=b.prev_length&&b.match_length<=b.prev_length){f=
b.strstart+b.lookahead-3;d=w._tr_tally(b,b.strstart-1-b.prev_match,b.prev_length-3);b.lookahead-=b.prev_length-1;b.prev_length-=2;do++b.strstart<=f&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+3-1])&b.hash_mask,b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart);while(0!==--b.prev_length);b.match_available=0;b.match_length=2;b.strstart++;if(d&&(q(b,!1),0===b.strm.avail_out))return 1}else if(b.match_available){if((d=w._tr_tally(b,0,b.window[b.strstart-1]))&&q(b,!1),b.strstart++,
b.lookahead--,0===b.strm.avail_out)return 1}else b.match_available=1,b.strstart++,b.lookahead--}b.match_available&&(w._tr_tally(b,0,b.window[b.strstart-1]),b.match_available=0);b.insert=2>b.strstart?b.strstart:2;return 4===c?(q(b,!0),0===b.strm.avail_out?3:4):b.last_lit&&(q(b,!1),0===b.strm.avail_out)?1:2}function r(b,c){for(var d,f,e,g=b.window;;){if(258>=b.lookahead){a(b);if(258>=b.lookahead&&0===c)return 1;if(0===b.lookahead)break}b.match_length=0;if(3<=b.lookahead&&0<b.strstart&&(f=b.strstart-
1,d=g[f],d===g[++f]&&d===g[++f]&&d===g[++f])){for(e=b.strstart+258;d===g[++f]&&d===g[++f]&&d===g[++f]&&d===g[++f]&&d===g[++f]&&d===g[++f]&&d===g[++f]&&d===g[++f]&&f<e;);b.match_length=258-(e-f);b.match_length>b.lookahead&&(b.match_length=b.lookahead)}3<=b.match_length?(d=w._tr_tally(b,1,b.match_length-3),b.lookahead-=b.match_length,b.strstart+=b.match_length,b.match_length=0):(d=w._tr_tally(b,0,b.window[b.strstart]),b.lookahead--,b.strstart++);if(d&&(q(b,!1),0===b.strm.avail_out))return 1}b.insert=
0;return 4===c?(q(b,!0),0===b.strm.avail_out?3:4):b.last_lit&&(q(b,!1),0===b.strm.avail_out)?1:2}function B(b,c){for(var d;;){if(0===b.lookahead&&(a(b),0===b.lookahead)){if(0===c)return 1;break}b.match_length=0;d=w._tr_tally(b,0,b.window[b.strstart]);b.lookahead--;b.strstart++;if(d&&(q(b,!1),0===b.strm.avail_out))return 1}b.insert=0;return 4===c?(q(b,!0),0===b.strm.avail_out?3:4):b.last_lit&&(q(b,!1),0===b.strm.avail_out)?1:2}function y(){this.strm=null;this.status=0;this.pending_buf=null;this.wrap=
this.pending=this.pending_out=this.pending_buf_size=0;this.gzhead=null;this.gzindex=0;this.method=8;this.last_flush=-1;this.w_mask=this.w_bits=this.w_size=0;this.window=null;this.window_size=0;this.head=this.prev=null;this.nice_match=this.good_match=this.strategy=this.level=this.max_lazy_match=this.max_chain_length=this.prev_length=this.lookahead=this.match_start=this.strstart=this.match_available=this.prev_match=this.match_length=this.block_start=this.hash_shift=this.hash_mask=this.hash_bits=this.hash_size=
this.ins_h=0;this.dyn_ltree=new t.Buf16(1146);this.dyn_dtree=new t.Buf16(122);this.bl_tree=new t.Buf16(78);g(this.dyn_ltree);g(this.dyn_dtree);g(this.bl_tree);this.bl_desc=this.d_desc=this.l_desc=null;this.bl_count=new t.Buf16(16);this.heap=new t.Buf16(573);g(this.heap);this.heap_max=this.heap_len=0;this.depth=new t.Buf16(573);g(this.depth);this.bi_valid=this.bi_buf=this.insert=this.matches=this.static_len=this.opt_len=this.d_buf=this.last_lit=this.lit_bufsize=this.l_buf=0}function z(a){var b;if(!a||
!a.state)return f(a,-2);a.total_in=a.total_out=0;a.data_type=2;b=a.state;b.pending=0;b.pending_out=0;0>b.wrap&&(b.wrap=-b.wrap);b.status=b.wrap?42:113;a.adler=2===b.wrap?0:1;b.last_flush=0;w._tr_init(b);return 0}function v(a){var b=z(a);0===b&&(a=a.state,a.window_size=2*a.w_size,g(a.head),a.max_lazy_match=C[a.level].max_lazy,a.good_match=C[a.level].good_length,a.nice_match=C[a.level].nice_length,a.max_chain_length=C[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=
a.prev_length=2,a.match_available=0,a.ins_h=0);return b}function A(a,b,c,d,e,g){if(!a)return-2;var h=1;-1===b&&(b=6);0>d?(h=0,d=-d):15<d&&(h=2,d-=16);if(1>e||9<e||8!==c||8>d||15<d||0>b||9<b||0>g||4<g)return f(a,-2);8===d&&(d=9);var k=new y;a.state=k;k.strm=a;k.wrap=h;k.gzhead=null;k.w_bits=d;k.w_size=1<<k.w_bits;k.w_mask=k.w_size-1;k.hash_bits=e+7;k.hash_size=1<<k.hash_bits;k.hash_mask=k.hash_size-1;k.hash_shift=~~((k.hash_bits+3-1)/3);k.window=new t.Buf8(2*k.w_size);k.head=new t.Buf16(k.hash_size);
k.prev=new t.Buf16(k.w_size);k.lit_bufsize=1<<e+6;k.pending_buf_size=4*k.lit_bufsize;k.pending_buf=new t.Buf8(k.pending_buf_size);k.d_buf=k.lit_bufsize>>1;k.l_buf=3*k.lit_bufsize;k.level=b;k.strategy=g;k.method=c;return v(a)}var t=e("../utils/common"),w=e("./trees"),H=e("./adler32"),I=e("./crc32"),D=e("./messages");e=function(a,b,c,d,f){this.good_length=a;this.max_lazy=b;this.nice_length=c;this.max_chain=d;this.func=f};var C;C=[new e(0,0,0,0,function(b,c){var d=65535;for(d>b.pending_buf_size-5&&(d=
b.pending_buf_size-5);;){if(1>=b.lookahead){a(b);if(0===b.lookahead&&0===c)return 1;if(0===b.lookahead)break}b.strstart+=b.lookahead;b.lookahead=0;var f=b.block_start+d;if(0===b.strstart||b.strstart>=f)if(b.lookahead=b.strstart-f,b.strstart=f,q(b,!1),0===b.strm.avail_out)return 1;if(b.strstart-b.block_start>=b.w_size-262&&(q(b,!1),0===b.strm.avail_out))return 1}b.insert=0;if(4===c)return q(b,!0),0===b.strm.avail_out?3:4;b.strstart>b.block_start&&q(b,!1);return 1}),new e(4,4,8,4,c),new e(4,5,16,8,
c),new e(4,6,32,32,c),new e(4,4,16,16,k),new e(8,16,32,32,k),new e(8,16,128,128,k),new e(8,32,128,256,k),new e(32,128,258,1024,k),new e(32,258,258,4096,k)];b.deflateInit=function(a,b){return A(a,b,8,15,8,0)};b.deflateInit2=A;b.deflateReset=v;b.deflateResetKeep=z;b.deflateSetHeader=function(a,b){if(!a||!a.state||2!==a.state.wrap)return-2;a.state.gzhead=b;return 0};b.deflate=function(a,b){var c,e,h,k;if(!a||!a.state||5<b||0>b)return a?f(a,-2):-2;e=a.state;if(!a.output||!a.input&&0!==a.avail_in||666===
e.status&&4!==b)return f(a,0===a.avail_out?-5:-2);e.strm=a;c=e.last_flush;e.last_flush=b;42===e.status&&(2===e.wrap?(a.adler=0,p(e,31),p(e,139),p(e,8),e.gzhead?(p(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),p(e,e.gzhead.time&255),p(e,e.gzhead.time>>8&255),p(e,e.gzhead.time>>16&255),p(e,e.gzhead.time>>24&255),p(e,9===e.level?2:2<=e.strategy||2>e.level?4:0),p(e,e.gzhead.os&255),e.gzhead.extra&&e.gzhead.extra.length&&(p(e,e.gzhead.extra.length&
255),p(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(a.adler=I(a.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=69):(p(e,0),p(e,0),p(e,0),p(e,0),p(e,0),p(e,9===e.level?2:2<=e.strategy||2>e.level?4:0),p(e,3),e.status=113)):(h=8+(e.w_bits-8<<4)<<8,k=-1,k=2<=e.strategy||2>e.level?0:6>e.level?1:6===e.level?2:3,h|=k<<6,0!==e.strstart&&(h|=32),e.status=113,d(e,h+(31-h%31)),0!==e.strstart&&(d(e,a.adler>>>16),d(e,a.adler&65535)),a.adler=1));if(69===e.status)if(e.gzhead.extra){for(h=e.pending;e.gzindex<
(e.gzhead.extra.length&65535)&&(e.pending!==e.pending_buf_size||(e.gzhead.hcrc&&e.pending>h&&(a.adler=I(a.adler,e.pending_buf,e.pending-h,h)),l(a),h=e.pending,e.pending!==e.pending_buf_size));)p(e,e.gzhead.extra[e.gzindex]&255),e.gzindex++;e.gzhead.hcrc&&e.pending>h&&(a.adler=I(a.adler,e.pending_buf,e.pending-h,h));e.gzindex===e.gzhead.extra.length&&(e.gzindex=0,e.status=73)}else e.status=73;if(73===e.status)if(e.gzhead.name){h=e.pending;do{if(e.pending===e.pending_buf_size&&(e.gzhead.hcrc&&e.pending>
h&&(a.adler=I(a.adler,e.pending_buf,e.pending-h,h)),l(a),h=e.pending,e.pending===e.pending_buf_size)){k=1;break}k=e.gzindex<e.gzhead.name.length?e.gzhead.name.charCodeAt(e.gzindex++)&255:0;p(e,k)}while(0!==k);e.gzhead.hcrc&&e.pending>h&&(a.adler=I(a.adler,e.pending_buf,e.pending-h,h));0===k&&(e.gzindex=0,e.status=91)}else e.status=91;if(91===e.status)if(e.gzhead.comment){h=e.pending;do{if(e.pending===e.pending_buf_size&&(e.gzhead.hcrc&&e.pending>h&&(a.adler=I(a.adler,e.pending_buf,e.pending-h,h)),
l(a),h=e.pending,e.pending===e.pending_buf_size)){k=1;break}k=e.gzindex<e.gzhead.comment.length?e.gzhead.comment.charCodeAt(e.gzindex++)&255:0;p(e,k)}while(0!==k);e.gzhead.hcrc&&e.pending>h&&(a.adler=I(a.adler,e.pending_buf,e.pending-h,h));0===k&&(e.status=103)}else e.status=103;103===e.status&&(e.gzhead.hcrc?(e.pending+2>e.pending_buf_size&&l(a),e.pending+2<=e.pending_buf_size&&(p(e,a.adler&255),p(e,a.adler>>8&255),a.adler=0,e.status=113)):e.status=113);if(0!==e.pending){if(l(a),0===a.avail_out)return e.last_flush=
-1,0}else if(0===a.avail_in&&(b<<1)-(4<b?9:0)<=(c<<1)-(4<c?9:0)&&4!==b)return f(a,-5);if(666===e.status&&0!==a.avail_in)return f(a,-5);if(0!==a.avail_in||0!==e.lookahead||0!==b&&666!==e.status){c=2===e.strategy?B(e,b):3===e.strategy?r(e,b):C[e.level].func(e,b);if(3===c||4===c)e.status=666;if(1===c||3===c)return 0===a.avail_out&&(e.last_flush=-1),0;if(2===c&&(1===b?w._tr_align(e):5!==b&&(w._tr_stored_block(e,0,0,!1),3===b&&(g(e.head),0===e.lookahead&&(e.strstart=0,e.block_start=0,e.insert=0))),l(a),
0===a.avail_out))return e.last_flush=-1,0}if(4!==b)return 0;if(0>=e.wrap)return 1;2===e.wrap?(p(e,a.adler&255),p(e,a.adler>>8&255),p(e,a.adler>>16&255),p(e,a.adler>>24&255),p(e,a.total_in&255),p(e,a.total_in>>8&255),p(e,a.total_in>>16&255),p(e,a.total_in>>24&255)):(d(e,a.adler>>>16),d(e,a.adler&65535));l(a);0<e.wrap&&(e.wrap=-e.wrap);return 0!==e.pending?0:1};b.deflateEnd=function(a){var b;if(!a||!a.state)return-2;b=a.state.status;if(42!==b&&69!==b&&73!==b&&91!==b&&103!==b&&113!==b&&666!==b)return f(a,
-2);a.state=null;return 113===b?f(a,-3):0};b.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./messages":37,"./trees":38}],33:[function(e,h,b){h.exports=function(){this.os=this.xflags=this.time=this.text=0;this.extra=null;this.extra_len=0;this.comment=this.name="";this.hcrc=0;this.done=!1}},{}],34:[function(e,h,b){h.exports=function(b,e){var h,q,p,d,n,a,c,k,r,B,y,z,v,A,t,w,H,I,D,C,s,u,x,G;h=b.state;q=b.next_in;x=b.input;p=q+(b.avail_in-5);d=b.next_out;
G=b.output;n=d-(e-b.avail_out);a=d+(b.avail_out-257);c=h.dmax;k=h.wsize;r=h.whave;B=h.wnext;y=h.window;z=h.hold;v=h.bits;A=h.lencode;t=h.distcode;w=(1<<h.lenbits)-1;H=(1<<h.distbits)-1;a:do b:for(15>v&&(z+=x[q++]<<v,v+=8,z+=x[q++]<<v,v+=8),I=A[z&w];;){D=I>>>24;z>>>=D;v-=D;D=I>>>16&255;if(0===D)G[d++]=I&65535;else if(D&16){C=I&65535;if(D&=15)v<D&&(z+=x[q++]<<v,v+=8),C+=z&(1<<D)-1,z>>>=D,v-=D;15>v&&(z+=x[q++]<<v,v+=8,z+=x[q++]<<v,v+=8);I=t[z&H];c:for(;;){D=I>>>24;z>>>=D;v-=D;D=I>>>16&255;if(D&16){I&=
65535;D&=15;v<D&&(z+=x[q++]<<v,v+=8,v<D&&(z+=x[q++]<<v,v+=8));I+=z&(1<<D)-1;if(I>c){b.msg="invalid distance too far back";h.mode=30;break a}z>>>=D;v-=D;D=d-n;if(I>D){D=I-D;if(D>r&&h.sane){b.msg="invalid distance too far back";h.mode=30;break a}s=0;u=y;if(0===B){if(s+=k-D,D<C){C-=D;do G[d++]=y[s++];while(--D);s=d-I;u=G}}else if(B<D){if(s+=k+B-D,D-=B,D<C){C-=D;do G[d++]=y[s++];while(--D);s=0;if(B<C){D=B;C-=D;do G[d++]=y[s++];while(--D);s=d-I;u=G}}}else if(s+=B-D,D<C){C-=D;do G[d++]=y[s++];while(--D);
s=d-I;u=G}for(;2<C;)G[d++]=u[s++],G[d++]=u[s++],G[d++]=u[s++],C-=3;C&&(G[d++]=u[s++],1<C&&(G[d++]=u[s++]))}else{s=d-I;do G[d++]=G[s++],G[d++]=G[s++],G[d++]=G[s++],C-=3;while(2<C);C&&(G[d++]=G[s++],1<C&&(G[d++]=G[s++]))}}else if(0===(D&64)){I=t[(I&65535)+(z&(1<<D)-1)];continue c}else{b.msg="invalid distance code";h.mode=30;break a}break}}else if(0===(D&64)){I=A[(I&65535)+(z&(1<<D)-1)];continue b}else{D&32?h.mode=12:(b.msg="invalid literal/length code",h.mode=30);break a}break}while(q<p&&d<a);C=v>>
3;q-=C;v-=C<<3;b.next_in=q;b.next_out=d;b.avail_in=q<p?5+(p-q):5-(q-p);b.avail_out=d<a?257+(a-d):257-(d-a);h.hold=z&(1<<v)-1;h.bits=v}},{}],35:[function(e,h,b){function f(a){return(a>>>24&255)+(a>>>8&65280)+((a&65280)<<8)+((a&255)<<24)}function g(){this.mode=0;this.last=!1;this.wrap=0;this.havedict=!1;this.total=this.check=this.dmax=this.flags=0;this.head=null;this.wnext=this.whave=this.wsize=this.wbits=0;this.window=null;this.extra=this.offset=this.length=this.bits=this.hold=0;this.distcode=this.lencode=
null;this.have=this.ndist=this.nlen=this.ncode=this.distbits=this.lenbits=0;this.next=null;this.lens=new n.Buf16(320);this.work=new n.Buf16(288);this.distdyn=this.lendyn=null;this.was=this.back=this.sane=0}function l(a){var b;if(!a||!a.state)return-2;b=a.state;a.total_in=a.total_out=b.total=0;a.msg="";b.wrap&&(a.adler=b.wrap&1);b.mode=1;b.last=0;b.havedict=0;b.dmax=32768;b.head=null;b.hold=0;b.bits=0;b.lencode=b.lendyn=new n.Buf32(852);b.distcode=b.distdyn=new n.Buf32(592);b.sane=1;b.back=-1;return 0}
function q(a){var b;if(!a||!a.state)return-2;b=a.state;b.wsize=0;b.whave=0;b.wnext=0;return l(a)}function p(a,b){var c,d;if(!a||!a.state)return-2;d=a.state;0>b?(c=0,b=-b):(c=(b>>4)+1,48>b&&(b&=15));if(b&&(8>b||15<b))return-2;null!==d.window&&d.wbits!==b&&(d.window=null);d.wrap=c;d.wbits=b;return q(a)}function d(a,b){var c;if(!a)return-2;c=new g;a.state=c;c.window=null;c=p(a,b);0!==c&&(a.state=null);return c}var n=e("../utils/common"),a=e("./adler32"),c=e("./crc32"),k=e("./inffast"),r=e("./inftrees"),
B=!0,y,z;b.inflateReset=q;b.inflateReset2=p;b.inflateResetKeep=l;b.inflateInit=function(a){return d(a,15)};b.inflateInit2=d;b.inflate=function(b,d){var e,g,h,l,q,p,s,u,x,G,M,F,J,P,E=0,aa,Q,U,W=new n.Buf8(4),K=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!b||!b.state||!b.output||!b.input&&0!==b.avail_in)return-2;e=b.state;12===e.mode&&(e.mode=13);q=b.next_out;h=b.output;s=b.avail_out;l=b.next_in;g=b.input;p=b.avail_in;u=e.hold;x=e.bits;G=p;M=s;U=0;a:for(;;)switch(e.mode){case 1:if(0===e.wrap){e.mode=
13;break}for(;16>x;){if(0===p)break a;p--;u+=g[l++]<<x;x+=8}if(e.wrap&2&&35615===u){e.check=0;W[0]=u&255;W[1]=u>>>8&255;e.check=c(e.check,W,2,0);x=u=0;e.mode=2;break}e.flags=0;e.head&&(e.head.done=!1);if(!(e.wrap&1)||(((u&255)<<8)+(u>>8))%31){b.msg="incorrect header check";e.mode=30;break}if(8!==(u&15)){b.msg="unknown compression method";e.mode=30;break}u>>>=4;x-=4;J=(u&15)+8;if(0===e.wbits)e.wbits=J;else if(J>e.wbits){b.msg="invalid window size";e.mode=30;break}e.dmax=1<<J;b.adler=e.check=1;e.mode=
u&512?10:12;x=u=0;break;case 2:for(;16>x;){if(0===p)break a;p--;u+=g[l++]<<x;x+=8}e.flags=u;if(8!==(e.flags&255)){b.msg="unknown compression method";e.mode=30;break}if(e.flags&57344){b.msg="unknown header flags set";e.mode=30;break}e.head&&(e.head.text=u>>8&1);e.flags&512&&(W[0]=u&255,W[1]=u>>>8&255,e.check=c(e.check,W,2,0));x=u=0;e.mode=3;case 3:for(;32>x;){if(0===p)break a;p--;u+=g[l++]<<x;x+=8}e.head&&(e.head.time=u);e.flags&512&&(W[0]=u&255,W[1]=u>>>8&255,W[2]=u>>>16&255,W[3]=u>>>24&255,e.check=
c(e.check,W,4,0));x=u=0;e.mode=4;case 4:for(;16>x;){if(0===p)break a;p--;u+=g[l++]<<x;x+=8}e.head&&(e.head.xflags=u&255,e.head.os=u>>8);e.flags&512&&(W[0]=u&255,W[1]=u>>>8&255,e.check=c(e.check,W,2,0));x=u=0;e.mode=5;case 5:if(e.flags&1024){for(;16>x;){if(0===p)break a;p--;u+=g[l++]<<x;x+=8}e.length=u;e.head&&(e.head.extra_len=u);e.flags&512&&(W[0]=u&255,W[1]=u>>>8&255,e.check=c(e.check,W,2,0));x=u=0}else e.head&&(e.head.extra=null);e.mode=6;case 6:if(e.flags&1024&&(F=e.length,F>p&&(F=p),F&&(e.head&&
(J=e.head.extra_len-e.length,e.head.extra||(e.head.extra=Array(e.head.extra_len)),n.arraySet(e.head.extra,g,l,F,J)),e.flags&512&&(e.check=c(e.check,g,F,l)),p-=F,l+=F,e.length-=F),e.length))break a;e.length=0;e.mode=7;case 7:if(e.flags&2048){if(0===p)break a;F=0;do J=g[l+F++],e.head&&J&&65536>e.length&&(e.head.name+=String.fromCharCode(J));while(J&&F<p);e.flags&512&&(e.check=c(e.check,g,F,l));p-=F;l+=F;if(J)break a}else e.head&&(e.head.name=null);e.length=0;e.mode=8;case 8:if(e.flags&4096){if(0===
p)break a;F=0;do J=g[l+F++],e.head&&J&&65536>e.length&&(e.head.comment+=String.fromCharCode(J));while(J&&F<p);e.flags&512&&(e.check=c(e.check,g,F,l));p-=F;l+=F;if(J)break a}else e.head&&(e.head.comment=null);e.mode=9;case 9:if(e.flags&512){for(;16>x;){if(0===p)break a;p--;u+=g[l++]<<x;x+=8}if(u!==(e.check&65535)){b.msg="header crc mismatch";e.mode=30;break}x=u=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0);b.adler=e.check=0;e.mode=12;break;case 10:for(;32>x;){if(0===p)break a;p--;u+=g[l++]<<
x;x+=8}b.adler=e.check=f(u);x=u=0;e.mode=11;case 11:if(0===e.havedict)return b.next_out=q,b.avail_out=s,b.next_in=l,b.avail_in=p,e.hold=u,e.bits=x,2;b.adler=e.check=1;e.mode=12;case 12:if(5===d||6===d)break a;case 13:if(e.last){u>>>=x&7;x-=x&7;e.mode=27;break}for(;3>x;){if(0===p)break a;p--;u+=g[l++]<<x;x+=8}e.last=u&1;u>>>=1;x-=1;switch(u&3){case 0:e.mode=14;break;case 1:F=e;if(B){J=void 0;y=new n.Buf32(512);z=new n.Buf32(32);for(J=0;144>J;)F.lens[J++]=8;for(;256>J;)F.lens[J++]=9;for(;280>J;)F.lens[J++]=
7;for(;288>J;)F.lens[J++]=8;r(1,F.lens,0,288,y,0,F.work,{bits:9});for(J=0;32>J;)F.lens[J++]=5;r(2,F.lens,0,32,z,0,F.work,{bits:5});B=!1}F.lencode=y;F.lenbits=9;F.distcode=z;F.distbits=5;e.mode=20;if(6===d){u>>>=2;x-=2;break a}break;case 2:e.mode=17;break;case 3:b.msg="invalid block type",e.mode=30}u>>>=2;x-=2;break;case 14:u>>>=x&7;for(x-=x&7;32>x;){if(0===p)break a;p--;u+=g[l++]<<x;x+=8}if((u&65535)!==(u>>>16^65535)){b.msg="invalid stored block lengths";e.mode=30;break}e.length=u&65535;x=u=0;e.mode=
15;if(6===d)break a;case 15:e.mode=16;case 16:if(F=e.length){F>p&&(F=p);F>s&&(F=s);if(0===F)break a;n.arraySet(h,g,l,F,q);p-=F;l+=F;s-=F;q+=F;e.length-=F;break}e.mode=12;break;case 17:for(;14>x;){if(0===p)break a;p--;u+=g[l++]<<x;x+=8}e.nlen=(u&31)+257;u>>>=5;x-=5;e.ndist=(u&31)+1;u>>>=5;x-=5;e.ncode=(u&15)+4;u>>>=4;x-=4;if(286<e.nlen||30<e.ndist){b.msg="too many length or distance symbols";e.mode=30;break}e.have=0;e.mode=18;case 18:for(;e.have<e.ncode;){for(;3>x;){if(0===p)break a;p--;u+=g[l++]<<
x;x+=8}e.lens[K[e.have++]]=u&7;u>>>=3;x-=3}for(;19>e.have;)e.lens[K[e.have++]]=0;e.lencode=e.lendyn;e.lenbits=7;F={bits:e.lenbits};U=r(0,e.lens,0,19,e.lencode,0,e.work,F);e.lenbits=F.bits;if(U){b.msg="invalid code lengths set";e.mode=30;break}e.have=0;e.mode=19;case 19:for(;e.have<e.nlen+e.ndist;){for(;;){E=e.lencode[u&(1<<e.lenbits)-1];F=E>>>24;E&=65535;if(F<=x)break;if(0===p)break a;p--;u+=g[l++]<<x;x+=8}if(16>E)u>>>=F,x-=F,e.lens[e.have++]=E;else{if(16===E){for(J=F+2;x<J;){if(0===p)break a;p--;
u+=g[l++]<<x;x+=8}u>>>=F;x-=F;if(0===e.have){b.msg="invalid bit length repeat";e.mode=30;break}J=e.lens[e.have-1];F=3+(u&3);u>>>=2;x-=2}else if(17===E){for(J=F+3;x<J;){if(0===p)break a;p--;u+=g[l++]<<x;x+=8}u>>>=F;x-=F;J=0;F=3+(u&7);u>>>=3;x-=3}else{for(J=F+7;x<J;){if(0===p)break a;p--;u+=g[l++]<<x;x+=8}u>>>=F;x-=F;J=0;F=11+(u&127);u>>>=7;x-=7}if(e.have+F>e.nlen+e.ndist){b.msg="invalid bit length repeat";e.mode=30;break}for(;F--;)e.lens[e.have++]=J}}if(30===e.mode)break;if(0===e.lens[256]){b.msg=
"invalid code -- missing end-of-block";e.mode=30;break}e.lenbits=9;F={bits:e.lenbits};U=r(1,e.lens,0,e.nlen,e.lencode,0,e.work,F);e.lenbits=F.bits;if(U){b.msg="invalid literal/lengths set";e.mode=30;break}e.distbits=6;e.distcode=e.distdyn;F={bits:e.distbits};U=r(2,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,F);e.distbits=F.bits;if(U){b.msg="invalid distances set";e.mode=30;break}e.mode=20;if(6===d)break a;case 20:e.mode=21;case 21:if(6<=p&&258<=s){b.next_out=q;b.avail_out=s;b.next_in=l;b.avail_in=p;
e.hold=u;e.bits=x;k(b,M);q=b.next_out;h=b.output;s=b.avail_out;l=b.next_in;g=b.input;p=b.avail_in;u=e.hold;x=e.bits;12===e.mode&&(e.back=-1);break}for(e.back=0;;){E=e.lencode[u&(1<<e.lenbits)-1];F=E>>>24;J=E>>>16&255;E&=65535;if(F<=x)break;if(0===p)break a;p--;u+=g[l++]<<x;x+=8}if(J&&0===(J&240)){P=F;aa=J;for(Q=E;;){E=e.lencode[Q+((u&(1<<P+aa)-1)>>P)];F=E>>>24;J=E>>>16&255;E&=65535;if(P+F<=x)break;if(0===p)break a;p--;u+=g[l++]<<x;x+=8}u>>>=P;x-=P;e.back+=P}u>>>=F;x-=F;e.back+=F;e.length=E;if(0===
J){e.mode=26;break}if(J&32){e.back=-1;e.mode=12;break}if(J&64){b.msg="invalid literal/length code";e.mode=30;break}e.extra=J&15;e.mode=22;case 22:if(e.extra){for(J=e.extra;x<J;){if(0===p)break a;p--;u+=g[l++]<<x;x+=8}e.length+=u&(1<<e.extra)-1;u>>>=e.extra;x-=e.extra;e.back+=e.extra}e.was=e.length;e.mode=23;case 23:for(;;){E=e.distcode[u&(1<<e.distbits)-1];F=E>>>24;J=E>>>16&255;E&=65535;if(F<=x)break;if(0===p)break a;p--;u+=g[l++]<<x;x+=8}if(0===(J&240)){P=F;aa=J;for(Q=E;;){E=e.distcode[Q+((u&(1<<
P+aa)-1)>>P)];F=E>>>24;J=E>>>16&255;E&=65535;if(P+F<=x)break;if(0===p)break a;p--;u+=g[l++]<<x;x+=8}u>>>=P;x-=P;e.back+=P}u>>>=F;x-=F;e.back+=F;if(J&64){b.msg="invalid distance code";e.mode=30;break}e.offset=E;e.extra=J&15;e.mode=24;case 24:if(e.extra){for(J=e.extra;x<J;){if(0===p)break a;p--;u+=g[l++]<<x;x+=8}e.offset+=u&(1<<e.extra)-1;u>>>=e.extra;x-=e.extra;e.back+=e.extra}if(e.offset>e.dmax){b.msg="invalid distance too far back";e.mode=30;break}e.mode=25;case 25:if(0===s)break a;F=M-s;if(e.offset>
F){F=e.offset-F;if(F>e.whave&&e.sane){b.msg="invalid distance too far back";e.mode=30;break}F>e.wnext?(F-=e.wnext,J=e.wsize-F):J=e.wnext-F;F>e.length&&(F=e.length);P=e.window}else P=h,J=q-e.offset,F=e.length;F>s&&(F=s);s-=F;e.length-=F;do h[q++]=P[J++];while(--F);0===e.length&&(e.mode=21);break;case 26:if(0===s)break a;h[q++]=e.length;s--;e.mode=21;break;case 27:if(e.wrap){for(;32>x;){if(0===p)break a;p--;u|=g[l++]<<x;x+=8}M-=s;b.total_out+=M;e.total+=M;M&&(b.adler=e.check=e.flags?c(e.check,h,M,q-
M):a(e.check,h,M,q-M));M=s;if((e.flags?u:f(u))!==e.check){b.msg="incorrect data check";e.mode=30;break}x=u=0}e.mode=28;case 28:if(e.wrap&&e.flags){for(;32>x;){if(0===p)break a;p--;u+=g[l++]<<x;x+=8}if(u!==(e.total&4294967295)){b.msg="incorrect length check";e.mode=30;break}x=u=0}e.mode=29;case 29:U=1;break a;case 30:U=-3;break a;case 31:return-4;default:return-2}b.next_out=q;b.avail_out=s;b.next_in=l;b.avail_in=p;e.hold=u;e.bits=x;if(e.wsize||M!==b.avail_out&&30>e.mode&&(27>e.mode||4!==d))g=b.output,
l=b.next_out,q=M-b.avail_out,s=b.state,null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new n.Buf8(s.wsize)),q>=s.wsize?(n.arraySet(s.window,g,l-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):(p=s.wsize-s.wnext,p>q&&(p=q),n.arraySet(s.window,g,l-q,p,s.wnext),(q-=p)?(n.arraySet(s.window,g,l-q,q,0),s.wnext=q,s.whave=s.wsize):(s.wnext+=p,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=p)));G-=b.avail_in;M-=b.avail_out;b.total_in+=G;b.total_out+=M;e.total+=M;e.wrap&&M&&(b.adler=
e.check=e.flags?c(e.check,h,M,b.next_out-M):a(e.check,h,M,b.next_out-M));b.data_type=e.bits+(e.last?64:0)+(12===e.mode?128:0)+(20===e.mode||15===e.mode?256:0);(0===G&&0===M||4===d)&&0===U&&(U=-5);return U};b.inflateEnd=function(a){if(!a||!a.state)return-2;var b=a.state;b.window&&(b.window=null);a.state=null;return 0};b.inflateGetHeader=function(a,b){var c;if(!a||!a.state)return-2;c=a.state;if(0===(c.wrap&2))return-2;c.head=b;b.done=!1;return 0};b.inflateInfo="pako inflate (from Nodeca project)"},
{"../utils/common":27,"./adler32":29,"./crc32":31,"./inffast":34,"./inftrees":36}],36:[function(e,h,b){var f=e("../utils/common"),g=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],q=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],p=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,
24,25,25,26,26,27,27,28,28,29,29,64,64];h.exports=function(b,e,a,c,h,r,B,y){for(var z=y.bits,v=0,A=0,t=0,w=0,H=0,I=0,D=0,C=0,s=0,u=0,x,G,M=null,F=0,J,P=new f.Buf16(16),I=new f.Buf16(16),E=null,aa=0,Q,U,W,v=0;15>=v;v++)P[v]=0;for(A=0;A<c;A++)P[e[a+A]]++;H=z;for(w=15;1<=w&&0===P[w];w--);H>w&&(H=w);if(0===w)return h[r++]=20971520,h[r++]=20971520,y.bits=1,0;for(t=1;t<w&&0===P[t];t++);H<t&&(H=t);for(v=C=1;15>=v;v++)if(C<<=1,C-=P[v],0>C)return-1;if(0<C&&(0===b||1!==w))return-1;I[1]=0;for(v=1;15>v;v++)I[v+
1]=I[v]+P[v];for(A=0;A<c;A++)0!==e[a+A]&&(B[I[e[a+A]]++]=A);0===b?(M=E=B,J=19):1===b?(M=g,F-=257,E=l,aa-=257,J=256):(M=q,E=p,J=-1);A=u=0;v=t;z=r;I=H;D=0;G=-1;s=1<<H;c=s-1;if(1===b&&852<s||2===b&&592<s)return 1;for(var K=0;;){K++;Q=v-D;B[A]<J?(U=0,W=B[A]):B[A]>J?(U=E[aa+B[A]],W=M[F+B[A]]):(U=96,W=0);C=1<<v-D;t=x=1<<I;do x-=C,h[z+(u>>D)+x]=Q<<24|U<<16|W|0;while(0!==x);for(C=1<<v-1;u&C;)C>>=1;0!==C?(u&=C-1,u+=C):u=0;A++;if(0===--P[v]){if(v===w)break;v=e[a+B[A]]}if(v>H&&(u&c)!==G){0===D&&(D=H);z+=t;I=
v-D;for(C=1<<I;I+D<w;){C-=P[I+D];if(0>=C)break;I++;C<<=1}s+=1<<I;if(1===b&&852<s||2===b&&592<s)return 1;G=u&c;h[G]=H<<24|I<<16|z-r|0}}0!==u&&(h[z+u]=v-D<<24|4194304);y.bits=H;return 0}},{"../utils/common":27}],37:[function(e,h,b){h.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],38:[function(e,h,b){function f(a){for(var b=a.length;0<=--b;)a[b]=0}function g(a,b){a.pending_buf[a.pending++]=
b&255;a.pending_buf[a.pending++]=b>>>8&255}function l(a,b,c){a.bi_valid>16-c?(a.bi_buf|=b<<a.bi_valid&65535,g(a,a.bi_buf),a.bi_buf=b>>16-a.bi_valid,a.bi_valid+=c-16):(a.bi_buf|=b<<a.bi_valid&65535,a.bi_valid+=c)}function q(a,b,c){l(a,c[2*b],c[2*b+1])}function p(a,b){var c=0;do c|=a&1,a>>>=1,c<<=1;while(0<--b);return c>>>1}function d(a,b,c){var d=Array(16),e=0,f;for(f=1;15>=f;f++)d[f]=e=e+c[f-1]<<1;for(c=0;c<=b;c++)e=a[2*c+1],0!==e&&(a[2*c]=p(d[e]++,e))}function n(a){var b;for(b=0;286>b;b++)a.dyn_ltree[2*
b]=0;for(b=0;30>b;b++)a.dyn_dtree[2*b]=0;for(b=0;19>b;b++)a.bl_tree[2*b]=0;a.dyn_ltree[512]=1;a.opt_len=a.static_len=0;a.last_lit=a.matches=0}function a(a){8<a.bi_valid?g(a,a.bi_buf):0<a.bi_valid&&(a.pending_buf[a.pending++]=a.bi_buf);a.bi_buf=0;a.bi_valid=0}function c(a,b,c,d){var e=2*b,f=2*c;return a[e]<a[f]||a[e]===a[f]&&d[b]<=d[c]}function k(a,b,d){for(var e=a.heap[d],f=d<<1;f<=a.heap_len;){f<a.heap_len&&c(b,a.heap[f+1],a.heap[f],a.depth)&&f++;if(c(b,e,a.heap[f],a.depth))break;a.heap[d]=a.heap[f];
d=f;f<<=1}a.heap[d]=e}function r(a,b,c){var d,e,f=0,g,h;if(0!==a.last_lit){do d=a.pending_buf[a.d_buf+2*f]<<8|a.pending_buf[a.d_buf+2*f+1],e=a.pending_buf[a.l_buf+f],f++,0===d?q(a,e,b):(g=x[e],q(a,g+256+1,b),h=w[g],0!==h&&(e-=G[g],l(a,e,h)),d--,g=256>d?u[d]:u[256+(d>>>7)],q(a,g,c),h=H[g],0!==h&&(d-=M[g],l(a,d,h)));while(f<a.last_lit)}q(a,256,b)}function B(a,b){var c=b.dyn_tree,e=b.stat_desc.static_tree,f=b.stat_desc.has_stree,g=b.stat_desc.elems,h,l=-1,n;a.heap_len=0;a.heap_max=573;for(h=0;h<g;h++)0!==
c[2*h]?(a.heap[++a.heap_len]=l=h,a.depth[h]=0):c[2*h+1]=0;for(;2>a.heap_len;)n=a.heap[++a.heap_len]=2>l?++l:0,c[2*n]=1,a.depth[n]=0,a.opt_len--,f&&(a.static_len-=e[2*n+1]);b.max_code=l;for(h=a.heap_len>>1;1<=h;h--)k(a,c,h);n=g;do h=a.heap[1],a.heap[1]=a.heap[a.heap_len--],k(a,c,1),e=a.heap[1],a.heap[--a.heap_max]=h,a.heap[--a.heap_max]=e,c[2*n]=c[2*h]+c[2*e],a.depth[n]=(a.depth[h]>=a.depth[e]?a.depth[h]:a.depth[e])+1,c[2*h+1]=c[2*e+1]=n,a.heap[1]=n++,k(a,c,1);while(2<=a.heap_len);a.heap[--a.heap_max]=
a.heap[1];h=b.dyn_tree;n=b.max_code;for(var p=b.stat_desc.static_tree,q=b.stat_desc.has_stree,r=b.stat_desc.extra_bits,s=b.stat_desc.extra_base,t=b.stat_desc.max_length,u,v,w=0,g=0;15>=g;g++)a.bl_count[g]=0;h[2*a.heap[a.heap_max]+1]=0;for(e=a.heap_max+1;573>e;e++)f=a.heap[e],g=h[2*h[2*f+1]+1]+1,g>t&&(g=t,w++),h[2*f+1]=g,f>n||(a.bl_count[g]++,u=0,f>=s&&(u=r[f-s]),v=h[2*f],a.opt_len+=v*(g+u),q&&(a.static_len+=v*(p[2*f+1]+u)));if(0!==w){do{for(g=t-1;0===a.bl_count[g];)g--;a.bl_count[g]--;a.bl_count[g+
1]+=2;a.bl_count[t]--;w-=2}while(0<w);for(g=t;0!==g;g--)for(f=a.bl_count[g];0!==f;)p=a.heap[--e],p>n||(h[2*p+1]!==g&&(a.opt_len+=(g-h[2*p+1])*h[2*p],h[2*p+1]=g),f--)}d(c,l,a.bl_count)}function y(a,b,c){var d,e=-1,f,g=b[1],h=0,k=7,l=4;0===g&&(k=138,l=3);b[2*(c+1)+1]=65535;for(d=0;d<=c;d++)f=g,g=b[2*(d+1)+1],++h<k&&f===g||(h<l?a.bl_tree[2*f]+=h:0!==f?(f!==e&&a.bl_tree[2*f]++,a.bl_tree[32]++):10>=h?a.bl_tree[34]++:a.bl_tree[36]++,h=0,e=f,0===g?(k=138,l=3):f===g?(k=6,l=3):(k=7,l=4))}function z(a,b,c){var d,
e=-1,f,g=b[1],h=0,k=7,n=4;0===g&&(k=138,n=3);for(d=0;d<=c;d++)if(f=g,g=b[2*(d+1)+1],!(++h<k&&f===g)){if(h<n){do q(a,f,a.bl_tree);while(0!==--h)}else 0!==f?(f!==e&&(q(a,f,a.bl_tree),h--),q(a,16,a.bl_tree),l(a,h-3,2)):10>=h?(q(a,17,a.bl_tree),l(a,h-3,3)):(q(a,18,a.bl_tree),l(a,h-11,7));h=0;e=f;0===g?(k=138,n=3):f===g?(k=6,n=3):(k=7,n=4)}}function v(a){var b=4093624447,c;for(c=0;31>=c;c++,b>>>=1)if(b&1&&0!==a.dyn_ltree[2*c])return 0;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return 1;
for(c=32;256>c;c++)if(0!==a.dyn_ltree[2*c])return 1;return 0}function A(b,c,d,e){l(b,0+(e?1:0),3);a(b);g(b,d);g(b,~d);t.arraySet(b.pending_buf,b.window,c,d,b.pending);b.pending+=d}var t=e("../utils/common"),w=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],H=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],C=Array(576);f(C);var s=Array(60);f(s);var u=Array(512);f(u);var x=
Array(256);f(x);var G=Array(29);f(G);var M=Array(30);f(M);var F=function(a,b,c,d,e){this.static_tree=a;this.extra_bits=b;this.extra_base=c;this.elems=d;this.max_length=e;this.has_stree=a&&a.length},J,P,E,aa=function(a,b){this.dyn_tree=a;this.max_code=0;this.stat_desc=b},Q=!1;b._tr_init=function(a){if(!Q){var b,c,e,f=Array(16);for(e=c=0;28>e;e++)for(G[e]=c,b=0;b<1<<w[e];b++)x[c++]=e;x[c-1]=e;for(e=c=0;16>e;e++)for(M[e]=c,b=0;b<1<<H[e];b++)u[c++]=e;for(c>>=7;30>e;e++)for(M[e]=c<<7,b=0;b<1<<H[e]-7;b++)u[256+
c++]=e;for(b=0;15>=b;b++)f[b]=0;for(b=0;143>=b;)C[2*b+1]=8,b++,f[8]++;for(;255>=b;)C[2*b+1]=9,b++,f[9]++;for(;279>=b;)C[2*b+1]=7,b++,f[7]++;for(;287>=b;)C[2*b+1]=8,b++,f[8]++;d(C,287,f);for(b=0;30>b;b++)s[2*b+1]=5,s[2*b]=p(b,5);J=new F(C,w,257,286,15);P=new F(s,H,0,30,15);E=new F([],I,0,19,7);Q=!0}a.l_desc=new aa(a.dyn_ltree,J);a.d_desc=new aa(a.dyn_dtree,P);a.bl_desc=new aa(a.bl_tree,E);a.bi_buf=0;a.bi_valid=0;n(a)};b._tr_stored_block=A;b._tr_flush_block=function(b,c,d,e){var f,g,h=0;if(0<b.level){2===
b.strm.data_type&&(b.strm.data_type=v(b));B(b,b.l_desc);B(b,b.d_desc);y(b,b.dyn_ltree,b.l_desc.max_code);y(b,b.dyn_dtree,b.d_desc.max_code);B(b,b.bl_desc);for(h=18;3<=h&&0===b.bl_tree[2*D[h]+1];h--);b.opt_len+=3*(h+1)+14;f=b.opt_len+3+7>>>3;g=b.static_len+3+7>>>3;g<=f&&(f=g)}else f=g=d+5;if(d+4<=f&&-1!==c)A(b,c,d,e);else if(4===b.strategy||g===f)l(b,2+(e?1:0),3),r(b,C,s);else{l(b,4+(e?1:0),3);c=b.l_desc.max_code+1;d=b.d_desc.max_code+1;h+=1;l(b,c-257,5);l(b,d-1,5);l(b,h-4,4);for(f=0;f<h;f++)l(b,b.bl_tree[2*
D[f]+1],3);z(b,b.dyn_ltree,c-1);z(b,b.dyn_dtree,d-1);r(b,b.dyn_ltree,b.dyn_dtree)}n(b);e&&a(b)};b._tr_tally=function(a,b,c){a.pending_buf[a.d_buf+2*a.last_lit]=b>>>8&255;a.pending_buf[a.d_buf+2*a.last_lit+1]=b&255;a.pending_buf[a.l_buf+a.last_lit]=c&255;a.last_lit++;0===b?a.dyn_ltree[2*c]++:(a.matches++,b--,a.dyn_ltree[2*(x[c]+256+1)]++,a.dyn_dtree[2*(256>b?u[b]:u[256+(b>>>7)])]++);return a.last_lit===a.lit_bufsize-1};b._tr_align=function(a){l(a,2,3);q(a,256,C);16===a.bi_valid?(g(a,a.bi_buf),a.bi_buf=
0,a.bi_valid=0):8<=a.bi_valid&&(a.pending_buf[a.pending++]=a.bi_buf&255,a.bi_buf>>=8,a.bi_valid-=8)}},{"../utils/common":27}],39:[function(e,h,b){h.exports=function(){this.input=null;this.total_in=this.avail_in=this.next_in=0;this.output=null;this.total_out=this.avail_out=this.next_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}},{}]},{},[9])(9)});
function number_format(m,e,h,b){m=(m+"").replace(/[^0-9+\-Ee.]/g,"");m=isFinite(+m)?+m:0;e=isFinite(+e)?Math.abs(e):0;b="undefined"===typeof b?",":b;h="undefined"===typeof h?".":h;var f="",f=function(b,e){var f=Math.pow(10,e);return""+Math.round(b*f)/f},f=(e?f(m,e):""+Math.round(m)).split(".");3<f[0].length&&(f[0]=f[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,b));(f[1]||"").length<e&&(f[1]=f[1]||"",f[1]+=Array(e-f[1].length+1).join("0"));return f.join(h)}
function findChildNode(m,e,h){var b=[];for(m=m?m.firstElementChild:null;m;)m.localName===h&&m.namespaceURI===e&&b.push(m),m=m.nextElementSibling;return b}
var gformats2=[["svg","image/svg+xml"],["pdf","application/pdf"],["gif","image/gif"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["png","image/png"],["bmp","image/bmp"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["htm","text/html"],["html","text/html"],["txt","text/plain"],["text","text/plain"],["odt","application/vnd.oasis.opendocument.text"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],
["odp","application/vnd.oasis.opendocument.presentation"],["xls","application/vnd.ms-excel"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["csv","text/csv"],["tsv","text/tab-separated-values"]];function getmimetype2(m){m=(m||"").split(".");m=m[m.length-1].toLowerCase();for(var e=0;e<=gformats2.length-1;e++)if(gformats2[e][0]==m)return gformats2[e][1]};
